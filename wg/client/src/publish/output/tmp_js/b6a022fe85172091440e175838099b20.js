SetTradingAreaDlg=Class.extern(function(){var a=null,b=null,c=null,d={},e=[],f=!1,g=4,h=[];this.init=function(c){b=c,a=this,b.regEvent(EVT.NET,NETCMD.TRADING_AREA,a,o)},this.openDlg=function(a,b){i(a,b),j(),m(),n()};var i=function(a,b){f=!1,g=a,h=b},j=function(){if(c)return;k(),l()},k=function(){c=Dialog.snew(b,{modal:!0,title:rstr.alli.settradingareadlg.title,pos:{x:"center",y:40}}),b.getGUI().initDlg(c,uicfg.alli.settradingareadlg,d)},l=function(){d.list.setCaller({self:a,caller:C}),d.autoSelBtn.setCaller({self:a,caller:D}),d.allCancelBtn.setCaller({self:a,caller:E}),d.saveSelBtn.setCaller({self:a,caller:F})},m=function(){c.show()},n=function(){TradingAreaSender.sendGetMembers(b)},o=function(a){if(!a.data.mems)return;TQ.dictCopy(e,a.data.mems),e.sort(function(a,b){return a.distance-b.distance}),p()},p=function(){if(!c||!c.isShow())return;q(),r(),t()},q=function(){d.list.setItemCount(e.length);for(var a=0;a<e.length;++a){var b=d.list.getItem(a),c=e[a];TQ.setTextEx(b.exsubs.no,a+1),TQ.setTextEx(b.exsubs.roleName,c.roleName);var f=FieldUtil.getPosByGridId(c.gridId);TQ.setTextEx(b.exsubs.cood,"("+f.x+","+f.y+")"),TQ.setTextEx(b.exsubs.buildLevel,c.buildLevel),TQ.setTextEx(b.exsubs.distance,c.distance)}},r=function(){if(f)return;f=!0,s();for(var a=0;a<h.length;++a){var b=h[a];if(!TQ.find(e,"roleName",b))continue;z(TQ.getLastFindIdx())}},s=function(){for(var a=0;a<e.length;++a){var b=d.list.getItem(a);b.exsubs.sel.setCheck(0)}},t=function(){TQ.setTextEx(d.cityNumber,u()+"/"+g),TQ.setTextEx(d.totalDis,v()),TQ.setTextEx(d.needTime,w()),TQ.setTextEx(d.gain,x()+" "+rstr.comm.money)},u=function(){return y(function(a){return 1})},v=function(){return y(function(a){return e[a].distance})},w=function(){return y(function(a){return e[a].needTime?e[a].needTime:0})},x=function(){return y(function(a){return e[a].gain?e[a].gain:0})},y=function(a){var b=0;for(var c=0;c<e.length;++c){if(!B(c))continue;b+=a(c)}return b},z=function(a){if(u()>=g){b.getGUI().sysMsgTips(SMT_WARNING,rstr.alli.settradingareadlg.tip.maxCount);return}d.list.getItem(a).exsubs.sel.setCheck(1),e[a].isDetail||TradingAreaSender.sendGetMemDetail(b,e[a].roleId)},A=function(a){d.list.getItem(a).exsubs.sel.setCheck(0)},B=function(a){return d.list.getItem(a).exsubs.sel.getCheck()==1},C=function(a,b){var c=d.list.getItem(b);if(!c)return;var e=!B(b);e?z(b):A(b),t()},D=function(){s();for(var a=0;a<e.length&&a<g;++a)z(a);t()},E=function(){s(),t()},F=function(){if(u()==0){b.getGUI().sysMsgTips(SMT_WARNING,rstr.alli.settradingareadlg.tip.noSelected);return}TradingAreaSender.sendSetTradingArea(b,G()),c.hide()},G=function(){var a=[];return y(function(b){return a.push(e[b].roleId),1}),a}})