BuildingOpMgr=Class.extern(function(){var a=null,b=null,c=null,d=[];this.init=function(e){a=e,b=this,c=BuildingInfoNullOpHdr.snew(a),d[ALLBUILDSGROUP_TYPE.CITY]=BuildingInfoCityOpHdr.snew(a),d[ALLBUILDSGROUP_TYPE.ALLI]=BuildingInfoAlliOpHdr.snew(a),d[ALLBUILDSGROUP_TYPE.CULTURE]=BuildingInfoCultureOpHdr.snew(a)},this.getStateName=function(b,c){var d=a.getImgr().getTypeInAllBuildsGroup(c);return e(d).getStateName(b)},this.opSpeed=function(b,c){var d=a.getImgr().getTypeInAllBuildsGroup(c);e(d).opSpeed(b)},this.opCancel=function(b,c){var d=a.getImgr().getTypeInAllBuildsGroup(c);e(d).opCancel(b)};var e=function(a){var b=d[a];return b?b:c}}),BuildingInfoNullOpHdr=Class.extern(function(){this.opSpeed=function(a){},this.opCancel=function(a){},this.getStateName=function(a){return""}}),BuildingInfoCityOpHdr=Class.extern(function(){this.opSpeed=function(a){UIM.getPanel("inbuild").opSpeed(a)},this.opCancel=function(a){UIM.getPanel("inbuild").opCancel(a)},this.getStateName=function(a){return a.level==0?rstr.comm.buildstates[BUILD_STATE.BUILD]:rstr.comm.buildstates[a.state]}}),BuildingInfoAlliOpHdr=Class.extern(function(){this.opSpeed=function(a){},this.opCancel=function(a){},this.getStateName=function(a){return a.level==0?rstr.comm.buildstates[BUILD_STATE.BUILD]:rstr.comm.buildstates[a.state]}}),BuildingInfoCultureOpHdr=Class.extern(function(){this.opSpeed=function(a){UIM.getDlg("culture").opSpeed(a)},this.opCancel=function(a){UIM.getDlg("culture").opCancel(a)},this.getStateName=function(a){return rstr.comm.buildstates[BUILD_STATE.LEARNSKILL]}}),BuildingInfoDlg=Class.extern(function(){var a=null,b=null,c=null,d={},e=null,f=null;this.init=function(c){a=c,b=this,f=BuildingOpMgr.snew(c)},this.openDlg=function(){g(),h(),c.show(),a.regUpdater(b,i,1e3)},this.hideDlg=function(){c&&c.hide()};var g=function(){c||(c=Dialog.snew(a,{modal:!1,title:rstr.inbuild.buildinfo.title,pos:{x:"center",y:60}}),a.getGUI().initDlg(c,uicfg.inbuild.buildinginfo,d),c.setCaller({self:b,caller:j}),e=CommBuildUpdater.snew(a,{list:d.list,rgroupList:a.getImgr().getAllBuildsGroup(),opspeed:f.opSpeed,opcancel:f.opCancel,getStateName:f.getStateName,needitems:["name","state","curlevel","goallevel","lefttime","opbtn"]}),c.hide())},h=function(){e.update()},i=function(a){e.update()},j=function(c){c==C_SYS_DLG_HIDE&&a.unregUpdater(b,i)}}),BuildingTraceDlg=Class.extern(function(){var a,b,c,d={},e=null,f={x:600,y:40};this.init=function(c){a=c,b=this},this.openDlg=function(){g(),c.show(),e.show(),i()},this.closeDlg=function(){c.hide()},this.setPosition=function(a){h(a),i()},this.getSize=function(){return{cx:274,cy:160}},this.getCore=function(){return c};var g=function(){c||(c=Dialog.snew(a,{modal:!1,pos:{x:600,y:40},uiback:uiback.dlg.minihelp}),a.getGUI().initDlg(c,uicfg.tracedlg.building,d),e=new IBuildTrace(a,d),d.closebtn.setCaller({self:b,caller:function(){c.hide()}}),c.setCaller({self:b,caller:j}))},h=function(a){f=a},i=function(){if(!c||!c.isShow())return;c.setPosition(f)},j=function(a){a==C_SYS_DLG_HIDE&&UIM.getPanel("main")&&(UIM.getPanel("main").notifyTraceClose("building"),e.hide())}}),IBuildTrace=function(){var a,b,c,d,e=null;this.initialize=function(f,g){a=f,b=this,c=g,e=BuildingOpMgr.snew(f),d=CommBuildUpdater.snew(a,{list:c.list,firststatefmt:rstr.inbuild.buildstate,statefmt:rstr.inbuild.state,rgroupList:a.getImgr().getAllBuildsGroup(),opspeed:e.opSpeed,opcancel:e.opCancel,needitems:["stop","name","state","levelstate","lefttime","opbtn"]})},this.show=function(){a.regUpdater(b,f,1e3)},this.hide=function(){a.unregUpdater(b,f)};var f=function(a){d.update()};this.initialize.apply(this,arguments)}