CreateRoleDlg=Class.extern(function(){var a,b,c,d={},e=!1,f="",g={cx:2048,cy:1536},h=500;this.init=function(c){a=c,b=this,a.regEvent(EVT.NET,NETCMD.CREATEROLE,b,v)},this.openDlg=function(){i(),r(),s(),g_loading.hide(),SoundMgr.playBackSound(res_baksounds.createRole)},this.resize=function(a){if(!j())return;var b=(a.cx-g.cx)/2;c.setPosition({x:b,y:0})};var i=function(){if(c)return;k(),l(),m(),o(),q()},j=function(){return c?c.isShow():!1},k=function(){c=Dialog.snew(a,{modal:!1,pos:{x:"center",y:0},uiback:uiback.dlg.noborder}),a.getGUI().initDlg(c,uicfg.createrole,d)},l=function(){d.randName.setType(BTN_TYPE.DELAY),d.randName.setDelay(h)},m=function(){d.list.setCaller({self:b,caller:z}),d.entergame.setCaller({self:b,caller:B}),d.randName.setCaller({self:b,caller:A}),n()},n=function(){for(var a=0;a<d.list.getCount();++a){var c=d.list.getItem(a);c.exsubs.selectIcon.setId(a),c.exsubs.selectIcon.setCaller({self:b,caller:C})}},o=function(){for(var a=0;a<d.list.getCount();++a){var b=d.list.getItem(a),c=Math.floor(Math.random()*res_role_icons.length),e=res_role_icons[c].icon[a];p(b,e)}},p=function(a,b){a.exsubs.iconId=b;var c=ItemResUtil.findItemres(a.exsubs.iconId);IMG.setBKImage(a.exsubs.icon,IMG.makeBigImg(c.bigpic))},q=function(){InputLimit.maxGBKBytes(d.rolename,JVALID.getMaxUserLen(),Caller.snew(b,u))},r=function(){d.list.setCurSel(0),TQ.setTextEx(d.namedesc,TQ.formatColorStr(rstr.createroledlg.err.empty,COLORS.INVALID_ROLE_NAME))},s=function(){c.show()},t=function(){e=!1;var b=UnicodeStr.gbkLen(d.rolename.value);b==0?TQ.setTextEx(d.namedesc,TQ.formatColorStr(rstr.createroledlg.err.empty,COLORS.INVALID_ROLE_NAME)):b<JVALID.getMinUserLen()||b>JVALID.getMaxUserLen()?TQ.setTextEx(d.namedesc,TQ.formatColorStr(rstr.createroledlg.err.errlength,COLORS.INVALID_ROLE_NAME)):JVALID.checkUsername(d.rolename.value)?CreateRoleSender.sendCheckName(a,d.rolename.value):TQ.setTextEx(d.namedesc,TQ.formatColorStr(rstr.createroledlg.err.invalidchar,COLORS.INVALID_ROLE_NAME))},u=function(){f!=d.rolename.value&&(f=d.rolename.value,t())},v=function(a){var c=a.data;c.subid==0?b.openDlg():c.subid==1?w(c):c.subid==2?x(c.randname):c.subid==99&&y(c)},w=function(a){e=!1,a.result=="OK"?(TQ.setTextEx(d.namedesc,TQ.formatColorStr(rstr.createroledlg.err.okname,COLORS.VALID_ROLE_NAME)),e=!0):(TQ.setTextEx(d.namedesc,TQ.formatColorStr(a.result,COLORS.INVALID_ROLE_NAME)),d.entergame.enable(!0))},x=function(b){d.rolename.value=b,CreateRoleSender.sendCheckName(a,b)},y=function(b){b.result==0?(c.hide(),a.getImgr().setFirstCreateGame(!0)):d.entergame.enable(!0)},z=function(a,b){for(var c=0;c<d.list.getCount();++c)c==b?d.list.getItem(c).exsubs.selectIcon.show():d.list.getItem(c).exsubs.selectIcon.hide()},A=function(){CreateRoleSender.sendGetRandName(a,d.list.getCurSel())},B=function(){e&&(CreateRoleSender.sendCreateRole(a,d.rolename.value,D()),d.entergame.enable(!1))},C=function(a){var c=d.list.getItem(a),e=function(a){p(c,a)},f=UIM.getDlg("selecticon");f.setCaller({self:b,caller:e});var g=[];for(var h=0;h<res_role_icons.length;++h)g.push(res_role_icons[h].icon[a]);f.openDlg(g,c.exsubs.iconId)},D=function(){var a=d.list.getCurSel();return d.list.getItem(a).exsubs.iconId}})