RedDot=JClass.ex({init:function(a){this.g_=a,this.actValCanGetOrSignChecker_=ActivityValCanGetOrSignChecker.snew(this.g_),this.activityValTaskUtil_=ActivityValTaskUtil.snew(this.g_),this._regEvents()},_regEvents:function(){this.g_.regUpdater(this,this._onUpdate,3e4),this.g_.regEvent(EVT.LETTERUPDATE,0,this,this._onLetterUpdate),this.g_.regEvent(EVT.PKG_CHANGE,0,this,this._onItemChanged),this.g_.regEvent(EVT.AUTOBUILD,0,this,this._onAutoBuild),this.g_.regEvent(EVT.ROLEBASE,0,this,this._onRoleAttrChanged),this.g_.regEvent(EVT.TASKCHANGE,0,this,this._onTaskChanged),this.g_.regEvent(EVT.TASKCHANGE,1,this,this._onTaskChanged),this.g_.regEvent(EVT.TASKCHANGE,2,this,this._onTaskChanged),this.g_.regEvent(EVT.ROLEBASE,0,this,this._onTaskChanged),this.g_.regEvent(EVT.FARMINFO,2,this,this._onFarmInfo),this.g_.regEvent(EVT.ACTIVITY_VAL,0,this,this._onActivityValChange),this.g_.regEvent(EVT.UPD_ACT_VAL_REDDOT,0,this,this._onActivityValChange),this.g_.regEvent(EVT.PERSONAL_ARMY_UPDATE,0,this,this._onArmys),this.g_.regEvent(EVT.SALLIANCE_ARMY_UPDATE,0,this,this._onArmys)},_onUpdate:function(){this._onActivityValChange()},_onLetterUpdate:function(){var a=this.g_.getImgr().getLetterRes().all,b=!1;for(var c=0;c<a.length;++c)if(a[c].read==0){b=!0;break}var d=UIM.getPanel("main").getSmallMapBtnBar().getBtn("letter");d.setNewFlag(b)},_onItemChanged:function(){var a=UIM.getDlg("exchange").hasCanExChangeItem(0)||UIM.getDlg("exchange").hasCanExChangeItem(1),b=UIM.getDlg("package").getCtrl("exchangebtn");b&&b.setNewFlag(a)},_onAutoBuild:function(){var a=UIM.getPanel("main").getTraceBar().getBtn("autobuild"),b=this.g_.getImgr().getAutoBuild(),c=b.max>0&&(b.starting==0||b.list.length==0);a.setNewFlag(c)},_onRoleAttrChanged:function(){var a=UIM.getPanel("main").getToolbar().getBtn("role");a.setNewFlag(this.g_.getImgr().getRoleAttrVal(ATTR.PP)>0)},_onTaskChanged:function(){var a=UIM.getPanel("main").getToolbar().getBtn("task");a.setNewFlag(UIM.getDlg("task").hasCanGetGifts())},_onFarmInfo:function(){var a=!1,b=this.g_.getImgr().getMyFarm();for(var c=0;c<b.blocks.length;++c){var d=b.blocks[c];if(d.resid==FIXID.EMPTYFARMBLOCK)continue;if(d.resid==FIXID.NEXTFARMBLOCK)continue;if(d.state==FARM_STATE.COMPLETE){a=!0;break}}var e=UIM.getPanel("main").getSelCityTool().getBtn("myfarm");e.setNewFlag(a)},_onActivityValChange:function(){var a=UIM.getPanel("main").getTraceBar().getBtn("act");a.setNewFlag(this.actValCanGetOrSignChecker_.hasCanGetReward()||this.actValCanGetOrSignChecker_.hasCanSign()||this.actValCanGetOrSignChecker_.hasCanGetSignReward()||this.activityValTaskUtil_.hasRedDot())},_onArmys:function(){var a=this.g_.getImgr().getArmys().list,b=this.g_.getImgr().getArmys().samealli,c=UIM.getPanel("main").getToolbar().getBtn("military");c.setNewFlag(a.length>0||b.length>0)}})