NoBindPkgClassifyItems=BaseClassifyItems.ex({_initClassItems:function(){this.classitems_=[{classid:RES_CLS.PKGITEM,items:[]},{classid:RES_CLS.EQUIPITEM,items:[]},{classid:RES_CLS.CANUSEITEM,items:[]},{classid:RES_CLS.OTHERITEM,items:[]}]},_getItems:function(){return this.g_.getImgr().getPkgs().items},_isSatisfiedBy:function(a,b){return this._isInRange(a,b)&&!b.isBind&&!b.itemres.isbind},_sortFun:function(a,b){return a.resid-b.resid}}),AlliMySellDlg=JBaseDlg.ex({_innerInit:function(){this.curSelItemId_=-1,this.itemsClassify_=NoBindPkgClassifyItems.snew(this.g_),this.g_.regEvent(EVT.PKG_CHANGE,0,this,this._onItemsChange),this.g_.regEvent(EVT.SELLING_ITEMS,0,this,this._onSellingItems)},_getDlgCfg:function(){return{modal:!1,title:rstr.alli.myselldlg.title,pos:{x:"center",y:40},uicfg:uicfg.alli.myselldlg}},_setCallers:function(){for(var a=0;a<this.items_.pkgTabs.getTabCount();++a){var b=this.items_.pkgTabs.getTabItems(a).list;b.setCaller({self:this,caller:this._onSelectItem})}this.items_.inumber.setLimitCaller({self:this,caller:this._onGetNumberLimit}),this.items_.sellBtn.setCaller({self:this,caller:this._onClickSellBtn})},_afterCreate:function(){this._setTabsText()},_initInfo:function(){AllianceSender.sendGetSellItems(this.g_),this.items_.pkgTabs.activeTab(0),this._updatePkgTabList(),this._updateCurSelItem(),this._updateSellingItems()},_setTabsText:function(){for(var a=0;a<rstr.alli.myselldlg.tabs.length;++a)this.items_.pkgTabs.setTabText(a,rstr.alli.myselldlg.tabs[a])},_updatePkgTabList:function(){if(!this.isShow())return;this.itemsClassify_.refresh();for(var a=0;a<this.items_.pkgTabs.getTabCount();++a){var b=this.items_.pkgTabs.getTabItems(a).list,c=this.itemsClassify_.getClassItems(a).items;b.setItemCount(c.length);for(var d=0;d<b.getCount();++d){var e=b.getItem(d),f=c[d];CommDrawItem.drawIconAndNumber(e,f,!0),TTIP.setCallerData(e.exsubs.tooltips.$item,{self:this,caller:this._onGetTooltip},{tabIdx:a,listIdx:d})}}},_updateCurSelItem:function(){if(!this.isShow())return;var a=this.imgr_.getItemById(this.curSelItemId_);if(!a){this._clearCurSelItem();return}CommDrawItem.drawItemIcon(this.items_.icon,a.itemres),TQ.setRichText(this.items_.num,a.number),TQ.setRichText(this.items_.itemDesc,a.itemres.desc)},_updateSellingItems:function(){if(!this.isShow())return;var a=this.imgr_.getSellingItems();this.items_.sellingList.setItemCount(a.length);for(var b=0;b<this.items_.sellingList.getCount();++b){var c=this.items_.sellingList.getItem(b),d=a[b];CommDrawItem.drawIconAndNumber(c,d,!0),TQ.setRichText(c.exsubs.curPrice,d.cur),TQ.setRichText(c.exsubs.fixedPrice,d.fixed),TQ.setRichText(c.exsubs.state,rstr.alli.myselldlg.lbl.auctionStates[this._getSellingItemState(d)]);var e=d.stopTime-this.g_.getSvrTimeS();TQ.setRichText(c.exsubs.leftTime,AlliAuctionLeftTimeState.getLeftTimeState(this.g_,d.stopTime)),TTIP.setCallerData(c.exsubs.tooltips.$item,{self:this,caller:this._onGetSellingItemTooltip},{idx:b}),c.exsubs.cancelBtn.enable(this._getSellingItemState(d)==0),c.exsubs.cancelBtn.setId(b),c.exsubs.cancelBtn.setCaller({self:this,caller:this._onClickCancelSellBtn})}},_clearCurSelItem:function(){IMG.setBKImage(this.items_.icon,""),TQ.setClass(this.items_.icon,""),TQ.setRichText(this.items_.num,""),TQ.setRichText(this.items_.itemDesc,""),this.items_.iauctionPrice.setVal(0),this.items_.ifixedPrice.setVal(0)},_onGetTooltip:function(a){var b=this.itemsClassify_.getItem(a.tabIdx,a.listIdx);return TIPM.getItemDesc(b)},_onGetSellingItemTooltip:function(a){var b=this.imgr_.getSellingItems(),c=b[a.idx];return TIPM.getItemDesc(c,"sys")},_onSelectItem:function(a,b){var c=this.items_.pkgTabs.getActiveTab();this.curSelItemId_=this.itemsClassify_.getItem(c,b).id,this.items_.inumber.setVal(1),this._clearCurSelItem(),this._updateCurSelItem()},_onGetNumberLimit:function(){var a=this.imgr_.getItemById(this.curSelItemId_);return a?{min:0,max:a.number}:{min:0,max:0}},_onClickSellBtn:function(){var a=this.imgr_.getItemById(this.curSelItemId_);if(!a){this.g_.getGUI().sysMsgTips(SMT_WARNING,rstr.alli.myselldlg.tip.canNotSelectItemId);return}var b=this.items_.inumber.getVal();if(b<=0){this.g_.getGUI().sysMsgTips(SMT_WARNING,rstr.alli.myselldlg.tip.canNotInputNumber);return}var c=this.items_.iauctionPrice.getVal();if(c<=0){this.g_.getGUI().sysMsgTips(SMT_WARNING,rstr.alli.myselldlg.tip.notInputAuctionPrice);return}var d=this.items_.ifixedPrice.getVal();if(d<=c){this.g_.getGUI().sysMsgTips(SMT_WARNING,rstr.alli.myselldlg.tip.notInputFixedPrice);return}AllianceSender.sendSellItem(this.g_,this.curSelItemId_,b,c,d)},_onClickCancelSellBtn:function(a){var b=this.imgr_.getSellingItems();AllianceSender.sendCancelSellItem(this.g_,b[a].id)},_onItemsChange:function(){this._updatePkgTabList(),this._updateCurSelItem()},_onSellingItems:function(){this._updateSellingItems()},_getSellingItemState:function(a){var b=0;return a.doing==0&&this.g_.getSvrTimeS()<=a.stopTime?b=0:this.g_.getSvrTimeS()>a.stopTime?b=2:b=1,b}})