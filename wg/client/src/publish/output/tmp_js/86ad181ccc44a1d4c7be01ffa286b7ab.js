C_SYS_DLG_HIDE=-20,C_SYS_CLOSEBTN_ID=-1,C_SYS_HELPBTN_ID=-2,C_SYS_DLG_SEPARATOR=-30,Dialog=Class.extern(function(){var a=5,b=20;this.init=function(a,b){TQ.isMobile()&&(W=uiback.mb.commdlg,Z={mdlg:"mb-ui-mdlg",dlg:"mb-ui-dlg"}),D=a,H=this,T=b,T.uiback&&(W=T.uiback,W.commclass&&TQ.dictCopy(Z,W.commclass)),fb=W.dragTitleH,W.canDrag&&(gb=W.canDrag),T.helpid&&($=T.helpid);var d=T.btns&&T.btns.length>0;!d&&W.nbtn_cls&&(W={type:W.type,cls:W.nbtn_cls}),T.zIndex?cb=T.zIndex:T.modal?cb=UI_ZORDER_MDLG:cb=UI_ZORDER_DLG,db=T.fixzIndex?!0:!1,Y=D.getGUI(),c()},this.uiClass=function(){return"Dialog"},this.getZIndex=function(){return parseInt(F.style.zIndex,10)},this.setZIndex=function(a){TQ.setCSS(F,"zIndex",a),db&&(cb=a)},this.show=function(a){U=!0,TQ.setCSS(F,"visibility","visible");var b=T.pos.x,c=T.pos.y;a&&(b=a.x,c=a.y),u(b,c),db?TQ.setCSS(F,"zIndex",cb):Y.upDlg(cb,H)},this.setPosition=function(a){u(a.x,a.y)},this.hide=function(){U=!1,F.style.zIndex=-9e5,TQ.setCSS(F,"visibility","hidden"),TQ.setCSS(G,"left","-1000000px"),TQ.setCSS(G,"top","-1000000px"),C(C_SYS_DLG_HIDE)},this.isShow=function(){return U},this.setTitle=function(a){TQ.setHtml(K,a)},this.getTitle=function(){return TQ.getTextEx(K)},this.getConDom=function(){return M},this.setContent=function(a){TQ.setHtml(M,a)},this.getId=function(){return E},this.getDom=function(){return F},this.addBtn=function(c,d){if(c.id==C_SYS_DLG_SEPARATOR){var e=TQ.createDom("div");TQ.setDomWidth(e,b),TQ.setDomHeight(e,10),TQ.setCSS(e,"float","left"),TQ.append(O,e),R.push(e)}else{var f=new ComButton(D,O,{uiback:uiback.btn.dlgbtn});f.setText(c.text),f.setId(c.id),f.setCaller(d),P.push(f);var g=TQ.createDom("div");TQ.setDomWidth(g,a),TQ.setDomHeight(g,10),TQ.setCSS(g,"float","left"),TQ.append(O,g),Q.push(g)}t()},this.setCaller=function(a){a&&!d(a)&&X.push(a)},this.unsetCaller=function(a){TQ.find(X,null,a)&&TQ.removeElement(X,TQ.getLastFindIdx())},this.getBtns=function(){return P},this.refresh=function(){A(),z(),w(),t(),x(),v(),B()},this.refreshBtn=function(){t(),x()},this.refreshBack=function(){v()},this.refreshTitle=function(){w()},this.changeParent=function(a){_&&_!=a&&(TQ.remove(_,F),TQ.append(a,F),_=a)},this.getSysCloseBtn=function(){return S.length>0?S[0]:null},this.getSize=function(){return{cx:TQ.getDomWidth(G),cy:TQ.getDomHeight(G)}},this.setSize=function(a){TQ.setDomWidth(G,a.cx),TQ.setDomHeight(G,a.cy),v()},this.getId=function(){return E},this.getPosition=function(){return{x:eb.x,y:eb.y}},this.getParent=function(){return _},this.setUpCaller=function(a){jb=a};var c=function(){E="tqdlg_"+Y.allocDlgId();var a=e(T);a=f(a,T),g(a,T),h(a,T),i(a,T),y(),j()},d=function(a){for(var b=0;b<X.length;++b)if(X[b].self==a.self&&X[b].caller==a.caller)return!0;return!1},e=function(a){var b=TQ.getUiBody();_=b;var c=b;if(a.modal){F=TQ.createDom("div"),TQ.setClass(F,Z.mdlg),TQ.setCSS(F,"visibility","hidden"),TQ.append(c,F),TQ.setCSS(F,"zIndex",cb),c=F;var d=TQ.createDom("div");TQ.append(c,d),TQ.setClass(d,"ui-overlay-dlg"),TQ.setAttr(d,"unselectable","on")}return c},f=function(a,b){var c=TQ.createDom("div");return b.modal||(F=c,TQ.setCSS(F,"zIndex",UI_ZORDER_DLG)),b.zIndex&&TQ.setCSS(F,"zIndex",b.zIndex),b.modal?TQ.setClass(c,"ui-panel-dlg"):TQ.setClass(c,Z.dlg),TQ.append(a,c),b.width?TQ.setDomWidth(c,b.width):TQ.setDomWidth(c,"auto"),G=c,a=c,a},g=function(a,b){if(b.title){I=TQ.createDom("div"),TQ.setClass(I,"ui-titlebar"),TQ.setAttr(I,"unselectable","on"),TQ.append(a,I),J=TQ.createDom("div"),TQ.setClass(J,"ui-titleprespace"),TQ.append(I,J),K=TQ.createDom("div"),TQ.setClass(K,"ui-titletext"),TQ.setAttr(K,"unselectable","on"),TQ.append(I,K),L=TQ.createDom("div"),TQ.setClass(L,"ui-titlebtn"),TQ.append(I,L);var c=null;TQ.isMobile()?c=uiback.mb.closebtn1:c=uiback.btn.dlgclose;var d=new ComButton(D,L,{uiback:c});d.setId(C_SYS_CLOSEBTN_ID),d.setCaller({self:H,caller:s}),S.push(d);if($>0){var e=new ComButton(D,L,{uiback:uiback.btn.dlghelp});e.setId(C_SYS_HELPBTN_ID),e.setCaller({self:H,caller:s}),S.push(e)}TQ.setHtml(K,b.title)}},h=function(a,b){M=TQ.createDom("div"),TQ.append(a,M),TQ.setClass(M,"ui-content")},i=function(a,b){if(b.btns!=null){ab=TQ.createDom("div"),TQ.append(a,ab),TQ.setClass(ab,"ui-btns"),N=TQ.createDom("div"),TQ.append(ab,N),TQ.setClass(N,"ui-btnbarspace"),O=TQ.createDom("div"),TQ.append(ab,O),TQ.setClass(O,"ui-dlg-btn");for(var c in b.btns){var d=b.btns[c];H.addBtn(d.btn,d.caller)}}},j=function(a){if(T.canDrag==0)return;if(isNull(T.canDrag)&&gb==0)return;TQ.addEvent(H.getDom(),"dragstart",function(){return!1}),TQ.addEvent(H.getDom(),"selectstart",function(){return!1}),TQ.captureMouseEvent(H.getDom(),{self:H,isCanCapture:k,mouseDown:n,mouseMove:o}),TQ.captureTouchEvent(H.getDom(),{self:H,isCanCapture:k,touchStart:l,touchMove:m})},k=function(a){var b=0;fb&&(b=fb),T.dragTitleH&&(b=T.dragTitleH);if(b==0)return!0;var c=TQ.mouseCoords(a),d=H.getPosition();return c.y-d.y<b&&c.y-d.y>=0},l=function(a,b,c){var d=TQ.makeMouseEvent(b.pageX,b.pageY,BTN_LEFT,c);p(TQ.mouseCoords(d))},m=function(a,b,c){var d=TQ.makeMouseEvent(b.pageX,b.pageY,BTN_LEFT,c);q(TQ.mouseCoords(d))},n=function(a){p(TQ.mouseCoords(a))},o=function(a){q(TQ.mouseCoords(a))},p=function(a){r(),hb=a,ib=H.getPosition()},q=function(a){log("x:"+a.x+", y:"+a.y);var b=D.getWinSizer().getValidClientSize();a.x=Math.clamp(a.x,0,b.cx),a.y=Math.clamp(a.y,0,b.cy);var c={x:a.x-hb.x,y:a.y-hb.y},d={x:ib.x+c.x,y:ib.y+c.y};H.setPosition(d)},r=function(){if(T.modal)return;Y.upDlg(UI_ZORDER_DLG,H),jb.invoke()},s=function(a){if(a==C_SYS_CLOSEBTN_ID){var b=C(C_SYS_CLOSEBTN_ID);b||H.hide()}else a==C_SYS_HELPBTN_ID&&D.pendEvent({eid:EVT.SHOWHELPBYID,sid:0,pendtime:1,helpid:$})},t=function(){if(ab){var c=0;for(var d in P){var e=P[d],f="none";e.isShow()&&(c+=e.getWidth()+a,f="block"),TQ.setCSS(Q[d],"display",f)}c=c+R.length*b+TQ.getIe6DrtW(),TQ.setDomWidth(O,c)}},u=function(a,b){a==="center"?eb.x=(TQ.getDomWidth(_)-TQ.getDomWidth(G))/2:a==="left"?eb.x=0:a==="right"?eb.x=TQ.getDomWidth(_)-TQ.getDomWidth(G):eb.x=a,b==="top"?eb.y=0:b=="vcenter"?eb.y=(TQ.getDomHeight(_)-TQ.getDomHeight(G))/2:b=="bottom"?eb.y=TQ.getDomHeight(_)-TQ.getDomHeight(G):eb.y=b,TQ.setCSS(G,"left",eb.x+"px"),TQ.setCSS(G,"top",eb.y+"px")},v=function(){if(W.type>=0){var a=TQ.getDomWidth(G),b=TQ.getDomHeight(G);Y.setUIBack(V,a,b,W.type)}},w=function(){if(I){var a=TQ.getDomWidth(G);TQ.setDomWidth(I,a),TQ.setDomWidth(K,a-TQ.getDomOutWidth(L)-TQ.getDomWidth(J))}},x=function(){if(ab){var a=TQ.getDomWidth(G);TQ.setDomWidth(ab,a),TQ.setDomHeight(N,TQ.getDomHeight(O)),TQ.setDomWidth(N,a-TQ.getDomOutWidth(O))}},y=function(){V&&(TQ.remove(G,V),TQ.deleteDom(V),V=null);if(!V&&W&&W.type>=0){var a=T.nofixpng?!0:!1;V=Y.createPanelUIBack(G,W,a)}},z=function(){if(!T.width&&M.firstChild&&M.firstChild.tagName.toLowerCase()=="div"){var a=TQ.getDomMarginWidth(M),b=a+TQ.getDomWidth(M.firstChild);TQ.isIE6()&&TQ.setCSS(G,"overflow","hidden"),TQ.setDomWidth(M,TQ.getDomWidth(M.firstChild)),TQ.setDomWidth(G,b)}},A=function(){TQ.isIE6()&&(bb=TQ.curCSS(G,"overflow"),bb||(bb="visible"))},B=function(){TQ.isIE6()&&TQ.setCSS(G,"overflow",bb)},C=function(a){if(X.length==0)return;var b=!1;for(var c=X.length-1;c>=0;--c){var d=X[c],e=d.caller.call(d.self,a);b||(b=e?!0:!1)}return b},D=null,E="",F=null,G=null,H=null,I=null,J=null,K=null,L=null,M=null,N=null,O=null,P=[],Q=[],R=[],S=[],T=null,U=!0,V=null,W=uiback.dlg.comm,X=[],Y,Z={mdlg:"ui-mdlg",dlg:"ui-dlg"},$=0,_,ab,bb="visible",cb,db=!1,eb={x:-1,y:-1},fb=0,gb=!1,hb={x:0,y:0},ib={x:0,y:0},jb=NullCaller})