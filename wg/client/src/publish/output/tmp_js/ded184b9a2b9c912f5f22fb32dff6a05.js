UIM=Class.extern(function(){var a,b,c={},d={},e=[],f={},g={},h=null,i={};this.init=function(){b=this,h=Caller.snew(this,this._onDlgOpen)},this.initOneTime=function(b){a=b,j()},this.getDlg=function(a){return c[a]},this.isSync=function(a){return g[a]?!0:!1},this.getPanel=function(a){return d[a]},this.forceRegPanel=function(a,b){d[a]=b},this.regPanel=function(a,b){d[a]?log("*error: the panel is exist, key:"+a):d[a]=b},this.regDlg=function(a,b){c[a]=b},this.clearDlgs=function(){c={}},this.clearPanels=function(){d={}},this.openDlg=function(){var a=[];for(var c=1;c<arguments.length;++c)a.push(arguments[c]);var d=arguments[0],g=b.getDlg(d);b.isSync(d)||f[d]?g.openDlg.apply(g,a):(b.getDlg("midwait")&&b.getDlg("midwait").openDlg(),e.push({dlg:g,args:a}),window.setTimeout(b.onOpenDlg,1),f[d]=!0)},this.onOpenDlg=function(){if(e.length>0){var a=e[0];a.dlg.openDlg.apply(a.dlg,a.args),TQ.removeElement(e,0),b.getDlg("midwait")&&b.getDlg("midwait").closeDlg()}},this.closeMapPanels=function(){var a=["statecity","inbuild","farm","field"];for(var b in a){var c=d[a[b]];if(!c)continue;c.hide(),c.setActive(!1)}this.getPanel("main").getSubCityPanels().hideAllPanels(),this._resetFarm(),SoundMgr.stopBackSound()},this._resetFarm=function(){UIM.getDlg("selpip").closeDlg(),UIM.getPanel("farm").getModel().setOpState(FARMOP_STATE.SEL)},this.closeMainCityDlgs=function(){var a=["culture","task","package","shop","expedition","soldier","hero","steelhero","steellist","military","allievents","allicreate","allimain","allidetail","buildinginfo","resprotect","hospital","role","changecity","soldierop","allidetail","assignheros","selectexpedtarget","assignsoldiers","tradingarea","buyitem","saleitem"];this._closeDlgs(a)},this.closeStateCityDlgs=function(){var a=["acttower","acttowerexped","actterrace","actterraceexped","buyitem","saleitem"];this._closeDlgs(a)},this._closeDlgs=function(a){for(var b=0;b<a.length;++b){var c=UIM.getDlg(a[b]);try{c.closeDlg?c.closeDlg():c.hideDlg&&c.hideDlg()}catch(d){alert(a[b])}}},this.closeAllFieldDlg=function(){this.getDlg("rolecity").closeDlg(),this.getDlg("selffield").closeDlg(),this.getDlg("field").closeDlg(),this.getDlg("emptyfield").closeDlg()},this.openActTowerDlg=function(){UIM._openActDlg("acttower","acttowerexped")},this.openActTerraceDlg=function(){UIM._openActDlg("actterrace","actterraceexped")},this._openActDlg=function(a,b){UIM.getDlg(b).isRunning()?(log("act terrace is running..."),UIM.getDlg(b).forceShow()):(log("act terrace is not running"),UIM.getDlg(a).openDlg())},this._onDlgOpen=function(a){var b=i[a];if(!b)return;this._closeOthersDlg(a,b)},this._closeOthersDlg=function(a,b){for(var c=0;c<b.length;++c){var d=b[c];if(d==a)continue;this._closeDlgs([d])}};var j=function(){k(),l(),m()},k=function(){i.shop=i.rank=i.letter=i.role=i.task=i.hero=i.alli=i.expedition=i.military=i.exchange=i.friend=i["package"]=["shop","rank","letter","role","task","hero","alli","expedition","military","exchange","friend","package"]},l=function(){c.shop=ShopDlg.snew(a,"shop",h),c["package"]=PackageDlg.snew(a,"package",h),c.task=TaskDlg.snew(a,"task",h),c.letter=LetterDlg.snew(a,"letter",h),c.help=HelpDlg.snew(a),c.expedition=ExpeditionDlg.snew(a,"expedition",h),c.farminfo=new FarmInfoDlg(a),c.culture=CultureDlg.snew(a),c.soldier=SoldierDlgPresenter.snew(a,SoldierDlgView.snew(a),SoldierDlgModel.snew(a)),c.hero=HeroDlgPresenter.snew(a,HeroDlgView.snew(a,"hero",h),HeroDlgModel.snew(a)),c.steelhero=SteelHeroDlg.snew(a),g.steelhero=!0,c.steellist=SteelListDlg.snew(a),c.military=MilitaryDlg.snew(a,"military",h),c.allievents=AlliEventsDlg.snew(a),c.allicreate=AlliCreateDlg.snew(a),c.alli=AlliDlg.snew(a,"alli",h),c.allimain=AlliMainDlg.snew(a),c.allidetail=AlliDetailDlg.snew(a),c.buildinginfo=BuildingInfoDlg.snew(a),g.buildinginfo=!0,c.resprotect=ResProtectDlg.snew(a),g.resprotect=!0,c.hospital=HospitalDlg.snew(a),c.role=RoleDlg.snew(a,"role",h),c.changecity=ChangeCityDlg.snew(a),c.buildingtrace=BuildingTraceDlg.snew(a),g.buildingtrace=!0,c.soldierop=SoldierOpDlg.snew(a),c.assignheros=AssignHerosDlg.snew(a),c.selectexpedtarget=SelectExpedTargetDlg.snew(a),c.assignsoldiers=AssignSoldiersDlg.snew(a),c.tradingarea=TradingAreaDlg.snew(a),c.acttower=ActTowerDlg.snew(a),c.acttowerexped=ActTowerExpedDlg.snew(a),c.actterrace=ActTerraceDlg.snew(a),c.actterraceexped=ActTerraceExpedDlg.snew(a),c.activityval=ActivityValDlg.snew(a),c.rank=RankDlg.snew(a,"rank",h),c.friendapplylist=FriendApplyListDlg.snew(a),g.friendapplylist=!0,c.buyitem=BuyItemDlg.snew(a),g.buyitem=!0,c.saleitem=new SaleItemDlg(a),c.declarewar=new DeclareWarDlg(a),c.seltargetuseitem=new UseItemSelTargetDlg(a),c.uselistitem=UseListItemDlg.snew(a),g.uselistitem=!0,c.filteritem=FilterItemDlg.snew(a),c.filteritemex=new FilterItemDlgEx(a),c.weararm=new WearArmDlg(a),c.writeletter=WriteLetterDlg.snew(a),c.readletter=ReadLetterDlg.snew(a),c.minihelp=new MiniHelpDlg(a),c.friend=FriendDlg.snew(a,"friend",h),g.friend=!0,c.findinfo=new FindInfoDlg(a),c.playerdetail=new PlayerDetailDlg(a),c.team=new TeamDlg(a),c.inviteconfirm=new InviteConfirmDlg(a),c.mainselbuild=MainCitySelBuildDlg.snew(a),g.mainselbuild=!0,c.resselbuild=ResCitySelBuildDlg.snew(a),c.militaryselbuild=MilitaryCitySelBuildDlg.snew(a),c.citydef=CityDefDlg.snew(a),c.fightresult=FightResultDlg.snew(a),c.worldbossresult=WorldBossResultDlg.snew(a),g.worldbossresult=!0,c.strategy=new StrategyDlg(a),c.usestrategy=new UseStrategyDlg(a),c.appointhero=new AppointHeroDlg(a),c.selectsteeltype=SelectSteelTypeDlg.snew(a),c.recruithero=new RecruitHeroDlg(a),g.recruithero=!0,c.militaryop=MilitaryOpDlg.snew(a),c.buyitemlist=new BuyItemListDlg(a),c.manageshop=new ManageShopDlg(a),c.cansaleitem=new CanSaleItemDlg(a),c.saleupinput=new SaleUpInputDlg(a),c.shopslist=new ShopsListDlg(a),c.saleshop=new SaleShopDlg(a),c.midwait=new WaitmidDlg(a),c.clearrolepp=new ClearRolePPDlg(a),c.roleassignexp=RoleAssignExpDlg.snew(a),c.worldmap=WorldMapDlg.snew(a),c.armop=ArmOpDlg.snew(a),c.upgradegem=UpgradeGemDlg.snew(a),c.inputcood=InputCoodDlg.snew(a),c.selffield=SelfFieldDlg.snew(a),c.selffieldslist=SelfFieldsListDlg.snew(a),c.emptyfield=EmptyFieldDlg.snew(a),g.emptyfield=!0,c.rolecity=RoleCityDlg.snew(a),g.rolecity=!0,c.rolecitymodal=RoleCityDlg.snew(a,!0),g.rolecity=!0,c.field=FieldDlg.snew(a),g.field=!0,c.createsubcity=CreateSubCityDlg.snew(a),g.createsubcity=!0,c.jitan=JiTanDlg.snew(a),g.jitan=!0,c.selecticon=SelectIconDlg.snew(a),g.selecticon=!0,c.testanim=TestAnimDlg.snew(a),g.testanim=!0,c.fightmap=FightMapDlg.snew(a),c.allilist=AlliListDlg.snew(a),c.selfallimemlist=SelfAlliMemListDlg.snew(a),c.otherallimemlist=OtherAlliMemListDlg.snew(a),c.allitransfer=AlliTransferDlg.snew(a),g.allitransfer=!0,c.alliuntransfer=AlliUnTransferDlg.snew(a),g.alliuntransfer=!0,c.allisubscribe=AlliSubscribeDlg.snew(a),c.alliapplylist=AlliApplyListDlg.snew(a),c.allimerge=AlliMergeDlg.snew(a),g.allimerge=!0,c.allimeminfo=AlliMemInfoDlg.snew(a),g.allimeminfo=!0,c.alliauctionbuy=AlliAuctionBuyDlg.snew(a),g.alliauctionbuy=!0,c.allimysell=AlliMySellDlg.snew(a),g.allimysell=!0,c.reinforcement=ReinforcementDlg.snew(a),c.settradingarea=SetTradingAreaDlg.snew(a),c.tipmsgbox=TipMsgBox.snew(a),g.tipmsgbox=!0,c.diecitysetpos=DieCitySetPos.snew(a),c.actskiplayer=ActSkipLayerDlg.snew(a),c.actgainskiplayergift=ActGainSkipLayerGiftDlg.snew(a),c.acttowerlastgetgifts=ActTowerLastGetGiftsDlg.snew(a),c.imghelp=ImgHelpDlg.snew(a),c.newcomerhelper=NewcomerHelper.snew(a),c.selpip=new SelPipDlg(a),c.exchange=ExchangeDlg.snew(a,"exchange",h),c.buygold=BuyGoldDlg.snew(a),g.buygold=!0,c.yellowdiamond=YellowdiamondDlg.snew(a),c.bluediamond=BluediamondDlg.snew(a),c.blue3366diamond=Blue3366DiamondDlg.snew(a),c.payact=PayActDlg.snew(a),c.worldboss=WorldBossDlg.snew(a),c.worldbossrank=WorldBossRankDlg.snew(a),c.worldbossalligift=WorldBossAlliGiftDlg.snew(a),c.createrole=CreateRoleDlg.snew(a),c.inputnum=new InputNumDlg(a),c.inputnumex=new InputNumDlg(a,uicfg.comm.inputnumdlgex),c.inputtext=new InputTextDlg(a),c.inputareatext=new InputAreaTextDlg(a),c.waiting=WaitingDlg.snew(a),g.waiting=!0,TQ.isMobile()&&(c.chatpanel=ChatPanelDlg.snew(a)),c.autobuild=AutoBuildDlg.snew(a),c.vip=VipDlg.snew(a),c.gonggao=GongGaoDlg.snew(a),g.gonggao=!0,c.npc=NpcDlg.snew(a),g.npc=!0,log("....uimgr: 1 "),c.bindguest=BindGuestDlg.snew(a),g.bindguest=!0,log("....uimgr: 2 ")},m=function(){d.main=new MainPanel(a)}}).snew()