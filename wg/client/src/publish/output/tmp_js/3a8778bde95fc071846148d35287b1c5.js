var AUCTION_STEP=10;AlliDlg=ListenerBaseDlg.extern(function(){var a=null;this._init=function(){a=this.g_},this.openDlg=function(){AlliDlgOpener.snew(a).open(),this._notifyOpenDlg()},this.hideDlg=function(){UIM.getDlg("allicreate").isShow()&&UIM.getDlg("allicreate").hideDlg(),UIM.getDlg("allimain").isShow()&&UIM.getDlg("allimain").hideDlg()},this.isShow=function(){return UIM.getDlg("allicreate").isShow()||UIM.getDlg("allimain").isShow()},this.openSubscribeDlg=function(){AlliSubscribeDlgOpener.snew(a).open()},this.openGiftDlg=function(){AlliGiftDlgOpener.snew(a).open()}}),AlliDlgBaseOpener=Class.extern(function(){this.g_=null,this.init=function(a){this.g_=a},this.open=function(){var a=this.g_.getImgr().getBuildByResid(BUILDCITY_ID.ALL,FIXID.ALLIINBUILD);!a||a.level==0?this._openWhenNoBuild():this.g_.getImgr().isInAlliance()?this._open():this._openWhenNoAlli()},this._openWhenNoBuild=function(){this.g_.getGUI().sysMsgTips(SMT_WARNING,rstr.alli.nobuild)},this._openWhenNoAlli=function(){this.g_.getGUI().sysMsgTips(SMT_WARNING,rstr.alli.noInAlliance)},this._open=function(){}}),AlliDlgOpener=AlliDlgBaseOpener.extern(function(){this._openWhenNoAlli=function(){UIM.getDlg("allicreate").openDlg(),UIM.getPanel("main").getToolbar().stopAllianceBlinking()},this._open=function(){UIM.getDlg("allimain").openDlg(),UIM.getPanel("main").getToolbar().stopAllianceBlinking()}}),AlliSubscribeDlgOpener=AlliDlgBaseOpener.extern(function(){this._open=function(){UIM.getDlg("allisubscribe").openDlg()}}),AlliGiftDlgOpener=AlliDlgBaseOpener.extern(function(){this._open=function(){UIM.getDlg("allimain").openDlg(1),UIM.getPanel("main").getToolbar().stopAllianceBlinking()}}),AlliCreateDlg=ListenerBaseDlg.extern(function(){var C_BTN_DELAY_MS=1500,C_APPLY_TAB_IDX=0,C_CREATE_TAB_IDX=1,m_g,m_this,m_dlg,m_items={},m_invitelist=[];this._init=function(){m_g=this.g_,m_this=this,m_g.regEvent(EVT.NET,NETCMD.ALLIANCE,m_this,_onSvrPkg),m_g.regEvent(EVT.LOGIN_OK,0,m_this,_onLoginOk)},this.openDlg=function(){_initDlg(),_showDlg(),_initInfo(),this._notifyOpenDlg()},this.sendApplyToSvr=function(a){AllianceSender.sendApplyJoin(m_g,a),m_g.getGUI().sysMsgTips(SMT_NORMAL,TQ.format(rstr.alli.detaildlg.sendapply,a))},this.isShow=function(){return _isShow()},this.hideDlg=function(){m_dlg&&m_dlg.hide()};var _isShow=function(){return m_dlg?m_dlg.isShow():!1},_initDlg=function(){if(m_dlg)return;_createDlg(),_setCallers(),_initInputs(),_setBtnsDelayType()},_createDlg=function(){m_dlg=Dialog.snew(m_g,{modal:!1,title:rstr.alli.createdlg.title,pos:{x:"center",y:40}}),m_g.getGUI().initDlg(m_dlg,uicfg.alli.createdlg,m_items)},_setCallers=function(){_getCtrl("listbtn").setCaller({self:m_this,caller:_onClickAlliListBtn}),_getCtrl("applybtn").setCaller({self:m_this,caller:_onClickApplyBtn}),_getCtrl("createbtn").setCaller({self:m_this,caller:_onClickCreateBtn}),_getCtrl("randbtn").setCaller({self:m_this,caller:_onClickRandBtn})},_initInputs=function(){InputLimit.maxGBKBytes(_getCtrl("ialliname"),JVALID.getMaxAlliLen()),InputLimit.maxGBKBytes(_getCtrl("icreatename"),JVALID.getMaxAlliLen()),TQ.maxLength(_getCtrl("iflagname"),JVALID.getMaxAlliFlagLen())},_setBtnsDelayType=function(){_getCtrl("applybtn").setType(BTN_TYPE.DELAY),_getCtrl("applybtn").setDelay(C_BTN_DELAY_MS),_getCtrl("createbtn").setType(BTN_TYPE.DELAY),_getCtrl("createbtn").setDelay(C_BTN_DELAY_MS)},_showDlg=function(){m_dlg.show()},_initInfo=function(){TQ.setTextEx(_getCtrl("alliname"),""),TQ.setTextEx(_getCtrl("needmoney"),res_create_alli_need_money),AllianceSender.sendGetCurApplying(m_g),m_items.tab.activeTab(0)},_onLoginOk=function(){AllianceSender.sendGetInviteList(m_g)},_onSvrPkg=function(a){var b=a.data;_handleCreateResult(b.create),_handleApplyInfo(b.applyinfo),_handleInviteInfo(b.inviteinfo)},_onClickAlliListBtn=function(){var a=UIM.getDlg("allilist");a.setCaller({self:m_this,caller:_onSelectAlliance}),a.openDlg(m_g.getImgr().getStateCity())},_onSelectAlliance=function(a){_getCtrl("ialliname").value=a},_onClickApplyBtn=function(){JVALID.checkAlliname(_getCtrl("ialliname").value)?m_this.sendApplyToSvr(_getCtrl("ialliname").value):m_g.getGUI().msgBox(rstr.comm.msgts,rstr.rankingdlg.invalidalliname,MB_F_CLOSE,null)},_onClickCreateBtn=function(){if(!JVALID.checkAlliname(_getCtrl("icreatename").value)){m_g.getGUI().msgBox(rstr.comm.msgts,rstr.rankingdlg.invalidalliname,MB_F_CLOSE,null),_getCtrl("icreatename").focus();return}if(!JVALID.checkAlliFlagName(_getCtrl("iflagname").value)){m_g.getGUI().msgBox(rstr.comm.msgts,rstr.alli.createdlg.tips.invalidalliflag,MB_F_CLOSE,null),_getCtrl("iflagname").focus();return}AllianceSender.sendCreateAlli(m_g,_getCtrl("icreatename").value,_getCtrl("iflagname").value)},_onClickRandBtn=function(){_getCtrl("iflagname").value=_getRandHZ()},_onClickAgreeInvite=function(a){var b=m_invitelist[a];AllianceSender.sendAgreeInvite(m_g,b.roleId,b.alliId)},_onClickIgnoreInvite=function(a){var b=m_invitelist[a];AllianceSender.sendIgnoreInvite(m_g,b.roleId,b.alliId)},_handleApplyInfo=function(a){if(!a)return;if(!a.alli)return;if(!_isShow())return;TQ.setTextEx(_getCtrl("alliname"),a.alli)},_handleCreateResult=function(a){if(!a)return;if(!_isShow())return;a.result==0&&(m_g.getImgr().getRoleRes().allipos=a.allipos,m_g.getGUI().sysMsgTips(SMT_SUCCESS,rstr.alli.createdlg.tips.createalliok),_hideDlg(),UIM.getDlg("alli").openDlg())},_handleInviteInfo=function(a){if(!a)return;TQ.dictCopy(m_invitelist,a);if(!_isShow()){m_invitelist.length>0&&UIM.getPanel("main").getToolbar().startAllianceBlinking(1e4);return}var b=_getCtrl("invitelist");_setInviteListItems(b),_setInviteListItemsBtnCaller(b)},_setInviteListItems=function(a){a.setItemCount(m_invitelist.length);for(var b=0;b<m_invitelist.length;++b){var c=m_invitelist[b],d=a.getItem(b);TQ.setTextEx(d.exsubs.desc,HyperLinkMgr.formatLink(c.desc))}},_setInviteListItemsBtnCaller=function(a){for(var b=0;b<a.getCount();++b){var c=a.getItem(b);c.exsubs.agreeBtn.setId(b),c.exsubs.ignoreBtn.setId(b),c.exsubs.agreeBtn.setCaller({self:m_this,caller:_onClickAgreeInvite}),c.exsubs.ignoreBtn.setCaller({self:m_this,caller:_onClickIgnoreInvite})}},_hideDlg=function(){m_dlg&&m_dlg.hide()},_getCtrl=function(a){var b=m_items.tab.getTabItems(C_APPLY_TAB_IDX),c=m_items.tab.getTabItems(C_CREATE_TAB_IDX);return b[a]?b[a]:c[a]},_getRandHZ=function(){return eval('var word="\\u'+(Math.round(Math.random()*20901)+19968).toString(16)+'"'),word}}),AlliListDlg=Class.extern(function(){var a=null,b=null,c=null,d={},e=0,f=null,g=null;this.init=function(a){h(this,a)},this.setCaller=function(a){g=a},this.openDlg=function(a){i(a),j(),n(),o()},this.isShow=function(){return c?c.isShow():!1};var h=function(c,d){b=c,a=d},i=function(a){e=a},j=function(){if(c)return;k(),l(),m()},k=function(){c=Dialog.snew(a,{modal:!1,title:rstr.alli.listdlg.title,pos:{x:"center",y:40}}),a.getGUI().initDlg(c,uicfg.alli.allilistdlg,d)},l=function(){f=AlliListDlgTempl.snew(a,b,d.container,"join")},m=function(){f.setCaller({self:b,caller:p})},n=function(){c.show()},o=function(){f.openDlg(e)},p=function(a){g&&(g.caller.call(g.self,a),c.hide())}}),AlliListDlgTempl=Class.extern(function(){var a=null,b=null,c=null,d={},e=0,f="rank",g=[],h=null,i=null;this.init=function(a,b,c,d){j(this,a,b,d),k(c),l(),m()},this.setCaller=function(a){h=a},this.openDlg=function(a){n(a),d.pageBar.activePage(1,!0)},this.onPageBarClickSearch=function(b){if(b=="")return;if(!JVALID.checkAlliname(b)){a.getGUI().sysMsgTips(SMT_WARNING,rstr.alli.listdlg.tip.invalidalli);return}AllianceSender.sendSearchAlliance(a,e,b)},this.onPageBarClickGetSelf=function(){if(!a.getImgr().isInAlliance()){a.getGUI().sysMsgTips(SMT_WARNING,rstr.alli.listdlg.tip.selfNoInAlli);return}AllianceSender.sendSearchAlliance(a,e,a.getImgr().getAllianceName())},this.onPageNavigate=function(b){AllianceSender.sendGetAlliList(a,e,b)};var j=function(d,e,g,h){b=d,a=e,c=g,f=h},k=function(b){var c=uicfg.alli.allilistdlg.t_,e=c[0];a.getGUI().buildDomItems(b,e,c,d)},l=function(){i=RankPageBar.snew(a,rstr.alli.listdlg.lbl.searchalli,JVALID.getMaxAlliLen(),d.pageBarCon,d),i.regObServer(b)},m=function(){a.regEvent(EVT.NET,NETCMD.ALLIANCE,b,v)},n=function(a){e=a},o=function(a){var b=p(a);d.list.setItemCount(b.length);for(var c=0;c<d.list.getCount();++c){var e=d.list.getItem(c),f=b[c],g=ItemResUtil.findItemres(f.cityResId);IMG.setBKImage(e.exsubs.cityFlag,IMG.makeSmallStateCityFlag(g.flagimg)),TQ.setTextEx(e.exsubs.rank,f.rank),TQ.setTextEx(e.exsubs.name,f.name),TQ.setTextEx(e.exsubs.leader,f.leader),TQ.setTextEx(e.exsubs.level,f.level),TQ.setTextEx(e.exsubs.mem,f.mem),TQ.setTextEx(e.exsubs.honour,f.honour),e.exsubs.seeBtn.setId(c),e.exsubs.joinBtn.setId(c)}},p=function(a){var b=[];for(var c=0;c<a.length;++c){var d=a[c];if(d.name=="--"&&d.cityResId==0)continue;b.push(d)}return b},q=function(){for(var a=0;a<d.list.getCount();++a){var b=d.list.getItem(a);f=="join"?b.exsubs.joinBtn.show():b.exsubs.joinBtn.hide()}},r=function(){for(var a=0;a<d.list.getCount();++a){var c=d.list.getItem(a);c.exsubs.seeBtn.setCaller({self:b,caller:t}),c.exsubs.joinBtn.setCaller({self:b,caller:u})}},s=function(a){isNull(a)?d.list.setCurSel(-1):d.list.setCurSel(a)},t=function(b){var c=g[b];AllianceSender.sendGetAllianceDetail(a,c.name)},u=function(a){if(h){var b=g[a];h.caller.call(h.self,b.name)}},v=function(a){if(!c.isShow())return;w(a)},w=function(a){var b=a.data;if(!b.alliances)return;if(b.cityResId!=e)return;g=b.alliances,i.setPageBarNoActive(b.pageNo,b.pageCount),o(g),q(),r(),s(b.curSelIdx)}}),RankPageBar=Class.extern(function(){this.g_=null,this.items_=null,this.parent_=null,this.searchMaxLen_=1,this.searchLbl_="",this.observer_=null;var a=null;this.init=function(b,c,d,e,f){a=this,this.g_=b,this.searchLbl_=c,this.searchMaxLen_=d,this.parent_=e,this.items_=f,this._createTempl(),this._setCallers()},this.regObServer=function(a){this.observer_=a,this.items_.pageBar.activePage(1,!0)},this.setPageBarNoActive=function(a,b){this.items_.pageBar.setPageCnt(b),this.items_.pageBar.activePage(a,!1,!0),this.items_.pageno.setVal(a)},this._createTempl=function(a){var b=uicfg.alli.allilistdlg.t_,c=b[2];this.g_.getGUI().buildDomItems(this.parent_,c,b,this.items_),TQ.setTextEx(this.items_.searchLbl,this.searchLbl_),InputLimit.maxGBKBytes(this.items_.searchName,this.searchMaxLen_)},this._setCallers=function(){this.items_.pageno.setLimit(b),this.items_.searchBtn.setCaller({self:this,caller:this._onClickSearch}),this.items_.getSelfBtn.setCaller({self:this,caller:this._onClickGetSelf}),this.items_.gotoPage.setCaller({self:this,caller:this._onClickGotoPage}),this.items_.pageBar.setCaller({self:this,caller:this._onPageNavigate})},this._onClickSearch=function(){this.observer_.onPageBarClickSearch(this.items_.searchName.value)},this._onClickGetSelf=function(){this.observer_.onPageBarClickGetSelf()},this._onPageNavigate=function(a){this.items_.pageno.setVal(a),this.observer_.onPageNavigate(a)},this._onClickGotoPage=function(){this.items_.pageBar.activePage(this.items_.pageno.getVal())};var b=function(){return{min:1,max:a.items_.pageBar.getPageCnt()}}}),AlliDetailDlg=Class.extern(function(){var a=null,b=null,c=null,d={},e=null;this.init=function(c){a=c,b=this,a.regEvent(EVT.NET,NETCMD.ALLIANCE,b,l)},this.hideDlg=function(){c&&c.hide()};var f=function(a){g(),h(),k(a)},g=function(){if(c)return;i(),j()},h=function(){c.show()},i=function(){c=Dialog.snew(a,{modal:!1,title:rstr.alli.detaildlg.title,pos:{x:"center",y:40}}),a.getGUI().initDlg(c,uicfg.alli.allidetail,d)},j=function(){d.applybtn.setCaller({self:b,caller:m}),d.membtn.setCaller({self:b,caller:n})},k=function(a){e=a;var b=["name","level","flag","leader","mem","buildVal","card","honour"];for(var c=0;c<b.length;++c){var f=b[c];TQ.setTextEx(d[f],e[f])}TQ.setTextEx(d.introduction.getContainerObj(),e.introduction);var g=ItemResUtil.findItemres(e.cityResId);IMG.setBKImage(d.cityFlag,IMG.makeSmallStateCityFlag(g.flagimg))},l=function(a){var b=a.data;if(!b.detail)return;f(b.detail)},m=function(){UIM.getDlg("allicreate").sendApplyToSvr(e.name)},n=function(){a.getImgr().isSameAllianceByName(e.name)?UIM.getDlg("selfallimemlist").openDlg():UIM.getDlg("otherallimemlist").openDlg(e.name)}}),SelfAlliMemListDlg=Class.extern(function(){var a=3,b=null,c=null,d=null,e={},f=[];this.init=function(a){c=this,b=a,b.regEvent(EVT.NET,NETCMD.ALLIANCE,c,l)},this.openDlg=function(){g(),j(),k()};var g=function(){if(d)return;h(),i()},h=function(){d=Dialog.snew(b,{modal:!1,title:rstr.alli.selfmemlistdlg.title,pos:{x:"center",y:40}}),b.getGUI().initDlg(d,uicfg.alli.selfmemlist,e)},i=function(){e.pageBar.setCaller({self:c,caller:r})},j=function(){d.show()},k=function(){e.pageBar.activePage(1,!0)},l=function(a){if(!d||!d.isShow())return;if(!a.data.selfmems)return;f=a.data.selfmems,m(a.data.pageNo,a.data.pageCount),n(),o()},m=function(a,b){e.pageBar.setPageCnt(b),e.pageBar.activePage(a,!1,!0)},n=function(){e.list.setItemCount(f.length);for(var a=0;a<e.list.getCount();++a){var b=e.list.getItem(a),d=f[a];TQ.setTextEx(b.exsubs.name,d.name),TQ.setTextEx(b.exsubs.alliPos,rstr.alli.alliposs[d.alliPos]),TQ.setTextEx(b.exsubs.roleRank,d.roleRank),TQ.setTextEx(b.exsubs.level,d.level),TQ.setTextEx(b.exsubs.buildCurVal,d.buildCurVal),TQ.setTextEx(b.exsubs.contributes,d.contributes),TQ.setTextEx(b.exsubs.state,p(d.loginTime)),TTIP.setCallerData(b.exsubs.tooltips.$alliPos,{self:c,caller:q},{idx:a}),b.exsubs.seeBtn.setId(a)}},o=function(){for(var a=0;a<e.list.getCount();++a){var b=e.list.getItem(a);b.exsubs.seeBtn.setCaller({self:c,caller:s})}},p=function(c){if(c==0)return"--";var d=Math.floor((b.getSvrTimeS()-c)/86400);return d<a?"--":TQ.format(rstr.alli.selfmemlistdlg.tip.noLoginDays,d)},q=function(a){return TIPM.makeItemTip(rstr.alli.allipostips[f[a.idx].alliPos])},r=function(a){AllianceSender.sendGetSelfMems(b,a)},s=function(a){var b=UIM.getDlg("allimeminfo");b.openDlg(f[a]),b.setObserver(t)},t=function(){AllianceSender.sendGetSelfMems(b,e.pageBar.getCurPage())}}),OtherAlliMemListDlg=Class.extern(function(){var a=null,b=null,c=null,d={},e=[],f=0,g="";this.init=function(c){b=this,a=c,a.regEvent(EVT.NET,NETCMD.ALLIANCE,b,m)},this.openDlg=function(a){h(),k(),l(a)};var h=function(){if(c)return;i(),j()},i=function(){c=Dialog.snew(a,{modal:!1,title:rstr.alli.othermemlistdlg.title,pos:{x:"center",y:40}}),a.getGUI().initDlg(c,uicfg.alli.othermemlist,d)},j=function(){d.pageBar.setCaller({self:b,caller:s})},k=function(){c.show()},l=function(a){g=a,d.pageBar.activePage(1,!0)},m=function(a){if(!c||!c.isShow())return;if(!a.data.mems)return;e=a.data.mems,f=a.data.cityResId,n(a.data.pageNo,a.data.pageCount),o(),p(),q()},n=function(a,b){d.pageBar.setPageCnt(b),d.pageBar.activePage(a,!1,!0)},o=function(){var c=ItemResUtil.findItemres(f);IMG.setBKImage(d.cityFlag,IMG.makeSmallStateCityFlag(c.flagimg)),d.list.setItemCount(e.length);for(var g=0;g<d.list.getCount();++g){var h=d.list.getItem(g),i=e[g];TQ.setTextEx(h.exsubs.name,i.name),TQ.setTextEx(h.exsubs.alliPos,rstr.alli.alliposs[i.alliPos]),TQ.setTextEx(h.exsubs.roleRank,i.roleRank),TQ.setTextEx(h.exsubs.level,i.level);var j=a.getImgr().getFightRefState(i.roleId);TQ.setTextEx(h.exsubs.state,rstr.field.rolecitydlg.lbl.refstate[j]);var k=FieldUtil.getPosByGridId(i.gridId),l="#[m:"+k.x+":"+k.y+"]";TQ.setTextEx(h.exsubs.cood,HyperLinkMgr.formatLink(l));var m=Math.round(ExpedTargetUtil.getDistance(a,k));TQ.setTextEx(h.exsubs.distance,m),TTIP.setCallerData(h.exsubs.tooltips.$alliPos,{self:b,caller:r},{idx:g}),h.exsubs.seeBtn.setId(g),h.exsubs.declareBtn.setId(g)}},p=function(){for(var a=0;a<d.list.getCount();++a){var c=d.list.getItem(a);c.exsubs.seeBtn.setCaller({self:b,caller:t}),c.exsubs.declareBtn.setCaller({self:b,caller:u})}},q=function(){for(var b=0;b<d.list.getCount();++b){var c=d.list.getItem(b),f=e[b],g=a.getImgr().getFightRefState(f.roleId);c.exsubs.declareBtn.enable(g==REF_ROLESTATE.NORMAL)}},r=function(a){return TIPM.makeItemTip(rstr.alli.allipostips[e[a.idx].alliPos])},s=function(b){AllianceSender.sendGetOtherMems(a,g,b)},t=function(a){var b=e[a],c={gridId:b.gridId,objType:OBJ_TYPE.ROLE,roleId:b.roleId,roleName:b.name,alliance:{uid:-1,name:"alliance"}};UIM.getDlg("rolecitymodal").openDlg(c)},u=function(b){var c=e[b],d=a.getImgr().getFightRefState(c.roleId);d==REF_ROLESTATE.NORMAL&&MilitarySender.sendDeclareFight(a,c.roleId)}}),AlliMainDlg=ListenerBaseDlg.extern(function(){var a=0,b=1,c=2,d=null,e=null,f=null,g={},h=null,i=null,j=null;this._init=function(){k(this,this.g_),d.regEvent(EVT.NET,NETCMD.ALLIANCE,e,r)},this.openDlg=function(a){l(),p(),q(a),this._notifyOpenDlg()},this.isShow=function(){return f?f.isShow():!1},this.hideDlg=function(){f&&f.hide()};var k=function(a,b){d=b,e=a,h=NullAlliMainPanel.snew(),i=NullAlliMainPanel.snew(),j=NullAlliMainPanel.snew()},l=function(){if(f)return;m(),n(),o()},m=function(){f=Dialog.snew(d,{modal:!1,title:rstr.alli.main.title,pos:{x:"center",y:40}}),d.getGUI().initDlg(f,uicfg.alli.maindlg,g)},n=function(){f.setCaller({self:e,caller:x})},o=function(){h=AlliMainBasePanel.snew(d,g.tablist.getTabItems(a)),i=AlliMainLawLightPanel.snew(d,g.tablist.getTabItems(b)),j=AlliMainAuctionPanel.snew(d,g.tablist.getTabItems(c))},p=function(){f.show(),h.show(),i.show(),j.show()},q=function(a){AllianceSender.sendGetMyAllianceDetail(d),g.tablist.activeTab(a?a:0)},r=function(a){var b=a.data;s(b.mydetail),t(b.lawlight),u(b.auction),v(b.selfmem),w(b.sellingItems)},s=function(a){if(!a)return;d.getImgr().getMyAlliance().copyDetail(a),d.sendEvent({eid:EVT.SELFALLI_DETAIL,sid:0}),y()},t=function(a){if(!a)return;d.getImgr().getMyAlliance().copyLawLight(a),y()},u=function(a){if(!a)return;d.getImgr().getMyAlliance().copyAuction(a),y()},v=function(a){if(!a)return;d.getImgr().getMyAlliance().copySelfMember(a),d.sendEvent({eid:EVT.SELFALLIMEM_CHANGE,sid:0}),y()},w=function(a){if(!a)return;d.getImgr().copySellingItems(a),d.sendEvent({eid:EVT.SELLING_ITEMS,sid:0})},x=function(a){a==C_SYS_DLG_HIDE&&(h.hide(),i.hide(),j.hide())},y=function(){if(!f||!f.isShow())return;h.update(),i.update(),j.update()}}),NullAlliMainPanel=Class.extern(function(){this.show=function(){},this.hide=function(){},this.update=function(){}}),AlliMainBasePanel=Class.extern(function(){var a=0,b=1,c=2,d=3,e=4,f=5,g=6,h=7,i,j,k={},l=null,m=0;this.init=function(a,b){i=a,j=this,k=b,n()},this.show=function(){i.regUpdater(j,y,1e3)},this.hide=function(){i.unregUpdater(j,y)},this.update=function(){o(),r(),s(),t(),u(),v(),w()};var n=function(){k.upgradeLevelBtn.setCaller({self:j,caller:z}),k.transferBtn.setCaller({self:j,caller:D}),k.seeMemsBtn.setCaller({self:j,caller:E}),k.subscribeBtn.setCaller({self:j,caller:F}),k.modifyQQGroupBtn.setCaller({self:j,caller:G}),k.inviteBtn.setCaller({self:j,caller:I}),k.agreeApplyBtn.setCaller({self:j,caller:K}),k.showEventBtn.setCaller({self:j,caller:L}),k.mergeBtn.setCaller({self:j,caller:M}),k.dismissBtn.setCaller({self:j,caller:N}),k.quitBtn.setCaller({self:j,caller:O}),k.modifyIntroduceBtn.setCaller({self:j,caller:P}),k.modifyBulletinBtn.setCaller({self:j,caller:R}),k.upgradeBar.setShowFlag(PROGBAR_SHOWFLAG_CUSTOM),k.upgradeBar.setCustomValCaller({self:j,caller:T}),k.transferOrDismissBar.setShowFlag(PROGBAR_SHOWFLAG_CUSTOM),k.transferOrDismissBar.setCustomValCaller({self:j,caller:T}),TTIP.setCallerData(k.tooltips.$honour,{self:j,caller:U},{}),TTIP.setCallerData(k.tooltips.$buildVal,{self:j,caller:V},{}),TTIP.setCallerData(k.tooltips.$card,{self:j,caller:W},{})},o=function(){p(),q()},p=function(){var a={upgradeLevelBtn:ALLI_POS.ALEADER,transferBtn:ALLI_POS.LEADER,modifyQQGroupBtn:ALLI_POS.LEADER,inviteBtn:ALLI_POS.ELDER,agreeApplyBtn:ALLI_POS.ELDER,mergeBtn:ALLI_POS.ALEADER,dismissBtn:ALLI_POS.LEADER,modifyIntroduceBtn:ALLI_POS.LEADER,modifyBulletinBtn:ALLI_POS.LEADER};for(var b in a){var c=a[b],d=i.getImgr().getMyAlliance().getSelfMember().getAlliPos()>=c;k[b].enable(d)}},q=function(){if(k.upgradeLevelBtn.isEnable()){var a=i.getImgr().getMyAlliance();k.upgradeLevelBtn.enable(!a.isUpgradingAlliance()&&!a.isFullLevel())}},r=function(){var a={modifyIntroduceBtn:ALLI_POS.LEADER,modifyBulletinBtn:ALLI_POS.LEADER};for(var b in a){var c=a[b],d=i.getImgr().getMyAlliance().getSelfMember().getAlliPos()>=c;d?k[b].show():k[b].hide()}},s=function(){var a=i.getImgr().getMyAlliance();TQ.setCSS(k.upgradeBarContainer,"display",a.isUpgradingAlliance()?"block":"none"),TQ.setCSS(k.transferBarContainer,"display",a.isTransfering()||a.isDismissing()?"block":"none")},t=function(){var a=i.getImgr().getMyAlliance();TQ.setTextEx(k.transferOrDismissLbl,a.isDismissing()?rstr.alli.main.lbl.dismissBar:rstr.alli.main.lbl.transferBar)},u=function(){var a=i.getImgr().getMyAlliance();k.dismissBtn.setText(a.isDismissing()?rstr.alli.main.btn.undismiss:rstr.alli.main.btn.dismiss)},v=function(){var a=i.getImgr().getMyAlliance();TQ.setTextEx(k.name,a.getName()),TQ.setTextEx(k.cityName,ItemResUtil.findItemres(a.getCityResId()).name),TQ.setTextEx(k.alliFlag,a.getAlliFlag()),TQ.setTextEx(k.rank,a.getRank()),TQ.setTextEx(k.honour,RStrUtil.formatResNumStr(a.getHonour())),TQ.setTextEx(k.level,a.getLevel()),TQ.setTextEx(k.leader,a.getLeader()),TQ.setTextEx(k.mem,a.getMemCount()+"/"+B().memmaxcount),TQ.setTextEx(k.buildVal,RStrUtil.formatResNumStr(a.getBuildVal())),TQ.setTextEx(k.card,RStrUtil.formatResNumStr(a.getCardNumber())),TQ.setTextEx(k.qqGroup,a.getQQGroup()),TQ.setRichText(k.introduction.getContainerObj(),TQ.decodeMessage(a.getIntroduction())),TQ.setRichText(k.bulletin.getContainerObj(),TQ.decodeMessage(a.getBulletin())),k.introduction.refresh(),k.bulletin.refresh()},w=function(){var a=i.getImgr().getMyAlliance();x("upgradeBar",a.getUpgradeStartTime(),a.getUpgradeStopTime()),x("transferOrDismissBar",a.getDismissStartTime(),a.getDismissStopTime()),x("transferOrDismissBar",a.getTransferStartTime(),a.getTransferStopTime())},x=function(a,b,c){if(c==0)return;var d=c-b,e=i.getSvrTimeS()-b,e=Math.min(d,e);k[a].setRange(d),k[a].setValue(0,e)},y=function(){w()},z=function(){if(A().needbuildval>i.getImgr().getMyAlliance().getBuildVal()){i.getGUI().sysMsgTips(SMT_WARNING,TQ.format(rstr.ids[100118].msg,A().needbuildval));return}i.getGUI().msgBox(rstr.comm.msgts,rstr.alli.main.tip.confirmUpgradeAlli,MB_F_YESNO,{self:j,caller:function(a){a==MB_IDYES&&AllianceSender.sendUpgradeAlliance(i)}})},A=function(){return C(i.getImgr().getMyAlliance().getLevel()+1)},B=function(){return C(i.getImgr().getMyAlliance().getLevel())},C=function(a){var b=a-1;return res_alli_upd_needs[b]},D=function(){i.getImgr().getMyAlliance().isDismissing()?i.getGUI().sysMsgTips(SMT_WARNING,rstr.ids[100119].msg):i.getImgr().getMyAlliance().isTransfering()?UIM.getDlg("alliuntransfer").openDlg():UIM.getDlg("allitransfer").openDlg()},E=function(){UIM.getDlg("selfallimemlist").openDlg()},F=function(){UIM.getDlg("allisubscribe").openDlg()},G=function(){var a=UIM.getDlg("inputnumex");a.openDlg(rstr.alli.main.lbl.inputQQGroup,99999999999),a.setNumber(i.getImgr().getMyAlliance().getQQGroup()),a.setCaller({self:j,caller:H})},H=function(a){AllianceSender.sendModifyQQGroup(i,a)},I=function(){var a=UIM.getDlg("inputtext");a.openDlg(rstr.alli.main.lbl.inputInviteName,JVALID.getMaxUserLen()),a.setCaller({self:j,caller:J})},J=function(a){JVALID.checkUsername(a)?AllianceSender.sendInvite(i,a):i.getGUI().sysMsgTips(SMT_WARNING,rstr.ids[100050].msg)},K=function(){UIM.getDlg("alliapplylist").openDlg()},L=function(){UIM.getDlg("allievents").openDlg()},M=function(){UIM.getDlg("allimerge").openDlg()},N=function(){i.getImgr().getMyAlliance().isTransfering()?i.getGUI().sysMsgTips(SMT_WARNING,rstr.ids[100120].msg):i.getImgr().getMyAlliance().isDismissing()?i.getGUI().msgBox(rstr.comm.msgts,rstr.alli.main.tip.confirmUnDismissAlli,MB_F_YESNO,{self:j,caller:function(a){a==MB_IDYES&&AllianceSender.sendCancelDismiss(i)}}):i.getGUI().msgBox(rstr.comm.msgts,rstr.alli.main.tip.confirmDismissAlli,MB_F_YESNO,{self:j,caller:function(a){a==MB_IDYES&&AllianceSender.sendDismiss(i)}})},O=function(){var a=i.getImgr().getMyAlliance();a.getSelfMember().getAlliPos()==ALLI_POS.LEADER?i.getGUI().sysMsgTips(SMT_WARNING,rstr.ids[100121].msg):i.getGUI().msgBox(rstr.comm.msgts,rstr.alli.main.tip.confirmExitAlli,MB_F_YESNO,{self:j,caller:function(a){a==MB_IDYES&&AllianceSender.sendExitAlliance(i)}})},P=function(){var a=i.getImgr().getMyAlliance(),b=UIM.getDlg("inputareatext");b.openDlg(rstr.alli.main.lbl.modifyIntroduce,TQ.decodeMessageForText(a.getIntroduction()),rstr.alli.main.lbl.introduceDesc,JVALID.getMaxAllianceIntroduceGBKBytes()),b.setCaller({self:j,caller:Q})},Q=function(a){var b=i.getImgr().getMyAlliance(),c=TQ.decodeMessageForText(b.getIntroduction());a!=c&&AllianceSender.sendModifyIntroduce(i,a)},R=function(){var a=i.getImgr().getMyAlliance(),b=UIM.getDlg("inputareatext");b.openDlg(rstr.alli.main.lbl.modifyBulletin,TQ.decodeMessageForText(a.getBulletin()),rstr.alli.main.lbl.bulletinDesc,JVALID.getMaxAllianceBulletinGBKBytes()),b.setCaller({self:j,caller:S})},S=function(a){var b=i.getImgr().getMyAlliance(),c=TQ.decodeMessageForText(b.getBulletin());a!=c&&AllianceSender.sendModifyBulletin(i,a)},T=function(a,b){return TQ.formatTime(0,b-a)},U=function(a){var b=i.getImgr().getMyAlliance();return b.getHonour().toString()},V=function(a){var b=i.getImgr().getMyAlliance();return b.getBuildVal().toString()},W=function(a){var b=i.getImgr().getMyAlliance();return b.getCardNumber().toString()}}),AlliLawLightUtil=JClass.ex({_init:function(a){this._g=a,this._imgr=this._g.getImgr()},isCanFeed:function(){var a=this._imgr.getMyAlliance().getSelfMember();return a.getTodayFeedTimes()<this.getMaxFeedTimes()},getMaxFeedTimes:function(){return this.getLawLightCurLevelRes().maxfeedtimes+this._imgr.getVipEffectVal(VIP_EFF.ADD_LAWLIGHTFEED_TIMES)},getLawLightCurLevelRes:function(){var a=this._imgr.getMyAlliance().getLawLight();return this._getLawLightLevelRes(a.getLevel())},getLawLightNextLevelRes:function(){var a=this._imgr.getMyAlliance().getLawLight();return this._getLawLightLevelRes(a.getLevel()+1)},_getLawLightLevelRes:function(a){var b=a-1;return res_alli_lawlight_upd[b]}}),AlliMainLawLightPanel=Class.extern(function(){var a,b,c={},d=null;this.init=function(e,f){a=e,b=this,c=f,d=AlliLawLightUtil.snew(e),l(),m()},this.show=function(){},this.hide=function(){},this.update=function(){e(),j(),k()};var e=function(){f(),g(),h(),i()},f=function(){var b=a.getImgr().getMyAlliance().getSelfMember();c.getResBtn.enable(!b.isTodayGotRes())},g=function(){var b=d.getLawLightNextLevelRes();if(!b)return;var e=a.getImgr().getMyAlliance();e.getBuildVal()>=b.needbuildval&&e.getCardNumber()>=b.needcard?c.upgradeBtn.enable(!0):c.upgradeBtn.enable(!1)},h=function(){var b=d.getLawLightCurLevelRes(),e=a.getImgr().getMyAlliance().getLawLight();e.getGrowupVal()==b.maxgrowupval?c.bestowBtn.enable(!0):c.bestowBtn.enable(!1)},i=function(){c.feedBtn.enable(d.isCanFeed()),c.feedAllBtn.enable(d.isCanFeed())},j=function(){var b=a.getImgr().getMyAlliance();b.getSelfMember().getAlliPos()==ALLI_POS.LEADER?(c.upgradeBtn.show(),c.bestowBtn.show()):(c.upgradeBtn.hide(),c.bestowBtn.hide());var d=b.getLawLight();d.getLevel()==res_alli_lawlight_maxlevel&&c.upgradeBtn.hide()},k=function(){var b=a.getImgr().getMyAlliance();TQ.setTextEx(c.canGetMoney,t().getmoney),TQ.setTextEx(c.canGetHeroExp,t().getheroexp),TQ.setTextEx(c.getResNeedContributes,t().expendcontribute),TQ.setTextEx(c.totalContributes,b.getSelfMember().getContributes());var e=["addFoodOutput","addWoodOutput","addStoneOutput","addIronOutput","addMoneyOutput"];for(var f in e)TQ.setTextEx(c[e[f]],"+"+b.getLevel()*5+"%");c.growupBar.setRange(d.getLawLightCurLevelRes().maxgrowupval),c.growupBar.setValue(0,b.getLawLight().getGrowupVal()),TQ.setTextEx(c.todayLeftTime,d.getMaxFeedTimes()-b.getSelfMember().getTodayFeedTimes()),TQ.setTextEx(c.feedNeedContributes,d.getLawLightCurLevelRes().feedneedcontributes),IMG.setBKImage(c.lawLightIcon,IMG.makeImg("alli/lawlight/icon/"+b.getLawLight().getLevel()+".jpg"))},l=function(){c.getResBtn.setCaller({self:b,caller:n}),c.upgradeBtn.setCaller({self:b,caller:o}),c.bestowBtn.setCaller({self:b,caller:p}),c.feedBtn.setCaller({self:b,caller:q}),c.feedAllBtn.setCaller({self:b,caller:r})},m=function(){TTIP.setCallerData(c.tooltips.$upgradeBtnTip,{self:b,caller:s},{})},n=function(){AllianceSender.sendGainTodayGift(a)},o=function(){var c=v(),d=c+rstr.alli.main.lawLight.tip.confirmUpgrade;a.getGUI().msgBox(rstr.comm.msgts,d,MB_F_YESNO,{self:b,caller:function(b){b==MB_IDYES&&AllianceSender.sendUpgradeLawLight(a)}})},p=function(){var c=rstr.alli.main.lawLight.tip.confirmBestow;a.getGUI().msgBox(rstr.comm.msgts,c,MB_F_YESNO,{self:b,caller:function(b){b==MB_IDYES&&AllianceSender.sendLawLightBestow(a)}})},q=function(){AllianceSender.sendLawLightFeed(a)},r=function(){AllianceSender.sendLawLightFeedAll(a)},s=function(){return v()},t=function(){return u(a.getImgr().getMyAlliance().getLevel())},u=function(a){var b=a-1;return res_alli_upd_needs[b]},v=function(){var b=d.getLawLightNextLevelRes(),c=a.getImgr().getMyAlliance(),e=c.getBuildVal()<b.needbuildval?COLORS.NO_ENOUGH_ITEM:COLORS.ENOUGH_ITEM,f=c.getCardNumber()<b.needcard?COLORS.NO_ENOUGH_ITEM:COLORS.ENOUGH_ITEM,g=TQ.format(rstr.alli.main.lawLight.tip.upgradeNeed,e,b.needbuildval,c.getBuildVal(),f,b.needcard,c.getCardNumber());return g}}),AlliAuctionClassifyItems=BaseClassifyItems.ex({_initClassItems:function(){this.classitems_=[{classid:RES_CLS.PKGITEM,items:[]},{classid:RES_CLS.EQUIPITEM,items:[]},{classid:RES_CLS.CANUSEITEM,items:[]},{classid:RES_CLS.OTHERITEM,items:[]},{classid:RES_CLS.MY_AUCTION_ITEM,items:[]}]},_getItems:function(){var a=this.g_.getImgr().getMyAlliance();return a.getAuctionItems()},_isSatisfiedBy:function(a,b){return a.classid==RES_CLS.MY_AUCTION_ITEM?b.ismy==1:this._isInRange(a,b)},_sortFun:function(a,b){return a.stopTime-b.stopTime}}),AlliAuctionLeftTimeState=JClass.ex({getLeftTimeState:function(a,b){var c=b-a.getSvrTimeS();return rstr.alli.main.lbl.leftTimeNames[this._getLeftTimeIdx(c)]},_getLeftTimeIdx:function(a){return a<0?0:a<7200?1:a<21600?2:a<43200?3:a<86400?4:5}}).snew(),AlliMainAuctionPanel=JClass.ex({init:function(a,b){this.TAB_MY_IDX=4,this.g_=a,this.items_=b,this.itemsClassify_=AlliAuctionClassifyItems.snew(this.g_),this._setCallers(),this._setTabsText()},show:function(){this.items_.paimaiTabs.activeTab(4),AllianceSender.sendGetAuctionInfo(this.g_)},hide:function(){},update:function(){this.itemsClassify_.refresh(),this._updateMyContribution(),this._updateList()},_setCallers:function(){this.items_.mySellBtn.setCaller({self:this,caller:this._onClickMySellBtn})},_updateMyContribution:function(){var a=this.g_.getImgr().getMyAlliance();TQ.setRichText(this.items_.myContribution,a.getSelfMember().getContributes())},_updateList:function(){for(var a=0;a<this.items_.paimaiTabs.getTabCount();++a){var b=this.items_.paimaiTabs.getTabItems(a).list,c=this.itemsClassify_.getClassItems(a).items;b.setItemCount(c.length);for(var d=0;d<b.getCount();++d){var e=b.getItem(d),f=c[d];TQ.setRichText(e.exsubs.itemName,f.itemres.name),TTIP.setCallerData(e.exsubs.tooltips.$item,{self:this,caller:this._onGetItemTip},{id:this._makeOwnerBtnId(a,d)}),TQ.setRichText(e.exsubs.itemNumber,f.num),e.exsubs.owner.setId(this._makeOwnerBtnId(a,d)),e.exsubs.owner.setCaller({self:this,caller:this._onClickOwner}),f.isboss?e.exsubs.owner.setText(rstr.alli.main.lbl.worldboss):e.exsubs.owner.setText(f.owner),TQ.setRichText(e.exsubs.auctionPrice,f.auction),TQ.setRichText(e.exsubs.fixedPrice,f.fixed),TQ.setRichText(e.exsubs.leftTime,AlliAuctionLeftTimeState.getLeftTimeState(this.g_,f.stopTime)),e.exsubs.auctionBuyBtn.setId(this._makeOwnerBtnId(a,d)),e.exsubs.auctionBuyBtn.setCaller({self:this,caller:this._onClickAuctionBuyBtn}),e.exsubs.fixedBuyBtn.setId(this._makeOwnerBtnId(a,d)),e.exsubs.fixedBuyBtn.setCaller({self:this,caller:this._onClickFixedBuyBtn}),a==this.TAB_MY_IDX&&e.exsubs.auctionBuyBtn.hide()}}},_setTabsText:function(){for(var a=0;a<rstr.alli.main.paimaiTabs.length;++a)this.items_.paimaiTabs.setTabText(a,rstr.alli.main.paimaiTabs[a])},_onGetItemTip:function(a){var b=this._splitOwnerBtnId(a.id),c=this.itemsClassify_.getItem(b.tabIdx,b.listIdx);return c=SysItemMaker.make(0,c.itemres),TIPM.getItemDesc(c,"sys")},_onClickOwner:function(a){var b=this._splitOwnerBtnId(a),c=this.itemsClassify_.getItem(b.tabIdx,b.listIdx);c.isboss==0?OutFieldSender.sendGetFieldDetailByRole(this.g_,c.owner):UIM.openDlg("worldboss")},_onClickAuctionBuyBtn:function(a){var b=this._splitOwnerBtnId(a),c=this.itemsClassify_.getItem(b.tabIdx,b.listIdx);c.ismy==1?this.g_.getGUI().sysMsgTips(SMT_WARNING,rstr.alli.main.tip.isMyAuctionItem):c.owner==this.g_.getImgr().getRoleName()?this.g_.getGUI().sysMsgTips(SMT_WARNING,rstr.alli.main.tip.myIsSeller):c.auction+AUCTION_STEP>=c.fixed?this.g_.getGUI().sysMsgTips(SMT_WARNING,rstr.alli.main.tip.beyondFixedPrice):UIM.openDlg("alliauctionbuy",{type:"auction",item:c})},_onClickFixedBuyBtn:function(a){var b=this._splitOwnerBtnId(a),c=this.itemsClassify_.getItem(b.tabIdx,b.listIdx);c.owner==this.g_.getImgr().getRoleName()?this.g_.getGUI().sysMsgTips(SMT_WARNING,rstr.alli.main.tip.myIsSeller):UIM.openDlg("alliauctionbuy",{type:"fixed",item:c})},_makeOwnerBtnId:function(a,b){return a*1e4+b},_splitOwnerBtnId:function(a){var b=Math.floor(a/1e4),c=a%1e4;return{tabIdx:b,listIdx:c}},_onClickMySellBtn:function(){UIM.openDlg("allimysell")}}),AlliTransferDlg=Class.extern(function(){var a=null,b=null,c=null,d={};this.init=function(c){a=c,b=this,a.regEvent(EVT.NET,NETCMD.ALLIANCE,b,l)},this.openDlg=function(){e(),h(),i()};var e=function(){if(c)return;f(),g()},f=function(){c=Dialog.snew(a,{modal:!1,title:rstr.alli.transferdlg.title,pos:{x:"center",y:40}}),a.getGUI().initDlg(c,uicfg.alli.transferdlg,d)},g=function(){d.confirmBtn.setCaller({self:b,caller:j}),d.cancelBtn.setCaller({self:b,caller:k})},h=function(){c.show()},i=function(){AllianceSender.sendGetALeaders(a),d.names.deleteAllItem(),d.names.setCurSel(-1),d.names.setTitle(rstr.alli.transferdlg.lbl.dropTitle)},j=function(){if(d.names.getCurSel()<0){a.getGUI().sysMsgTips(SMT_WARNING,rstr.alli.transferdlg.tip.selectTransferTarget);return}var c=TQ.format(rstr.alli.transferdlg.tip.confirmTransfer,d.names.getTitle());a.getGUI().msgBox(rstr.comm.msgts,c,MB_F_YESNO,{self:b,caller:function(b){b==MB_IDYES&&AllianceSender.sendTransferLeader(a,d.names.getTitle())}})},k=function(){c.hide()},l=function(a){if(!c||!c.isShow())return;if(!a.data.aleaders)return;d.names.deleteAllItem();for(var b=0;b<a.data.aleaders.length;++b){var e=a.data.aleaders[b];d.names.addItem({text:e})}}}),AlliUnTransferDlg=Class.extern(function(){var a=null,b=null,c=null,d={};this.init=function(c){a=c,b=this},this.openDlg=function(){e(),h(),i()};var e=function(){if(c)return;f(),g()},f=function(){c=Dialog.snew(a,{modal:!1,title:rstr.alli.untransferdlg.title,pos:{x:"center",y:40}}),a.getGUI().initDlg(c,uicfg.alli.untransferdlg,d)},g=function(){d.stopTransferBtn.setCaller({self:b,caller:j})},h=function(){c.show()},i=function(){var b=a.getImgr().getMyAlliance();TQ.setTextEx(d.name,TQ.format(rstr.alli.untransferdlg.lbl.newname,b.getTransferName()));var c=TQ.formatTime(0,b.getTransferStopTime()-a.getSvrTimeS());TQ.setTextEx(d.leftTime,TQ.format(rstr.alli.untransferdlg.lbl.lefttime,c))},j=function(){a.getGUI().msgBox(rstr.comm.msgts,rstr.alli.untransferdlg.tip.stopTransfer,MB_F_YESNO,{self:b,caller:function(b){b==MB_IDYES&&AllianceSender.sendStopTransfer(a)}})}}),AlliSubscribeDlg=Class.extern(function(){var a=12,b=0,c=1,d=null,e=null,f=null,g={},h=[rstr.comm.food,rstr.comm.wood,rstr.comm.stone,rstr.comm.iron,rstr.comm.card];this.init=function(a){d=a,e=this,d.regEvent(EVT.CITYRES,0,e,z),d.regEvent(EVT.SELFALLIMEM_CHANGE,0,e,A),d.regEvent(EVT.PKG_CHANGE,0,e,B),d.regEvent(EVT.NET,NETCMD.ALLIANCE,e,C)},this.openDlg=function(){i(),p(),q()};var i=function(){if(f)return;j(),k(),l(),m()},j=function(){f=Dialog.snew(d,{modal:!1,title:rstr.alli.subscribedlg.title,pos:{x:"center",y:40}}),d.getGUI().initDlg(f,uicfg.alli.subscribedlg,g)},k=function(){g.list.setItemCount(h.length);for(var a=0;a<g.list.getCount();++a)TQ.setTextEx(g.list.getItem(a).exsubs.resName,h[a])},l=function(){for(var a=0;a<rstr.alli.subscribedlg.tabs.length;++a){var b=rstr.alli.subscribedlg.tabs[a];g.tablist.setTabText(a,b)}},m=function(){n(),o()},n=function(){for(var a=0;a<g.list.getCount();++a){var b=g.list.getItem(a);b.exsubs.inum.setId(a),b.exsubs.inum.setLimit(v),b.exsubs.contributeBtn.setId(a),b.exsubs.contributeBtn.setCaller({self:e,caller:w}),a<g.list.getCount()-1?b.exsubs.buyBtn.hide():b.exsubs.buyBtn.show(),b.exsubs.buyBtn.setCaller({self:e,caller:x})}},o=function(){for(var a=0;a<g.tablist.getTabCount();++a){var b=g.tablist.getTabItems(a).pageBar;b.setId(a),b.setCaller({self:e,caller:y})}},p=function(){f.show()},q=function(){r(),s(),t(),u()},r=function(){g.tablist.activeTab(0)},s=function(){for(var a=0;a<g.tablist.getTabCount();++a){var b=g.tablist.getTabItems(a).pageBar;b.activePage(1,!0)}},t=function(){var a=d.getImgr().getMyAlliance().getSelfMember().getContributes();TQ.setTextEx(g.myContributes,a)},u=function(){var a=I();for(var b=0;b<g.list.getCount();++b){var c=g.list.getItem(b),d="";b<g.list.getCount()-1?d=TQ.format(rstr.alli.subscribedlg.lbl.curHas,h[b],a[b]):(d=TQ.format(rstr.alli.subscribedlg.lbl.curHasCard,h[b],a[b]),TQ.setTextEx(c.exsubs.unitName,rstr.alli.subscribedlg.lbl.oneUnit)),TQ.setTextEx(c.exsubs.curHas,d)}},v=function(a){var b=I();return{min:0,max:b[a]}},w=function(a){var b=g.list.getItem(a),c=b.exsubs.inum.getVal();c>0&&(AllianceSender.sendContributeRes(d,a,c),AllianceSender.sendGetTodaySortMems(d,g.tablist.getTabItems(0).pageBar.getCurPage()),AllianceSender.sendGetAllSortMems(d,g.tablist.getTabItems(1).pageBar.getCurPage()))},x=function(){UIM.getDlg("buyitem").openDlg({id:0,resid:FIXID.ALLI_CARD,number:1e5})},y=function(a,c){c==b?AllianceSender.sendGetTodaySortMems(d,a):AllianceSender.sendGetAllSortMems(d,a)},z=function(){if(!H())return;u()},A=function(){if(!H())return;t()},B=function(){if(!H())return;u()},C=function(a){if(!H())return;D(a.data),E(a.data)},D=function(a){G(0,a,F(a),a.todaysortmems,{name:"name",res:"todayRes",card:"todayCard"})},E=function(a){G(1,a,F(a),a.allsortmems,{name:"name",res:"totalRes",card:"totalCard"})},F=function(b){return(b.pageNo-1)*a+1},G=function(a,b,c,d,e){if(!d)return;var f=g.tablist.getTabItems(a);f.pageBar.setPageCnt(b.pageCount),f.pageBar.activePage(b.pageNo,!1,!0),f.list.setItemCount(d.length);for(var h=0;h<f.list.getCount();++h){var i=f.list.getItem(h),j=d[h];TQ.setTextEx(i.exsubs.rank,c+h),TQ.setTextEx(i.exsubs.name,j[e.name]),TQ.setTextEx(i.exsubs.res,j[e.res]+rstr.alli.subscribedlg.lbl.wan),TQ.setTextEx(i.exsubs.card,j[e.card])}},H=function(){return f?f.isShow():!1},I=function(){var a=d.getImgr().getCityRes().cres,b=[a.food,a.wood,a.stone,a.iron];for(var c=0;c<b.length;++c)b[c]=Math.floor(b[c]/1e4);return b.push(d.getImgr().getItemNumByResId(FIXID.ALLI_CARD)),b}}),AlliMemInfoDlg=Class.extern(function(){var a=null,b=null,c=null,d={},e=null,f=[],g=function(){};this.init=function(c){a=c,b=this},this.setObserver=function(a){g=a},this.openDlg=function(a){h(a),i(),l(),m()};var h=function(a){e=a},i=function(){if(c)return;j(),k()},j=function(){c=Dialog.snew(a,{modal:!1,title:rstr.alli.meminfodlg.title,pos:{x:"center",y:40}}),a.getGUI().initDlg(c,uicfg.alli.meminfodlg,d)},k=function(){d.appointBtn.setCaller({self:b,caller:s}),d.fireBtn.setCaller({self:b,caller:t}),d.chatBtn.setCaller({self:b,caller:u}),d.mailBtn.setCaller({self:b,caller:v}),d.friendBtn.setCaller({self:b,caller:w})},l=function(){c.show()},m=function(){n(),o(),p(),q(),r()},n=function(){IMG.setBKImage(d.icon,IMG.makeBigImg(e.icon)),TQ.setTextEx(d.name,e.name),TQ.setTextEx(d.alliName,a.getImgr().getMyAlliance().getName()),TQ.setTextEx(d.alliPos,rstr.alli.alliposs[e.alliPos]),TQ.setTextEx(d.level,e.level),TQ.setTextEx(d.roleRank,e.roleRank),TQ.setTextEx(d.buildCurVal,e.buildCurVal),TQ.setTextEx(d.contributes,e.contributes);var b=FieldUtil.getPosByGridId(e.gridId),c="#[m:"+b.x+":"+b.y+"]";TQ.setTextEx(d.cood,HyperLinkMgr.formatLink(c))},o=function(){d.alliPosDropList.deleteAllItem(),f=[];var b=a.getImgr().getMyAlliance().getSelfMember().getAlliPos();b==ALLI_POS.LEADER?f=[ALLI_POS.ALEADER,ALLI_POS.ELDER,ALLI_POS.MEM]:b==ALLI_POS.ALEADER&&(f=[ALLI_POS.ELDER,ALLI_POS.MEM]);for(var c=0;c<f.length;++c)d.alliPosDropList.addItem({text:rstr.alli.alliposs[f[c]]})},p=function(){TQ.find(f,null,e.alliPos),d.alliPosDropList.setCurSel(TQ.getLastFindIdx())},q=function(){var b=a.getImgr().getMyAlliance().getSelfMember().getAlliPos();b>e.alliPos&&b>=ALLI_POS.ALEADER?TQ.setCSS(d.appointContainer,"display","block"):TQ.setCSS(d.appointContainer,"display","none")},r=function(){var b=a.getImgr().getMyAlliance().getSelfMember().getAlliPos();b>e.alliPos?d.fireBtn.show():d.fireBtn.hide()},s=function(){var h=d.alliPosDropList.getCurSel(),i=f[h];if(i==e.alliPos){a.getGUI().sysMsgTips(SMT_WARNING,rstr.alli.meminfodlg.tip.noChangeAppoint);return}var j=TQ.format(rstr.alli.meminfodlg.tip.confirmAppoint,e.name,d.alliPosDropList.getTitle());a.getGUI().msgBox(rstr.comm.msgts,j,MB_F_YESNO,{self:b,caller:function(b){b==MB_IDYES&&(AllianceSender.sendAppointMember(a,e.name,i),g())}}),c.hide()},t=function(){var d=TQ.format(rstr.alli.meminfodlg.tip.confirmFire,e.name);a.getGUI().msgBox(rstr.comm.msgts,d,MB_F_YESNO,{self:b,caller:function(b){b==MB_IDYES&&(AllianceSender.sendFireMember(a,e.name),g())}}),c.hide()},u=function(){UIM.getPanel("chat").setChatTarget(e.name),c.hide()},v=function(){UIM.getDlg("writeletter").writeLetterTo(e.name),c.hide()},w=function(){FriendSender.sendApplyFriend(a,e.name)}}),AlliApplyListDlg=Class.extern(function(){var a=null,b=null,c=null,d={},e=[];this.init=function(c){a=c,b=this,a.regEvent(EVT.NET,NETCMD.ALLIANCE,b,j)},this.openDlg=function(){f(),h(),i()};var f=function(){if(c)return;g()},g=function(){c=Dialog.snew(a,{modal:!1,title:rstr.alli.applylistdlg.title,pos:{x:"center",y:40}}),a.getGUI().initDlg(c,uicfg.alli.applylistdlg,d)},h=function(){c.show()},i=function(){k()},j=function(a){if(!a.data.applys)return;TQ.dictCopy(e,a.data.applys),c&&c.isShow()&&k()},k=function(){l(),m()},l=function(){d.list.setItemCount(e.length);for(var a=0;a<d.list.getCount();++a){var b=d.list.getItem(a),c=e[a];TQ.setTextEx(b.exsubs.name,c.roleName),TQ.setTextEx(b.exsubs.level,c.level),TQ.setTextEx(b.exsubs.buildVal,c.buildVal)}},m=function(){for(var a=0;a<d.list.getCount();++a){var c=d.list.getItem(a);c.exsubs.agreeBtn.setId(a),c.exsubs.refuseBtn.setId(a),c.exsubs.agreeBtn.setCaller({self:b,caller:n}),c.exsubs.refuseBtn.setCaller({self:b,caller:o})}},n=function(b){AllianceSender.sendAgreeApply(a,e[b].roleId)},o=function(b){AllianceSender.sendIgnoreApply(a,e[b].roleId)}}),AlliEventsDlg=Class.extern(function(){var a,b,c,d={},e=[];this.init=function(c){a=c,b=this,a.regEvent(EVT.NET,NETCMD.ALLIANCE,b,l)},this.openDlg=function(){f(),i(),j()},this.hideDlg=function(){c&&c.hide()};var f=function(){if(c)return;g(),h()},g=function(){c=Dialog.snew(a,{modal:!1,title:rstr.alli.eventsdlg.title,pos:{x:"center",y:40}}),a.getGUI().initDlg(c,uicfg.alli.eventsdlg,d)},h=function(){d.pageBar.setCaller({self:b,caller:k})},i=function(){c.show()},j=function(){d.pageBar.activePage(1,!0)},k=function(b){AllianceSender.sendGetEvents(a,b)},l=function(a){var b=a.data.events;if(!b)return;if(!c||!c.isShow())return;d.pageBar.setPageCnt(b.pageCount),d.pageBar.activePage(b.pageNo,!1,!0),d.list.setItemCount(b.list.length);for(var e=0;e<d.list.getCount();e++){var f=d.list.getItem(e),g=b.list[e];TQ.setTextEx(f.exsubs.desc,g.desc),TQ.setTextEx(f.exsubs.time,TQ.formatDateTime(g.time))}}}),AlliMergeDlg=Class.extern(function(){var a=null,b=null,c=null,d={},e=[];this.init=function(c){a=c,b=this,a.regEvent(EVT.NET,NETCMD.ALLIANCE,b,k)},this.openDlg=function(){f(),i(),j()};var f=function(){if(c)return;g(),h()},g=function(){c=Dialog.snew(a,{modal:!1,title:rstr.alli.mergedlg.title,pos:{x:"center",y:40}}),a.getGUI().initDlg(c,uicfg.alli.mergedlg,d)},h=function(){d.applyMergeBtn.setCaller({self:b,caller:n})},i=function(){c.show()},j=function(){AllianceSender.sendGetApplyMerges(a)},k=function(a){var b=a.data.applymerges;if(!b)return;if(!c||!c.isShow())return;TQ.dictCopy(e,b),l(),m()},l=function(){d.list.setItemCount(e.length);for(var a=0;a<d.list.getCount();a++){var b=d.list.getItem(a),c=e[a];TQ.setTextEx(b.exsubs.name,c.name),TQ.setTextEx(b.exsubs.level,c.level),TQ.setTextEx(b.exsubs.leader,c.leader)}},m=function(){for(var a=0;a<d.list.getCount();a++){var c=d.list.getItem(a);c.exsubs.agreeBtn.setId(a),c.exsubs.refuseBtn.setId(a),c.exsubs.agreeBtn.setCaller({self:b,caller:p}),c.exsubs.refuseBtn.setCaller({self:b,caller:q})}},n=function(){var a=UIM.getDlg("inputtext");a.openDlg(rstr.alli.mergedlg.lbl.applyMergeTip,JVALID.getMaxAlliLen()),a.setCaller({self:b,caller:o})},o=function(b){JVALID.checkAlliname(b)?AllianceSender.sendApplyMerge(a,b):a.getGUI().sysMsgTips(SMT_WARNING,rstr.ids[100116].msg)},p=function(d){a.getGUI().msgBox(rstr.comm.msgts,rstr.alli.mergedlg.tip.confirmMerge,MB_F_YESNO,{self:b,caller:function(b){b==MB_IDYES&&AllianceSender.sendAgreeMerge(a,e[d].name)}}),c.hide()},q=function(b){AllianceSender.sendRefuseMerge(a,e[b].name)}})