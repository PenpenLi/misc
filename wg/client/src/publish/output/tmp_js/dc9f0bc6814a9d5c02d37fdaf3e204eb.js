PayActDlg=BaseDlg.extern(function(){this._init=function(){this.g_.regEvent(EVT.NET,NETCMD.ACTIVITY_VAL,this,this._onSvrPkg),this.g_.regEvent(EVT.PAYACT,0,this,this._onPayAct)},this._getDlgCfg=function(){return{modal:!1,title:rstr.payActDlg.title,pos:{x:"center",y:40},uicfg:uicfg.payActDlg}},this._setCallers=function(){this.dlg_.setCaller({self:this,caller:this._onDlgEvent}),this.items_.payBtn.setCaller({self:this,caller:this._onClickPayBtn})},this._afterCreate=function(){for(var a=0;a<this.items_.list.getCount();++a){var b=this.items_.list.getItem(a),c=res_pay_act_gifts[a];TTIP.setCallerData(b.exsubs.tooltips.$item,{self:this,caller:this._onGetRewardItemTip},{itemtip:c.itemtip}),b.exsubs.getBtn.setId(a),b.exsubs.getBtn.setCaller({self:this,caller:this._onClickGetBtn}),TQ.setText(b.exsubs.number,c.allpay)}TTIP.setCallerData(this.items_.tooltips.$returntip,{self:this,caller:this._onGetReturnRuleTip},{})},this._initInfo=function(){this._update(),this.g_.regUpdater(this,this._onUpdater,1e3)},this._onUpdater=function(){this._updateLeftTime()},this._onSvrPkg=function(a){var b=a.data;b.payGiftGots&&(this.g_.getImgr().getPayAct().payGiftGots=b.payGiftGots),b.payActAllGold&&(this.g_.getImgr().getPayAct().payActAllGold=b.payActAllGold),b.payActTime&&TQ.dictCopy(this.g_.getImgr().getPayAct().payActTime,b.payActTime),(b.payGiftGots||b.payActAllGold||b.payActTime)&&this.g_.sendEvent({eid:EVT.PAYACT,sid:0})},this._onPayAct=function(){this._update()},this._onClickPayBtn=function(){JMISC.openPayWnd()},this._onDlgEvent=function(a){a==C_SYS_DLG_HIDE&&this.g_.unregUpdater(this,this._onUpdater)},this._onGetRewardItemTip=function(a){return TIPM.makeItemTip(a.itemtip)},this._onGetReturnRuleTip=function(){var a="";for(var b=0;b<res_pay_act_returns.length;++b)a+=res_pay_act_returns[b].desc+"<br/>";return a+=rstr.payActDlg.tip.returnRule,TIPM.makeItemTip2(a)},this._onClickGetBtn=function(a){ActivityValSender.sendGetPayActReward(this.g_,a)},this._update=function(){if(!this.isShow())return;this._updateActTime(),this._updateLeftTime(),this._updatePayGold(),this._updateReturnPer(),this._updatePayGoldProg(),this._updateGetBtnsState(),this._updateBkImage(),this._updateReturnRuleDesc()},this._updateActTime=function(){var a=this.g_.getImgr().getPayAct().payActTime,b=TQ.format(rstr.payActDlg.lbl.payActTime,TQ.formatDate(a.start),TQ.formatDate(a.stop));TQ.setRichText(this.items_.actTime,b)},this._updateLeftTime=function(){var a=this.g_.getImgr().getPayAct().payActTime,b=a.stop+86400-this.g_.getSvrTimeS(),c=TQ.format(rstr.payActDlg.lbl.leftTime,TQ.formatTime(2,b));TQ.setRichText(this.items_.leftTime,c)},this._updatePayGold=function(){TQ.setRichText(this.items_.payGold,this.g_.getImgr().getPayAct().payActAllGold);var a=this._getCurGiftLevel();if(a<res_pay_act_gifts.length){var b=a+1-1,c=res_pay_act_gifts[b],d=c.allpay-this.g_.getImgr().getPayAct().payActAllGold,e=TQ.format(rstr.payActDlg.lbl.nextLevelGift,a+1);TQ.setRichText(this.items_.nextLevelPayGold,TQ.format(rstr.payActDlg.lbl.nextLevelPayGold,d,e))}else TQ.setRichText(this.items_.nextLevelPayGold,"")},this._updateReturnPer=function(){if(this._hasReturn()){TQ.setRichText(this.items_.returnPer,this._getReturnPer()+"%");var a=Math.ceil(this.g_.getImgr().getPayAct().payActAllGold*this._getReturnPer()/1e3)*10;TQ.setRichText(this.items_.returnVal,a+rstr.comm.giftgold)}else TQ.setRichText(this.items_.returnPer,""),TQ.setRichText(this.items_.returnVal,"")},this._updatePayGoldProg=function(){var a=458,b=a/res_pay_act_gifts.length,c=this._getCurGiftLevel(),d=c-1,e=c+1-1,f=0,g=this.g_.getImgr().getPayAct().payActAllGold;c==0?f=res_pay_act_gifts[e].allpay:c<res_pay_act_gifts.length?(f=res_pay_act_gifts[e].allpay-res_pay_act_gifts[d].allpay,g-=res_pay_act_gifts[d].allpay):(f=1,g=0);var h=c*b+g/f*b;TQ.setCSS(this.items_.valProg,"width",h+"px")},this._updateGetBtnsState=function(){var a=this.g_.getImgr().getPayAct().payGiftGots,b=this._getCurGiftLevel();for(var c=0;c<this.items_.list.getCount();++c){var d=this.items_.list.getItem(c),e=a[c],f=e==0&&c<b;d.exsubs.getBtn.enable(f)}},this._updateBkImage=function(){this._hasReturn()?IMG.setBKImage(this.items_.bk_img,IMG.makeImg("payactdlg/bk.jpg")):IMG.setBKImage(this.items_.bk_img,IMG.makeImg("payactdlg/bk_noret.jpg"))},this._updateReturnRuleDesc=function(){this._hasReturn()?(TQ.setCSS(this.items_.returnRuleTip,"display","block"),TQ.setCSS(this.items_.returnRuleDesc,"display","block")):(TQ.setCSS(this.items_.returnRuleTip,"display","none"),TQ.setCSS(this.items_.returnRuleDesc,"display","none"))},this._getCurGiftLevel=function(){var a=0;for(var b=0;b<res_pay_act_gifts.length;++b){var c=res_pay_act_gifts[b];this.g_.getImgr().getPayAct().payActAllGold>=c.allpay&&(a=b+1)}return a},this._getReturnPer=function(){var a=100;for(var b=0;b<res_pay_act_returns.length;++b){var c=res_pay_act_returns[b];if(this.g_.getImgr().getPayAct().payActAllGold<c.allpay){a=c.returnper;break}}return a},this._hasReturn=function(){return res_pay_act_returns[res_pay_act_returns.length-1].returnper>0}})