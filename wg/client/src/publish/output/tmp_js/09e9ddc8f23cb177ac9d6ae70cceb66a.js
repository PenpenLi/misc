var actorstate_log=function(a){};StateFactory=Class.extern(function(){this.C_MOVESPEED=.08,this.g=null,this.initOneTime=function(a){this.g=a},this.createByType=function(a,b,c,d){return c?c=="standstate"?StandState.snew(a):c=="lockedstate"?LockedState.snew(a):c=="hurtstate"?HurtState.snew(this.g,b,d):c=="attackstate"?AttackState.snew(a,b,d):c=="diestate"?DieState.snew(this.g,a):c=="movestate"?MoveState.snew(a,this._createRoute(a.getPosition(),d.paths)):NullState:NullState},this._createRoute=function(a,b){var c=0;b[0].x==a.x&&b[0].y==a.y&&(c=1);var d=[];d.push({x:a.x,y:a.y});for(var e=c;e<b.length;++e)d.push({x:b[e].x,y:b[e].y});return MoveRoute.snew(this.g,this.C_MOVESPEED,d)}}).snew(),BaseState=Class.extern(function(){this.type_="base",this.isIdle=function(){return!1},this.start=function(){},this.update=function(){},this.end=function(){}}),NullState=BaseState.extern(function(){this.type_="null",this.isIdle=function(){return!0}}).snew(),StandState=BaseState.extern(function(){this.type_="stand",this.actor=null,this.init=function(a){this.actor=a},this.isIdle=function(){return!0},this.start=function(){this.actor.setAction("stand")}}),LockedState=BaseState.extern(function(){this.type_="locked",this.actor=null,this.init=function(a){this.actor=a},this.start=function(){this.actor.setAction("stand")}}),MoveState=BaseState.extern(function(){this.type_="move",this.actor=null,this.route=null,this.init=function(a,b){this.actor=a,this.route=b},this.start=function(){this.actor.setAction("walk")},this.update=function(){this.route.update(),this.actor.setPosition(this.route.getPosition()),this.actor.setDirection(this.route.getDirection()),this.route.isEnd()&&this.actor.setState(StateFactory.createByType(this.actor,null,"standstate",{}))}}),AttackState=BaseState.extern(function(){this.type_="attack",this.source=null,this.target=null,this.action=null,this.skill_=null,this.init=function(a,b,c){this.source=a,this.target=b,this.action=c},this.start=function(){this.source.setAction("attack"),this.target.setState(StateFactory.createByType(this.target,null,"lockedstate",{}));var a=DirectionVector.calcDirectionVector(this.source.getPosition(),this.target.getPosition());this.source.setDirection(DirectionVector.getDirectionByVector(a)),this.source.getAnim().addCaller({self:this,caller:this._onAnimStop}),actorstate_log(this.source.getResId()+" attack "+this.target.getResId()+" start")},this.update=function(){var a=this.source.getAnim();a.isTriggerTime()&&(a.setTriggered(),actorstate_log(this.source.getResId()+" attack "+this.target.getResId()+" trigge skill start"),this.skill_=SkillManager.addSkill(this.source.getParent(),this.action,this.source,this.target),actorstate_log(this.source.getResId()+" attack "+this.target.getResId()+" trigge skill end")),a.isEnd()&&this.skill_&&this.skill_.isEnd()&&(actorstate_log(this.source.getResId()+" attack "+this.target.getResId()+" set standstate 1"),this._setStandState())},this._onAnimStop=function(a){actorstate_log(this.source.getResId()+" attack "+this.target.getResId()+" set standstate 2"),this.update(),this._setStandState()},this._setStandState=function(){this.source.setState(StateFactory.createByType(this.source,null,"standstate",{}))},this.end=function(){actorstate_log(this.source.getResId()+" attack "+this.target.getResId()+" end"),this.source.getAnim().removeCaller({self:this,caller:this._onAnimStop})}}),HurtState=BaseState.extern(function(){this.type_="hurt",this.g_=null,this.actor=null,this.action=null,this.init=function(a,b,c){this.g_=a,this.actor=b,this.action=c},this.start=function(){this.actor.setAction("hurt"),this.actor.getAnim().addCaller({self:this,caller:this._onAnimStop}),actorstate_log(this.actor.getResId()+" be hurt start")},this.update=function(){var a=this.actor.getAnim();a.isTriggerTime()&&(actorstate_log(this.actor.getResId()+" hurt trigge effect start"),a.setTriggered(),EffectManager.addMapEffect(this.actor.isHero(),this.action),actorstate_log(this.actor.getResId()+" hurt trigge effect end")),a.isEnd()&&(actorstate_log(this.actor.getResId()+" hurt set standstate 1"),this._setStandState())},this._onAnimStop=function(a){actorstate_log(this.actor.getResId()+" hurt set standstate 2"),this.update(),this._setStandState()},this._setStandState=function(){this.actor.setState(StateFactory.createByType(this.actor,null,"standstate",{}))},this.end=function(){actorstate_log(this.actor.getResId()+" hurt end"),this.actor.getAnim().removeCaller({self:this,caller:this._onAnimStop})}}),DieState=BaseState.extern(function(){this.type_="die",this.g_=null,this.actor=null,this.init=function(a,b){this.g_=a,this.actor=b},this.start=function(){this.actor.setAction("die"),actorstate_log(this.actor.getResId()+" die start")},this.isIdle=function(){return!0},this.update=function(){var a=this.actor.getAnim();a.isEnd()&&(actorstate_log(this.actor.getResId()+" die in update start"),this.actor.die(),this.g_.getActorMgr().remove(this.actor),actorstate_log(this.actor.getResId()+" die in update end"))}})