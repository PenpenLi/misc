FieldUtil=Class.extern(function(){this.init=function(){this.cityIdMapResId={},this.cityIdMapResId[1]=9900001,this.cityIdMapResId[2]=9900002,this.cityIdMapResId[3]=9900003,this.cityIdMapResId[4]=9900004},this.getPosByGridId=function(a){var b=a-1,c={x:0,y:0};return c.x=Math.floor(b%C_OUTFIELD_ROW_GRIDS),c.y=Math.floor(b/C_OUTFIELD_ROW_GRIDS),c},this.getGridIdByPos=function(a){return a.y*C_OUTFIELD_ROW_GRIDS+a.x+1},this.getCityResIdByGridId=function(a){var b=this.getPosByGridId(a),c=1;for(var d=4;d>=1;--d)if(this._isInRects(res_maprects[d],b)){c=d;break}return this.cityIdMapResId[c]},this.getCityResIdByPos=function(a){var b=this.getGridIdByPos(a);return this.getCityResIdByGridId(b)},this.getCityNameByGridId=function(a){var b=this.getCityResIdByGridId(a),c=ItemResUtil.findItemres(b);return c?c.name:""},this.getFieldName=function(a){if(a.objType==OBJ_TYPE.ROLE)return rstr.comm.cityfield;if(a.objType==OBJ_TYPE.NPCFIELD)return rstr.comm.npcfield;if(a.objType==OBJ_TYPE.NONE)return rstr.comm.emptyfield;var b=ItemResUtil.findItemres(a.resid);return TQ.format(rstr.comm.flevelsomething,a.level,b.name)},this.makeFieldFromSelfField=function(a){return{gridId:a.id,resid:a.resid,level:a.level,objType:OBJ_TYPE.FIELD}},this._isInRects=function(a,b){for(var c=0;c<a.length;++c){var d=a[c];if(b.x>=d[0]&&b.x<d[2]&&b.y>=d[1]&&b.y<d[3])return!0}return!1}}).snew(),EmptyFieldDlg=Class.extern(function(){var a=null,b=null,c=null,d=null,e={};this.init=function(c){a=c,b=this},this.openDlg=function(a){c=a,UIM.closeAllFieldDlg(),f(),h(),i()},this.closeDlg=function(){if(!d)return;d.hide()};var f=function(){if(d)return;d=Dialog.snew(a,{modal:!1,title:rstr.field.emptyfielddlg.title,pos:{x:"center",y:50}}),a.getGUI().initDlg(d,uicfg.field.emptyfielddlg,e),g()},g=function(){e.favoriteBtn.setCaller({self:b,caller:j}),e.transferBtn.setCaller({self:b,caller:k})},h=function(){d.show()},i=function(){var a=FieldUtil.getPosByGridId(c.gridId),b=FieldUtil.getCityResIdByGridId(c.gridId),d=ItemResUtil.findItemres(b),f=TQ.format(rstr.field.emptyfielddlg.lbl.cityNamePos,d.name,a.x,a.y);TQ.setTextEx(e.cityNamePos,f)},j=function(){MilitarySender.sendAddFavorite(a,c.gridId)},k=function(){var b=a.getImgr().getItemResByEffect(RES_EFF.SETPOS_MOVECITY),e=a.getImgr().getItemNumByResId(b.id);if(e==0){var f=RStrUtil.makeNoItemBuyMsg(a,b.id,1);a.getGUI().msgBox(rstr.comm.msgts,f,MB_F_CLOSE,null);return}var g=function(e){if(e==MB_IDYES){var f={id:0,resid:b.id},g=FieldUtil.getPosByGridId(c.gridId);UseItemSender.send(a,f,1,{type:b.targets[0],posX:g.x,posY:g.y}),OutFieldSender.sendRefreshFieldsByLastViewPos(a),d.hide()}};a.getGUI().msgBox(rstr.comm.msgts,rstr.field.emptyfielddlg.lbl.confirmTran,MB_F_YESNO,{self:this,caller:g})}})