Validator=function(){var a,b,c=3,d=12,e=1,f=30,g=45,h=1,i=500,j=750,k=2,l=5,m=3,n=8,o=50,p=[" ","\\","'",'"',"<",">"],q=3,r=12,s=100,t=150,u=1,v=1,w=400,x=600,y=400,z=600;this.initialize=function(){b=this},this.checkUsername=function(a){return A(a,c,d)},this.checkHeroname=function(a){return A(a,m,n)},this.checkAlliname=function(a){return A(a,q,r)},this.checkAlliFlagName=function(a){return a?a.length!=v?!1:B(a):!1},this.checkEmailTitle=function(a){return a.length<e||a.length>f?!1:!0},this.checkEmailContent=function(a){return a.length<h||a.length>i?!1:!0},this.checkGroupName=function(a){return A(a,k,l)},this.checkShopName=function(a){return A(a,b.getMinShopLen(),b.getMaxShopLen())},this.getMaxUserLen=function(){return d},this.getMaxCDKeyLen=function(){return 20},this.getMinUserLen=function(){return c},this.getMaxGroupLen=function(){return l},this.getMaxDescGroupLen=function(){return o},this.getMinHeroLen=function(){return m},this.getMaxHeroLen=function(){return n},this.getMinAlliLen=function(){return q},this.getMaxAlliLen=function(){return r},this.getMinAlliFlagLen=function(){return u},this.getMaxAlliFlagLen=function(){return v},this.getMinShopLen=function(){return c},this.getMaxShopLen=function(){return d+3},this.getMaxMailTitleLen=function(){return f},this.getMaxMailTitleBytes=function(){return g},this.getMaxMailContentLen=function(){return i},this.getMaxMailContentBytes=function(){return j},this.getSelfSignMaxLen=function(){return s},this.getSelfSignMaxBytes=function(){return t},this.getMaxAllianceIntroduceGBKBytes=function(){return w},this.getMaxAllianceIntroduceBytes=function(){return x},this.getMaxAllianceBulletinGBKBytes=function(){return y},this.getMaxAllianceBulletinBytes=function(){return z};var A=function(a,b,c){var d=UnicodeStr.gbkLen(a);return d<b||d>c?!1:B(a)?!0:!1},B=function(a){for(var b in p)if(a.indexOf(p[b])>=0)return!1;return!0};this.initialize.apply(this,arguments)},JVALID=new Validator,CommDrawItem=Class.extern(function(){var a;this.init=function(){a=this},this.drawItemIconAndName=function(a,b,c){this.drawItemIcon(a,c),this.drawItemName(b,c)},this.drawItemIcon=function(a,b){IMG.setBKImage(a,IMG.makeBigImg(b.bigpic)),d(a,b)},this.drawItemName=function(a,b){b.name&&TQ.setRichText(a,ItemNameColorGetter.getColorVal(b.level,b.name))},this.drawPkgItem=function(a,c,d){e(a,b(c,d)),this.drawItemIconAndName(a.exsubs.icon,a.exsubs.name,c.itemres)},this.drawIconAndNumber=function(a,c,d){e(a,b(c,d)),this.drawItemIcon(a.exsubs.icon,c.itemres)};var b=function(a,b){return c(a,b)?a.number:""},c=function(a,b){return!a.number&&a.number!=0?!1:b?a.number:a.itemres.unique?!1:!a.itemres.pile||a.itemres.pile<=1?!1:!0},d=function(a,b){var c=b.level?b.level:1,d="item_icon_border_level"+c;TQ.setClass(a,d)},e=function(a,b){a.exsubs.fnum&&TQ.setTextEx(a.exsubs.fnum,b),a.exsubs.bnum&&TQ.setTextEx(a.exsubs.bnum,b),a.exsubs.num&&TQ.setTextEx(a.exsubs.num,b)}}).snew(),InputTextDlg=function(){var a=1,b=2,c,d,e,f={},g,h,i,j;this.initialize=function(a){c=a,d=this},this.openDlg=function(a,b,c,d){i=c,j=d,k(),l(a,b),e.show(),f.text.focus()},this.setCaller=function(a){g=a},this.isShow=function(){return e?e.isShow():!1},this.clickOk=function(){m(a)},this.setText=function(a){f.text.value=a},this.setTip=function(a){this.isShow()&&TQ.setTextEx(f.tip,a)};var k=function(){e||(e=Dialog.snew(c,{modal:!0,pos:{x:"center",y:100},uiback:uiback.dlg.npc,btns:[{btn:{id:a,text:rstr.comm.confirm},caller:{self:d,caller:m}},{btn:{id:b,text:rstr.comm.cancel},caller:{self:d,caller:m}}]}),c.getGUI().initDlg(e,uicfg.comm.inputtextdlg,f),e.hide())},l=function(a,b){TQ.setTextEx(f.label,a),TQ.setTextEx(f.tip,""),f.text.value="",InputLimit.maxGBKBytes(f.text,b,j)},m=function(b){b==a&&(i?i.invoke(f.text.value):g&&g.caller.call(g.self,f.text.value)),e.hide()};this.initialize.apply(this,arguments)},InputAreaTextDlg=function(){var a=1,b=2,c,d,e,f={},g,h;this.initialize=function(a){c=a,d=this},this.openDlg=function(a,b,c,d){i(),j(c,d),e.setTitle(a),e.show(),this.setContent(b),f.text.getContainerObj().focus(),f.text.refresh()},this.setCaller=function(a){g=a},this.clickOk=function(){k(a)},this.setContent=function(a){f.text.getContainerObj().value=a};var i=function(){e||(e=Dialog.snew(c,{modal:!0,title:"..",pos:{x:"center",y:60},btns:[{btn:{id:a,text:rstr.comm.confirm},caller:{self:d,caller:k}},{btn:{id:b,text:rstr.comm.cancel},caller:{self:d,caller:k}}]}),c.getGUI().initDlg(e,uicfg.comm.inputareatextdlg,f),e.hide())},j=function(a,b){TQ.setTextEx(f.label,a),f.text.getContainerObj().value="",InputLimit.maxGBKBytes(f.text.getContainerObj(),b)},k=function(b){b==a&&g&&g.caller.call(g.self,f.text.getContainerObj().value),e.hide()};this.initialize.apply(this,arguments)},InputNumDlg=function(){var a=1,b=2,c,d,e,f={},g=1,h,i=uicfg.comm.inputnumdlg;this.initialize=function(a,b){c=a,d=this,b&&(i=b)},this.openDlg=function(a,b){j(),k(a,b),e.show(),f.num.focus()},this.setNumber=function(a){f.num.setVal(a)},this.setCaller=function(a){h=a},this.isShow=function(){return e&&e.isShow()},this.click=function(){m(a)};var j=function(){e||(e=Dialog.snew(c,{modal:!0,pos:{x:"center",y:60},uiback:uiback.dlg.npc,btns:[{btn:{id:a,text:rstr.comm.confirm},caller:{self:d,caller:m}},{btn:{id:b,text:rstr.comm.cancel},caller:{self:d,caller:m}}]}),c.getGUI().initDlg(e,i,f),e.hide(),f.num.setLimit(l))},k=function(a,b){g=b,f.num.setVal(g),TQ.setTextEx(f.name,a)},l=function(){return{min:0,max:g}},m=function(b){if(b==a&&h){var c=f.num.getVal();h.caller.call(h.self,c)}e.hide()};this.initialize.apply(this,arguments)},UseItemTarget=function(){var a,b,c,d,e=[],f=[],g,h={};this.initialize=function(c){a=c,b=this,i()},this.set=function(a,b,e){d=a,c=b;var f=n(e);return o(f.getters),j(),f.needupdate},this.startUpdater=function(){a.regUpdater(b,m,1e3)},this.stopUpdater=function(){a.unregUpdater(b,m)};var i=function(){h[RES_TRG.SELF_HERO]={getter:new UseItemHeroGetter(a,RES_TRG.SELF_HERO),update:!1},h[RES_TRG.OBUILD]={getter:new UseItemBuildGetter(a,RES_TRG.OBUILD),update:!1},h[RES_TRG.IBUILD]={getter:new UseItemBuildGetter(a,RES_TRG.IBUILD),update:!1},h[RES_TRG.BUILDING_OBUILD]={getter:new UseItemBuildingGetter(a,RES_TRG.BUILDING_OBUILD),update:!0},h[RES_TRG.BUILDING_IBUILD]={getter:new UseItemBuildingGetter(a,RES_TRG.BUILDING_IBUILD),update:!0},h[RES_TRG.RECRUITING_SOLDIER]={getter:new UseItemBuildingSoldierGetter(a,RES_TRG.RECRUITING_SOLDIER),update:!0},h[RES_TRG.LEARNING_CULTURE]={getter:new UseItemBuildingCultureGetter(a,RES_TRG.LEARNING_CULTURE),update:!0},h[RES_TRG.MAKING_WEAPONRY]={getter:new UseItemBuildingWeaponryGetter(a,RES_TRG.MAKING_WEAPONRY),update:!0},h[RES_TRG.OBUILDRES]={getter:new UseItemOutBuildResGetter(a,RES_TRG.OBUILDRES),update:!1},h[RES_TRG.FARM]={getter:new UseItemOutBuildResGetter(a,RES_TRG.FARM),update:!1},h[RES_TRG.TIMBERYARD]={getter:new UseItemOutBuildResGetter(a,RES_TRG.TIMBERYARD),update:!1},h[RES_TRG.QUARRY]={getter:new UseItemOutBuildResGetter(a,RES_TRG.QUARRY),update:!1},h[RES_TRG.IRONORE]={getter:new UseItemOutBuildResGetter(a,RES_TRG.IRONORE),update:!1}},j=function(){f=[],g=a.getCurTimeMs();var c=d.targetlist;c.setItemCount(e.length);for(var h=0;h<e.length;++h){var i=e[h],j=c.getItem(h);IMG.setBKImage(j.exsubs.icon,IMG.makeSmallImg(i.icon)),TQ.setRichText(j.exsubs.name,i.name),TQ.setRichText(j.exsubs.desc1,i.desc1),i.flag=="stable"&&TQ.setRichText(j.exsubs.desc2,i.desc2),f.push({time:i.desc2,flag:i.flag});var k=j.exsubs.usebtn;k.setId(h),k.setText(i.btntext),k.clearCaller(),k.setCaller({self:b,caller:l})}c.scrollPos(0)},l=function(b){if(c.number>0){var d=e[b];if(d){var f="{cmd="+NETCMD.USEITEM+",id="+c.id+",resid="+c.resid+",number=1,target={type="+d.targettype+",id="+d.id+"}}";a.send(null,f)}}else a.getGUI().msgBox(rstr.comm.msgts,rstr.useitem.targetdlg.noitem,MB_F_CLOSE,null)},m=function(a){var b=(a-g)/1e3,c=d.targetlist,e=c.getCount();for(var h=0;h<e;++h){var i=c.getItem(h),j=b;if(f[h].flag=="stable")continue;f[h].flag=="inc"&&(j=-b);var k=f[h].time-j;k<0&&(k=0),TQ.setTextEx(i.exsubs.desc2,TQ.formatTime(0,k))}},n=function(a){var b=!1,c=[];for(k in a){var d=a[k],e=h[d];e&&(e.update&&(b=!0),c.push(e.getter))}return{getters:c,needupdate:b}},o=function(a){e=[];for(k in a){var b=a[k];b.reset();var c=b.getCount();for(var d=0;d<c;++d){var f=b.getItem(d);e.push(f)}}};this.initialize.apply(this,arguments)},UseItemHeroGetter=function(){var a,b,c;this.initialize=function(d,e){a=d,c=e,b=a.getImgr().getHeros().list},this.reset=function(){},this.getCount=function(){return b.length},this.getItem=function(a){var d=b[a];return{id:d.id,targettype:c,icon:d.itemres.smallpic,name:d.name,desc1:rstr.comm.level+":"+d.level,desc2:rstr.comm.position+":"+rstr.comm.herostate[d.state],flag:0,btntext:rstr.useitem.targetdlg.use}},this.initialize.apply(this,arguments)},UseItemBuildGetter=function(){var a,b,c;this.initialize=function(d,e){a=d,b=e;var f={};c=a.getImgr().getBuildsByCityId(BUILDCITY_ID.MAIN)},this.reset=function(){},this.getCount=function(){return c.length},this.getItem=function(a){var d=c[a],e=rstr.comm.level+":";return d.state==0?e+=d.level:d.state==1?e+="↑"+d.level+"->"+(d.level+1):d.state==2&&(e+="↓"+d.level+"->"+(d.level-1)),{id:d.id,targettype:b,icon:d.itemres.smallpic,name:d.itemres.name,desc1:e,desc2:"",flag:"stable",btntext:rstr.useitem.targetdlg.use}},this.initialize.apply(this,arguments)},UseItemBuildingGetter=function(){var a,c,d;this.initialize=function(b,d){a=b,c=d,e()},this.reset=function(){f()},this.getCount=function(){return d.length},this.getItem=function(b){var e=parseInt(a.getSvrTimeMs()/1e3),f=d[b],g=rstr.comm.level+":";f.state==1?g+="↑"+f.level+"->"+(f.level+1):f.state==2&&(g+="↓"+f.level+"->"+(f.level-1));var h=f.stoptime-e;return h<0&&(h=0),{id:f.id,targettype:c,icon:f.itemres.smallpic,name:f.itemres.name,desc1:g,desc2:h,flag:"dec",btntext:rstr.useitem.targetdlg.use}};var e=function(){f()},f=function(){var c={},e=a.getImgr().getBuildsByCityId(BUILDCITY_ID.MAIN);d=[];for(k in e)b=e[k],b.state!=0&&d.push(b)};this.initialize.apply(this,arguments)},UseItemBuildingSoldierGetter=function(){var a,b,c;this.initialize=function(d,e){a=d,b=e,c=a.getImgr().getSoldiers().recruiting},this.reset=function(){},this.getCount=function(){return c.length},this.getItem=function(d){var e=parseInt(a.getSvrTimeMs()/1e3),f=c[d],g=rstr.comm.recruit+":"+f.number,h=f.stoptime>e?f.stoptime-e:0;return{id:f.id,targettype:b,icon:f.itemres.smallpic,name:f.itemres.name,desc1:g,desc2:h,flag:"dec",btntext:rstr.useitem.targetdlg.use}},this.initialize.apply(this,arguments)},UseItemBuildingCultureGetter=function(){var a,b,c;this.initialize=function(c,e){a=c,b=e,d()},this.reset=function(){d()},this.getCount=function(){return c.length},this.getItem=function(d){var e=parseInt(a.getSvrTimeMs()/1e3),f=c[d],g=rstr.comm.level+":↑"+f.level+"->"+(f.level+1),h=f.stoptime>e?f.stoptime-e:0;return{id:f.id,targettype:b,icon:f.itemres.smallpic,name:f.itemres.name,desc1:g,desc2:h,flag:"dec",btntext:rstr.useitem.targetdlg.use}};var d=function(){var b=a.getImgr().getCultures().list;c=[];for(k in b){var d=b[k];d.state!=0&&c.push(d)}};this.initialize.apply(this,arguments)},UseItemBuildingWeaponryGetter=function(){var a,b,c;this.initialize=function(d,e){a=d,b=e,c=a.getImgr().getWeaponrys().making},this.reset=function(){},this.getCount=function(){return c.length},this.getItem=function(d){var e=parseInt(a.getSvrTimeMs()/1e3),f=c[d],g=rstr.comm.make+":"+f.number,h=f.stoptime>e?f.stoptime-e:0;return{id:f.id,targettype:b,icon:f.itemres.smallpic,name:f.itemres.name,desc1:g,desc2:h,flag:"dec",btntext:rstr.useitem.targetdlg.use}},this.initialize.apply(this,arguments)},UseItemOutBuildResGetter=function(){var a,b,c;this.initialize=function(c,e){a=c,b=e,d()},this.reset=function(){},this.getCount=function(){return c.length},this.getItem=function(a){var d=c[a];return{id:d.id,targettype:b,icon:d.itemres.smallpic,name:d.itemres.name,desc1:"",desc2:"",flag:"stable",btntext:rstr.useitem.targetdlg.use}};var d=function(){b==RES_TRG.OBUILDRES?c=[{id:FIXID.FARM,resid:FIXID.FARM},{id:FIXID.TIMBERYARD,resid:FIXID.TIMBERYARD},{id:FIXID.QUARRY,resid:FIXID.QUARRY},{id:FIXID.IRONORE,resid:FIXID.IRONORE}]:b==RES_TRG.FARM?c=[{id:FIXID.FARM,resid:FIXID.FARM}]:b==RES_TRG.TIMBERYARD?c=[{id:FIXID.TIMBERYARD,resid:FIXID.TIMBERYARD}]:b==RES_TRG.QUARRY?c=[{id:FIXID.QUARRY,resid:FIXID.QUARRY}]:b==RES_TRG.IRONORE&&(c=[{id:FIXID.IRONORE,resid:FIXID.IRONORE}]);for(k in c){var a=c[k];a.itemres=ItemResUtil.findItemres(a.resid)}};this.initialize.apply(this,arguments)},UseItemSelTargetDlg=function(){var a=1,b=44,c=5,d=6,e,f,g,h={},i,j,k;this.initialize=function(a){e=a,f=this,e.regEvent(EVT.PKG_CHANGE,0,f,q),k=new UseItemTarget(e)},this.openDlg=function(a,b){l(),m(a,b),g.show()};var l=function(){g||(g=Dialog.snew(e,{modal:!1,title:rstr.useitem.targetdlg.title,pos:{x:"center",y:25},btns:[{btn:{id:a,text:rstr.comm.close},caller:{self:f,caller:o}}]}),e.getGUI().initDlg(g,uicfg.useitem.targetdlg,h),g.hide(),g.setCaller({self:f,caller:p}))},m=function(a,b){i=a,j=b,CommDrawItem.drawItemIconAndName(h.icon,h.name,i.itemres),TQ.setTextEx(h.desc,i.itemres.desc),TQ.setTextEx(h.totalnum,i.number);var c=k.set(h,i,j);c&&k.startUpdater(),n()},n=function(){var a=h.targetlist,e=a.getCount();e>d?e=d:e==0&&(e=1);var f=b*e,i=a.getScroller();i.setSize(-1,f),i.refresh();var j=i.getDom(),k=parseInt(j.style.top)+f+c,l=g.getConDom();TQ.setDomHeight(l,k),TQ.setDomHeight(l.firstChild,k),g.refreshBack()},o=function(a){g.hide()},p=function(a){a==C_SYS_DLG_HIDE&&k.stopUpdater()},q=function(){g&&g.isShow()&&TQ.setTextEx(h.totalnum,i.number)};this.initialize.apply(this,arguments)},SaleItemDlg=function(){var a=1,b=2,c,d,e,f={},g,h=0;this.initialize=function(a){c=a,d=this},this.openDlg=function(a){if(!i())return;j(),k(a),e.show()},this.hideDlg=function(){e&&e.hide()};var i=function(){return!0},j=function(){e||(e=Dialog.snew(c,{modal:!1,title:rstr.shop.saleitem.title,pos:{x:"center",y:25},btns:[{btn:{id:a,text:rstr.comm.confirm},caller:{self:d,caller:n}},{btn:{id:b,text:rstr.comm.cancel},caller:{self:d,caller:n}}]}),c.getGUI().initDlg(e,uicfg.shop.saledlg,f),e.hide(),f.inum.setLimit(l),f.inum.setCaller({self:d,caller:m}))},k=function(a){g=a;var b=ItemResUtil.findItemres(g.resid);if(b==null)return;h=b.saleprice,IMG.setBKImage(f.icon,IMG.makeBigImg(b.bigpic)),TQ.setTextEx(f.totalnum,g.number),TQ.setTextEx(f.name,b.name),TQ.setTextEx(f.price,h+rstr.shop.buyitem.paynames[0]),TQ.setTextEx(f.desc,b.desc),f.inum.setVal(1),TQ.setTextEx(f.totalprice,h)},l=function(a){return{min:1,max:g.number}},m=function(a){TQ.setTextEx(f.totalprice,a*h)},n=function(b){e.hide();if(b==a){var d="{cmd="+NETCMD.DEAL+",subcmd=1,id="+g.id+",gpos="+g.gpos+",num="+f.inum.getVal()+"}";c.send(null,d)}};this.initialize.apply(this,arguments)},BaseItemFilter=Class.extern(function(){this.g=null,this.init=function(a){this.g=a},this.filter=function(a){var b=[],c=this.getSrcItems(a);for(var d=0;d<c.length;++d){var e=c[d];if(!this.isFit(a,e))continue;b.push(e)}return b},this.isFit=function(a,b){return!1},this.getSrcItems=function(a){return a&&a.items?a.items:this.g.getImgr().getPkgs().items}}),ItemClassRangeFilter=BaseItemFilter.extern(function(){this.filter=function(a){var b=[],c=this.getSrcItems(a),d=ItemClassRange.getRange(a.classId);for(var e=0;e<c.length;++e){var f=c[e],g=f.resid?f.resid:f.itemres.id;if(!ItemClassRange.isInRange(d,g))continue;b.push(f)}return b}}),ArmPosFilter=BaseItemFilter.extern(function(){this.isFit=function(a,b){return b.itemres?b.itemres.apos?a.armPos==0?!0:a.armPos==b.itemres.apos:!1:!1}}),CanIntensifyArmPosFilter=BaseItemFilter.extern(function(){this.isFit=function(a,b){return b.itemres.apos?a.armPos!=0?a.armPos==b.itemres.apos:b.itemres.apos<HEROARM_POS.HEAD||b.itemres.apos>HEROARM_POS.SHOES?!1:!0:!1}}),CanSaleFilterEx=BaseItemFilter.extern(function(){this.isFit=function(a,b){var c=b.itemres.salePrice?!0:!1;return c?b.gems?b.gems.length==0:!0:!1}}),CanSplitArmFilter=BaseItemFilter.extern(function(){this.isFit=function(a,b){var c=b.itemres.decomposeGet?!0:!1;return c?b.gems?b.gems.length==0:!0:!1}}),ItemLevelFilter=BaseItemFilter.extern(function(){this.isFit=function(a,b){return a.itemLevel==0?!0:a.itemLevel==b.itemres.level}}),GemFilter=BaseItemFilter.extern(function(){this.filter=function(a){a||(a={}),a.classId=RES_CLS.GEMITEM;var b=ItemClassRangeFilter.snew(this.g).filter(a);return b.sort(function(a,b){return a.itemres.gemLevel==b.itemres.gemLevel?a.itemres.id-b.itemres.id:b.itemres.gemLevel-a.itemres.gemLevel}),b}}),CanSaleFilter=function(){var a,b,c=[];this.init=function(b){a=b},this.filter=function(b){c=[];var e=a.getImgr().getPkgs().items;for(var f in e)f!="task"&&d(e[f]);return c};var d=function(a){for(var b=0;b<a.length;++b)!a[b].isBind&&!a[b].islock&&c.push(a[b])};this.init.apply(this,arguments)},UseItemByEffectFilter=Class.extern(function(){var a;this.init=function(b){a=b},this.filter=function(a){var b=[];for(var c=0;c<a.effids.length;++c)this._filterByEffectId(a.effids[c],b);return b},this._filterByEffectId=function(c,d){var e=a.getImgr(),f=ItemResUtil.findEffectItems(c);for(var g in f.items){var h=f.items[g],i=ItemResUtil.findItemres(h),j=b(i),k=e.getItemNumByResId(h);i.nobindid!=undefined&&i.nobindid>0&&(i=ItemResUtil.findItemres(i.nobindid),TQ.find(d,"resid",i.id)!=null&&TQ.removeElement(d,TQ.getLastFindIdx())),d.push({id:j,resid:h,number:k,itemres:i,valid:!0})}};var b=function(b){var c=a.getImgr(),d=c.getItemByResId(b.id);if(d)return d.id;var e=c.getItemByResId(b.nobindid);return e?e.id:0}}),UseItemByItemIdsFilter=Class.extern(function(){var a;this.init=function(b){a=b},this.filter=function(c){var d=a.getImgr(),e=[];for(var f=0;f<c.itemids.length;++f){var g=c.itemids[f],h=ItemResUtil.findItemres(g),i=b(h),j=d.getItemNumByResId(g);e.push({id:i,resid:g,number:j,itemres:h,valid:!0})}return e};var b=function(b){var c=a.getImgr(),d=c.getItemByResId(b.id);if(d)return d.id;var e=c.getItemByResId(b.nobindid);return e?e.id:0}}),RefFightItemFilter=function(){var a,b,c=[];this.initialize=function(b){a=b},this.filter=function(d){b=d.scutpos,c=[];var e=a.getImgr().getPkgs();for(var f=0,g=e.tags.length;f<g;++f){var h=e.items[e.tags[f]];for(var i=0,j=h.length;i<j;++i){var k=h[i];k.itemres.canuse&&k.itemres.canuse.fight&&(k.valid=!0,c.push(k))}}return c},this.initialize.apply(this,arguments)},SoldierFilter=function(){var a,b,c=[];this.initialize=function(b){a=b},this.filter=function(d){c=[],b=d.soldierpos;var e=a.getImgr().getSoldiers().list;for(var f=0,g=e.length;f<g;++f){var h=e[f];h.valid=!0,c.push(h)}return c},this.initialize.apply(this,arguments)},CommItemInfoGetter=Class.extern(function(){this.getInfo=function(a,b){return{number:a.number,desc:a.itemres.desc,needNumber:1,isGiftGold:!1}}}),AccNeedGoldCalculator=Class.extern(function(){this.getNeedGold=function(a,b){if(b<=0)return 0;var c=TQ.find(res_acc_needgolds,"type",a);if(!c)return alert("error:689gj383q, type:"+a),0;var d={timeS:0,gold:0};for(var e=0;e<c.phases.length;++e){var f=c.phases[e];if(b<=f.timeS)return d.gold+parseInt((b-d.timeS)*(f.gold-d.gold)/(f.timeS-d.timeS))+1;if(f.timeS==0)return parseInt(b*d.gold/d.timeS)+1;if(e==c.phases.length-1)return parseInt(b*f.gold/f.timeS)+1;d=f}return 0}}).snew(),GoldItemInfoGetter=Class.extern(function(){this.init=function(a){this.g=a},this.getInfo=function(a,b){var c=this.g.getImgr(),d=rstr.comm.giftgold+c.getGiftGold()+","+rstr.comm.gold+c.getGold(),e=AccNeedGoldCalculator.getNeedGold(this.getAccType(),b),f=TQ.format(a.itemres.desc,e);return{number:d,desc:f,needNumber:e,isGiftGold:!0}},this.getAccType=function(){alert("no implement")}}),BuildGoldItemInfoGetter=GoldItemInfoGetter.extern(function(){this.getAccType=function(){return"build"}}),CultureLearnGoldItemInfoGetter=GoldItemInfoGetter.extern(function(){this.getAccType=function(){return"culture"}}),SkeletonSteelGoldItemInfoGetter=GoldItemInfoGetter.extern(function(){this.getAccType=function(){return"skeleton"}}),SkillSteelGoldItemInfoGetter=GoldItemInfoGetter.extern(function(){this.getAccType=function(){return"skill"}}),CityDefGoldItemInfoGetter=GoldItemInfoGetter.extern(function(){this.getAccType=function(){return"citydef"}}),TradingGoldItemInfoGetter=GoldItemInfoGetter.extern(function(){this.getAccType=function(){return"trading"}}),RoleTaskGoldItemInfoGetter=GoldItemInfoGetter.extern(function(){this.getAccType=function(){return"roletask"}}),FilterItemDlgEx=function(){var a=1,b,c,d,e={},f={},g,h,i,j;this.initialize=function(a){b=a,c=this,e.arm=ArmPosFilter.snew(b),e.fightitem=new RefFightItemFilter(b),e.soldier=new SoldierFilter(b),e.gem=GemFilter.snew(b),e.cansaleitem=new CanSaleFilter(b)},this.openDlg=function(a){j=a,g=e[a.filter],k(),l(a),d.show()},this.setCaller=function(a){h=a};var k=function(){if(!d){d=Dialog.snew(b,{modal:!1,title:".",pos:{x:"center",y:25}}),b.getGUI().initDlg(d,uicfg.useitem.filterdlg2,f);var a=f.itemlist;a.setCaller({caller:m,self:c}),d.hide()}},l=function(a){d.setTitle(a.title);var b=f.itemlist;i=g.filter(a),b.setItemCount(i.length);for(var e=0;e<i.length;++e){var h=b.getItem(e);CommDrawItem.drawPkgItem(h,i[e]),TTIP.setCallerData(h.exsubs.tooltips.$item,{self:c,caller:n},{idx:e})}b.scrollPos(0)},m=function(a,b){var c=i[b];if(h){var e=h.caller.call(h.self,c);e==RET_END&&d.hide()}},n=function(a){if(i&&a.idx>=0&&a.idx<i.length){var b=i[a.idx];return TIPM.getItemDesc(b)}return null};this.initialize.apply(this,arguments)},WearArmDlg=function(){this.initialize=function(a){},this.openDlg=function(a,b,c){var d=UIM.getDlg("filteritemex");d.setCaller(a),d.openDlg({title:rstr.armdlg.weararm.title,filter:"arm",armpos:b,hero:c})},this.initialize.apply(this,arguments)},RefSCutDlg=function(){this.initialize=function(a){},this.openDlg=function(a,b,c){var d=UIM.getDlg("filteritemex");d.setCaller(a),d.openDlg({title:rstr.military.expeddlg.scuttitle,filter:"fightitem",scutpos:b,hero:c})},this.initialize.apply(this,arguments)},DeclareWarDlg=function(){var a=1,b=2,c,d,e,f,g={},h;this.initialize=function(a){c=a,d=this},this.openDlg=function(a){i(),h=a,j(),e.show()},this.setName=function(a){i(),TQ.setTextEx(g.name,a)};var i=function(){e||(e=Dialog.snew(c,{modal:!1,title:rstr.military.declaredlg.title,pos:{x:"center",y:20},btns:[{btn:{id:a,text:rstr.comm.confirm},caller:{self:d,caller:m}},{btn:{id:b,text:rstr.comm.cancel},caller:{self:d,caller:m}}]}),c.getGUI().initDlg(e,uicfg.military.declaredlg,g),f=new InnerUseItem(c,g.uitem),f.setItems([{id:FIXID.EDICT}]),e.hide(),e.refreshBack())},j=function(){f.setCurIdx(0),f.setCurIdx(-1),TQ.setTextEx(g.name,h.name)},k=function(){var a=f.getItemId();if(a>0){var b=c.getImgr().getItemByResId(a);if(!b||b.number<1){var d=UIM.getDlg("buyitem");return d.openDlg({id:0,resid:a,number:1e4}),!1}}return!0},l=function(){var a=f.getItemId(),b="{cmd="+NETCMD.MILITARY;b+=",subcmd=1",b+=",useitem="+a,h.id>=0&&(b+=",id="+h.id),h.uid>=0&&(b+=",uid="+h.uid),h.uid<0&&(b+=',name="'+h.name+'"'),b+="}",c.send(null,b),h.uid<0&&h.type==OBJ_TYPE.HERO&&alert("must set uid if hero: 43489f623")},m=function(b){if(b==a){if(!k())return;l(),e.hide()}else e.hide()};this.initialize.apply(this,arguments)},FindInfoDlg=function(){var a,b,c,d={},e={name:"",id:0},f=[],g=0,h=0,i=null,j=null;this.initialize=function(c){a=c,b=this,j=a.getGUI(),a.regEvent(EVT.NET,NETCMD.FRIEND,b,A),a.regSendDelay("cmd_addgroup",500),a.regSendDelay("cmd_invitegroup",500),a.regSendDelay("cmd_inviteteam",500)},this.openDlg=function(a,b){h=a,i=b,k(),l(),c.show()},this.inviteTeam=function(a){w(a)},this.addGroup=function(a){v(a)};var k=function(){c||(c=Dialog.snew(a,{modal:!1,title:rstr.friend.finddlg.title,pos:{x:"center",y:80},btns:[{btn:{id:0,text:rstr.friend.finddlg.showbtn},caller:{self:b,caller:o}},{btn:{id:0,text:rstr.friend.finddlg.addbtn},caller:{self:b,caller:p}},{btn:{id:0,text:rstr.friend.finddlg.iaddbtn},caller:{self:b,caller:q}},{btn:{id:0,text:rstr.friend.finddlg.aaddbtn},caller:{self:b,caller:r}},{btn:{id:0,text:rstr.friend.finddlg.iteambtn},caller:{self:b,caller:s}},{btn:{id:0,text:rstr.friend.finddlg.farmbtn},caller:{self:b,caller:t}}]}),a.getGUI().initDlg(c,uicfg.friend.finddlg,d),c.hide(),TQ.maxLength(d.iname,JVALID.getMaxUserLen()),d.findtype.setCaller({self:b,caller:m}),d.findbtn.setCaller({self:b,caller:n}),d.list.setCaller({self:b,caller:x},null,null,{self:b,caller:z}))},l=function(){e.name="",e.id=0,d.list.setItemCount(0),f=[];var a=c.getBtns();for(var b=0;b<a.length;++b)a[b].enable(!1);y([!0,!1,!1,!1]),c.refreshBtn(),d.findtype.select(h)},m=function(a){h=a,e.name="",e.id=0},n=function(){var b=TQ.trim(d.iname.value),c=d.iid.getVal();b!=""&&!JVALID.checkUsername(b)&&(b="");if(b!=""||c!=0){if(e.name!=b||e.id!=c){e.name=b,e.id=c;var f="{cmd="+NETCMD.FRIEND+",subcmd=4,ftype="+h+',name="'+b+'",uid='+c+"}";a.send(null,f)}}else a.getGUI().msgBox(rstr.comm.msgts,rstr.friend.finddlg.validfind,MB_F_CLOSE,null)},o=function(){var a=f[g];if(a){var b=UIM.getDlg("playerdetail");b.openDlg(a)}},p=function(){var a=f[g];HDRM.getHdr("friend").applyFriend(a)},q=function(){var a=f[g];u(a)},r=function(){var a=f[g];v(a)},s=function(){var a=f[g];w(a)},t=function(){var a=B(g);a&&a.type==OBJ_TYPE.ROLE?UIM.getDlg("farm").openDlg(a.uid):a&&a.type==OBJ_TYPE.HERO&&a.owner&&UIM.getDlg("farm").openDlg(a.owner.uid)},u=function(b){if(b&&i){j.sysMsgTips(SMT_NORMAL,TQ.format(rstr.friend.finddlg.invitegroup,b.name,i.name));var c="{cmd="+NETCMD.FRIEND+",subcmd=11,uid="+b.uid+",groupuid="+i.uid+"}";a.send("cmd_invitegroup",c)}},v=function(b){if(b){j.sysMsgTips(SMT_NORMAL,TQ.format(rstr.friend.finddlg.addgroup,b.name));var c="{cmd="+NETCMD.FRIEND+",subcmd=13,groupuid="+b.uid+"}";a.send("cmd_addgroup",c)}},w=function(b){if(b){var c=HDRM.getHdr("team");if(!c.meInTeam()||c.meIsLeader()){j.sysMsgTips(SMT_NORMAL,TQ.format(rstr.friend.finddlg.inviteteam,b.name));var d="{cmd="+NETCMD.TEAM+",subcmd=8,uid="+b.uid+"}";a.send("cmd_inviteteam",d)}else j.sysMsgTips(SMT_WARNING,rstr.friend.finddlg.noinviteteam)}},x=function(a,b){var d=f.length>0,e=c.getBtns(),h=B(b),j=[];h?h.type==OBJ_TYPE.ROLE?i?j=[!0,!0,!0,!1,!1,!0]:j=[!0,!0,!1,!1,!1,!0]:h.type==OBJ_TYPE.GROUP?j=[!0,!1,!1,!0,!1,!1]:h.type==OBJ_TYPE.HERO?h.owner?j=[!0,!1,!1,!1,!0,!0]:j=[!0,!1,!1,!1,!0,!1]:alert("error obj type: gk5939423"):j=[!0,!1,!1,!1,!1,!1];for(var k=0;k<e.length;++k)e[k].enable(d);y(j),g=b},y=function(a){var b=c.getBtns();for(var d=0;d<b.length;++d)b[d][a[d]?"show":"hide"]();c.refreshBtn(),c.refreshBack()},z=function(a,b){o()},A=function(a){var b=a.data;b.finds&&(f=b.finds,C())},B=function(a){return a>=0&&a<f.length?f[a]:null},C=function(){if(!c||!c.isShow())return;var a=d.list;if(f.length==0){a.setItemCount(1);var b=a.getItem(0);TQ.setTextEx(b.exsubs.name,rstr.friend.finddlg.nofind)}else{a.setItemCount(f.length);for(var e=0,g=a.getCount();e<g;++e){var b=a.getItem(e),h=f[e],i=ItemResUtil.findItemres(h.resid);i&&IMG.setBKImage(b.exsubs.icon,IMG.makeSmallImg(i.smallpic)),TQ.setTextEx(b.exsubs.name,h.name),h.level&&TQ.setTextEx(b.exsubs.level,TQ.format(rstr.comm.flevel,h.level));if(h.cityid){var j=ItemResUtil.findItemres(h.cityid);TQ.setTextEx(b.exsubs.city,j.name)}}}a.setCurSel(0)};this.initialize.apply(this,arguments)},PlayerDetailDlg=function(){var a,b,c,d={},e;this.initialize=function(c){a=c,b=this,m_gui=a.getGUI(),a.regEvent(EVT.NET,NETCMD.FRIEND,b,I)},this.openDlg=function(a){e=a,f(),c.show(),g()};var f=function(){c||(c=Dialog.snew(a,{modal:!0,title:rstr.friend.detaildlg.title,pos:{x:"center",y:100},btns:[{btn:{id:0,text:rstr.friend.detaildlg.btns[0]},caller:{self:b,caller:A}},{btn:{id:0,text:rstr.friend.detaildlg.btns[1]},caller:{self:b,caller:B}},{btn:{id:0,text:rstr.friend.detaildlg.btns[2]},caller:{self:b,caller:C}},{btn:{id:0,text:rstr.friend.detaildlg.btns[3]},caller:{self:b,caller:D}},{btn:{id:0,text:rstr.friend.detaildlg.btns[4]},caller:{self:b,caller:E}},{btn:{id:0,text:rstr.friend.detaildlg.btns[5]},caller:{self:b,caller:F}},{btn:{id:0,text:rstr.friend.detaildlg.btns[6]},caller:{self:b,caller:G}},{btn:{id:0,text:rstr.friend.detaildlg.btns[7]},caller:{self:b,caller:H}}]}),a.getGUI().initDlg(c,uicfg.friend.detaildlg,d),c.hide())},g=function(){h(),i(),k(),m(),n(),o(),p(),q()},h=function(){var a=rstr.friend.detaildlg.title;e.type==OBJ_TYPE.ROLE?a+=rstr.friend.detaildlg.titlesuffix[0]:e.type==OBJ_TYPE.GROUP?a+=rstr.friend.detaildlg.titlesuffix[1]:e.type==OBJ_TYPE.HERO&&(a+=rstr.friend.detaildlg.titlesuffix[2]),c.setTitle(a)},i=function(){var a=[!1,!1,!1,!1,!1,!1,!1,!0];e.type==OBJ_TYPE.ROLE?a=[!0,!0,!0,!0,!0,!1,!1,!0]:e.type==OBJ_TYPE.GROUP?a=[!1,!1,!1,!1,!1,!0,!1,!1]:e.type==OBJ_TYPE.HERO&&(a=[!0,!0,!0,!0,!0,!1,!0,!0]);var b=c.getBtns();for(var d=0;d<a.length;++d)b[d][a[d]?"show":"hide"]();c.refresh()},j=function(a){return e[a]?e[a]:""},k=function(){if(l(e.resid)){var a=ItemResUtil.findItemres(e.resid);a&&IMG.setBKImage(d.icon,IMG.makeBigImg(a.bigpic))}},l=function(a){return a!=undefined&&a>=0},m=function(){TQ.setTextEx(d.name,e.name?e.name:""),TQ.setTextEx(d.id,l(e.uid)?e.uid:""),TQ.setTextEx(d.level,l(e.level)?e.level:"");var a="";if(l(e.cityid)){var b=ItemResUtil.findItemres(e.cityid);b&&(a=b.name)}TQ.setTextEx(d.city,a);var c=l(e.sex)?rstr.comm.sexs[e.sex]:"";TQ.setTextEx(d.sex,c);var f=e.alliance?e.alliance:{uid:0,name:""};TQ.setTextEx(d.alliance,f.name)},n=function(){var a="";if(e.type==OBJ_TYPE.HERO){var b=z();a+=u(b)+"<br/>",a+=v(b)+"<br/>"}else e.desc&&(a+=e.desc);TQ.setTextEx(d.desc,a)},o=function(){if(r()){var b="{cmd="+NETCMD.FRIEND+",subcmd=24,type="+e.type;e.uid>=0&&(b+=",uid="+e.uid),e.uid<0&&(b+=',name="'+e.name+'"'),b+="}",a.send(null,b),e.uid<0&&e.type==OBJ_TYPE.HERO&&alert("must set uid if hero: 3684323")}},p=function(){if(s()){var b="{cmd="+NETCMD.FRIEND+",subcmd=5,type="+e.type;e.id>=0&&(b+=",id="+e.id),e.uid>=0&&(b+=",uid="+e.uid),e.uid<0&&(b+=',name="'+e.name+'"'),b+="}",a.send(null,b),e.uid<0&&e.type==OBJ_TYPE.HERO&&alert("must set uid if hero: 98589279fd")}},q=function(){var b=z();if(b&&t(b)){var c="{cmd="+NETCMD.FRIEND+",subcmd=25,type="+b.type+",uid="+b.uid+"}";a.send(null,c)}},r=function(){return e.resid<0},s=function(){var a=!1;return e.type==OBJ_TYPE.HERO&&!e.attrs?a=!0:e.type!=OBJ_TYPE.HERO&&!e.desc&&(a=!0),a},t=function(a){return!a.owner},u=function(a){var b=a.owner;return b?TQ.format(rstr.heroattr.owner,b.name,b.uid):""},v=function(a){var b="";if(a.attrs)for(var c=0;c<res_heroattrs.length;++c)b+=w(res_heroattrs[c],a.attrs)+"<br/>";return b},w=function(a,b){var c="";c+=a.name;for(var d=0;d<a.attrs.length;++d){var e=b[a.attrs[d]];d>0&&(c+="/"),c+=e.val,e.u==VAL_UNIT.PER&&(c+="%")}return c},x=function(){return e.type==OBJ_TYPE.ROLE?e:e.type==OBJ_TYPE.HERO?e.owner:null},y=function(){return e.type==OBJ_TYPE.GROUP?e:null},z=function(){return e.type==OBJ_TYPE.HERO?e:null},A=function(){UIM.getPanel("chat").setChatTarget(x().name)},B=function(){HDRM.getHdr("friend").applyFriend(x())},C=function(){UIM.getDlg("declarewar").openDlg(x())},D=function(){UIM.getDlg("expedition").openDlg(x())},E=function(){HDRM.getHdr("letter").writeLetter(x())},F=function(){UIM.getDlg("findinfo").addGroup(y())},G=function(){UIM.getDlg("findinfo").inviteTeam(z())},H=function(){var a=x();a&&UIM.getDlg("farm").openDlg(a.uid)},I=function(a){if(!c||!c.isShow())return;var b=a.data;b.baseobj&&(e.uid<0||e.uid==b.baseobj.uid)&&(TQ.dictCopy(e,b.baseobj),k(),m()),b.heroowner&&(e.uid<0||e.uid==b.heroowner.uid)&&(TQ.dictCopy(e,b.heroowner),n()),b.detailobj&&(e.uid<0||e.uid==b.detailobj.uid)&&(TQ.dictCopy(e,b.detailobj),n())};this.initialize.apply(this,arguments)},ChatConScroller=Class.extern(function(){this.init=function(a){k=a,l=this},this.initScroller=function(a,b,c){m=a,m.setCanSelect(),n=m.getContainerObj(),o=b,o<1&&(o=1),p=c,p>o&&(p=o),p<1&&(p=1)},this.append=function(b){a(b)},this.clear=function(){q=0,r=0,s=[],t=[],u=0,v=0,w=0,x=0,TQ.setHtml(n,""),m.stopDownBlink(),m.refresh()},this.refresh=function(){m.refresh()};var a=function(a){var d=b(),e=c();f(a),g(),h(),i();if(d)m.scrollEnd();else{j();if(e){var k=m.getScrollPos();k=Math.max(0,k-e),m.scrollPos(k)}}},b=function(){return m.isNearToEnd()},c=function(){var a=0;if(++r>=o&&s.length>0){var b=n.innerHTML,c=d();a=e(),b=b.substr(c,b.length-c),n.innerHTML=b,r-=p}return a},d=function(){var a=s[0];TQ.removeElement(s,0);var b=a-v;return v=a,b},e=function(){var a=t[0];return TQ.removeElement(t,0),curh=a-x,x=a,curh},f=function(a){var b=n.innerHTML.length;n.innerHTML+=a;var c=n.innerHTML.length;u+=c-b},g=function(){++q>=p&&(s.push(u),q=0)},h=function(){var a=m.getRange();m.refresh(),w+=m.getRange()-a},i=function(){t.length<s.length&&t.push(w)},j=function(){m.startDownBlink()},k,l,m,n,o=1e3,p=50,q=0,r=0,s=[],t=[],u=0,v=0,w=0,x=0}),FontSizePanelBtn=Class.extern(function(){var a,b,c,d,e;this.init=function(c,d,e){a=c,b=this,f(d,e)},this.setCaller=function(a){e=a},this.setDefaultSize=function(a){d.setCurSel(a),i(a)};var f=function(e,f){f||(f={}),f.uiback||(f.uiback=uiback.btn.font),c=new ComButton(a,e,f),c.setCaller({self:b,caller:g}),d=new FontSizePanel(a),d.setCaller({self:b,caller:h})},g=function(){a.getGUI().showBtnPanel(0,c.getDom(),d)},h=function(a){i(a)},i=function(a){e&&e.caller.call(e.self,a)}}),ColorPanelBtn=Class.extern(function(){var a,b,c,d,e,f=0;this.init=function(c,d,e){a=c,b=this,g(d,e)},this.setCaller=function(a){e=a},this.setDefaultColor=function(a){var b=d.getColorByIdx(a);b&&j({color:b,idx:a})};var g=function(e,f){f||(f={}),f.uiback||(f.uiback=uiback.btn.color),c=new ComButton(a,e,f),c.setCaller({self:b,caller:h}),d=new ColorPanel(a),d.setCaller({self:b,caller:i})},h=function(){a.getGUI().showBtnPanel(0,c.getDom(),d)},i=function(a){j(a)},j=function(a){var b=c.getDom();b.style.backgroundColor=a.color,f=a.idx,e&&e.caller.call(e.self,a)}}),FontSizePanel=function(){var a,b,c,d,e={},f=uiback.dlg.minihelp,g=[12,14,16];this.initialize=function(c){a=c,b=this,h()},this.setCaller=function(a){d=a},this.show=function(a){c.show(a)},this.getSizeByIdx=function(a){return a>=0&&a<g.length?g[a]:null},this.getSize=function(){return{cx:c.getWidth(),cy:c.getHeight()}},this.setCurSel=function(a){e.list.setCurSel(a)};var h=function(){c=new PopPanel(a,{});var d=c.getDom(),g=a.getGUI();g.initPanel(d,uicfg.fontsizepanel,e),m_panelback=g.createPanelUIBack(d,f);var h=TQ.getDomWidth(d),j=TQ.getDomHeight(d);g.setUIBack(m_panelback,h,j,f.type),e.list.setItemCount(rstr.sizepanel.items.length);for(var k=0,l=e.list.getCount();k<l;++k){var m=e.list.getItem(k);TQ.setTextEx(m.exsubs.fontsize,rstr.sizepanel.items[k])}e.list.setCaller({self:b,caller:i}),c.hide()},i=function(a,b){d&&d.caller.call(d.self,b),c.hide()};this.initialize.apply(this,arguments)},ColorPanel=function(){var a=8,b=2,c,d,e,f,g,h={},i=uiback.dlg.minihelp,j=["#000000","#800000","#008000","#808000","#000080","#800080","#008080","#808080","#C0C0C0","#FF0000","#00FF00","#FFFF00","#0000FF","#FF00FF","#00FFFF","#FFFFFF"];this.initialize=function(a){c=a,d=this,k()},this.setCaller=function(a){g=a},this.show=function(a){f.show(a)},this.getSize=function(){return{cx:f.getWidth(),cy:f.getHeight()}},this.getColorByIdx=function(a){return a>=0&&a<j.length?j[a]:null};var k=function(){f=new PopPanel(c,{});var a=f.getDom(),b=c.getGUI();b.initPanel(a,uicfg.colorpanel,h),m_panelback=b.createPanelUIBack(a,i);var e=TQ.getDomWidth(a),g=TQ.getDomHeight(a);b.setUIBack(m_panelback,e,g,i.type);for(var k=0,m=h.list.getCount();k<m;++k){var n=h.list.getItem(k);n.exsubs.coloritem.style.backgroundColor=j[k]}h.list.setCaller({self:d,caller:l}),f.hide()},l=function(a,b){g&&g.caller.call(g.self,{color:j[b],idx:b}),f.hide()};this.initialize.apply(this,arguments)},CreateGroupDlg=function(){var a=1,b=2,c,d,e,f={},g=[{members:10,money:10},{members:50,money:50},{members:100,money:2e3}];this.initialize=function(a){c=a,d=this,m_gui=c.getGUI()},this.openDlg=function(a){m_player=a,h(),i(),e.show()};var h=function(){if(!e){e=Dialog.snew(c,{modal:!0,title:rstr.friend.crtgroupdlg.title,pos:{x:"center",y:80},btns:[{btn:{id:a,text:rstr.comm.confirm},caller:{self:d,caller:k}},{btn:{id:b,text:rstr.comm.cancel},caller:{self:d,caller:k}}]}),c.getGUI().initDlg(e,uicfg.friend.creategroup,f),TQ.maxLength(f.inputname,JVALID.getMaxGroupLen()),TQ.maxLength(f.idesc.getContainerObj(),JVALID.getMaxDescGroupLen()),f.grouptype.select(0);for(var h=0;h<g.length;++h){var i=g[h],j=f.grouptype.getRadio(h),l=rstr.friend.crtgroupdlg.types[h];j.setText(TQ.format(l,i.members,i.money))}e.hide()}},i=function(){},j=function(a){return a<=c.getImgr().getMoney()},k=function(b){if(b==a){if(!JVALID.checkGroupName(f.inputname.value)){c.getGUI().msgBox(rstr.comm.msgts,rstr.friend.crtgroupdlg.invalidname,MB_F_CLOSE,{self:d,caller:function(a){f.inputname.focus()}});return}var h=f.grouptype.getCurSelId();if(!j(g[h].money)){c.getGUI().msgBox(rstr.comm.msgts,rstr.friend.crtgroupdlg.nomoney,MB_F_CLOSE,null);return}c.getGUI().msgBox(rstr.comm.msgts,rstr.friend.crtgroupdlg.confirmcreate,MB_F_YESNO,{self:d,caller:function(a){if(a==MB_IDYES){var b=f.idesc.getContainerObj(),d=TQ.trim(b.value);d.length>JVALID.getMaxDescGroupLen()&&(d=d.substr(0,JVALID.getMaxDescGroupLen()));var g="{cmd="+NETCMD.FRIEND+",subcmd=16,gtype="+h+",desc=[[-"+d+"-]],name=[[-"+f.inputname.value+"-]]}";c.send(null,g),e.hide()}}})}else e.hide()};this.initialize.apply(this,arguments)},ManageGroupDlg=function(){var a,b,c,d={},e,f=-1,g=0;this.initialize=function(c){a=c,b=this,m_gui=a.getGUI(),a.regEvent(EVT.NET,NETCMD.FRIEND,b,n)},this.openDlg=function(a){e=a,h(),i(),c.show()};var h=function(){c||(c=Dialog.snew(a,{modal:!0,title:rstr.friend.mgroupdlg.title,pos:{x:"center",y:30},btns:[{btn:{id:0,text:rstr.friend.mgroupdlg.ops[0]},caller:{self:b,caller:j}},{btn:{id:0,text:rstr.friend.mgroupdlg.ops[1]},caller:{self:b,caller:k}},{btn:{id:0,text:rstr.friend.mgroupdlg.ops[2]},caller:{self:b,caller:l}},{btn:{id:0,text:rstr.friend.mgroupdlg.ops[3]},caller:{self:b,caller:m}}]}),a.getGUI().initDlg(c,uicfg.friend.memberdlg,d),d.list.setCaller({self:b,caller:o}),r([!1,!1,!1,!0]),c.hide())},i=function(){if(!e.detail){var b="{cmd="+NETCMD.FRIEND+",subcmd=17,id="+e.id+"}";g=a.send(null,b)}else s()},j=function(c){var d=q(f);if(d){var g=function(b){if(b==MB_IDYES){var c="{cmd="+NETCMD.FRIEND+",subcmd=19,guid="+e.uid+",uid="+d.uid+"}";a.send(null,c)}};a.getGUI().msgBox(rstr.comm.msgts,TQ.format(rstr.friend.mgroupdlg.transfer,e.name,d.name),MB_F_YESNO,{self:b,caller:g})}},k=function(c){var d=q(f);if(d){var g=function(b){if(b==MB_IDYES){var c="{cmd="+NETCMD.FRIEND+",subcmd=20,guid="+e.uid+",uid="+d.uid+"}";a.send(null,c)}};a.getGUI().msgBox(rstr.comm.msgts,TQ.format(rstr.friend.mgroupdlg.appoint,d.name,e.name),MB_F_YESNO,{self:b,caller:g})}},l=function(c){var d=q(f);if(d){var g=function(b){if(b==MB_IDYES){var c="{cmd="+NETCMD.FRIEND+",subcmd=21,guid="+e.uid+",uid="+d.uid+"}";a.send(null,c)}};a.getGUI().msgBox(rstr.comm.msgts,TQ.format(rstr.friend.mgroupdlg.fire,d.name,e.name),MB_F_YESNO,{self:b,caller:g})}},m=function(c){var d=q(f);if(d){var g=function(b){if(b==MB_IDYES){var c="{cmd="+NETCMD.FRIEND+",subcmd=22,guid="+e.uid+",uid="+d.uid+"}";a.send(null,c)}};a.getGUI().msgBox(rstr.comm.msgts,TQ.format(rstr.friend.mgroupdlg.kickout,d.name,e.name),MB_F_YESNO,{self:b,caller:g})}},n=function(a){if(p()){var b=a.data;b._s==g&&b.detailgroup&&b.detailgroup.id==e.id&&(TQ.dictCopy(e,b.detailgroup),s())}},o=function(a,b){f=b;var c=q(b);if(!c)return;e.gpos==GROUP_POS.ADMIN?c.gpos==GROUP_POS.ADMIN?r([!1,!1,!1,!1]):c.gpos==GROUP_POS.ASSIST?r([!0,!1,!0,!1]):c.gpos==GROUP_POS.COMM&&r([!1,!0,!1,!0]):e.gpos==GROUP_POS.ASSIST&&(c.gpos==GROUP_POS.ASSIST||c.gpos==GROUP_POS.ADMIN?r([!1,!1,!1,!1]):c.gpos==GROUP_POS.COMM&&r([!1,!1,!1,!0]))},p=function(){return c&&c.isShow()?!0:!1},q=function(a){return a>=0&&a<e.detail.members.length?e.detail.members[a]:null},r=function(a){var b=c.getBtns();for(var d=0;d<b.length;++d)b[d][a[d]?"show":"hide"]();c.refreshBtn(),c.refreshBack()},s=function(){TQ.setTextEx(d.desc,e.detail.desc),d.list.setItemCount(e.detail.members.length);for(var a=0,b=e.detail.members.length;a<b;++a){var c=e.detail.members[a],f=d.list.getItem(a);if(!c.itemres||c.resid!=c.itemres.id)c.itemres=ItemResUtil.findItemres(c.resid);IMG.setBKImage(f.exsubs.icon,IMG.makeSmallImg(c.itemres.smallpic)),IMG.setBKImage(f.exsubs.pos,IMG.makeGroupPosImg(c.gpos)),TQ.setTextEx(f.exsubs.name,c.name),c.level&&TQ.setTextEx(f.exsubs.level,TQ.format(rstr.comm.flevel,c.level));if(c.cityid){var g=ItemResUtil.findItemres(c.cityid);TQ.setTextEx(f.exsubs.city,g.name)}}d.list.setCurSel(d.list.getCount()>0?0:-1)};this.initialize.apply(this,arguments)},FriendHandler=function(){var a,b;this.init=function(c){a=c,b=this},this.applyFriend=function(a){c(a)},this.getAllListFromSvr=function(){d()};var c=function(b){a.getGUI().sysMsgTips(SMT_NORMAL,TQ.format(rstr.map.addfriend,b.name)),FriendSender.sendApplyFriend(a,b.name)},d=function(){FriendSender.getAllFriends(a)};this.init.apply(this,arguments)},TeamDlg=function(){var a=0,b=1,c=2,d=3,e=4,f=5,g=6,h=7,i=8,j=9,k=10,l=10,m=11,n=12,o=20,p=21,q=22,r=30,s=31,t=32,u=0,v=1,w=2,x=3,y=4,z=2e3,A=parseInt(UI_ZORDER_DLG/2,10),B,C,D,E={},F=0,G=0,H=[!0,!0,!0,!0],I=[-1,-1,-1,-1],J={},K=[10,3,3,3],L,M=[],N=[],O=[],P=!1;this.initialize=function(a){B=a,C=this,m_gui=B.getGUI(),B.regSendDelay("cmd_createteam",200),B.regEvent(EVT.TEAMINFO_CHANGE,0,C,T),B.regEvent(EVT.NET,NETCMD.TEAM,C,U)},this.openDlg=function(){Q(),R(),D.show()};var Q=function(){if(!D){D=Dialog.snew(B,{modal:!0,title:rstr.teamdlg.title,fixzIndex:!0,zIndex:A,pos:{x:"center",y:80}}),B.getGUI().initDlg(D,uicfg.team.teamdlg,E),D.hide(),L=UIM.getPanel("main").getTeamGroup();for(var a=0;a<K.length;++a){var b=E.tab.getTabItems(a);for(var c=0,d=K[a];c<d;++c){var e="op"+a+""+c,f=b[e];f.setCaller({self:C,caller:rb});var g=a*10+c;f.setId(g);if(g==o||g==r)f.setType(BTN_TYPE.DELAY),f.setDelay(z)}}E.tab.getTabItems(u).list.setCaller({self:C,caller:Cb}),E.tab.getTabItems(v).list.setCaller({self:C,caller:Db}),E.tab.getTabItems(w).list.setCaller({self:C,caller:Eb}),E.tab.getTabItems(x).list.setCaller({self:C,caller:Fb});for(var a=0;a<rstr.teamdlg.tabs.length;++a)E.tab.setTabText(a,rstr.teamdlg.tabs[a]);E.tab.setCaller({self:C,caller:V}),E.tab.activeTab(0)}},R=function(){S(),P&&E.tab.activeTab(v)},S=function(){D&&(sb(),ub(),vb(),wb())},T=function(){H[u]=!0,S()},U=function(a){var b=a.data;b.applys&&(TQ.dictCopy(M,b.applys),H[v]=!0,S()),b.singles&&(TQ.dictCopy(N,b.singles),H[w]=!0,S()),b.oteams&&(TQ.dictCopy(O,b.oteams),H[x]=!0,S()),b.newapply&&(!D||!D.isShow()||F!=v)&&(P=!0,B.sendEvent({eid:EVT.NEWAPPLY_TEAM,sid:0,start:!0}))},V=function(a){F=a;var b=E.tab.getTabItems(F).list;b.refresh(),P&&F==v&&(P=!1,B.sendEvent({eid:EVT.NEWAPPLY_TEAM,sid:0,stop:!0}))},W=function(){var a="{cmd="+NETCMD.TEAM+",subcmd=2}";B.send("cmd_createteam",a)},X=function(){HDRM.getHdr("team").applyLeader(Jb())},Y=function(){HDRM.getHdr("team").tranLeader(Hb())},Z=function(){HDRM.getHdr("team").tickoutTeam(Hb())},$=function(){UIM.getDlg("findinfo").openDlg(2,null)},_=function(){HDRM.getHdr("team").stepoutTeam(Ib())},ab=function(){HDRM.getHdr("team").returnTeam(Ib())},bb=function(){HDRM.getHdr("team").exitTeam(Ib())},cb=function(){HDRM.getHdr("friend").applyFriend(Hb().owner)},db=function(){UIM.getPanel("chat").setChatTarget(Hb().owner.name)},eb=function(){HDRM.getHdr("letter").writeLetter(Hb().owner)},fb=function(){var a=ob(),b="{cmd="+NETCMD.TEAM+",subcmd=11,agree=1,uid="+a.uid+"}";B.send(null,b),m_gui.sysMsgTips(SMT_NORMAL,TQ.format(rstr.teamdlg.agreejoin,a.name))},gb=function(){var a=ob(),b="{cmd="+NETCMD.TEAM+",subcmd=11,agree=0,uid="+a.uid+"}";B.send(null,b),m_gui.sysMsgTips(SMT_NORMAL,TQ.format(rstr.teamdlg.refusejoin,a.name))},hb=function(){var a=function(a){if(a==MB_IDYES){var b="{cmd="+NETCMD.TEAM+",subcmd=11,agree=0,uid=-1}";B.send(null,b)}};m_gui.msgBox(rstr.comm.msgts,rstr.teamdlg.refuseall,MB_F_YESNO,{self:C,caller:a})},ib=function(){var a="{cmd="+NETCMD.TEAM+",subcmd=12}";B.send(null,a)},jb=function(){var a=pb();HDRM.getHdr("friend").applyFriend(a.owner)},kb=function(){var a=pb();UIM.getDlg("findinfo").inviteTeam(a)},lb=function(){var a="{cmd="+NETCMD.TEAM+",subcmd=13}";B.send(null,a)},mb=function(){var a=qb();HDRM.getHdr("friend").applyFriend(a.owner)},nb=function(){var a=qb(),b="{cmd="+NETCMD.TEAM+",subcmd=10,uid="+a.uid+"}";B.send(null,b),m_gui.sysMsgTips(SMT_NORMAL,TQ.format(rstr.teamdlg.applyteam,a.name))},ob=function(){var a=I[v];return M[a]},pb=function(){var a=I[w];return N[a]},qb=function(){var a=I[x];return O[a]},rb=function(k){if(k==a)W();else if(k==b)X();else if(k==c)Y();else if(k==d)Z();else if(k==e)$();else if(k==f){var u=Ib();u&&(u.state==0?ab():_())}else k==g?bb():k==h?cb():k==i?db():k==j?eb():k==l?fb():k==m?gb():k==n?hb():k==o?ib():k==p?jb():k==q?kb():k==r?lb():k==s?mb():k==t&&nb()},sb=function(){if(H[u]){H[u]=!1;var a=B.getImgr().getTeams().list,b=E.tab.getTabItems(u).list;b.setItemCount(a.length);for(var c=0;c<a.length;++c){var d=a[c],e=b.getItem(c);IMG.setBKImage(e.exsubs.icon,IMG.makeBigImg(d.itemres.bigpic));var f=B.getImgr().isMyHero(d.uid)?"*":"";TQ.setTextEx(e.exsubs.name,f+d.name),IMG.setBKImage(e.exsubs.flag,IMG.makeStepoutImg(d.state));var g=b.getSubItem(e,"tooltips").$hero,h=TTIP.getTipById(g);h.setCaller({self:C,caller:Gb}),h.setData({tabidx:u,idx:c})}var i=I[u];i<0&&(i=0),i>=a.length&&(i=a.length-1),b.setCurSel(i)}},tb=function(a,b){if(H[a]){H[a]=!1;var c=E.tab.getTabItems(a).list;c.setItemCount(b.length);for(var d=0;d<b.length;++d){var e=b[d],f=c.getItem(d);if(!e.itemres||e.resid!=e.itemres.id)e.itemres=ItemResUtil.findItemres(e.resid);IMG.setBKImage(f.exsubs.icon,IMG.makeSmallImg(e.itemres.smallpic)),TQ.setTextEx(f.exsubs.name,e.name),TQ.setTextEx(f.exsubs.level,TQ.format(rstr.comm.flevel,e.level));var g=ItemResUtil.findItemres(e.cityid);TQ.setTextEx(f.exsubs.city,g.name),e.num!=undefined&&TQ.setTextEx(f.exsubs.info,TQ.format(rstr.teamdlg.teamnum,e.num));var h=c.getSubItem(f,"tooltips").$hero,i=TTIP.getTipById(h);i.setCaller({self:C,caller:Gb}),i.setData({tabidx:a,idx:d})}var j=I[a];j<0&&(j=0),j>=b.length&&(j=b.length-1),c.setCurSel(j)}},ub=function(){tb(v,M)},vb=function(){tb(w,N)},wb=function(){tb(x,O)},xb=function(){var l=B.getImgr().getTeams().list,m=E.tab.getTabItems(u),n={},o=I[u];if(o>=0&&o<l.length){var p=l[o],q=B.getImgr().isMyHero(p.uid),r=p.teampos==1,s=HDRM.getHdr("team").meIsLeader();q?s?(n[e]=!0,n[g]=!0):(n[b]=!0,n[f]=!0,n[g]=!0):(n[g]=!0,n[h]=!0,n[i]=!0,n[j]=!0,s?(n[c]=!0,n[d]=!0,n[e]=!0):(n[b]=!0,n[f]=!0))}else l.length>0&&alert("error 01248s8"),n[a]=!0;Bb(u,n);var t=Ib();if(t){var v=m["op"+u+""+f];v.setText(rstr.teamdlg.btns.op1s[t.state==1?f:k])}},yb=function(){var a=E.tab.getTabItems(v),b={},c=I[v];c>=0&&c<M.length&&(b[l-l]=!0,b[m-l]=!0,b[n-l]=!0),Bb(v,b)},zb=function(){var a=E.tab.getTabItems(w),b={},c=I[w];b[o-o]=!0;if(c>=0&&c<N.length){b[p-o]=!0;var d=HDRM.getHdr("team");if(!d.meInTeam()||d.meIsLeader())b[q-o]=!0}Bb(w,b)},Ab=function(){var a=E.tab.getTabItems(x),b={},c=I[x];b[r-r]=!0;if(c>=0&&c<O.length){b[s-r]=!0;var d=HDRM.getHdr("team");d.meInTeam()||(b[t-r]=!0)}Bb(x,b)},Bb=function(a,b){var c=K[a],d=E.tab.getTabItems(a);for(var e=0;e<c;++e){var f=d["op"+a+""+e];f.enable(b[e]==1)}},Cb=function(a,b){I[u]=b,xb()},Db=function(a,b){I[v]=b,yb()},Eb=function(a,b){I[w]=b,zb()},Fb=function(a,b){I[x]=b,Ab()},Gb=function(a){var b=Kb(a.tabidx,a.idx);return TIPM.getHeroDesc(b)},Hb=function(){var a=B.getImgr().getTeams().list;return a[I[u]]},Ib=function(){var a=B.getImgr().getTeams().list;for(var b=0;b<a.length;++b){var c=a[b];if(B.getImgr().isMyHero(c.uid))return c}return null},Jb=function(){var a=B.getImgr().getTeams().list;for(var b=0;b<a.length;++b){var c=a[b];if(c.teampos==1)return c}return null},Kb=function(a,b){var c=[B.getImgr().getTeams().list,M,N,O];return c[a][b]};this.initialize.apply(this,arguments)},TeamHandler=function(){var a=50,b,c,d=!0,e=!1;this.init=function(a){b=a,c=this,b.regEvent(EVT.NET,NETCMD.TEAM,c,q),b.regSendDelay("cmd_applyleader",200)},this.meInTeam=function(){return f()},this.meIsLeader=function(){return g()},this.applyLeader=function(a){h(a)},this.tranLeader=function(a){i(a)},this.tickoutTeam=function(a){j(a)},this.stepoutTeam=function(a){k(a)},this.returnTeam=function(a){l(a)},this.exitTeam=function(a){m(a)},this.inviteMe=function(a){n(a)},this.applyLeaderFromMe=function(a){o(a)},this.changeLeaderToMe=function(a){p(a)};var f=function(){var a=b.getImgr().getTeams().list;return a.length>0},g=function(){if(d){d=!1,e=!1;var a=b.getImgr().getTeams().list;for(var c=0;c<a.length;++c){var f=a[c],g=b.getImgr().isMyHero(f.uid);if(g&&f.teampos==1){e=!0;break}}}return e},h=function(a){var c="{cmd="+NETCMD.TEAM+",subcmd=6,uid="+a.uid+"}";b.send("cmd_applyleader",c),b.getGUI().sysMsgTips(SMT_NORMAL,TQ.format(rstr.teampanel.applyleader,a.name))},i=function(a){var d=function(c){if(c==MB_IDYES){var d="{cmd="+NETCMD.TEAM+",subcmd=7,uid="+a.uid+"}";b.send(null,d)}};b.getGUI().msgBox(rstr.comm.msgts,TQ.format(rstr.teampanel.tranleader,a.name),MB_F_YESNO,{self:c,caller:d})},j=function(a){var d=function(c){if(c==MB_IDYES){var d="{cmd="+NETCMD.TEAM+",subcmd=3,uid="+a.uid+"}";b.send(null,d)}};b.getGUI().msgBox(rstr.comm.msgts,TQ.format(rstr.teampanel.tickout,a.name),MB_F_YESNO,{self:c,caller:d})},k=function(a){var d=function(c){if(c==MB_IDYES){var d="{cmd="+NETCMD.TEAM+",subcmd=5,uid="+a.uid+"}";b.send(null,d)}};b.getGUI().msgBox(rstr.comm.msgts,TQ.format(rstr.teampanel.stepout,a.name),MB_F_YESNO,{self:c,caller:d})},l=function(a){var c="{cmd="+NETCMD.TEAM+",subcmd=9,uid="+a.uid+"}";b.send(null,c)},m=function(a){var d=function(c){if(c==MB_IDYES){var d="{cmd="+NETCMD.TEAM+",subcmd=4,uid="+a.uid+"}";b.send(null,d)}};b.getGUI().msgBox(rstr.comm.msgts,TQ.format(rstr.teampanel.exit,a.name),MB_F_YESNO,{self:c,caller:d})},n=function(d){var e=UIM.getDlg("inviteconfirm"),f=function(a){var c="{cmd="+NETCMD.TEAM+",subcmd=14,uid="+d.uid+",agree="+a+"}";b.send(null,c)},g=TQ.format(rstr.teampanel.invitemsg,d.name,d.level,d.num);e.openDlg(g,a,{self:c,caller:f})},o=function(d){var e=UIM.getDlg("inviteconfirm"),f=function(a){var c="{cmd="+NETCMD.TEAM+",subcmd=15,uid="+d.uid+",agree="+a+"}";b.send(null,c)},g=TQ.format(rstr.teampanel.applyleaderfromme,d.name);e.openDlg(g,a,{self:c,caller:f})},p=function(d){var e=UIM.getDlg("inviteconfirm"),f=function(a){var c="{cmd="+NETCMD.TEAM+",subcmd=16,uid="+d.uid+",agree="+a+"}";b.send(null,c)},g=TQ.format(rstr.teampanel.changeleadertome,d.name);e.openDlg(g,a,{self:c,caller:f})},q=function(a){var b=a.data;b.teams&&(d=!0)};this.init.apply(this,arguments)},InviteConfirmDlg=function(){var a=0,b,c,d,e={},f,g,h;this.init=function(a){b=a,c=this},this.openDlg=function(a,b,c){i(),j(a,b),h=c,d.show()};var i=function(){d||(d=Dialog.snew(b,{modal:!0,pos:{x:"center",y:100},uiback:uiback.dlg.minihelp}),b.getGUI().initDlg(d,uicfg.team.inviteconfirm,e),d.hide(),e.agreebtn.setCaller({self:c,caller:m}),e.refusebtn.setCaller({self:c,caller:n}),d.setCaller({self:c,caller:l}))},j=function(a,d){g=d*1e3,g>0&&(b.regUpdater(c,k,1e3),f=b.getCurTimeMs(),TQ.setTextEx(e.lefttime,d)),TQ.setTextEx(e.tip,a)},k=function(b){var c=b-f,h=parseInt((g-c)/1e3,10);h<=-a&&(h=0,d.hide()),TQ.setTextEx(e.lefttime,h)},l=function(a){a==C_SYS_DLG_HIDE&&g>0&&b.unregUpdater(c,k)},m=function(){d.hide(),h&&h.caller.call(h.self,1)},n=function(){d.hide(),h&&h.caller.call(h.self,0)};this.init.apply(this,arguments)},SysMsgHandler=function(){var a,b,c;this.initialize=function(e){a=e,b=this,c=a.getGUI(),a.regEvent(EVT.NET,NETCMD.SYSMSG,b,d)};var d=function(a){var b=a.data;f(b,e(b))},e=function(b){return b.msgid==undefined?b.msg:rstr.ids[b.msgid].param!=b.params.length?"error: 784m3we , msgid:"+b.msgid+", netlen:"+b.params.length:rstr.ids[b.msgid].param==0?rstr.ids[b.msgid].msg:MsgTipUtil.formatIdMsg(a,b.msgid,b.params)},f=function(b,d){if(b.type==SMSGT.POP)c.sysMsgTips(b.flag,HyperLinkMgr.formatLink(d));else if(b.type==SMSGT.SYSCHANNEL){var e=HyperLinkMgr.formatLink(d);UIM.getPanel("sysmsg").append(b.flag,e);if(e.indexOf("fight_demo_a_0")>=0){var f=TQ.getDomById("fight_demo_a_0");HelpGuider.startFirstFightDemo(f)}}else b.type==SMSGT.POPMSGBOX?a.getGUI().msgBox(rstr.comm.msgts,d,MB_F_CLOSE,null):b.type==SMSGT.CHAT_CHANNEL?UIM.getPanel("chat").appendMsgToCurChannel(HyperLinkMgr.formatLink(d)):b.type==SMSGT.SYS_POPBAR?c.sysMsgTips2(b.flag,HyperLinkMgr.formatLink(d)):b.type==SMSGT.NPC_MSG?UIM.getDlg("npc").openDlg({desc:d,ops:[rstr.npcdlg.closeop]}):alert("error：f489572fa sys msg!")};this.initialize.apply(this,arguments)},WaitmidDlg=function(){var a,b,c,d={};this.init=function(c){a=c,b=this},this.openDlg=function(){e(),c.show()},this.closeDlg=function(){c.hide()};var e=function(){c||(c=Dialog.snew(a,{modal:!1,pos:{x:"center",y:150},zIndex:UI_ZORDER_TOOLTIP,uiback:uiback.dlg.minihelp}),a.getGUI().initDlg(c,uicfg.misc.waitmiddlg,d),c.hide())};this.init.apply(this,arguments)}