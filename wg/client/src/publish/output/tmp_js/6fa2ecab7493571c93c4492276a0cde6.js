NS=function(){var a=15,b,c,d=null,e=[null,null],f=0,g=0,h=[],i=!1,j=null;this.init=function(a,b){c=this,g=123456,f=0,d=new XXTea,o(a,b)},this.setGameObj=function(a){b=a},this.connect=function(){window.setTimeout(k,200)},this.send=function(a){if(b.getState()==GSTATE.CLOSE){b.onClose();return}var c=p();c?t(a):h.push(a)},this.close=function(){},this.setKey=function(a){},this.setMaxPackLen=function(a){},this.onConnect=function(a){},this.onClose=function(){};var k=function(){try{b.onConnect(!0),u(),j=window.setInterval(n,a)}catch(c){window.setTimeout(k,200)}},l=function(a){if(b==null)return;if(a=="err!"){u();return}var c=a.split("*");for(var d=0;d<c.length;++d)m(c[d])},m=function(a){var c=d.decrypt(a);if(c.indexOf("KI:")==0)g=parseInt(c.substr(3),10);else if(c.indexOf("K:")==0){var e=c.substr(2);d.setKey(e)}else if(c.indexOf("SI:")==0)f=parseInt(c.substr(3),10),i=!0;else{var h=c.lastIndexOf("}");h==c.length-1?b.onData(c):h>0?b.onData(c.substr(0,h+1)):alert("error data: e94939223")}},n=function(){h.length>0&&p()&&(t(h[0]),TQ.removeElement(h,0)),!q()&&!r()&&s()},o=function(a,b){for(var d=0;d<e.length;++d)e[d]=new MyAjax("http://"+a+":"+b+"/",d),e[d].setCaller({self:c,caller:l})},p=function(){var a=null;return e[0].getState()!=AJAX_STATE.GETTING?a=e[0]:e[1].getState()!=AJAX_STATE.GETTING&&(a=e[1]),a},q=function(){return e[0].getState()==AJAX_STATE.GETTING||e[1].getState()==AJAX_STATE.GETTING},r=function(){return e[0].getState()==AJAX_STATE.ERROR||e[1].getState()==AJAX_STATE.ERROR},s=function(){var a=p();if(a&&i){var b=d.encrypt("k:"+g);a.send(b+"&i="+f)}},t=function(a){var b=p();if(b){var c=d.encrypt("k:"+g+",s:"+a);b.send(c+"&i="+f)}},u=function(){j&&(window.clearInterval(j),j=null)};this.init.apply(this,arguments)}