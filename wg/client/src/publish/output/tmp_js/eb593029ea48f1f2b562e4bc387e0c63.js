WorldBossRankDlg=JBaseDlg.ex({_innerInit:function(){this.g_.regEvent(EVT.WORLDBOSS,0,this,this._onWorldBossUpdate),HDRM.regHdrEx(this.g_,"worldbosssvr",WorldBossSvrHdr)},_getDlgCfg:function(){return{modal:!1,title:rstr.worldboss.rankdlg.title,pos:{x:"center",y:40},uicfg:uicfg.worldboss.rankdlg}},_setCallers:function(){this.items_.getPersonGift.setCaller({self:this,caller:this._onClickGetPersonGift}),this.items_.seeDropAllianceGift.setCaller({self:this,caller:this._onClickSeeDropAllianceGift}),this.items_.getCountryGift.setCaller({self:this,caller:this._onClickGetCountryGift})},_initInfo:function(){this._update(),WorldBossrSender.sendGetRankInfo(this.g_)},_update:function(){if(!this.isShow())return;this._updatePersonDate(),this._updatePersonList(),this._updateBtnsEnable(),this._updateAllianceDate(),this._updateAllianceList(),this._updateCountryDate(),this._updateCountryList()},_updatePersonDate:function(){var a=TQ.format(rstr.worldboss.rankdlg.lbl.randdateLbl,TQ.formatShortDate(this.g_.getSvrTimeS()));TQ.setRichText(this.items_.persionDate,a)},_updatePersonList:function(){var a=this.imgr_.getWorldBoss().prank;this.items_.personList.setItemCount(a.length);for(var b=0;b<a.length;++b){var c=this.items_.personList.getItem(b),d=a[b];TQ.setRichText(c.exsubs.rank,b+1),c.exsubs.name.setId(b),c.exsubs.name.setText(d.role),c.exsubs.name.setCaller({self:this,caller:this._onClickRoleName});var e=RStrUtil.formatResNumStr(d.hurt);TQ.setRichText(c.exsubs.hurtNumber,TQ.format(rstr.worldboss.rankdlg.lbl.hurtNumber,e))}},_updateBtnsEnable:function(){var a=this.imgr_.getWorldBoss().today;this.items_.getPersonGift.enable(a.gotPRankGift==0),this.items_.getCountryGift.enable(a.gotCRankGift==0)},_updateAllianceDate:function(){var a=TQ.format(rstr.worldboss.rankdlg.lbl.randdateLbl,TQ.formatShortDate(this.g_.getSvrTimeS()));TQ.setRichText(this.items_.allianceDate,a)},_updateAllianceList:function(){var a=this.imgr_.getWorldBoss().arank;this.items_.allianceList.setItemCount(a.length);for(var b=0;b<a.length;++b){var c=this.items_.allianceList.getItem(b),d=a[b];TQ.setRichText(c.exsubs.rank,b+1),TQ.setRichText(c.exsubs.name,d.alli);var e=RStrUtil.formatResNumStr(d.hurt);TQ.setRichText(c.exsubs.hurtNumber,TQ.format(rstr.worldboss.rankdlg.lbl.hurtNumber,e))}},_updateCountryDate:function(){var a=this.imgr_.getWorldBoss().crankweek,b=TQ.format(rstr.worldboss.rankdlg.lbl.randdateLbl,TQ.format(rstr.worldboss.rankdlg.lbl.weekLbl,a));TQ.setRichText(this.items_.countryDate,b)},_updateCountryList:function(){var a=this.imgr_.getWorldBoss().crank;this.items_.countryList.setItemCount(a.length);for(var b=0;b<a.length;++b){var c=this.items_.countryList.getItem(b),d=a[b];TQ.setRichText(c.exsubs.rank,b+1),TQ.setRichText(c.exsubs.name,rstr.comm.countrys[d.country-FIXID.FIRSTSTATECITY]),TQ.setRichText(c.exsubs.times,TQ.format(rstr.worldboss.rankdlg.lbl.hurtTimes,d.times))}},_onClickRoleName:function(a){var b=this.imgr_.getWorldBoss().prank[a];OutFieldSender.sendGetFieldDetailByRole(this.g_,b.role)},_onClickGetPersonGift:function(){WorldBossrSender.sendGetPersonRankGift(this.g_)},_onClickSeeDropAllianceGift:function(){UIM.openDlg("worldbossalligift")},_onClickGetCountryGift:function(){WorldBossrSender.sendGetCountryRankGift(this.g_)},_onWorldBossUpdate:function(){this._update()}})