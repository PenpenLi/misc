CityBuildUtil=Class.extern(function(){var a=null,b={};this.init=function(){b[CITY_TYPE.MAIN]=[110002,110003,110004,110005,110006,110007,110008,110009,110010,110011,110012],b[CITY_TYPE.SUBRES]=[110002,110013,110014,110015,110016,110017],b[CITY_TYPE.SUBARMY]=[110006,110018,110019,110020,110021,110022]},this.initOneTime=function(b){a=b},this.isCanBuildInCity=function(c,d){var e=a.getImgr().getCityTypeByCityId(c),f=b[e];return f?TQ.find(f,null,d)!=null:!1}}).snew(),BaseCitySelBuildDlg=Class.extern(function(){var a=null,b=null,c=null,d={},e=null,f=0,g={ids:[],backImgClass:""};this.init=function(c){a=c,this.g_=c,b=this,this.initCfg(g),h()},this.initCfg=function(a){},this.setCaller=function(a){e=a},this.openDlg=function(a){i(a),j(),q(),r()},this._onOpen=function(a){},this._onClose=function(){};var h=function(){for(var a=0;a<g.ids.length;++a){var b=g.ids[a];b.id=0,b.level=0,b.itemres=ItemResUtil.findItemres(b.resid),b.maxcnt=b.itemres.maxCount}},i=function(a){f=a},j=function(){if(c)return;k(),l(),m(),n(),o(),p()},k=function(){c=Dialog.snew(a,{modal:!0,title:"",pos:{x:"center",y:50},uiback:uiback.dlg.noborder}),a.getGUI().initDlg(c,uicfg.selCityBuildDlg,d),TQ.setClass(d.backImg,g.backImgClass)},l=function(){d.list.setItemCount(g.ids.length)},m=function(){for(var a=0;a<d.list.getCount();++a){var b=d.list.getItem(a).item;TQ.setCSS(b,"float","none"),TQ.setCSS(b,"position","absolute"),TQ.setDomPos(b,g.ids[a].pos.x,g.ids[a].pos.y)}},n=function(){for(var a=0;a<d.list.getCount();++a){var b=d.list.getItem(a);TQ.setTextEx(b.exsubs.name,g.ids[a].itemres.name)}},o=function(){d.closeBtn.setCaller({self:b,caller:y}),d.list.setCaller({self:b,caller:B}),c.setCaller({self:b,caller:z})},p=function(){for(var a=0;a<d.list.getCount();++a){var c=d.list.getItem(a);TTIP.setCallerData(c.exsubs.tooltips.$item,{self:b,caller:C},{idx:a})}},q=function(){c.show(),a.regUpdater(b,A,3e3)},r=function(){s(),b._onOpen(d)},s=function(){if(!t())return;for(var a=0;a<d.list.getCount();++a)u(d.list.getItem(a),g.ids[a])},t=function(){return c?c.isShow():!1},u=function(a,b){v(a,b),w(a,b),x(a,b)},v=function(a,b){var c="d";if(D(b)||TIPM.isCanBuildUpgrade(f,b))c=null;IMG.setBKImage(a.exsubs.icon,IMG.makeBigImg(b.itemres.bigpic,c))},w=function(b,c){if(D(c))return;TQ.setCSS(b.exsubs.cnt,"display","block"),TQ.setCSS(b.exsubs.flag,"display","none");var d=a.getImgr().getBuildCntByResid(f,c.resid);TQ.setText(b.exsubs.cnt,d)},x=function(a,b){if(!D(b))return;TQ.setCSS(a.exsubs.flag,"display","block"),TQ.setCSS(a.exsubs.cnt,"display","none");var c=b.maxcnt==1,d=c?IMG.getBuildedFlag():IMG.getFullBuildedFlag();IMG.setBKImage(a.exsubs.flag,d)},y=function(){c.hide()},z=function(c){c==C_SYS_DLG_HIDE&&(a.unregUpdater(b,A),b._onClose())},A=function(a){s()},B=function(b,d){s();var h=g.ids[d];if(D(h)){a.getGUI().msgBox(rstr.comm.msgts,TQ.format(rstr.inbuild.sel.fullbuilded,h.itemres.name,h.maxcnt),MB_F_CLOSE,null);return}var i=TIPM.getSimpleBuildUpTip(f,h);if(i!=""){a.getGUI().msgBox(rstr.comm.msgts,i,MB_F_CLOSE,null);return}e&&(e.caller.call(e.self,h.resid),c.hide())},C=function(a){var b=g.ids[a.idx];return D(b)?TQ.format(rstr.inbuild.sel.fullbuilded,b.itemres.name,b.maxcnt):TIPM.getBuildDesc(f,"firstup",b)},D=function(b){var c=a.getImgr().getBuildCntByResid(f,b.resid);return c==b.maxcnt}}),MainCitySelBuildDlg=BaseCitySelBuildDlg.extern(function(){this.initCfg=function(a){var b=[45,207,372,528],c=[43,167,294];a.ids=[{resid:110002,pos:{x:b[0],y:c[0]}},{resid:110003,pos:{x:b[0],y:c[1]}},{resid:110004,pos:{x:b[0],y:c[2]}},{resid:110005,pos:{x:b[1],y:c[0]}},{resid:110006,pos:{x:b[2],y:c[0]}},{resid:110008,pos:{x:b[3],y:c[0]}},{resid:110009,pos:{x:b[3],y:c[1]}},{resid:110010,pos:{x:b[1],y:c[2]}},{resid:110011,pos:{x:b[2],y:c[2]}},{resid:110012,pos:{x:b[3],y:c[2]}}],a.backImgClass="mainback"},this._onOpen=function(a){HelpGuider.getNewcomerSpirit().onDlgOpen("mainselbuild",a)},this._onClose=function(){HelpGuider.getNewcomerSpirit().onDlgClose("mainselbuild")}}),ResCitySelBuildDlg=BaseCitySelBuildDlg.extern(function(){this.initCfg=function(a){var b=[45,278,528],c=[43,168,295];a.ids=[{resid:110002,pos:{x:b[0],y:c[1]}},{resid:110014,pos:{x:b[1],y:c[1]}},{resid:110015,pos:{x:b[2],y:c[1]}},{resid:110016,pos:{x:b[2],y:c[2]}},{resid:110017,pos:{x:b[2],y:c[0]}}],a.backImgClass="ressubback"}}),MilitaryCitySelBuildDlg=BaseCitySelBuildDlg.extern(function(){this.initCfg=function(a){var b=[45,278,528],c=[43,168,295];a.ids=[{resid:110006,pos:{x:b[0],y:c[1]}},{resid:110019,pos:{x:b[1],y:c[1]}},{resid:110020,pos:{x:b[2],y:c[1]}},{resid:110021,pos:{x:b[2],y:c[0]}},{resid:110022,pos:{x:b[2],y:c[2]}}],a.backImgClass="militarysubback"}})