Blue3366DiamondDlg=JBaseDlg.ex({_innerInit:function(){this.g_.regEvent(EVT.ROLEBASE,4,this,this._onDiamondInfo)},_getDlgCfg:function(){return{modal:!1,pos:{x:"center",y:40},uiback:uiback.dlg.noborder,uicfg:uicfg.blue3366DiamondDlg}},_setCallers:function(){this.items_.closeBtn.setCaller({self:this,caller:this._onCloseDlg}),this.items_.gotoBtn.setCaller({self:this,caller:this._onGoto}),this.items_.getBtn.setCaller({self:this,caller:this._onGet})},_initInfo:function(){this._update()},_update:function(){if(!this.isShow())return;this._updateCurLevel(),this._updateList(),this._updateGetBtnEnable()},_updateCurLevel:function(){TQ.setRichText(this.items_.curLevel,TQ.format(rstr.blue3366DiamondDlg.curLevel,this._getGrowLevel()))},_updateList:function(){var a=this.items_.everydayList;a.setItemCount(res_3366_lvlgifts.length);for(var b=0;b<a.getCount();++b){var c=res_3366_lvlgifts[b],d=DropItemUtil.getDropItems(c.dropid),e=a.getItem(b);TQ.setRichText(e.exsubs.level,this._makeLevel(c,b,b==0,b==a.getCount()-1));for(var f=1;f<=d.length;++f){var g=d[f-1];g.itemres=ItemResUtil.findItemres(g.id),this._setItem(e.exsubs["icon"+f],e.exsubs["number"+f],e.exsubs.tooltips["$item"+f],g)}for(var f=d.length+1;f<=3;++f)TTIP.setCallerData(e.exsubs.tooltips["$item"+f],{self:this,caller:this._onGetTooltip},{resid:0})}},_updateGetBtnEnable:function(){this.items_.getBtn.enable(!this._isGotEverydayGift())},_makeLevel:function(a,b,c,d){if(c)return TQ.format(rstr.blue3366DiamondDlg.lvl,1,a.level-1);if(d){var e=res_3366_lvlgifts[b-1];return TQ.format(rstr.blue3366DiamondDlg.maxlvl,e.level)}var e=res_3366_lvlgifts[b-1];return TQ.format(rstr.blue3366DiamondDlg.lvl,e.level,a.level-1)},_setItem:function(a,b,c,d){IMG.setBKImage(a,IMG.makeSmallImg(d.itemres.smallpic)),TQ.setText(b,"Ã—"+d.number),TTIP.setCallerData(c,{self:this,caller:this._onGetTooltip},{resid:d.id})},_getGrowLevel:function(){return this.imgr_.get3366GrowLevel()},_isGotEverydayGift:function(){var a=this.imgr_.getRoleRes().bdInfo;return a.got_3366gift?TQ.isSameDay(a.got_3366gift,this.g_.getSvrTimeS()):!1},_onGetTooltip:function(a){if(a.resid==0)return"";var b={id:a.resid,resid:a.resid,itemres:ItemResUtil.findItemres(a.resid)};return TIPM.getItemDesc(b)},_onDiamondInfo:function(a){this._update()},_onCloseDlg:function(){this.dlg_.hide()},_onGoto:function(){JMISC.open3366()},_onGet:function(){if(this._getGrowLevel()==0){this.g_.getGUI().sysMsgTips(SMT_WARNING,rstr.blue3366DiamondDlg.goto3366Tip);return}this._isGotEverydayGift()||BlueDiamondSender.sendGet3366EveryDayGift(this.g_)}})