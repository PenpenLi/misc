ActTowerDlg=BaseDlg.extern(function(){var a=null,b=300;this._init=function(){a=this,this.g_.regEvent(EVT.ROLESPECSTATE_CHANGE,0,this,c),this.g_.regEvent(EVT.NET,NETCMD.ACT_TOWER,this,this._onSvrPkg)},this._isCanOpen=function(){if(this.g_.getImgr().getRoleRes().level<res_enter_tower_need_rolelevel){var a=TQ.format(rstr.activity.tower.maindlg.tip.roleLevelNotArrived,res_enter_tower_need_rolelevel);return this.g_.getGUI().msgBox(rstr.comm.msgts,a,MB_F_CLOSE,null),!1}return!0},this._getDlgCfg=function(){return{modal:!1,title:rstr.activity.tower.maindlg.title,pos:{x:"center",y:40},uicfg:uicfg.activity.tower.maindlg}},this._setCallers=function(){this.items_.addRecoveryRateBtn.setCaller({self:this,caller:this._onClickAddRecoveryRateBtn}),this.items_.buyBtn.setCaller({self:this,caller:this._onClickBuyItemBtn}),this.items_.enterBtn.setCaller({self:this,caller:this._onClickEnterBtn})},this._initInfo=function(){this.items_.enterBtn.setType(BTN_TYPE.DELAY),this.items_.enterBtn.setDelay(b),g(),h(),this.items_.towerLayerRadio.select(0),ActTowerSender.sendGetBaseInfo(this.g_),UIM.getDlg("acttowerexped").reset()},this._onClickAddRecoveryRateBtn=function(){if(a.g_.getImgr().hasRoleState(RES_EFF.TOWER_RECOVER_SOLDIER)){this.g_.getGUI().sysMsgTips(SMT_WARNING,rstr.activity.tower.maindlg.tip.itemused);return}UIM.openDlg("uselistitem",[RES_EFF.TOWER_RECOVER_SOLDIER],{id:0,name:"",type:RES_TRG.SELF_ROLE})},this._onClickBuyItemBtn=function(){UIM.getDlg("buyitem").openDlg({id:0,resid:FIXID.HEIMULING,number:1e5})},this._onClickEnterBtn=function(){var b=a.g_.getImgr(),c=b.getActTower().baseInfo;if(c.today.freeTimes==c.today.maxTimes&&c.today.itemTimes==0&&b.getItemNumByResId(FIXID.HEIMULING)>0){a.g_.getGUI().msgBox(rstr.comm.msgts,rstr.activity.tower.maindlg.lbl.confirmUseItem,MB_F_YESNO,{self:a,caller:function(b){b==MB_IDYES&&a._enter()}});return}this._enter()},this._enter=function(){var a=this.items_.towerLayerRadio.getCurSelId(),b=[1,41,81];if(a==0){ActTowerSender.sendEnterTower(this.g_,b[a]);return}var c=this.g_.getImgr().getActTower().baseInfo;if(c.maxLayer+1<b[a]){this.g_.getGUI().sysMsgTips(SMT_WARNING,rstr.activity.tower.maindlg.tip.cannotSkip);return}UIM.getDlg("actskiplayer").openDlg({layer:b[a]})},this._onSvrPkg=function(a){d(a.data.ranks),e(a.data.baseInfo),f(a.data.enterTower)};var c=function(){h()},d=function(b){if(!a.isShow())return;if(!b)return;a.items_.rankingList.setItemCount(b.length);for(var c=0;c<a.items_.rankingList.getCount();++c){var d=a.items_.rankingList.getItem(c),e=b[c];TQ.setTextEx(d.exsubs.no,TQ.format(rstr.activity.tower.maindlg.lbl.no,e.rank)),TQ.setTextEx(d.exsubs.name,e.name),TQ.setTextEx(d.exsubs.maxLayer,TQ.format(rstr.activity.tower.maindlg.lbl.maxLayer,e.maxLayer))}},e=function(b){if(!b)return;TQ.dictCopy(a.g_.getImgr().getActTower().baseInfo,b);if(!a.isShow())return;TQ.setTextEx(a.items_.todayFreeTimes,TQ.format(rstr.activity.tower.maindlg.lbl.todayFreeTimes,b.today.freeTimes,b.today.maxTimes)),TQ.setTextEx(a.items_.todayItemTimes,TQ.format(rstr.activity.tower.maindlg.lbl.todayItemTimes,b.today.itemTimes)),TQ.setTextEx(a.items_.maxLayer,b.maxLayer)},f=function(b){if(!b)return;a.hideDlg()},g=function(){TQ.setTextEx(a.items_.todayFreeTimes,TQ.format(rstr.activity.tower.maindlg.lbl.todayFreeTimes,0)),TQ.setTextEx(a.items_.todayItemTimes,TQ.format(rstr.activity.tower.maindlg.lbl.todayItemTimes,0)),TQ.setTextEx(a.items_.maxLayer,0)},h=function(){if(!a.isShow())return;var b=rstr.activity.tower.maindlg.lbl.noUseRecoverItem;a.g_.getImgr().hasRoleState(RES_EFF.TOWER_RECOVER_SOLDIER)&&(b=rstr.activity.tower.maindlg.lbl.useRecoverItem),TQ.setTextEx(a.items_.usedItemTip,b)}}),ActSkipLayerDlg=BaseDlg.extern(function(){this._getDlgCfg=function(){return{modal:!0,title:rstr.activity.tower.skipLayerDlg.title,pos:{x:"center",y:40},uicfg:uicfg.activity.tower.skipLayerDlg}},this._setCallers=function(){this.items_.needBtn.setCaller({self:this,caller:this._onClickNeedBtn}),this.items_.noNeedBtn.setCaller({self:this,caller:this._onClickNoNeedBtn})},this._onClickNeedBtn=function(){this.dlg_.hide(),UIM.openDlg("actgainskiplayergift",this.params_)},this._onClickNoNeedBtn=function(){this.dlg_.hide(),ActTowerSender.sendEnterTower(this.g_,this.params_.layer)}}),ActGainSkipLayerGiftDlg=BaseDlg.extern(function(){var a=null;this._init=function(){a=this},this._getDlgCfg=function(){return{modal:!0,title:rstr.activity.tower.gainSkipLayerGift.title,pos:{x:"center",y:40},uicfg:uicfg.activity.tower.gainSkipLayerGift}},this._setCallers=function(){this.items_.gainBtn.setCaller({self:this,caller:this._onClickGainBtn}),this.items_.noGainBtn.setCaller({self:this,caller:this._onClickNoGainBtn})},this._initInfo=function(){var c=a.g_.getImgr().getActTower().baseInfo.maxLayer,d=b();a.g_.getImgr().hasVipEffect(VIP_EFF.SKIP_TOWER)&&(d+=rstr.activity.tower.gainSkipLayerGift.vip);var e=TQ.format(rstr.activity.tower.gainSkipLayerGift.desc,c,this.params_.layer-1,d);TQ.setTextEx(this.items_.desc,e)};var b=function(){if(a.g_.getImgr().hasVipEffect(VIP_EFF.SKIP_TOWER))return 0;var b=a.g_.getImgr().getActTower().baseInfo.maxLayer;return a.params_.layer==41?100-b:200-b};this._onClickGainBtn=function(){if(this.g_.getImgr().getGold()<b()){this.g_.getGUI().sysMsgTips(SMT_WARNING,rstr.activity.tower.gainSkipLayerGift.tip.noEnoughGold);return}this.dlg_.hide(),ActTowerSender.sendEnterTower(this.g_,this.params_.layer,!0)},this._onClickNoGainBtn=function(){this.dlg_.hide(),ActTowerSender.sendEnterTower(this.g_,this.params_.layer)}})