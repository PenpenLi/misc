HelpGuider.HELP_TIP={CHANGE_CITY:1,ASSIGN_ROLEPP:2,FIGHT_OUTFIELD:3,ACTTOWER_FIGHT:4,OPEN_SHOPDLG:5,OPEN_RANKDLG:6,OPEN_LETTERDLG:7,OPEN_EXCHANGEDLG:8,OPEN_VIPDLG:9,OPEN_PAYDLG:10,OPEN_MYFIELD:11},HelpGuider.opbitmaps_={},HelpGuider.curHelpTipId_=0,HelpGuider.buildOpMenu={itemId:"",buildId:0,buildState:-1},HelpGuider.isUsePaiChengKa=!1,HelpGuider.SpiritUtil=Class.extern(function(){this.startSpirit=function(a,b,c){if(!a||!b)return;var d={parent:a,text:c.spiritCon,blinktime:4294967295,arrawdir:c.spiritArrawDir,binfo:{dom:b,x:-8,y:-8,w:c.spiritTargetW,h:c.spiritTargetH,offsetx:c.spiritTargetOffX,offsety:c.spiritTargetOffY,isShow:c.spiritTargetShow==1}};c.shape&&(d.shape=c.shape),c.spiritSelectType==0?HelpGuider.spirit(d):c.spiritSelectType==99?HelpGuider.spiritTip(d):(d.x=-10,d.y=-6,HelpGuider.spiritRhombus(d))},this.getCurRes=function(a){var b=UIM.getDlg("newcomerhelper").getCurId(),c=ItemResUtil.findTaskRes(b);return c?c:(c=this._getResFromRoleLevel(a),c=this._getResFromGrowupTask(a,c),c)},this._getResFromRoleLevel=function(a){var b=this._getEmptyRes();return a.getImgr().getRoleLevel()>=10&&this._setActTowerFight(b,"rolelevel"),b},this._getResFromGrowupTask=function(a,b){var c=a.getImgr().getTask().growups;for(var d=0;d<c.length;++d){var e=c[d];if(e.state!=0)continue;if(e.id==FIXID.FIRST_FIGHT){b.spiritTarget="inbuild.firstfight",b.spiritCon=rstr.newcomerHelp.tip.clickExpedBtn,b.spiritArrawDir=3,b.spiritTargetW=80,b.spiritTargetH=30,b.spiritTargetOffY=25;break}if(e.id==FIXID.BUILD_JUNYING_TASK){b.spiritTarget="inbuild.firstfreeblock.junying",b.spiritSelectType=1,b.spiritCon=rstr.newcomerHelp.tip.buildJunYing,b.spiritArrawDir=3,b.spiritTargetW=113,b.spiritTargetH=65,b.spiritTargetShow=1;break}if(e.id==1600056){b.spiritTarget="inbuild.peibing2",b.spiritSelectType=1,b.spiritCon=rstr.newcomerHelp.tip.peibing,b.spiritArrawDir=3,b.spiritTargetW=80,b.spiritTargetH=30,b.spiritTargetOffY=25;break}if(e.id==1600029){b.spiritTarget="inbuild.secfight",b.spiritCon=rstr.newcomerHelp.tip.clickExpedBtn,b.spiritArrawDir=3,b.spiritTargetW=80,b.spiritTargetH=30,b.spiritTargetOffY=25;break}if(e.id==1600071){b.spiritTarget="inbuild.upbuild.guanfu2",b.spiritSelectType=1,b.spiritCon=rstr.newcomerHelp.tip.upguanfu,b.spiritArrawDir=2,b.spiritTargetW=100,b.spiritTargetH=100,b.spiritTargetOffX=50,b.spiritTargetOffY=427;break}if(e.id==1600023)break;if(e.id==1600072){b.spiritTarget="inbuild.upbuild.shuyuan",b.spiritSelectType=1,b.spiritCon=rstr.newcomerHelp.tip.upshuyuan,b.spiritArrawDir=3,b.spiritTargetW=100,b.spiritTargetH=100,b.spiritTargetOffX=40,b.spiritTargetOffY=5;break}if(e.id==1600036){HelpGuider.firstFightOutField();break}if(e.id==1600042){this._setActTowerFight(b,"task");break}}return b},this._getEmptyRes=function(){return{spiritSelectType:0,from:"",spiritTarget:"*.*.*.*",spiritCon:"",spiritArrawDir:0,spiritTargetW:0,spiritTargetH:0,spiritTargetOffX:0,spiritTargetOffY:0,spiritTargetShow:0}},this._setActTowerFight=function(a,b){a.spiritTarget="inbuild.firstActTowerFight",a.spiritSelectType=1,a.spiritCon=rstr.newcomerHelp.tip.acttowerfight,a.spiritArrawDir=2,a.spiritTargetW=100,a.spiritTargetH=100,a.spiritTargetOffX=40,a.spiritTargetOffY=5,a.from=b}}).snew(),HelpGuider.GetTaskAwardsChecker=Class.extern(function(){this.init=function(a){this.g_=a},this.check=function(){var a=UIM.getPanel("main").getTaskGuide().getTasks();for(var b=0;b<a.length;++b)if(this._checkGetTaskAward(a[b].id))return!0;return!1},this._checkGetTaskAward=function(a){var b=this.g_.getImgr().getTaskById(a);if(!b||b.state!=TASK_STATE.WAIT_GET)return!1;this._closeSomeDlgs(a),UIM.getPanel("main").getTaskGuide().scrollTop();var c=this._getGetTaskAwardBtn(b).getParent(),d=UIM.getPanel("main").getItems().rootmap,e={spiritSelectType:0,spiritCon:rstr.newcomerHelp.tip.getTaskAward,spiritArrawDir:0,spiritTargetW:50,spiritTargetH:30,spiritTargetOffX:0,spiritTargetOffY:0,spiritTargetShow:0};return HelpGuider.SpiritUtil.startSpirit(d,c,e),!0},this._closeSomeDlgs=function(a){a==FIXID.RECRUIT_JI_HERO?UIM.getDlg("recruithero").hideDlg():a==FIXID.CARRY_ONELEVEL_JI_SOLDIER?UIM.getDlg("assignsoldiers").hideDlg():a==FIXID.BUILD_JIBING_TASK&&UIM.getDlg("soldier").hideDlg()},this._getGetTaskAwardBtn=function(a){return UIM.getPanel("main").getTaskGuide().expandPanel(),UIM.getPanel("main").getTaskGuide().getTaskBtnById(a.id)}}),HelpGuider.GetCityUpgradeChecker=Class.extern(function(){this.init=function(a){this.g_=a},this.check=function(){if(!UIM.getPanel("briefres").isCanUpgradeCityLevel())return!1;var a=UIM.getPanel("briefres").getUpgradeCityBtn().getDom(),b=UIM.getPanel("main").getItems().rootmap,c={spiritSelectType:0,spiritCon:rstr.newcomerHelp.tip.upgradeCity,spiritArrawDir:3,spiritTargetW:50,spiritTargetH:30,spiritTargetOffX:24,spiritTargetOffY:5,spiritTargetShow:0};return HelpGuider.SpiritUtil.startSpirit(b,a,c),!0}}),HelpGuider.SubCityOpenChecker=Class.extern(function(){this.init=function(a){this.g_=a},this.check=function(){var a=UIM.getPanel("main").getSubCityBtnsBar().getEmptySubCity();if(!a)return!1;var b=a.getDom(),c=UIM.getPanel("main").getItems().rootmap,d={spiritSelectType:0,spiritCon:rstr.newcomerHelp.tip.openSubCity,spiritArrawDir:1,spiritTargetW:50,spiritTargetH:30,spiritTargetOffX:2,spiritTargetOffY:5,spiritTargetShow:0};return HelpGuider.SpiritUtil.startSpirit(c,b,d),!0}}),HelpGuider.BaseChecker=Class.extern(function(){this.init=function(a){this.g_=a},this._getPaths=function(){var a=this._getRes();return a.spiritTarget.split(".")},this._getRes=function(){return HelpGuider.SpiritUtil.getCurRes(this.g_)},this._isFirstFight=function(a,b){return a[0]=="inbuild"&&a[1]=="firstfight"},this._isSecFight=function(a,b){return a[0]=="inbuild"&&a[1]=="secfight"},this._hasGotoFirstArmy=function(){return this._hasGotoArmy(0)},this._hasGotoSecArmy=function(){return this._hasGotoArmy(1)},this._hasGotoArmy=function(a){var b=this.g_.getImgr().getArmys().list;for(var c=0;c<b.length;++c){var d=b[c],e=res_copyfields[a].id;if(d.targetId==e&&d.targetType==OBJ_TYPE.COPYFIELD&&d.state==ARMYDYN_STATE.GOTO)return!0}return!1},this._centerViewToTarget=function(a,b){var c=TQ.getDomPos(a),d=UIM.getPanel("inbuild").getViewPos(),e=c.x+b.spiritTargetOffX-d.w/2,f=c.y+b.spiritTargetOffY-d.h/2,e=e<0?0:e,f=f<0?0:f;UIM.getPanel("inbuild").setViewPos({x:e,y:f})}}),HelpGuider.BuildOpMenuChecker=HelpGuider.BaseChecker.extern(function(){this.check=function(a){}}),HelpGuider.SelBuildDlgChecker=HelpGuider.BaseChecker.extern(function(){this.check=function(a){var b=this._getPaths(),c=this._getRes();if(b[0]!="inbuild")return;var d=c.spiritCon,e=null;b[1]=="refreshhero"&&this.g_.getImgr().getBuildCntByResid(BUILDCITY_ID.MAIN,FIXID.TAVERNBUILD)==0&&(e=a.list.getItem(3).item,d=rstr.newcomerHelp.tip.buildJiuGuan),b[2]=="minju"&&this.g_.getImgr().getBuildCntByResid(BUILDCITY_ID.MAIN,FIXID.HOUSEBUILD)==0?e=a.list.getItem(0).item:b[2]=="cangku"?this.g_.getImgr().getBuildCntByResid(BUILDCITY_ID.MAIN,FIXID.HOUSEBUILD)==0?(e=a.list.getItem(0).item,c=ItemResUtil.findTaskRes(FIXID.NEWER_TASK_BUILD_MINJU),d=c.spiritCon):this.g_.getImgr().getBuildCntByResid(BUILDCITY_ID.MAIN,FIXID.STOREINBUILD)==0&&(e=a.list.getItem(1).item):b[2]=="shuyuan"&&this.g_.getImgr().getBuildCntByResid(BUILDCITY_ID.MAIN,FIXID.COLLEGEBUILD)==0?e=a.list.getItem(7).item:b[2]=="jiuguan"&&this.g_.getImgr().getBuildCntByResid(BUILDCITY_ID.MAIN,FIXID.TAVERNBUILD)==0?e=a.list.getItem(3).item:b[2]=="junying"&&this.g_.getImgr().getBuildCntByResid(BUILDCITY_ID.MAIN,FIXID.BARBACK)==0&&(e=a.list.getItem(4).item);if(!e){HelpGuider.hideSpirit();return}var f={spiritSelectType:0,spiritCon:d,spiritArrawDir:0,spiritTargetW:93,spiritTargetH:107,spiritTargetOffX:0,spiritTargetOffY:0,spiritTargetShow:1};HelpGuider.SpiritUtil.startSpirit(TQ.getDomParent(e),e,f)}}),HelpGuider.UseListItemDlgChecker=HelpGuider.BaseChecker.extern(function(){this.check=function(a){var b=this._getPaths(),c=this._getRes(),d=c.spiritCon;if(!this._isSpeedBuildState(b,a)&&!this._isHasUpgradeMinJu(b,a)&&!this._isHasUpgradeGuanFu(b,a)&&!this._isHasUpgradeShuYuan(b,a)&&!this._isLearnZhongZhiShuState(b,a)&&!this._isLearnJiBingCultureState(b,a))return;this._isLearnJiBingCultureState(b,a)&&(d=rstr.newcomerHelp.tip.speed);var e=a.items.itemlist.getItem(0).exsubs.usebtn,f=e.getDom(),g={spiritSelectType:0,spiritCon:d,spiritArrawDir:0,spiritTargetW:40,spiritTargetH:40,spiritTargetOffX:0,spiritTargetOffY:0,spiritTargetShow:1};HelpGuider.SpiritUtil.startSpirit(a.parent,f,g),UIM.getDlg("culture").closeDlg()},this._isSpeedBuildState=function(a,b){return a[0]=="inbuild"&&a[1]=="speedbuild"&&this._isSpeedBuildItem(a,b)},this._isHasUpgradeMinJu=function(a,b){return this._isHasUpgradeBuild(a,b,"minju",FIXID.HOUSEBUILD,1)},this._isHasUpgradeGuanFu=function(a,b){return this._isHasUpgradeBuild(a,b,"guanfu2",FIXID.GOV_BUILD,2)},this._isHasUpgradeShuYuan=function(a,b){return this._isHasUpgradeBuild(a,b,"shuyuan",FIXID.COLLEGEBUILD,1)},this._isHasUpgradeBuild=function(a,b,c,d,e){if(a[0]=="inbuild"&&a[1]=="upbuild"&&a[2]==c){var f=HelpGuider.AndSpec.snew(HelpGuider.SameResIdSpec.snew(d),HelpGuider.GreatLevelSpec.snew(e-1),HelpGuider.SameStateSpec.snew(BUILD_STATE.UPGRADE)),g=UIM.getPanel("inbuild").getBlocksByResId(f);return g.length>0&&this._isSpeedBuildItem(a,b)}return!1},this._isSpeedBuildItem=function(a,b){var c=b.data.effids&&b.data.effids.length>0&&b.data.effids[0]==RES_EFF.ACCELERATE,d=b.data.targetitem.type&&b.data.targetitem.type==RES_TRG.BUILDING_IBUILD;return c&&d},this._isLearnZhongZhiShuState=function(a,b){return a[0]=="inbuild"&&a[1]=="learnculture"&&this.g_.getImgr().getLearningCulture().id==FIXID.FOODCBUILD&&b.data.effids&&b.data.effids.length>0&&b.data.effids[0]==RES_EFF.ACC_CULTURELEARN},this._isLearnZhongZhiShuState=function(a,b){return a[0]=="inbuild"&&a[1]=="learnculture"&&this.g_.getImgr().getLearningCulture().id==FIXID.FOODCBUILD&&b.data.effids&&b.data.effids.length>0&&b.data.effids[0]==RES_EFF.ACC_CULTURELEARN},this._isLearnJiBingCultureState=function(a,b){return a[0]=="inbuild"&&a[1]=="recruitsoldier"&&a[2]=="jibing"&&this.g_.getImgr().getLearningCulture().id==FIXID.JIBINGCBUILD&&b.data.effids&&b.data.effids.length>0&&b.data.effids[0]==RES_EFF.ACC_CULTURELEARN}}),HelpGuider.RecruitHeroDlgChecker=HelpGuider.BaseChecker.extern(function(){this.init=function(a){this.g_=a},this.check=function(a){var b=null,c=null,d=this._getPaths(),e=this._getRes();if(this._isRecruitHeroState(d)){TQ.find(UIM.getDlg("recruithero").getNewHeros(),"prof",HERO_PROF.JIJIANG);var f=TQ.getLastFindIdx();if(f>=0){var g=a.items.list.getItem(f).exsubs.recruitbtn;b=g.getDom(),c={spiritSelectType:0,spiritCon:e.spiritCon,spiritArrawDir:0,spiritTargetW:65,spiritTargetH:40,spiritTargetOffX:0,spiritTargetOffY:0,spiritTargetShow:0}}}else this._isRefreshHeroState(d)&&(b=a.items.refreshbtn.getDom(),c={spiritSelectType:0,spiritCon:rstr.newcomerHelp.tip.refreshHeros,spiritArrawDir:0,spiritTargetW:80,spiritTargetH:26,spiritTargetOffX:-20,spiritTargetOffY:0,spiritTargetShow:0});if(!b)return;HelpGuider.SpiritUtil.startSpirit(a.parent,b,c)},this._isRecruitHeroState=function(a){return a[0]=="inbuild"&&a[1]=="recruithero"},this._isRefreshHeroState=function(a){var b=this.g_.getImgr().getTaskById(FIXID.REFRESH_HERO_TASK);return a[0]=="inbuild"&&a[1]=="refreshhero"&&(b==null||b.state==TASK_STATE.WAIT_COMPLETE)}}),HelpGuider.CultureDlgChecker=HelpGuider.BaseChecker.extern(function(){this.check=function(a){var b=this._getPaths(),c=this._getRes(),d={target:null,newRes:null};if(this._isLearnZhongZhiShuState(b)){var e={text:rstr.newcomerHelp.tip.learnZhongZhiShu,tabText:rstr.newcomerHelp.tip.selCurPage,cultureId:FIXID.FOODCBUILD,tabIdx:0,itemIdx:0};this._learnCulture(a,e,d)}else if(this._isLearnJiBingCultureState(b)){var e={text:rstr.newcomerHelp.tip.learnJiBingCulture,tabText:rstr.newcomerHelp.tip.selCurPage,cultureId:FIXID.JIBINGCBUILD,tabIdx:2,itemIdx:0};this._learnCulture(a,e,d)}if(!d.target)return;HelpGuider.SpiritUtil.startSpirit(a.parent,d.target,d.newRes)},this._isLearnZhongZhiShuState=function(a){return a[0]=="inbuild"&&a[1]=="learnculture"&&a[2]=="zhongzhishu"},this._isLearnJiBingCultureState=function(a){return a[0]=="inbuild"&&a[1]=="recruitsoldier"&&a[2]=="jibing"},this._learnCulture=function(a,b,c){c.target=null,c.newRes=null;var d=a.items.tablist.getActiveTab(),e=a.items.tablist.getTabItems(d).list.getCurSel(),f=this.g_.getImgr().getCultureLevel(b.cultureId);d!=b.tabIdx&&this.g_.getImgr().getLearningCulture().id!=b.cultureId&&f==0?(c.target=a.items.tablist.getTabBtn(b.tabIdx).getDom(),a.parent=TQ.getDomParent(c.target),c.newRes={spiritSelectType:0,spiritCon:b.tabText,spiritArrawDir:1,spiritTargetW:70,spiritTargetH:34,spiritTargetOffX:0,spiritTargetOffY:-10,spiritTargetShow:0}):d==b.tabIdx&&e==b.itemIdx&&this.g_.getImgr().getLearningCulture().id!=b.cultureId&&f==0?(c.target=a.items.learnbtn.getDom(),c.newRes={spiritSelectType:0,spiritCon:b.text,spiritArrawDir:0,spiritTargetW:65,spiritTargetH:40,spiritTargetOffX:0,spiritTargetOffY:0,spiritTargetShow:0}):d==b.tabIdx&&e!=b.itemIdx&&this.g_.getImgr().getLearningCulture().id!=b.cultureId&&f==0?(c.target=a.items.tablist.getTabItems(b.tabIdx).list.getItem(b.itemIdx).item,c.newRes={spiritSelectType:0,spiritCon:b.text,spiritArrawDir:1,spiritTargetW:71,spiritTargetH:71,spiritTargetOffX:15,spiritTargetOffY:0,spiritTargetShow:0}):this.g_.getImgr().getLearningCulture().id==b.cultureId?(c.target=a.items.speedbtn.getDom(),c.newRes={spiritSelectType:0,spiritCon:rstr.newcomerHelp.tip.speed,spiritArrawDir:1,spiritTargetW:53,spiritTargetH:32,spiritTargetOffX:0,spiritTargetOffY:0,spiritTargetShow:0}):HelpGuider.hideAllSpirits()}}),HelpGuider.ExpeditionDlgChecker=HelpGuider.BaseChecker.extern(function(){this.check=function(a){var b=this._getPaths(),c={target:null,newRes:null};this._isPeiBingState(b,a)||this._isPeiBing2State(b,a)?(c.target=a.items.assignsoldier.getDom(),c.newRes={spiritSelectType:0,spiritCon:rstr.newcomerHelp.tip.clickPeibingBtn,spiritArrawDir:0,spiritTargetW:65,spiritTargetH:40,spiritTargetOffX:0,spiritTargetOffY:0,spiritTargetShow:0}):this._isFirstFight(b,a)&&!this._hasGotoFirstArmy()?c=this._guide(a,171001):this._isSecFight(b,a)&&!this._hasGotoSecArmy()&&(c=this._guide(a,171002));if(!c.target)return;HelpGuider.SpiritUtil.startSpirit(a.parent,c.target,c.newRes)},this._guide=function(a,b){var c={target:null,newRes:null};return this._isCopyFieldTarget(b)?UIM.getDlg("expedition").hasExpedHeros()?(c.target=a.items.expedition.getDom(),c.newRes={spiritSelectType:0,spiritCon:rstr.newcomerHelp.tip.confirmExped,spiritArrawDir:0,spiritTargetW:110,spiritTargetH:51,spiritTargetOffX:-15,spiritTargetOffY:0,spiritTargetShow:0}):(c.target=a.items.changeforcetab.getDom(),c.newRes={spiritSelectType:0,spiritCon:rstr.newcomerHelp.tip.setExpedHerosForce,spiritArrawDir:0,spiritTargetW:50,spiritTargetH:82,spiritTargetOffX:-15,spiritTargetOffY:0,spiritTargetShow:0}):(c.target=a.items.selecttarget.getDom(),c.newRes={spiritSelectType:0,spiritCon:rstr.newcomerHelp.tip.selExpedTarget,spiritArrawDir:0,spiritTargetW:91,spiritTargetH:37,spiritTargetOffX:-10,spiritTargetOffY:0,spiritTargetShow:0}),c},this._isPeiBingState=function(a,b){return a[0]!="inbuild"||a[1]!="peibing"?!1:!0},this._isPeiBing2State=function(a,b){return a[0]!="inbuild"||a[1]!="peibing2"?!1:!0},this._isCopyFieldTarget=function(a){var b=UIM.getDlg("expedition").getTarget();return b!=null&&b.type==OBJ_TYPE.COPYFIELD&&b.resid==a}}),HelpGuider.AssignSoldiersDlgChecker=HelpGuider.BaseChecker.extern(function(){this.check=function(a,b){var c={target:null,newRes:null},d=this._getPaths();this._isPeiBingState(d,a)?c=this._guide(a,b,10):this._isPeiBing2State(d,a)&&(c=this._guide(a,b,20));if(!c.target)return;HelpGuider.SpiritUtil.startSpirit(a.parent,c.target,c.newRes)},this._guide=function(a,b,c){var d={target:null,newRes:null},e=a.items.herolist.getItem(0).exsubs;if(e.soldiertype.getTitle().indexOf(rstr.newcomerHelp.txt.jibing)<0)d.target=e.soldiertype.getTitleDom(),d.newRes={spiritSelectType:0,spiritCon:rstr.newcomerHelp.tip.selectSoldierType,spiritArrawDir:2,spiritTargetW:87,spiritTargetH:26,spiritTargetOffX:10,spiritTargetOffY:0,spiritTargetShow:0};else if(e.soldiernumber.getVal()<c){d.target=e.soldiernumber.getDom();var f=TQ.format(rstr.newcomerHelp.tip.inputSoldierNumber,c);d.newRes={spiritSelectType:0,spiritCon:f,spiritArrawDir:1,spiritTargetW:90,spiritTargetH:34,spiritTargetOffX:0,spiritTargetOffY:-6,spiritTargetShow:0}}else e.soldiernumber.setVal(c),d.target=e.confirm.getDom(),d.newRes={spiritSelectType:0,spiritCon:rstr.newcomerHelp.tip.confirmAssignSoldier,spiritArrawDir:1,spiritTargetW:59,spiritTargetH:34,spiritTargetOffX:0,spiritTargetOffY:-6,spiritTargetShow:0};return b=="dlgOpen"&&UIM.getDlg("expedition").isShow()&&UIM.getDlg("expedition").hideDlg(),d},this._isPeiBingState=function(a,b){return this._isCommPeiBingState(a,b,"peibing")},this._isPeiBing2State=function(a,b){return this._isCommPeiBingState(a,b,"peibing2")},this._isCommPeiBingState=function(a,b,c){return a[0]!="inbuild"||a[1]!=c?!1:b.items.herolist.getCount()==0?!1:!0}}),HelpGuider.SelPipDlgChecker=HelpGuider.BaseChecker.extern(function(){this.check=function(a){var b=null,c=null,d=this._getPaths(),e=this._getRes();if(this._isSeedState(d,a)){var f=this._getItem(a.items.list);b=f.exsubs.icon,a.parent=TQ.getDomParent(b),c={spiritSelectType:0,spiritCon:rstr.newcomerHelp.tip.selOnePip,spiritArrawDir:0,spiritTargetW:76,spiritTargetH:76,spiritTargetOffX:0,spiritTargetOffY:0,spiritTargetShow:1}}if(!b)return;HelpGuider.SpiritUtil.startSpirit(a.parent,b,c)},this._isSeedState=function(a,b){return a[0]!="farm"||a[1]!="seed"?!1:UIM.getPanel("farm").getView().getEmptyBlock()==null?!1:!0},this._getItem=function(a){var b=[{resid:FIXID.FARM,has:!1},{resid:FIXID.TIMBERYARD,has:!1},{resid:FIXID.QUARRY,has:!1},{resid:FIXID.IRONORE,has:!1}],c=UIM.getPanel("farm").getView().getBuildblocks(),d=c.getShowBlocks();for(var e=0;e<d;++e){var f=c.getBlock(e),g=f.getItem();if(g.empty)continue;if(g.next)continue;var h=TQ.find(b,"resid",g.resid);h.has=!0}hasNotIdx=0;for(var e=0;e<4;++e){var h=b[e];if(!h.has){hasNotIdx=e;break}}return a.getItem(hasNotIdx*4+3)}}),HelpGuider.SelectExpedTargetDlgChecker=HelpGuider.BaseChecker.extern(function(){this.check=function(a){var b={target:null,newRes:null},c=this._getPaths();this._isFirstFight(c,a)?b=this._guide(a,0):this._isSecFight(c,a)&&(b=this._guide(a,1));if(!b.target)return;HelpGuider.SpiritUtil.startSpirit(a.parent,b.target,b.newRes)},this._guide=function(a,b){var c={target:null,newRes:null},d=a.items.tablist.getTabItems(0);return a.items.tablist.getActiveTab()!=0?(c.target=a.items.tablist.getTabBtn(0).getDom(),a.parent=TQ.getDomParent(c.target),c.newRes={spiritSelectType:0,spiritCon:rstr.newcomerHelp.tip.selCopyFieldTab,spiritArrawDir:1,spiritTargetW:92,spiritTargetH:34,spiritTargetOffX:0,spiritTargetOffY:-10,spiritTargetShow:0}):d.typelist.getCurSel()!=0?(c.target=d.typelist.getItem(0).exsubs.name,a.parent=TQ.getDomParent(c.target),c.newRes={spiritSelectType:0,spiritCon:rstr.newcomerHelp.tip.selFirstCopyType,spiritArrawDir:0,spiritTargetW:136,spiritTargetH:24,spiritTargetOffX:-40,spiritTargetOffY:0,spiritTargetShow:0}):d.targetlist.getCurSel()!=b?(c.target=d.targetlist.getItem(b).item,a.parent=d.target_bak,c.newRes={spiritSelectType:0,spiritCon:rstr.newcomerHelp.tip.selCopyFields[b],spiritArrawDir:0,spiritTargetW:110,spiritTargetH:42,spiritTargetOffX:0,spiritTargetOffY:0,spiritTargetShow:0}):(c.target=a.items.confirmBtn.getDom(),a.parent=TQ.getDomParent(c.target),c.newRes={spiritSelectType:0,spiritCon:rstr.newcomerHelp.tip.confirmSelCopyField,spiritArrawDir:0,spiritTargetW:87,spiritTargetH:34,spiritTargetOffX:-10,spiritTargetOffY:0,spiritTargetShow:0}),c}}),HelpGuider.AssignHerosDlgChecker=HelpGuider.BaseChecker.extern(function(){this.check=function(a){var b=null,c=null,d=this._getPaths(),e=this._getRes();if(this._isFirstFight(d)||this._isSecFight(d))UIM.getDlg("assignheros").hasAssignedHero()?(b=UIM.getDlg("assignheros").getCoreDlg().getBtns()[0].getDom(),c={spiritSelectType:0,spiritCon:rstr.newcomerHelp.tip.confirmAssignHero,spiritArrawDir:3,spiritTargetW:80,spiritTargetH:34,spiritTargetOffX:0,spiritTargetOffY:10,spiritTargetShow:0}):(b=a.items.autosel.getDom(),c={spiritSelectType:0,spiritCon:rstr.newcomerHelp.tip.autoAssignHero,spiritArrawDir:3,spiritTargetW:80,spiritTargetH:34,spiritTargetOffX:0,spiritTargetOffY:10,spiritTargetShow:0});if(!b)return;HelpGuider.SpiritUtil.startSpirit(a.parent,b,c)}}),HelpGuider.MilitaryDlgChecker=HelpGuider.BaseChecker.extern(function(){this.check=function(a){var b=null,c=null,d=this._getPaths(),e=this._getRes();if(this._isFirstFight(d,a)||this._isSecFight(d,a)){HelpGuider.hideAllSpirits(),HelpGuider.opbitmaps_.openedMiliraryDlg=!0;return}}}),HelpGuider.SoldierDlgChecker=HelpGuider.BaseChecker.extern(function(){this.check=function(a){var b=null,c=null,d=this._getPaths(),e=this._getRes(),f=UIM.getDlg("soldier").getView(),g=f.getCtrl("cantraininglist").getCurSel(),h=f.getCtrl("isoldiernum").getVal();this._isCanRecruitSoldier(d,a)&&(g!=1?(b=f.getCtrl("cantraininglist").getItem(1).exsubs.icon,c={spiritSelectType:0,spiritCon:rstr.newcomerHelp.tip.selJiBing,spiritArrawDir:1,spiritTargetW:80,spiritTargetH:72,spiritTargetOffX:0,spiritTargetOffY:-10,spiritTargetShow:0}):h<20?(b=f.getCtrl("isoldiernum").getDom(),c={spiritSelectType:0,spiritCon:rstr.newcomerHelp.tip.input20JiBing,spiritArrawDir:2,spiritTargetW:84,spiritTargetH:34,spiritTargetOffX:10,spiritTargetOffY:0,spiritTargetShow:0}):(b=f.getCtrl("trainingbtn").getDom(),c={spiritSelectType:0,spiritCon:rstr.newcomerHelp.tip.confirmRecruitSoldier,spiritArrawDir:2,spiritTargetW:87,spiritTargetH:34,spiritTargetOffX:10,spiritTargetOffY:0,spiritTargetShow:0}));if(!b)return;HelpGuider.SpiritUtil.startSpirit(a.parent,b,c)},this._isCanRecruitSoldier=function(a,b){return a[0]=="inbuild"&&a[1]=="recruitsoldier"&&this.g_.getImgr().getCultureLevel(FIXID.JIBINGCBUILD)>0}}),HelpGuider.PackageDlgChecker=HelpGuider.BaseChecker.extern(function(){this.check=function(a){var b=null,c=null,d=this._getPaths(),e=this._getRes();if(!this._isUseItemState(d,a))return;var f=UIM.getDlg("package").getCtrl("tab"),g=f.getActiveTab();if(g!=0&&g!=1)b=f.getTabBtn(1).getDom(),c={spiritSelectType:0,spiritCon:rstr.newcomerHelp.tip.selCurPage,spiritArrawDir:1,spiritTargetW:80,spiritTargetH:34,spiritTargetOffX:0,spiritTargetOffY:-10,spiritTargetShow:0};else{var h=UIM.getDlg("package").getIdxByTabIdxAndItemResId(g,FIXID.PAICHENGKA);if(h>=0){var i=f.getTabItems(g).list;b=i.getItem(h).exsubs.icon,c={spiritSelectType:0,spiritCon:rstr.newcomerHelp.tip.useItem,spiritArrawDir:2,spiritTargetW:73,spiritTargetH:65,spiritTargetOffX:0,spiritTargetOffY:0,spiritTargetShow:0},HelpGuider.isUsePaiChengKa=!0}}if(!b)return;HelpGuider.SpiritUtil.startSpirit(a.parent,b,c)},this._isUseItemState=function(a,b){return a[0]=="pkg"&&a[1]=="useitem"}}),HelpGuider.InBuildFirstfreeblockChecker=HelpGuider.BaseChecker.extern(function(){this.check=function(a,b){var c=UIM.getPanel("inbuild").getBlocksByResId(HelpGuider.SameResIdSpec.snew(FIXID.HOUSEBUILD)).length>0,d=UIM.getPanel("inbuild").getBlocksByResId(HelpGuider.SameResIdSpec.snew(FIXID.STOREINBUILD)).length>0,e=HelpGuider.AndSpec.snew(HelpGuider.SameResIdSpec.snew(FIXID.HOUSEBUILD),HelpGuider.GreatLevelSpec.snew(0)),f=UIM.getPanel("inbuild").getBlocksByResId(e).length>0,g=UIM.getPanel("inbuild").getBlocksByResId(HelpGuider.SameResIdSpec.snew(FIXID.COLLEGEBUILD)).length>0,h=UIM.getPanel("inbuild").getBlocksByResId(HelpGuider.SameResIdSpec.snew(FIXID.TAVERNBUILD)).length>0,i=UIM.getPanel("inbuild").getBlocksByResId(HelpGuider.SameResIdSpec.snew(FIXID.BARBACK)).length>0,j=null;b[2]=="minju"&&!c?j=UIM.getPanel("inbuild").getFirstFreeBlock().getDom():b[2]=="cangku"&&!c?(j=UIM.getPanel("inbuild").getFirstFreeBlock().getDom(),a=ItemResUtil.findTaskRes(FIXID.NEWER_TASK_BUILD_MINJU)):b[2]=="cangku"&&!d&&f?j=UIM.getPanel("inbuild").getFirstFreeBlock().getDom():b[2]=="shuyuan"&&!g?j=UIM.getPanel("inbuild").getFirstFreeBlock().getDom():b[2]=="jiuguan"&&!h?j=UIM.getPanel("inbuild").getFirstFreeBlock().getDom():b[2]=="junying"&&!i&&(j=UIM.getPanel("inbuild").getFirstFreeBlock().getDom());if(!j){HelpGuider.hideAllSpirits();return}this._centerViewToTarget(j,a),HelpGuider.SpiritUtil.startSpirit(TQ.getDomParent(j),j,a)}}),HelpGuider.SameResIdSpec=Class.extern(function(){this.init=function(a){this.resid_=a},this.isSatisfiedBy=function(a){return a.resid==this.resid_}}),HelpGuider.SameLevelSpec=Class.extern(function(){this.init=function(a){this.level_=a},this.isSatisfiedBy=function(a){return a.level==this.level_}}),HelpGuider.GreatLevelSpec=Class.extern(function(){this.init=function(a){this.level_=a},this.isSatisfiedBy=function(a){return a.level>this.level_}}),HelpGuider.SameStateSpec=Class.extern(function(){this.init=function(a){this.state_=a},this.isSatisfiedBy=function(a){return a.state==this.state_}}),HelpGuider.AndSpec=Class.extern(function(){this.init=function(){this.specs_=[];for(var a=0;a<arguments.length;++a)this.specs_.push(arguments[a])},this.isSatisfiedBy=function(a){for(var b=0;b<this.specs_.length;++b)if(!this.specs_[b].isSatisfiedBy(a))return!1;return!0}}),HelpGuider.InBuildUpbuildChecker=HelpGuider.BaseChecker.extern(function(){this.check=function(a,b){var c={target:null,tres:a};if(b[2]=="guanfu"){var d=HelpGuider.AndSpec.snew(HelpGuider.SameResIdSpec.snew(FIXID.GOV_BUILD),HelpGuider.SameLevelSpec.snew(1),HelpGuider.SameStateSpec.snew(0)),e=UIM.getPanel("inbuild").getBlocksByResId(d),f=e.length>0;f&&(c.target=e[0].getDom(),HelpGuider.buildOpMenu.itemId="UPGRADE",HelpGuider.buildOpMenu.buildId=FIXID.GOV_BUILD,HelpGuider.buildOpMenu.buildState=0)}else if(b[2]=="guanfu2")c=this._upBuildOrSpeedBuilding(a,FIXID.GOV_BUILD,2);else if(b[2]=="minju"){var d=HelpGuider.SameResIdSpec.snew(FIXID.HOUSEBUILD),g=UIM.getPanel("inbuild").getBlocksByResId(d).length>0;g?c=this._upBuildOrSpeedBuilding(a,FIXID.HOUSEBUILD,1):(c.target=UIM.getPanel("inbuild").getFirstFreeBlock().getDom(),c.tres=ItemResUtil.findTaskRes(FIXID.NEWER_TASK_BUILD_MINJU))}else b[2]=="shuyuan"&&(c=this._upBuildOrSpeedBuilding(a,FIXID.COLLEGEBUILD,1));if(!c.target){HelpGuider.hideAllSpirits();return}this._centerViewToTarget(c.target,c.tres),HelpGuider.SpiritUtil.startSpirit(TQ.getDomParent(c.target),c.target,c.tres)},this._upBuildOrSpeedBuilding=function(a,b,c){var d={target:null,tres:a},e=HelpGuider.AndSpec.snew(HelpGuider.SameResIdSpec.snew(b),HelpGuider.GreatLevelSpec.snew(c-1),HelpGuider.SameStateSpec.snew(BUILD_STATE.UPGRADE)),f=UIM.getPanel("inbuild").getBlocksByResId(e),g=null;f.length>0&&(g=f[0]);var e=HelpGuider.AndSpec.snew(HelpGuider.SameResIdSpec.snew(b),HelpGuider.SameLevelSpec.snew(c),HelpGuider.SameStateSpec.snew(0)),f=UIM.getPanel("inbuild").getBlocksByResId(e),h=null;f.length>0&&(h=f[0]);if(g){d.target=g.getDom();var i={};TQ.dictCopy(i,a),i.spiritCon=ItemResUtil.findTaskRes(FIXID.NEWER_TASK_SPEED_BUILD).spiritCon,d.tres=i,HelpGuider.buildOpMenu.itemId="SPEED",HelpGuider.buildOpMenu.buildId=b,HelpGuider.buildOpMenu.buildState=BUILD_STATE.UPGRADE}else h&&(d.target=h.getDom(),HelpGuider.buildOpMenu.itemId="UPGRADE",HelpGuider.buildOpMenu.buildId=b,HelpGuider.buildOpMenu.buildState=BUILD_STATE.COMM);return d}}),HelpGuider.InBuildSpeedBuildChecker=HelpGuider.BaseChecker.extern(function(){this.check=function(a,b){var c=null,d=HelpGuider.AndSpec.snew(HelpGuider.GreatLevelSpec.snew(0),HelpGuider.SameStateSpec.snew(BUILD_STATE.UPGRADE)),e=UIM.getPanel("inbuild").getBlocksByResId(d);e.length>0&&(c=e[0]);if(!c){HelpGuider.hideAllSpirits();return}var f=c.getDom(),g=c.getItem().resid,h=ItemResUtil.findItemres(g),i={};TQ.dictCopy(i,a),i.spiritArrawDir=h.spiritArrawDir,i.spiritTargetW=h.spiritTargetW,i.spiritTargetH=h.spiritTargetH,i.spiritTargetOffX=h.spiritTargetOffX,i.spiritTargetOffY=h.spiritTargetOffY,HelpGuider.SpiritUtil.startSpirit(TQ.getDomParent(f),f,i),HelpGuider.buildOpMenu.itemId="SPEED",HelpGuider.buildOpMenu.buildId=g,HelpGuider.buildOpMenu.buildState=BUILD_STATE.UPGRADE,this._centerViewToTarget(f,i)}}),HelpGuider.InBuildRecruitHeroChecker=HelpGuider.BaseChecker.extern(function(){this.check=function(a,b){var c={};TQ.dictCopy(c,a);var d=null,e=HelpGuider.AndSpec.snew(HelpGuider.GreatLevelSpec.snew(0),HelpGuider.SameResIdSpec.snew(FIXID.TAVERNBUILD)),f=UIM.getPanel("inbuild").getBlocksByResId(e);if(f.length>0)d=f[0],HelpGuider.buildOpMenu.itemId="RECRUITHERO",HelpGuider.buildOpMenu.buildId=FIXID.TAVERNBUILD,HelpGuider.buildOpMenu.buildState=-1;else{var g=UIM.getPanel("inbuild").getBlocksByResId(HelpGuider.SameResIdSpec.snew(FIXID.TAVERNBUILD)).length>0;g||(d=UIM.getPanel("inbuild").getFirstFreeBlock(),c=ItemResUtil.findTaskRes(FIXID.NEWER_TASK_BUILD_JIUGUAN))}if(!d){HelpGuider.hideAllSpirits();return}var h=d.getDom();HelpGuider.SpiritUtil.startSpirit(TQ.getDomParent(h),h,c),this._centerViewToTarget(h,c)}}),HelpGuider.InBuildRefreshHeroChecker=HelpGuider.BaseChecker.extern(function(){this.check=function(a,b){var c={};TQ.dictCopy(c,a);var d=null,e=HelpGuider.AndSpec.snew(HelpGuider.GreatLevelSpec.snew(-1),HelpGuider.SameResIdSpec.snew(FIXID.TAVERNBUILD)),f=UIM.getPanel("inbuild").getBlocksByResId(e);f.length>0?(d=f[0],HelpGuider.buildOpMenu.itemId="RECRUITHERO",HelpGuider.buildOpMenu.buildId=FIXID.TAVERNBUILD,HelpGuider.buildOpMenu.buildState=-1):(d=UIM.getPanel("inbuild").getFirstFreeBlock(),c={spiritSelectType:1,spiritCon:rstr.newcomerHelp.tip.buildJiuGuan,spiritArrawDir:3,spiritTargetW:113,spiritTargetH:64,spiritTargetOffX:0,spiritTargetOffY:0,spiritTargetShow:1});if(!d){HelpGuider.hideAllSpirits();return}var g=d.getDom();HelpGuider.SpiritUtil.startSpirit(TQ.getDomParent(g),g,c),this._centerViewToTarget(g,c)}}),HelpGuider.InBuildLearnCultureChecker=HelpGuider.BaseChecker.extern(function(){this.check=function(a,b){var c={};TQ.dictCopy(c,a);var d=null,e=HelpGuider.AndSpec.snew(HelpGuider.GreatLevelSpec.snew(-1),HelpGuider.SameResIdSpec.snew(FIXID.COLLEGEBUILD)),f=UIM.getPanel("inbuild").getBlocksByResId(e),g=this.g_.getImgr().getCultureLevel(FIXID.FOODCBUILD);if(f.length>0&&this.g_.getImgr().getLearningCulture().id!=FIXID.FOODCBUILD&&g==0)d=f[0],HelpGuider.buildOpMenu.itemId="CULTURE",HelpGuider.buildOpMenu.buildId=FIXID.COLLEGEBUILD,HelpGuider.buildOpMenu.buildState=-1;else if(f.length==0)d=UIM.getPanel("inbuild").getFirstFreeBlock(),c=ItemResUtil.findTaskRes(FIXID.NEWER_TASK_BUILD_SHUYUAN);else if(UIM.getDlg("culture").isShow())return;if(!d){HelpGuider.hideAllSpirits();return}var h=d.getDom();HelpGuider.SpiritUtil.startSpirit(TQ.getDomParent(h),h,c),this._centerViewToTarget(h,c)}}),HelpGuider.FarmGetAllResChecker=HelpGuider.BaseChecker.extern(function(){this.check=function(a,b){var c={};TQ.dictCopy(c,a);var d=null,e=null,f=UIM.getPanel("main").getSelCityTool().getBtn("myfarm");f.isPress()?(d=UIM.getPanel("farm").getView().getCtrl("opall").getDom(),e=TQ.getUiBody(),c={spiritSelectType:0,spiritCon:rstr.newcomerHelp.tip.getAllFarmRes,spiritArrawDir:3,spiritTargetW:70,spiritTargetH:0,spiritTargetOffX:0,spiritTargetOffY:0,spiritTargetShow:0}):(d=f.getDom(),e=UIM.getPanel("main").getItems().rootmap);if(!d){HelpGuider.hideAllSpirits();return}HelpGuider.SpiritUtil.startSpirit(e,d,c)}}),HelpGuider.FarmSeedChecker=HelpGuider.BaseChecker.extern(function(){this.check=function(a,b){var c={};TQ.dictCopy(c,a);var d=null,e=null,f=UIM.getPanel("farm").getModel().getOpState(),g=UIM.getPanel("main").getSelCityTool().getBtn("myfarm");if(!g.isPress())d=g.getDom(),e=UIM.getPanel("main").getItems().rootmap;else if(this._hasEmptyBlock()){if(UIM.getDlg("selpip").isShow()&&f!=FARMOP_STATE.INPUT){UIM.getDlg("selpip").refreshNewComerSpirit();return}if(f!=FARMOP_STATE.INPUT&&f!=FARMOP_STATE.SEL)d=UIM.getPanel("farm").getView().getCtrl("opinput").getDom(),e=TQ.getUiBody(),c={spiritSelectType:0,spiritCon:rstr.newcomerHelp.tip.selPipBlock,spiritArrawDir:3,spiritTargetW:70,spiritTargetH:66,spiritTargetOffX:0,spiritTargetOffY:15,spiritTargetShow:0};else if(f==FARMOP_STATE.INPUT){var h=this._getEmptyBlock();d=h.getDom(),e=TQ.getDomParent(d),c={spiritSelectType:0,spiritCon:rstr.newcomerHelp.tip.seedFarmBlock,spiritArrawDir:3,spiritTargetW:120,spiritTargetH:66,spiritTargetOffX:0,spiritTargetOffY:25,spiritTargetShow:0}}else{var h=this._getEmptyBlock();d=h.getDom(),e=TQ.getDomParent(d),c={spiritSelectType:0,spiritCon:rstr.newcomerHelp.tip.seedFarmBlock,spiritArrawDir:3,spiritTargetW:120,spiritTargetH:66,spiritTargetOffX:0,spiritTargetOffY:25,spiritTargetShow:0}}}else if(f!=FARMOP_STATE.INIT)d=UIM.getPanel("farm").getView().getCtrl("opinit").getDom(),e=TQ.getUiBody(),c={spiritSelectType:0,spiritCon:rstr.newcomerHelp.tip.selInitFarmBlock,spiritArrawDir:3,spiritTargetW:70,spiritTargetH:66,spiritTargetOffX:0,spiritTargetOffY:15,spiritTargetShow:0};else{var h=this._getFirstBlock();d=h.getDom(),e=TQ.getDomParent(d),c={spiritSelectType:0,spiritCon:rstr.newcomerHelp.tip.initFarmBlock,spiritArrawDir:3,spiritTargetW:120,spiritTargetH:66,spiritTargetOffX:0,spiritTargetOffY:15,spiritTargetShow:0}}if(!d){HelpGuider.hideAllSpirits();return}HelpGuider.SpiritUtil.startSpirit(e,d,c)},this._hasEmptyBlock=function(){return this._getEmptyBlock()!=null},this._getEmptyBlock=function(){return UIM.getPanel("farm").getView().getEmptyBlock()},this._getFirstBlock=function(){return UIM.getPanel("farm").getView().getFirstBlock()}}),HelpGuider.InBuildPeiBingChecker=HelpGuider.BaseChecker.extern(function(){this.check=function(a,b){var c={};TQ.dictCopy(c,a);var d=null,e=null,f=UIM.getPanel("main").getSelCityTool().getBtn("mycity");f.isPress()?(d=UIM.getPanel("main").getToolbar().getBtn("exped").getDom(),e=TQ.getUiBody()):(d=f.getDom(),e=UIM.getPanel("main").getItems().rootmap,c={spiritSelectType:0,spiritCon:rstr.newcomerHelp.tip.enterMainCity,spiritArrawDir:1,spiritTargetW:70,spiritTargetH:40,spiritTargetOffX:7,spiritTargetOffY:0,spiritTargetShow:0});if(!d){HelpGuider.hideAllSpirits();return}HelpGuider.SpiritUtil.startSpirit(e,d,c)}}),HelpGuider.InbuildFightChecker=HelpGuider.BaseChecker.extern(function(){this.check=function(a,b,c){var d={};TQ.dictCopy(d,a);var e=null,f=null,g=UIM.getPanel("main").getSelCityTool().getBtn("mycity");g.isPress()?this._hasGotoArmy(c)?HelpGuider.opbitmaps_.openedMiliraryDlg||(e=UIM.getPanel("main").getToolbar().getBtn("military").getDom(),f=TQ.getUiBody(),d={spiritSelectType:0,spiritCon:rstr.newcomerHelp.tip.seeMilitary,spiritArrawDir:3,spiritTargetW:70,spiritTargetH:40,spiritTargetOffX:7,spiritTargetOffY:0,spiritTargetShow:0}):(e=UIM.getPanel("main").getToolbar().getBtn("exped").getDom(),f=TQ.getUiBody()):(e=g.getDom(),f=UIM.getPanel("main").getItems().rootmap,d={spiritSelectType:0,spiritCon:rstr.newcomerHelp.tip.enterMainCityExped,spiritArrawDir:1,spiritTargetW:70,spiritTargetH:40,spiritTargetOffX:7,spiritTargetOffY:0,spiritTargetShow:0});if(!e){HelpGuider.hideAllSpirits();return}HelpGuider.SpiritUtil.startSpirit(f,e,d)}}),HelpGuider.InbuildFirstFightChecker=Class.extern(function(){this.init=function(a){this._checker=HelpGuider.InbuildFightChecker.snew(a)},this.check=function(a,b){this._checker.check(a,b,0)}}),HelpGuider.InbuildSecFightChecker=Class.extern(function(){this.init=function(a){this._checker=HelpGuider.InbuildFightChecker.snew(a)},this.check=function(a,b){this._checker.check(a,b,1)}}),HelpGuider.InbuildActTowerFightChecker=HelpGuider.BaseChecker.extern(function(){this.check=function(a,b){if(a.from=="rolelevel"){var c=HDRM.getHdr("clientcfg").getHelpTipTimes(HelpGuider.HELP_TIP.ACTTOWER_FIGHT);if(c>0){HelpGuider.hideAllSpirits();return}HelpGuider.curHelpTipId_=HelpGuider.HELP_TIP.ACTTOWER_FIGHT}var d={};TQ.dictCopy(d,a);var e=null,f=null,g=UIM.getPanel("main").getSelCityTool().getBtn("statecity");g.isPress()?(e=UIM.getPanel("statecity").getActTowerDom(),f=TQ.getDomParent(e)):(e=g.getDom(),f=UIM.getPanel("main").getItems().rootmap,d={spiritSelectType:0,spiritCon:rstr.newcomerHelp.tip.acttowerfight,spiritArrawDir:1,spiritTargetW:70,spiritTargetH:40,spiritTargetOffX:7,spiritTargetOffY:0,spiritTargetShow:0});if(!e){HelpGuider.hideAllSpirits();return}HelpGuider.SpiritUtil.startSpirit(f,e,d)}}),HelpGuider.InbuildRecruitSoldierChecker=HelpGuider.BaseChecker.extern(function(){this.check=function(a,b){var c={};TQ.dictCopy(c,a);var d=null,e=null,f=UIM.getPanel("main").getSelCityTool().getBtn("mycity");if(!f.isPress())d=f.getDom(),e=UIM.getPanel("main").getItems().rootmap,c={spiritSelectType:0,spiritCon:rstr.newcomerHelp.tip.enterMainCity2,spiritArrawDir:1,spiritTargetW:70,spiritTargetH:40,spiritTargetOffX:7,spiritTargetOffY:0,spiritTargetShow:0};else if(!this._hasJiBingCulture()){if(UIM.getDlg("culture").isShow())return;var g=HelpGuider.AndSpec.snew(HelpGuider.GreatLevelSpec.snew(0),HelpGuider.SameResIdSpec.snew(FIXID.COLLEGEBUILD)),h=UIM.getPanel("inbuild").getBlocksByResId(g);h.length>0&&(d=h[0].getDom(),e=TQ.getDomParent(d),c={spiritSelectType:0,spiritCon:rstr.newcomerHelp.tip.clickLearnCulture,spiritArrawDir:3,spiritTargetW:50,spiritTargetH:65,spiritTargetOffX:70,spiritTargetOffY:0,spiritTargetShow:0},HelpGuider.buildOpMenu.itemId="CULTURE",HelpGuider.buildOpMenu.buildId=FIXID.COLLEGEBUILD,HelpGuider.buildOpMenu.buildState=-1,this._centerViewToTarget(d,c))}else{var g=HelpGuider.AndSpec.snew(HelpGuider.SameResIdSpec.snew(FIXID.BARBACK),HelpGuider.GreatLevelSpec.snew(0)),h=UIM.getPanel("inbuild").getBlocksByResId(g),i=h.length>0;i&&(d=h[0].getDom(),e=TQ.getDomParent(d),HelpGuider.buildOpMenu.itemId="SOLDIER",HelpGuider.buildOpMenu.buildId=FIXID.BARBACK,HelpGuider.buildOpMenu.buildState=-1,this._centerViewToTarget(d,c))}if(!d){HelpGuider.hideAllSpirits();return}HelpGuider.SpiritUtil.startSpirit(e,d,c)},this._hasJiBingCulture=function(){return this.g_.getImgr().getCultureLevel(FIXID.JIBINGCBUILD)>0}}),HelpGuider.PkgUseItemChecker=HelpGuider.BaseChecker.extern(function(){this.check=function(a,b){var c={};TQ.dictCopy(c,a);var d=null,e=null,f=UIM.getPanel("main").getSelCityTool().getBtn("myfarm");f.isPress()||(d=UIM.getPanel("main").getToolbar().getBtn("pkg").getDom(),e=TQ.getUiBody(),c={spiritSelectType:0,spiritCon:rstr.newcomerHelp.tip.enterPkg,spiritArrawDir:3,spiritTargetW:70,spiritTargetH:40,spiritTargetOffX:0,spiritTargetOffY:10,spiritTargetShow:0});if(!d){HelpGuider.hideAllSpirits();return}HelpGuider.SpiritUtil.startSpirit(e,d,c)},this._hasJiBingCulture=function(){return this.g_.getImgr().getCultureLevel(FIXID.JIBINGCBUILD)>0}}),HelpGuider.startFirstFightDemo=function(a){var b=a,c=TQ.getUiBody(),d={spiritSelectType:99,spiritArrawDir:0,spiritCon:rstr.newcomerHelp.tip.seeFightDemo,spiritTargetOffX:20,spiritTargetOffY:10};HelpGuider.SpiritUtil.startSpirit(c,b,d)},HelpGuider.firstChangeCountry=function(a){var b=HDRM.getHdr("clientcfg").getHelpTipTimes(HelpGuider.HELP_TIP.CHANGE_CITY);if(b>0)return;var c=a,d=TQ.getUiBody(),e={spiritSelectType:99,spiritArrawDir:0,spiritCon:rstr.newcomerHelp.tip.changeCity,spiritTargetOffX:-30,spiritTargetOffY:10};HelpGuider.SpiritUtil.startSpirit(d,c,e),HelpGuider.curHelpTipId_=HelpGuider.HELP_TIP.CHANGE_CITY},HelpGuider.firstAssignRolePP=function(a,b){var c=HDRM.getHdr("clientcfg").getHelpTipTimes(HelpGuider.HELP_TIP.ASSIGN_ROLEPP);if(c>=3)return;if(b==0)return;var d=a,e=TQ.getUiBody(),f={spiritSelectType:99,spiritArrawDir:0,spiritCon:rstr.newcomerHelp.tip.changeCity,spiritTargetOffX:-30,spiritTargetOffY:10};HelpGuider.SpiritUtil.startSpirit(e,d,f),HelpGuider.curHelpTipId_=HelpGuider.HELP_TIP.ASSIGN_ROLEPP},HelpGuider.firstFightOutField=function(){var a=HDRM.getHdr("clientcfg").getHelpTipTimes(HelpGuider.HELP_TIP.FIGHT_OUTFIELD);if(a>3)return;var b=UIM.getPanel("main").getSelCityTool().getBtn("outfield");if(b.isPress())return;var c=b.getDom(),d=UIM.getPanel("main").getItems().rootmap,e={spiritSelectType:99,spiritArrawDir:1,spiritCon:rstr.newcomerHelp.tip.fightoutfield,spiritTargetOffX:-159,spiritTargetOffY:132};HelpGuider.SpiritUtil.startSpirit(d,c,e),HelpGuider.curHelpTipId_=HelpGuider.HELP_TIP.FIGHT_OUTFIELD},HelpGuider.firstClickShopBtn=function(a){var b=rstr.newcomerHelp.tip.firstOpenShop;HelpGuider._firstClickRightSmallBtn(a,HelpGuider.HELP_TIP.OPEN_SHOPDLG,"shop",b,-203,110)},HelpGuider.firstClickRankBtn=function(a){var b=rstr.newcomerHelp.tip.firstOpenRank;HelpGuider._firstClickRightSmallBtn(a,HelpGuider.HELP_TIP.OPEN_RANKDLG,"rank",b,-203,110)},HelpGuider.firstClickLetterBtn=function(a){var b=rstr.newcomerHelp.tip.firstOpenLetter;HelpGuider._firstClickRightSmallBtn(a,HelpGuider.HELP_TIP.OPEN_LETTERDLG,"letter",b,-203,110)},HelpGuider.firstClickExchangeBtn=function(a){var b=rstr.newcomerHelp.tip.firstOpenExchange;HelpGuider._firstClickRightSmallBtn(a,HelpGuider.HELP_TIP.OPEN_EXCHANGEDLG,"exchange",b,-203,110)},HelpGuider._firstClickRightSmallBtn=function(a,b,c,d,e,f){if(!a.getImgr().isNewcomerHelpEnd())return;var g=HDRM.getHdr("clientcfg").getHelpTipTimes(b);if(g>2)return;if(UIM.getDlg(c).isShow())return;var h=UIM.getPanel("main").getSmallMapBtnBar().getBtn(c),i=h.getDom(),j=UIM.getPanel("main").getItems().rootmap,k={spiritSelectType:99,spiritArrawDir:1,spiritCon:d,spiritTargetOffX:e,spiritTargetOffY:f};HelpGuider.SpiritUtil.startSpirit(j,i,k),HelpGuider.curHelpTipId_=b},HelpGuider.firstClickVipBtn=function(a){if(!a.getImgr().isNewcomerHelpEnd())return;var b=HDRM.getHdr("clientcfg").getHelpTipTimes(HelpGuider.HELP_TIP.OPEN_VIPDLG);if(b>2)return;var c=rstr.newcomerHelp.tip.firstOpenVip,d=UIM.getPanel("main").getItems().vipBtn,e=d.getDom(),f=UIM.getPanel("main").getItems().rootmap,g={spiritSelectType:99,spiritArrawDir:2,spiritCon:c,spiritTargetOffX:-63,spiritTargetOffY:128};HelpGuider.SpiritUtil.startSpirit(f,e,g),HelpGuider.curHelpTipId_=HelpGuider.HELP_TIP.OPEN_VIPDLG},HelpGuider.firstClickPayBtn=function(){if(!g.getImgr().isNewcomerHelpEnd())return;var a=HDRM.getHdr("clientcfg").getHelpTipTimes(HelpGuider.HELP_TIP.OPEN_PAYDLG);if(a>2)return;var b=rstr.newcomerHelp.tip.firstOpenPay,c=UIM.getPanel("main").getItems().rechargebtn,d=c.getDom(),e=UIM.getPanel("main").getItems().rootmap,f={spiritSelectType:99,spiritArrawDir:2,spiritCon:b,spiritTargetOffX:-63,spiritTargetOffY:116};HelpGuider.SpiritUtil.startSpirit(e,d,f),HelpGuider.curHelpTipId_=HelpGuider.HELP_TIP.OPEN_PAYDLG},HelpGuider.firstClickMyFieldBtn=function(){if(!g.getImgr().isNewcomerHelpEnd())return;var a=HDRM.getHdr("clientcfg").getHelpTipTimes(HelpGuider.HELP_TIP.OPEN_MYFIELD);if(a>2)return;var b=rstr.newcomerHelp.tip.firstOpenMyField,c=UIM.getPanel("main").getItems().myfieldsBtn,d=c.getDom(),e=UIM.getPanel("main").getItems().rootmap,f={spiritSelectType:99,spiritArrawDir:2,spiritCon:b,spiritTargetOffX:-63,spiritTargetOffY:121};HelpGuider.SpiritUtil.startSpirit(e,d,f),HelpGuider.curHelpTipId_=HelpGuider.HELP_TIP.OPEN_MYFIELD},HelpGuider.hideTipDlg=function(){HelpGuider.spiritTip_&&HelpGuider.spiritTip_.hideDlg()},HelpGuider.hideTipDlgById=function(a){a==HelpGuider.curHelpTipId_&&HelpGuider.hideTipDlg()},HelpGuider.sendHelpTip=function(a,b){b==HelpGuider.curHelpTipId_&&(ClientCfgSender.sendSetHelpTip(a,b),HelpGuider.hideTipDlgById(b),HelpGuider.curHelpTipId_=0)},HelpGuider.NewcomerSpirit=Class.extern(function(){this.init=function(a){this.g_=a,this.dlgs_=[],this.dlgCheckers_={},this.chechers_={},this.dlgCheckers_.buildopmenu=HelpGuider.BuildOpMenuChecker.snew(a),this.dlgCheckers_.mainselbuild=HelpGuider.SelBuildDlgChecker.snew(a),this.dlgCheckers_.uselistitem=HelpGuider.UseListItemDlgChecker.snew(a),this.dlgCheckers_.recruithero=HelpGuider.RecruitHeroDlgChecker.snew(a),this.dlgCheckers_.culture=HelpGuider.CultureDlgChecker.snew(a),this.dlgCheckers_.expedition=HelpGuider.ExpeditionDlgChecker.snew(a),this.dlgCheckers_.assignsoldiers=HelpGuider.AssignSoldiersDlgChecker.snew(a),this.dlgCheckers_.selpip=HelpGuider.SelPipDlgChecker.snew(a),this.dlgCheckers_.selectexpedtarget=HelpGuider.SelectExpedTargetDlgChecker.snew(a),this.dlgCheckers_.assignheros=HelpGuider.AssignHerosDlgChecker.snew(a),this.dlgCheckers_.military=HelpGuider.MilitaryDlgChecker.snew(a),this.dlgCheckers_.soldier=HelpGuider.SoldierDlgChecker.snew(a),this.dlgCheckers_["package"]=HelpGuider.PackageDlgChecker.snew(a),this.chechers_["inbuild.firstfreeblock"]=HelpGuider.InBuildFirstfreeblockChecker.snew(a),this.chechers_["inbuild.upbuild"]=HelpGuider.InBuildUpbuildChecker.snew(a),this.chechers_["inbuild.speedbuild"]=HelpGuider.InBuildSpeedBuildChecker.snew(a),this.chechers_["inbuild.recruithero"]=HelpGuider.InBuildRecruitHeroChecker.snew(a),this.chechers_["inbuild.refreshhero"]=HelpGuider.InBuildRefreshHeroChecker.snew(a),this.chechers_["inbuild.learnculture"]=HelpGuider.InBuildLearnCultureChecker.snew(a),this.chechers_["farm.getallres"]=HelpGuider.FarmGetAllResChecker.snew(a),this.chechers_["inbuild.peibing"]=HelpGuider.InBuildPeiBingChecker.snew(a),this.chechers_["inbuild.peibing2"]=HelpGuider.InBuildPeiBingChecker.snew(a),this.chechers_["farm.seed"]=HelpGuider.FarmSeedChecker.snew(a),this.chechers_["inbuild.firstfight"]=HelpGuider.InbuildFirstFightChecker.snew(a),this.chechers_["inbuild.secfight"]=HelpGuider.InbuildSecFightChecker.snew(a),this.chechers_["inbuild.firstActTowerFight"]=HelpGuider.InbuildActTowerFightChecker.snew(a),this.chechers_["inbuild.recruitsoldier"]=HelpGuider.InbuildRecruitSoldierChecker.snew(a),this.chechers_["pkg.useitem"]=HelpGuider.PkgUseItemChecker.snew(a),this.preCheckers_=[],this.preCheckers_.push(HelpGuider.GetTaskAwardsChecker.snew(a)),this.preCheckers_.push(HelpGuider.GetCityUpgradeChecker.snew(a)),this.preCheckers_.push(HelpGuider.SubCityOpenChecker.snew(a)),this.g_.regUpdater(this,this._onUpdate,100),this.refreshStacks_=[]},this.refreshCurNewcomerTask=function(){this.refreshStacks_.length==0?this.refreshStacks_.push({type:"refresh"}):this.refreshStacks_[this.refreshStacks_.length-1].type!="refresh"&&this.refreshStacks_.push({type:"refresh"})},this._updateNewcomerTask=function(a){for(var b=0;b<this.preCheckers_.length;++b){var c=this.preCheckers_[b];if(c.check())return}if(!a||!a.spiritCon||a.spiritCon==""){HelpGuider.hideSpirit(),HelpGuider.hideSpiritRhombus();return}var d=a.spiritTarget.split("."),e=this.chechers_[d[0]];e||(e=this.chechers_[d[0]+"."+d[1]]),e&&e.check(a,d)},this.onDlgOpen=function(a,b){this.refreshStacks_.push({type:"dlgOpen",dlgName:a,items:b})},this.onDlgClose=function(a){this.refreshStacks_.push({type:"dlgClose",dlgName:a})},this._refreshDlg=function(a,b,c){this.dlgCheckers_[b].check(c,a)},this._findDlgIdx=function(a){return TQ.find(this.dlgs_,"name",a),TQ.getLastFindIdx()},this._onUpdate=function(){if(this.refreshStacks_.length==0)return;var a=this.refreshStacks_[0];if(a.type=="refresh")this._updateNewcomerTask(HelpGuider.SpiritUtil.getCurRes(this.g_));else if(a.type=="dlgOpen"){var b=this._findDlgIdx(a.dlgName);b>=0&&this.dlgs_.splice(b,1),this.dlgs_.push({name:a.dlgName,items:a.items});var c=this.dlgs_[this.dlgs_.length-1];this._refreshDlg(a.type,c.name,c.items)}else if(a.type=="dlgClose"){var b=this._findDlgIdx(a.dlgName);b>=0&&this.dlgs_.splice(b,1);if(b==this.dlgs_.length&&this.dlgs_.length>0){var c=this.dlgs_[this.dlgs_.length-1];this._refreshDlg(a.type,c.name,c.items)}this.dlgs_.length==0&&HelpGuider.getNewcomerSpirit().refreshCurNewcomerTask()}this.refreshStacks_.splice(0,1)}}),HelpGuider.enterGame=function(a){UIM.getPanel("sysmsg").append(0,rstr.newcomerHelp.tip.welcome),(TQ.isIE6()||TQ.isIE7()||TQ.isIE8())&&UIM.getPanel("sysmsg").append(0,rstr.newcomerHelp.tip.changeBrowser),HelpGuider._g=a,a.regUpdater(HelpGuider,HelpGuider._onUpdateCommonHelpTip,3e4)},HelpGuider._onUpdateCommonHelpTip=function(){var a=["firstClickShopBtn","firstClickRankBtn","firstClickLetterBtn","firstClickExchangeBtn","firstClickVipBtn","firstClickPayBtn","firstClickMyFieldBtn"],b=[];for(var c=0;c<a.length;++c)b.push(c);for(var c=0;c<b.length;++c){var d=Math.randomInt(b.length);if(d!=c){var e=b[c];b[c]=b[d],b[d]=e}}for(var c=0;c<b.length;++c)HelpGuider[a[b[c]]](this._g)}