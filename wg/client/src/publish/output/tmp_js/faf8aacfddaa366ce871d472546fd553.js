ReinforcementDlg=Class.extern(function(){var a=null,b=null,c=null,d={};this.init=function(c){b=c,a=this,b.regEvent(EVT.SELFALLI_DETAIL,0,a,l),b.regEvent(EVT.PERSONAL_ARMY_UPDATE,0,a,m)},this.openDlg=function(){e(),h(),i()};var e=function(){if(c)return;f(),g()},f=function(){c=Dialog.snew(b,{modal:!1,title:rstr.alli.reinforcementdlg.title,pos:{x:"center",y:40}}),b.getGUI().initDlg(c,uicfg.alli.reinforcementdlg,d)},g=function(){d.enterAllianceBtn.setCaller({self:a,caller:j})},h=function(){c.show()},i=function(){AllianceSender.sendGetMyAllianceDetail(b),n()},j=function(){UIM.getDlg("allimain").openDlg(),UIM.getPanel("main").getToolbar().stopAllianceBlinking()},k=function(c){var d=s()[c].id;b.getGUI().msgBox(rstr.comm.msgts,rstr.military.opdlg.lbl.confirmRepatriate,MB_F_YESNO,{self:a,caller:function(a){a==MB_IDYES&&MilitarySender.sendRepatriateArmy(b,d)}})},l=function(){n()},m=function(){n()},n=function(){if(!c||!c.isShow())return;o(),p()},o=function(){var a=b.getImgr().getMyAlliance();TQ.setTextEx(d.name,a.getName()),TQ.setTextEx(d.level,a.getLevel()),TQ.setTextEx(d.leader,a.getLeader()),TQ.setTextEx(d.flag,a.getAlliFlag()),TQ.setTextEx(d.rank,a.getRank()),TQ.setTextEx(d.number,s().length+"/5")},p=function(){q(),r()},q=function(){var a=s();d.list.setItemCount(a.length);for(var b=0;b<d.list.getCount();++b){var c=d.list.getItem(b),e=a[b];TQ.setTextEx(c.exsubs.roleName,e.sourceRole),TQ.setTextEx(c.exsubs.fightCap,t(e.heros))}},r=function(){for(var b=0;b<d.list.getCount();++b){var c=d.list.getItem(b);c.exsubs.repatriateBtn.setId(b),c.exsubs.repatriateBtn.setCaller({self:a,caller:k})}},s=function(){var a=[];for(var c=0;c<b.getImgr().getArmys().list.length;++c){var d=b.getImgr().getArmys().list[c];d.armyType==ARMY_TYPE.ALLI&&a.push(d)}return a},t=function(a){var c=0;for(var d=0;d<a.length;++d){var e=a[d];if(e.id==0)continue;c+=b.getImgr().getHeroAttrVal(e,ATTR.FC)}return c}})