res_cltskills=[{id:150001,phases:{attack:{id:0},fly:{id:0,speed:4294967295},hurt:{id:0}}},{id:150002,phases:{attack:{id:0},fly:{id:0,speed:4294967295},hurt:{id:0}}},{id:150003,phases:{attack:{id:0},fly:{id:1001,speed:.5},hurt:{id:0}}},{id:150004,phases:{attack:{id:0},fly:{id:0,speed:4294967295},hurt:{id:0}}},{id:150005,phases:{attack:{id:0},fly:{id:1002,speed:.5},hurt:{id:0}}},{id:150101,phases:{attack:{id:0},fly:{id:0,speed:4294967295},hurt:{id:0}}},{id:150102,phases:{attack:{id:0},fly:{id:0,speed:4294967295},hurt:{id:0}}},{id:150201,phases:{attack:{id:0},fly:{id:0,speed:4294967295},hurt:{id:0}}},{id:150300,phases:{attack:{id:0},fly:{id:0,speed:4294967295},hurt:{id:0}}},{id:150301,phases:{attack:{id:0},fly:{id:0,speed:4294967295},hurt:{id:1003}}},{id:150302,phases:{attack:{id:0},fly:{id:0,speed:4294967295},hurt:{id:1004}}},{id:150303,phases:{attack:{id:0},fly:{id:0,speed:4294967295},hurt:{id:1005}}},{id:150304,phases:{attack:{id:0},fly:{id:0,speed:4294967295},hurt:{id:1006}}},{id:150305,phases:{attack:{id:0},fly:{id:0,speed:4294967295},hurt:{id:1007}}}],NullSkillPhase=Class.extern(function(){var a=!1;this.start=function(){},this.update=function(){},this.isTriggerTime=function(){return!a},this.setTriggered=function(){a=!0},this.isEnd=function(){return!0}}),SkillAttackPhase=Class.extern(function(){var a=null;this.init=function(b,c,d,e){a=b.getAnimMgr().allocEffect(d,e.getDirection(),c)},this.start=function(){a.play()},this.update=function(){},this.isTriggerTime=function(){return a.isTriggerTime()},this.setTriggered=function(){a.setTriggered()},this.isEnd=function(){return a.isEnd()}}),SkillFlyPhase=Class.extern(function(){var a=null,b=null,c=null,d=null,e=null,f=!1,g=!1,h=!1;this.init=function(f,g,h,i,j,k){a=f,c=g,b=h;var l=[];l.push({x:j.getPosition().x,y:j.getPosition().y}),l.push({x:k.getPosition().x,y:k.getPosition().y}),e=MoveRoute.snew(f,i,l),d=NullPngAnim.snew(0)},this.start=function(){f=!0},this.update=function(){if(!i())return;e.update(),j(e.getDirection()),d.setPosition(e.getPosition()),e.isEnd()&&(d.stop(),h=!0)},this.isTriggerTime=function(){return h&&!g},this.setTriggered=function(){g=!0},this.isEnd=function(){return h&&g};var i=function(){return f&&!e.isEnd()},j=function(e){if(d.getId()==a.getAnimMgr().makeAvatarAnimId(b,e,0))return;d.stop(),d=a.getAnimMgr().allocEffect(b,e,c),d.play()}}),SkillHurtPhase=Class.extern(function(){var a=null,b=null,c=null,d=null,e=!1,f=!1;this.init=function(e,f,g,h,i){a=e,b=h,c=i,d=a.getAnimMgr().allocEffect(g,i.getDirection(),f)},this.start=function(){d.play(),d.setPosition(c.getPosition()),e=!0},this.update=function(){d.isTriggerTime()&&(d.setTriggered(),c.setState(StateFactory.createByType(null,c,"hurtstate",b)))},this.isTriggerTime=function(){return e&&!f&&d.isEnd()},this.setTriggered=function(){f=!0},this.isEnd=function(){return d.isEnd()}}),SkillPhaseFactory=Class.extern(function(){var a=null;this.initOneTime=function(b){a=b},this.createAttackPhase=function(c,d,e){var f=b(d,e);return f?SkillAttackPhase.snew(a,c,f.phases.attack.id,e):NullSkillPhase.snew()},this.createFlyPhase=function(c,d,e,f){var g=b(d,e);return g?SkillFlyPhase.snew(a,c,g.phases.fly.id,g.phases.fly.speed,e,f):NullSkillPhase.snew()},this.createHurtPhase=function(c,d,e,f){var g=b(d,e);return g?SkillHurtPhase.snew(a,c,g.phases.hurt.id,d,f):NullSkillPhase.snew()};var b=function(a,b){if(a.event!="attack"&&a.event!="miss"&&a.event!="berserk")return null;var c=b.getResId();return TQ.qfind(res_cltskills,"id",c)}}).snew(),ActorSkill=Class.extern(function(){var a=[];this.init=function(b,c,d,e){a.push(SkillPhaseFactory.createAttackPhase(b,c,d)),a.push(SkillPhaseFactory.createFlyPhase(b,c,d,e)),a.push(SkillPhaseFactory.createHurtPhase(b,c,d,e)),a.push(NullSkillPhase.snew())},this.start=function(){a[0].start()},this.update=function(){for(var c=0;c<a.length-1;++c)b(a[c],a[c+1])},this.isEnd=function(){for(var b=0;b<a.length;++b)if(!a[b].isEnd())return!1;return!0};var b=function(a,b){a.update(),a.isTriggerTime()&&(a.setTriggered(),b.start())}}),SkillManager=Class.extern(function(){var a=null,b=null,c=[];this.initOneTime=function(c){a=c,b=this},this.addSkill=function(e,f,g,h){var i=ActorSkill.snew(e,f,g,h);return i.start(),c.push(i),a.regUpdater(b,d,10),i};var d=function(){if(c.length==0){a.unregUpdater(b,d);return}for(i=c.length-1;i>=0;--i){c[i].update();if(c[i].isEnd()){c.splice(i,1);continue}}}}).snew()