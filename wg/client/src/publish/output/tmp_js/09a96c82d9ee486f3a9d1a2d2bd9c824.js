var FRAME_BORDER=2;WindowResizer=Class.extern(function(){var a=2048,b=900,c=1536,d=500;this.g=null,this.lastSize={cx:0,cy:0},this.curSize={cx:0,cy:0},this.regPanelSizers=[],this.hasActivePanelFlag=!1,this.updateTimes=0,this.init=function(a){this.g=a,this.g.regUpdater(this,this.onUpdate,1e3)},this.regPanelSizer=function(){this.regPanelSizers.push(GlobalBodySizer.snew(this.g,this)),this.regPanelSizers.push(MainPanelMapSizer.snew(this.g,this)),this.regPanelSizers.push(FarmPanelSizer.snew(this.g,this)),this.regPanelSizers.push(MapPanelSizer.snew(this.g,this)),this.regPanelSizers.push(InbuildPanelSizer.snew(this.g,this)),this.regPanelSizers.push(ChatPanelSizer.snew(this.g,this)),this.regPanelSizers.push(BriefresPanelSizer.snew(this.g,this)),this.regPanelSizers.push(QueueMsgBarSizer.snew(this.g,this)),this.regPanelSizers.push(NewcomerHelperSizer.snew(this.g,this)),this.regPanelSizers.push(SmallMapSizer.snew(this.g,this)),this.regPanelSizers.push(ScutbarSizer.snew(this.g,this)),this.regPanelSizers.push(FarmMainToolBarSizer.snew(this.g,this)),this.regPanelSizers.push(FarmSecToolBarSizer.snew(this.g,this)),this.regPanelSizers.push(FriendDlgSizer.snew(this.g,this)),this.regPanelSizers.push(OutFieldPanelSizer.snew(this.g,this)),this.regPanelSizers.push(this.g.getGUI().getSysMsgTipBox()),this.regPanelSizers.push(this.g.getGUI().getSysMsgTipBox2()),this.regPanelSizers.push(UIM.getDlg("createrole")),this.regPanelSizers.push(UIM.getDlg("fightmap")),this.regPanelSizers.push(UIM.getDlg("imghelp")),this.regPanelSizers.push(GameSuggestBtnSizer.snew(this.g,this)),this.regPanelSizers.push(LeftPanelSizer.snew(this.g,this))},this.onUpdate=function(){this.resize()},this.resize=function(){if(!this.hasMainPanel())return;this.updateCurSize(),this.updateTimes++;if(!this.isSizeChange()&&this.updateTimes>10)return;this.resizeAndPositionAllPanels(),this.updateLastSize()},this.getMaxClientSize=function(){return{cx:a,cy:c}},this.getValidClientSize=function(){var e=TQ.getWinInnerSize(),f={cx:0,cy:0};f.cx=Math.clamp(e.cx-FRAME_BORDER,b,a),f.cy=Math.clamp(e.cy-FRAME_BORDER,d,c);var g=this._adjustClientSizeCX(e,f),h=this._adjustClientSizeCY(e,f);return g||this._adjustClientSizeCX(e,f),h||this._adjustClientSizeCY(e,f),f},this._adjustClientSizeCX=function(c,d){if(TQ.isIE6()||TQ.isIE7())return!1;var e=d.cy>c.cy;return e?(c.cx-=TQ.getBrowserScollBarW(),d.cx=Math.clamp(c.cx-FRAME_BORDER,b,a),!0):!1},this._adjustClientSizeCY=function(a,b){var e=b.cx>a.cx;return e?(a.cy-=TQ.getBrowserScollBarH(),b.cy=Math.clamp(a.cy-FRAME_BORDER,d,c),!0):!1},this.hasMainPanel=function(){return UIM.getPanel("main")?!0:!1},this.updateCurSize=function(){var a=this.getValidClientSize();this.curSize.cx=a.cx,this.curSize.cy=a.cy},this.isSizeChange=function(){return this.curSize.cx!=this.lastSize.cx||this.curSize.cy!=this.lastSize.cy},this.resizeAndPositionAllPanels=function(){for(var a=0;a<this.regPanelSizers.length;++a){var b=this.regPanelSizers[a];b.resize&&b.resize(this.curSize),b.reposition&&b.reposition(this.curSize)}},this.updateLastSize=function(){if(!this.hasActivePanel())return;var a=this.getValidClientSize();this.lastSize.cx=this.curSize.cx,this.lastSize.cy=this.curSize.cy},this.panelActive=function(){this.hasActivePanelFlag=!0},this.hasActivePanel=function(){return this.hasActivePanelFlag},this.getCurSize=function(){return{cx:this.curSize.cx,cy:this.curSize.cy}}}),PanelSizer=Class.extern(function(){this.init=function(a,b){this.g=a,this.sizerMgr=b},this.resize=function(a){},this.reposition=function(a){},this.resizeInnerMapPanel=function(a,b){var c=a.getItems();TQ.setDomSize(c.gamemap,b.cx,b.cy),TQ.setDomSize(c.mousemap,b.cx,b.cy),a.resize(b),a.isActive()&&a.resetViewPos(),a.isActive()&&this.isMainBuildPanel(a)&&this.sizerMgr.panelActive()},this.isMainBuildPanel=function(a){return a==UIM.getPanel("inbuild")}}),GlobalBodySizer=PanelSizer.extern(function(){this.resize=function(a){var b=TQ.getUiBody(),c=TQ.getWinInnerSize(),d=c.cx-FRAME_BORDER,e=a.cy>c.cy;e&&(d-=TQ.getBrowserScollBarW()),TQ.setDomSize(b,a.cx,a.cy),d>a.cx?TQ.setDomPos(b,(d-a.cx)/2,0):TQ.setDomPos(b,0,0)}}),MainPanelMapSizer=PanelSizer.extern(function(){this.resize=function(a){var b=UIM.getPanel("main").getItems();TQ.setDomSize(b.rootmap,a.cx,a.cy),TQ.setDomSize(b.map,a.cx,a.cy)}}),FarmPanelSizer=PanelSizer.extern(function(){this.resize=function(a){this.resizeInnerMapPanel(UIM.getPanel("farm").getView(),a)}}),MapPanelSizer=PanelSizer.extern(function(){this.resize=function(a){this.resizeInnerMapPanel(UIM.getPanel("statecity"),a)}}),InbuildPanelSizer=PanelSizer.extern(function(){this.resize=function(a){this._resizeMainBuildPanel(a),this._resizeSubBuildPanels(a)},this._resizeMainBuildPanel=function(a){this.resizeInnerMapPanel(UIM.getPanel("inbuild"),a)},this._resizeSubBuildPanels=function(a){var b=UIM.getPanel("main").getSubCityPanels().getIterator();for(;b.hasMoreNodes();){var c=b.nextNode();this.resizeInnerMapPanel(c,a)}}}),ChatPanelSizer=PanelSizer.extern(function(){this.reposition=function(a){var b=UIM.getPanel("chat");b.setPosition(0,a.cy-b.getSize().cy)}}),BriefresPanelSizer=PanelSizer.extern(function(){var a=10,b=656,c=75;this.reposition=function(a){var b=UIM.getPanel("main").getItems(),c=this.getBriefBarPos(a);TQ.isMobile()?TQ.setDomPos(b.briefres,c.x-5,c.y):TQ.setDomPos(b.briefres,c.x,c.y)},this.getBriefBarPos=function(a){return{x:this._getBriefBarX(a),y:a.cy-c}},this._getBriefBarX=function(c){var d=(c.cx-b)/2,e=d<this._getChatPanelWidth()+a;return e?this._getChatPanelWidth()+a:d},this._getChatPanelWidth=function(){var a=UIM.getPanel("chat");return a.getSize().cx}}),QueueMsgBarSizer=PanelSizer.extern(function(){var a=350,b=30,c=25;this.init=function(a,b){this.g=a,this.sizerMgr=b,this.briefSizer=BriefresPanelSizer.snew()},this.reposition=function(d){var e=this.briefSizer.getBriefBarPos(d),f=UIM.getPanel("main").getQueueMsgBar();f.setPosition({x:e.x,y:e.y-b-c}),f.setSize({cx:a,cy:b})}}),NewcomerHelperSizer=PanelSizer.extern(function(){var a=410,b=30,c=25;this.init=function(a,b){this.g=a,this.sizerMgr=b,this.briefSizer=BriefresPanelSizer.snew()},this.reposition=function(d){TQ.isMobile()&&(a=390,b=45);var e=this.briefSizer.getBriefBarPos(d);UIM.getDlg("newcomerhelper").setPosition({x:e.x+a,y:e.y-b-c})}}),SmallMapSizer=PanelSizer.extern(function(){this.reposition=function(a){this.respositionSmallmap(a),this.respositionBtns(a),this.respositionFieldToolBar(a)},this.respositionSmallmap=function(a){var b=UIM.getPanel("smallmap").getMapSize();TQ.setCSS(UIM.getPanel("main").getItems().smallmap,"left",a.cx-b.cx+"px")},this.respositionBtns=function(a){var b=UIM.getPanel("main").getItems();if(TQ.isMobile()){var c=a.cx-60-5,d=a.cy-248-100;TQ.setDomPos(b.rightToolBar,c,d)}else{var e=UIM.getPanel("smallmap").getMapSize(),c=a.cx-e.cx-UIM.getPanel("main").getSmallMapBtnBar().getBtnSize().cx;TQ.setCSS(b.smbtn_shop.getParent(),"left",c+"px"),TQ.setCSS(b.smbtn_rank.getParent(),"left",c+"px"),TQ.setCSS(b.smbtn_letter.getParent(),"left",c+"px"),TQ.setCSS(b.smbtn_exchange.getParent(),"left",c+"px"),TQ.setCSS(b.smbtn_toggle_bgsound.getParent(),"left",c+"px")}},this.respositionFieldToolBar=function(a){var b=UIM.getPanel("smallmap").getMapSize(),c=a.cx-b.cx,d={x:c,y:b.cy};if(TQ.isMobile()){var e=UIM.getPanel("main").getItems().gotoToolBar;TQ.setDomPos(e,d.x,d.y)}else{var f=UIM.getPanel("main").getItems().outFieldToolBar;TQ.setDomPos(f,d.x,d.y)}}}),ScutbarSizer=PanelSizer.extern(function(){this.reposition=function(a){if(TQ.isMobile()){var b=210,c=60,d=UIM.getPanel("main").getItems(),e=a.cx-b;TQ.setCSS(d.scutbar,"left",e+"px");var f=e+c-UIM.getDlg("buildingtrace").getSize().cx,g=165;UIM.getDlg("buildingtrace").setPosition({x:f,y:g})}else{var b=404,c=115,d=UIM.getPanel("main").getItems(),e=a.cx-b;TQ.setCSS(d.scutbar,"left",e+"px");var f=e+c-UIM.getDlg("buildingtrace").getSize().cx+39+36,g=49;UIM.getDlg("buildingtrace").setPosition({x:f,y:g})}}}),FarmMainToolBarSizer=PanelSizer.extern(function(){var a=10;this.reposition=function(a){var b=UIM.getPanel("farm").getView();b.setMainToolBarPos(this.getMainToolBarPos(a))},this.getMainToolBarPos=function(a){var b=UIM.getPanel("farm").getView();return{x:this._getMainToolBarX(a),y:a.cy-b.getMainToolBarSize().cy}},this._getMainToolBarX=function(b){var c=UIM.getPanel("farm").getView(),d=(b.cx-c.getMainToolBarSize().cx)/2,e=d<this._getChatPanelWidth()+a;return e?this._getChatPanelWidth()+a:d},this._getChatPanelWidth=function(){var a=UIM.getPanel("chat");return a.getSize().cx}}),FarmSecToolBarSizer=PanelSizer.extern(function(){var a=10;this.init=function(a,b){this.g=a,this.sizerMgr=b,this.mainToolBarSizer=FarmMainToolBarSizer.snew()},this.reposition=function(b){var c=UIM.getPanel("farm").getView(),d=this.mainToolBarSizer.getMainToolBarPos(b);c.setSecToolBarPos({x:d.x+c.getMainToolBarSize().cx+a,y:b.cy-c.getSecToolBarSize().cy})}}),FriendDlgSizer=PanelSizer.extern(function(){this.reposition=function(a){UIM.getDlg("friend").resetPos()}}),OutFieldPanelSizer=PanelSizer.extern(function(){this.resize=function(a){this.resizeInnerMapPanel(UIM.getPanel("field"),a)}}),GameSuggestBtnSizer=PanelSizer.extern(function(){this.init=function(a,b){this.g=a,this.sizerMgr=b,this.briefSizer=BriefresPanelSizer.snew()},this.reposition=function(a){var b=UIM.getPanel("main");if(!b)return;var c=b.getItems();if(!c)return;var d=this.briefSizer.getBriefBarPos(a),e=c.gameSuggestBtn.getParent(),f=130;TQ.isMobile()&&(f=145),TQ.setDomPos(e,d.x+410+45,a.cy-f)}}),LeftPanelSizer=PanelSizer.extern(function(){this.init=function(a,b){this.g=a},this.reposition=function(a){if(!TQ.isMobile())return;var b=UIM.getPanel("main");if(!b)return;var c=b.getItems();if(!c)return;var d=265,e=103,f=80,g=70,h=c.collapseTaskGuideBtn.getParent(),i=c.expandTaskGuideBtn.getParent(),j=a.cy-g-5-f-5-e;TQ.setDomPos(c.taskGuide,0,j),TQ.setDomPos(h,d,j),TQ.setDomPos(i,0,j);var k=c.collapseSysMsgBtn.getParent(),l=c.expandSysMsgBtn.getParent(),j=a.cy-g-5-f;TQ.setDomPos(c.sysmsg,0,j),TQ.setDomPos(k,d,j),TQ.setDomPos(l,0,j)}})