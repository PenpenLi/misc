ActorEffect=Class.extern(function(){var a=0,b=0,c={x:0,y:0},d=0,e={x:0,y:0};this.setId=function(b){a=b},this.getId=function(){return a},this.setOffsetZIndex=function(a){b=a},this.setOffsetPos=function(a){TQ.dictCopy(c,a)},this.setZIndex=function(a){d=a,this.update(this._getFactZIndex(),this._getFactPos())},this.setPosition=function(a){TQ.dictCopy(e,a),this.update(this._getFactZIndex(),this._getFactPos())},this.update=function(a,b){},this._getFactZIndex=function(){return b+d},this._getFactPos=function(){return{x:e.x+c.x,y:e.y+c.y}},this.getAddHP=function(){return 0},this.getSubHP=function(){return 0},this.destory=function(){}}),ActorValueEffect=ActorEffect.extern(function(){var a=null,b=null,c=null,d=0,e=0,f=!1;this.init=function(c,d){a=c,b=c.getEntityfactory().allocNumEffect(d),b.setSize({cx:100,cy:30}),b.getEntity().setClass("actorValueEffect_front"),b.getBakEntity().setClass("actorValueEffect_back")},this.setValue=function(a){c=a,b.setNumber(a)},this.setColor=function(a){TQ.setCSS(b.getEntity().getDomObj(),"color",a)},this.setFontSize=function(a,c){TQ.setCSS(b.getEntity().getDomObj(),"fontSize",a+"px"),TQ.setCSS(b.getBakEntity().getDomObj(),"fontSize",a+"px"),c&&(TQ.setCSS(b.getEntity().getDomObj(),"fontWeight","bold"),TQ.setCSS(b.getBakEntity().getDomObj(),"fontWeight","bold"))},this.setSubHP=function(a){d=a},this.getSubHP=function(){return d},this.setAddHP=function(a){e=a},this.getAddHP=function(a){return e},this.play=function(){if(f)return;b.start(),EUPD.appendEffect(b,a.getEntityfactory().freeNumEffect),f=!0},this.update=function(a,c){b.setZOrder(a),b.setPos(c)}}),ActorAnimEffect=ActorEffect.extern(function(){var a=0,b=null,c=!1;this.init=function(c,d,e){a=e,b=c.getAnimMgr().alloc(a,d)},this.play=function(){if(c)return;b.play(),c=!0},this.update=function(a,c){b.setZIndex(a),b.setPosition(c)},this.destory=function(){b.stop()}}),EffectManager=Class.extern(function(){var a=1e4,b=1e8,c=null,d=null,e={};this.init=function(){e[RES_EFF.F_CLT_SUBHP]=[{type:"value",subhp:!0,zIndex:2e4,pos:{x:0,y:-60},color:"#ff0000",fontSize:12}],e[RES_EFF.F_CLT_BERSERK_SUBHP]=[{type:"value",subhp:!0,zIndex:20001,pos:{x:0,y:-60},color:"#ff0000",fontSize:20,isBold:!0}],e[RES_EFF.F_CLT_MISS]=[{type:"value",zIndex:20002,pos:{x:0,y:-60},color:"#ffff00",fontSize:12}],e[RES_EFF.F_CUIDU3]=[{type:"value",subhp:!0,zIndex:5,pos:{x:0,y:-50},color:"#00ff00",fontSize:12}],e[RES_EFF.F_SHENYI]=[{type:"anim",animId:10001,zIndex:6,pos:{x:0,y:-20}},{type:"value",addhp:!0,zIndex:7,pos:{x:0,y:-50},color:"#0030ff",fontSize:12}],e[RES_EFF.F_BISHA]=[{type:"anim",animId:10002,zIndex:9,pos:{x:0,y:-20}},{type:"value",subhp:!0,zIndex:10,pos:{x:0,y:-50},color:"#ff0000",fontSize:20,isBold:!0}],e[RES_EFF.F_HUOGONG]=[{type:"anim",animId:10003,zIndex:11,pos:{x:0,y:-20}},{type:"value",subhp:!0,zIndex:12,pos:{x:0,y:-50},color:"#ff0000",fontSize:16,isBold:!0}],e[RES_EFF.F_CHENGSHANG]=[{type:"anim",animId:10004,zIndex:13,pos:{x:0,y:-20}}],e[RES_EFF.F_XIXUE]=[{type:"anim",animId:10005,zIndex:15,pos:{x:0,y:-20}},{type:"value",addhp:!0,zIndex:16,pos:{x:0,y:-50},color:"#0030ff",fontSize:12}],e[RES_EFF.F_JIPO]=[{type:"anim",animId:10011,zIndex:17,pos:{x:0,y:-20}},{type:"value",subhp:!0,zIndex:18,pos:{x:0,y:-50},color:"#ff0000",fontSize:20,isBold:!0}],e[RES_EFF.F_ADD_HU]=[{type:"value",subhp:!0,zIndex:19,pos:{x:0,y:-50},color:"#ff0000",fontSize:12}],e[RES_EFF.F_ADD_FULLATTRS+a]=[{type:"anim",animId:10006,zIndex:-100,pos:{x:0,y:1}}],e[RES_EFF.F_XINGYUN+a]=[{type:"anim",animId:10007,zIndex:-101,pos:{x:0,y:1}}],e[RES_EFF.F_CUIDU3+a]=[{type:"anim",animId:10008,zIndex:-102,pos:{x:0,y:1}}],e[RES_EFF.F_XUERUO+a]=[{type:"anim",animId:10009,zIndex:-106,pos:{x:0,y:1}}],e[RES_EFF.F_CLT_SUBHP+b]=[{type:"value",subhp:!0,zIndex:1,pos:{x:0,y:-60},color:"#ff0000",fontSize:16}],e[RES_EFF.F_CLT_BERSERK_SUBHP+b]=[{type:"value",subhp:!0,zIndex:2,pos:{x:0,y:-60},color:"#ff0000",fontSize:26,isBold:!0}],e[RES_EFF.F_CLT_MISS+b]=[{type:"value",zIndex:3,pos:{x:0,y:-60},color:"#ffff00",fontSize:16}],e[RES_EFF.F_CUIDU3+b]=[{type:"value",subhp:!0,zIndex:5,pos:{x:0,y:-50},color:"#00ff00",fontSize:16}],e[RES_EFF.F_SHENYI+b]=[{type:"anim",animId:20001,zIndex:6,pos:{x:0,y:-20}},{type:"value",addhp:!0,zIndex:7,pos:{x:0,y:-50},color:"#0030ff",fontSize:16}],e[RES_EFF.F_BISHA+b]=[{type:"anim",animId:20002,zIndex:9,pos:{x:0,y:-20}},{type:"value",subhp:!0,zIndex:10,pos:{x:0,y:-60},color:"#ff0000",fontSize:26,isBold:!0}],e[RES_EFF.F_HUOGONG+b]=[{type:"anim",animId:20003,zIndex:11,pos:{x:0,y:-20}},{type:"value",subhp:!0,zIndex:12,pos:{x:0,y:-50},color:"#ff0000",fontSize:16}],e[RES_EFF.F_CHENGSHANG+b]=[{type:"anim",animId:20004,zIndex:13,pos:{x:0,y:-20}}],e[RES_EFF.F_XIXUE+b]=[{type:"anim",animId:20005,zIndex:15,pos:{x:0,y:-20}},{type:"value",addhp:!0,zIndex:16,pos:{x:0,y:-50},color:"#0030ff",fontSize:16}],e[RES_EFF.F_JIPO+b]=[{type:"anim",animId:20011,zIndex:17,pos:{x:0,y:-20}},{type:"value",subhp:!0,zIndex:18,pos:{x:0,y:-50},color:"#ff0000",fontSize:26,isBold:!0}],e[RES_EFF.F_ADD_HU+b]=[{type:"value",subhp:!0,zIndex:19,pos:{x:0,y:-60},color:"#ff0000",fontSize:16}],e[RES_EFF.F_ADD_FULLATTRS+a+b]=[{type:"anim",animId:20006,zIndex:-100,pos:{x:0,y:1}}],e[RES_EFF.F_XINGYUN+a+b]=[{type:"anim",animId:20007,zIndex:-101,pos:{x:0,y:1}}],e[RES_EFF.F_CUIDU3+a+b]=[{type:"anim",animId:20008,zIndex:-102,pos:{x:0,y:1}}],e[RES_EFF.F_XUERUO+a+b]=[{type:"anim",animId:20009,zIndex:-106,pos:{x:0,y:1}}]},this.initOneTime=function(a){c=a,d=this},this.addMapEffect=function(a,b){if(b.effects)for(var c in b.effects)f(a,b.effects[c]);else f(a,b)},this.createEffects=function(a,b){var c=a.getParent(),d=a.isHero(),e=h(b.event,d,b.effid);if(!e)return[];var f=[];for(var g=0;g<e.length;++g){var j=e[g];if(j.type=="value")f.push(i(c,j,b.val,a.getHP(),a.getMaxHP(),a.getUnitHP()));else if(j.type=="anim"){var k=b.effuid?b.effuid:1e5+b.effid;f.push(l(k,c,j))}}return f};var f=function(a,b){var e=c.getActorMgr().getById(b.userid),f=c.getActorMgr().getById(b.targetid),h=d.createEffects(f,b);for(var i in h){var j=h[i];j.setPosition(f.getPosition()),j.setZIndex(f.getZIndex()),f.addHP(j.getAddHP()),f.subHP(j.getSubHP()),e.isDef()&&e.subHP(g(e,j.getSubHP())),j.play()}},g=function(a,b){var c=a.getResId()-150301+CITYDEF_TYPE.FIRST;return Math.floor(b/res_citydefs_hurt_bytype[c])},h=function(c,d,f){return c=="addeff"&&(f+=a),d&&(f+=b),e[f]},i=function(a,b,d,e,f,g){var h=ActorValueEffect.snew(c,a);h.setValue(j(b.subhp,b.addhp,d,e,f,g)),h.setOffsetZIndex(b.zIndex);var i={x:b.pos.x-50,y:b.pos.y};return h.setOffsetPos(i),h.setColor(b.color),h.setFontSize(b.fontSize,b.isBold),b.subhp?h.setSubHP(d):b.addhp&&h.setAddHP(d),h},j=function(a,b,c,d,e,f){var g=Math.floor(d/f),h=Math.floor(e/f);if(a){var i=Math.ceil(c/f),j=Math.min(i,g);return isNaN(j)&&(j=0,k(a,b,c,d,e,f,g,h,i)),j}if(b){var i=Math.ceil(c/f),j=Math.min(i,h-g);return isNaN(j)&&(j=0,k(a,b,c,d,e,f,g,h,i)),j}return c},k=function(a,b,c,d,e,f,g,h,i){IS_DEBUG==1&&alert("isSubHP:"+a+",isAddHP:"+b+",changeHP:"+c+",curHP:"+d+",maxHP:"+e+",unitHP:"+f+",curSoldierNum:"+g+",maxSoldierNum:"+h+",changeSoldierNum:"+i)},l=function(a,b,d){var e=ActorAnimEffect.snew(c,b,d.animId);return e.setId(a),e.setOffsetZIndex(d.zIndex),e.setOffsetPos(d.pos),e}}).snew()