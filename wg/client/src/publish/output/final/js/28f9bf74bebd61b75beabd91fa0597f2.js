NewcomerHelper=BaseDlg.extern(function(){this.C_MINBTN_RT_=[750,485,32,32],this.C_DLG_W_=437,this.C_DLG_H_=166,this.C_BTN_W_=32,this.C_BTN_H_=32,this.lastPos_={x:0,y:0},this.caches_=[],this.curId_=-1,this.isOpened_=!1,TQ.isMobile()&&(this.C_MINBTN_RT_=[750,485,50,50],this.C_BTN_W_=50,this.C_BTN_H_=50),this.handleCaches=function(){for(var a=0;a<this.caches_.length;++a)this._onSvrPkg(this.caches_[a])},this.getCurId=function(){return this.curId_},this.setPosition=function(a){this._savePosition(a),this._setDlgPosition(),this._setSpiritDomPosition()},this._savePosition=function(a){this.lastPos_=a},this._setDlgPosition=function(){if(!this.isShow())return;var a=this.lastPos_.x+this.C_BTN_W_-this.C_DLG_W_,b=this.lastPos_.y+this.C_BTN_H_-this.C_DLG_H_;this.dlg_.setPosition({x:a,y:b})},this._setSpiritDomPosition=function(){if(!this.items_.spiritDom)return;TQ.setDomPos(this.items_.spiritDom,this.lastPos_.x,this.lastPos_.y)},this._init=function(){this._regEvents(),this._createSpiritMiniBtn()},this._getDlgCfg=function(){return{modal:!1,pos:{x:"center",y:0},uiback:uiback.dlg.noborder,uicfg:uicfg.help.NewcomerHelper}},this._afterCreate=function(){TQ.fixIE6Png(this.items_.bak),TQ.fixIE6Png(this.items_.subbak)},this._setCallers=function(){this.dlg_.setCaller({self:this,caller:this._onDlgEvent}),this.items_.closeBtn.setCaller({self:this,caller:this._onClickClose}),this.items_.seeAllHelp.setCaller({self:this,caller:this._onClickAllHelp})},this._initInfo=function(){this.items_.spiritBtn.hide(),this._setDlgPosition(),this.isOpened_=!0},this._regEvents=function(){this.g_.regEvent(EVT.NET,NETCMD.NEWCOMERHELP,this,this._onSvrPkg),this.g_.regEvent(EVT.LOGIN_OK,0,this,this._onLoginOk)},this._createSpiritMiniBtn=function(){var a=TQ.getUiBody();this.items_.spiritDom=TQ.createDom("div"),TQ.append(a,this.items_.spiritDom),TQ.setCSS(this.items_.spiritDom,"position","absolute"),TQ.setCSS(this.items_.spiritDom,"zIndex","1000"),TQ.setDomRect(this.items_.spiritDom,this.C_MINBTN_RT_[0],this.C_MINBTN_RT_[1],this.C_MINBTN_RT_[2],this.C_MINBTN_RT_[3]);var b=uiback.btn.helpspirit;TQ.isMobile()&&(b=uiback.mb.btn12_helpspirit),this.items_.spiritBtn=new ComButton(this.g_,this.items_.spiritDom,{uiback:b}),this.items_.spiritBtn.setCaller({self:this,caller:this._onClickOpen}),TTIP.addTip(this.items_.spiritDom,rstr.newcomerHelp.tip.spiritBtn)},this._isOpened=function(){return this.isOpened_},this._updateByCurTask=function(a){this.curId_=a;var b=ItemResUtil.findTaskRes(a);if(!b){TQ.setRichText(this.items_.con,""),HelpGuider.getNewcomerSpirit().refreshCurNewcomerTask();return}var c="";if(b.helpimg){var d=TQ.format(rstr.newcomerHelp.imgLink,b.helpimg);c=HyperLinkMgr.formatLink(d)}HelpGuider.getNewcomerSpirit().refreshCurNewcomerTask(),TQ.setRichText(this.items_.con,b.desc+c)},this._updateByRandTip=function(){var a=Math.randomInt(res_tip_helps.length),b="<div class=changetipbtn id=new_comer_helper_tip>"+rstr.newcomerHelp.btn.everydayTip+"</div>";TQ.setRichText(this.items_.con,rstr.newcomerHelp.lbl.everydayTip+res_tip_helps[a].desc+b);var c=TQ.getDomById("new_comer_helper_tip"),d=this;TQ.addEvent(c,"click",function(a){d._updateByRandTip()})},this._onDlgEvent=function(a){a==C_SYS_DLG_HIDE&&this.items_.spiritBtn.show()},this._onClickOpen=function(){this.openDlg()},this._onClickClose=function(){this.hideDlg()},this._onClickAllHelp=function(){UIM.getDlg("help").openDlg()},this._onLoginOk=function(){NewcomerHelpSender.sendGetCurNode(this.g_)},this._onSvrPkg=function(a){if(!a.data.newhelp)return;if(this.g_.getState()!=GSTATE.INGAME){this.caches_.push(a);return}this._isOpened()||(this.openDlg(),this.hideDlg()),this._updateByCurTask(a.data.newhelp.id),a.data.newhelp.id==0&&this._updateByRandTip()}})