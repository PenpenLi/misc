RankDlg=JBaseDlg.ex({_innerInit:function(){this.TAB_ROLE_IDX_=0,this.TAB_ALLI_IDX_=1,this.TAB_ACTTOWER_IDX_=2,this.rolePanel_=null,this.alliPanel_=null,this.actTowerPanel_=null},_getDlgCfg:function(){return{modal:!1,title:rstr.rankingdlg.title,pos:{x:"center",y:40},uicfg:uicfg.rankingdlg}},_afterCreate:function(){this._createRolePanel(),this._createAlliancePanel(),this._createActTowerPanel()},_createRolePanel:function(){var a=this.items_.tablist.getTabItems(this.TAB_ROLE_IDX_);this.rolePanel_=RankRolePanel.snew(this.g_,this,a)},_createAlliancePanel:function(){var a=this.items_.tablist.getTabItems(this.TAB_ALLI_IDX_).con;this.alliPanel_=AlliListDlgTempl.snew(this.g_,this,a,"rank")},_createActTowerPanel:function(){var a=this.items_.tablist.getTabItems(this.TAB_ACTTOWER_IDX_);this.actTowerPanel_=RankActTowerPanel.snew(this.g_,this,a)},_initInfo:function(){this.alliPanel_.openDlg(0),this.items_.tablist.activeTab(0),this.rolePanel_.refreshCurPage(),this.actTowerPanel_.refreshCurPage()}}),RankBasePanel=Class.extern(function(){this.g_=null,this.dlg_=null,this.items_=null,this.pageBar_=null,this.rankroles_=null,this.lastPageNo_=1,this.init=function(a,b,c){this.g_=a,this.dlg_=b,this.items_=c,this._createPageBar(),this._regEvents()},this.refreshCurPage=function(){this._sendGetPageRank(this.lastPageNo_)},this._createPageBar=function(){this.pageBar_=RankPageBar.snew(this.g_,rstr.alli.listdlg.lbl.searchrole,JVALID.getMaxUserLen(),this.items_.pageBarCon,this.items_),this.pageBar_.regObServer(this)},this.onPageBarClickSearch=function(a){if(a=="")return;if(!JVALID.checkUsername(a)){this.g_.getGUI().sysMsgTips(SMT_WARNING,rstr.alli.listdlg.tip.invalidrole);return}this._sendSearchRoleForRank(a)},this.onPageBarClickGetSelf=function(){this._sendSearchRoleForRank(this.g_.getImgr().getRoleName())},this.onPageNavigate=function(a){this.lastPageNo_=a,this._sendGetPageRank(a)},this._onSvrPkg=function(a){if(!this.dlg_.isShow())return;this._updateBySvrPkg(a)},this._updateBySvrPkg=function(a){var b=a.data;if(!b.ranks)return;this.rankroles_=b.ranks,this.pageBar_.setPageBarNoActive(b.pageNo,b.pageCount),this._setListItems(this.rankroles_),this._setListItemBtnsCaller(),this._setCurSelectItem(b.curSelIdx)},this._setListItems=function(a){this.items_.list.setItemCount(a.length);for(var b=0;b<this.items_.list.getCount();++b){var c=this.items_.list.getItem(b),d=a[b];this._setListItem(c,d)}},this._setListItemBtnsCaller=function(){for(var a=0;a<this.items_.list.getCount();++a){var b=this.items_.list.getItem(a);b.exsubs.seebtn.setId(a),b.exsubs.seebtn.setCaller({self:this,caller:this._onClickSeeOp}),b.exsubs.chatbtn.setId(a),b.exsubs.chatbtn.setCaller({self:this,caller:this._onClickChatOp}),b.exsubs.letterbtn.setId(a),b.exsubs.letterbtn.setCaller({self:this,caller:this._onClickLetterOp})}},this._setCurSelectItem=function(a){this.items_.list.setCurSel(a)},this._onClickSeeOp=function(a){var b=this.rankroles_[a],c={gridId:b.gridId,objType:OBJ_TYPE.ROLE,roleId:b.roleId,roleName:b.name,alliance:{uid:-1,name:"--"}};UIM.getDlg("rolecity").openDlg(c)},this._onClickChatOp=function(a){var b=this.rankroles_[a];UIM.getPanel("chat").setChatTarget(b.name)},this._onClickLetterOp=function(a){var b=this.rankroles_[a];UIM.getDlg("writeletter").writeLetterTo(b.name)},this._regEvents=function(){},this._sendSearchRoleForRank=function(a){},this._sendGetPageRank=function(a){},this._setListItem=function(a,b){}}),RankRolePanel=RankBasePanel.extern(function(){this._regEvents=function(){this.g_.regEvent(EVT.NET,NETCMD.ROLEBASE,this,this._onSvrPkg)},this._sendSearchRoleForRank=function(a){RoleSender.sendSearchRoleForRank(this.g_,a)},this._sendGetPageRank=function(a){RoleSender.sendGetPageRankRoles(this.g_,a)},this._setListItem=function(a,b){TQ.setTextEx(a.exsubs.rank,b.rank),TQ.setTextEx(a.exsubs.role,b.name),TQ.setTextEx(a.exsubs.alli,b.alli),TQ.setTextEx(a.exsubs.level,b.level),TQ.setTextEx(a.exsubs.buildVal,b.buildVal)}}),RankActTowerPanel=RankBasePanel.extern(function(){this._regEvents=function(){this.g_.regEvent(EVT.NET,NETCMD.ACT_TOWER,this,this._onSvrPkg)},this._sendSearchRoleForRank=function(a){ActTowerSender.sendSearchRoleForRank(this.g_,a)},this._sendGetPageRank=function(a){ActTowerSender.sendGetPageRankRoles(this.g_,a)},this._setListItem=function(a,b){TQ.setTextEx(a.exsubs.rank,b.rank),TQ.setTextEx(a.exsubs.role,b.name),TQ.setTextEx(a.exsubs.maxLayer,b.maxLayer),TQ.setTextEx(a.exsubs.maxTime,TQ.formatDateTime(b.maxTime))}})