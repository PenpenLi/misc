BaseHeroSteelOpHdr=JClass.ex({_init:function(a,b,c,d){this.g=a,this.heros=b,this.dlg=c,this.items=d,this.efficiencys=[],this._initOneTime()},_initOneTime:function(){},_getNeedExpend:function(){},_getCanGetExpPerQuarter:function(){},_getNeedExpends:function(a){var b=0;for(var c=0;c<this.heros.length;++c)b+=this._getNeedExpend(c,a);return b},_getMaxLevelNeedExp:function(a){var b=0,c=this.g.getImgr().getMaxHeroLevel(a),d=this.g.getImgr().getHeroAttr(a,ATTR.XP).val;for(var e=a.level;e<c;e++){var f=e+1;b+=res_herolevelexps[f-1].needexp-d,d=0}return b},_getHerosSteelQuarters:function(a){var b=[];for(var c=0;c<this.heros.length;++c)b.push(this._getHeroSteelQuarters(c,a));return b},_getHeroSteelQuarters:function(a,b){var c=this.heros[a],d=this._getMaxLevelNeedExp(c),e=Math.ceil(d/this._getCanGetExpPerQuarter(a));return Math.min(b,e)}}),CommHeroSteelOpHdr=BaseHeroSteelOpHdr.ex({getTitle:function(){return rstr.steelherodlg.title},getNeedExpendLbl:function(){return rstr.steelherodlg.lbl.needMoneyLbl},getCanGetExp:function(a,b,c){var d=res_herosteel[b.level-1];return d.commGetExp*this._getHeroSteelQuarters(a,c)},getNeedExpendStr:function(a,b,c){return this._getNeedExpend(a,c)},_getNeedExpend:function(a,b){var c=this.heros[a],d=res_herosteel[c.level-1];return d.expendMoney*this._getHeroSteelQuarters(a,b)},setOpDom:function(a,b,c){TQ.setCSS(c.exsubs.opDom,"display","none")},getMaxSteelHours:function(){return res_comm_herosteel_max_hours},getExpendDesc:function(a){return TQ.format(rstr.steelherodlg.lbl.needMoney,this._getNeedExpends(a))},isEnoughExpend:function(a){return this._getNeedExpends(a)<=this.g.getImgr().getMoney()},getNotEnoughExpendMsg:function(a){return TQ.format(rstr.comm.noEnoughBuyMoney,this._getNeedExpends(a),this.g.getImgr().getMoney(),FIXID.MONEYPKGID)},sendSteelMsg:function(a){var b=this._getHerosSteelQuarters(a);HeroSender.sendHerosSteel(this.g,"steel",this.heros,b,null)},_getCanGetExpPerQuarter:function(a){var b=this.heros[a],c=res_herosteel[b.level-1];return c.commGetExp},getSpeedEffectSteelHeroCount:function(){return 0}}),HighHeroSteelOpHdr=BaseHeroSteelOpHdr.ex({_initOneTime:function(){this.efficiencys=[];for(var a=0;a<this.heros.length;++a)this.heros[a].level<=res_hero_lowsteel_level?this.efficiencys.push({can:!0,cur:!0}):this.efficiencys.push({can:!1,cur:!1})},getTitle:function(){return rstr.steelherodlg.highTitle},getNeedExpendLbl:function(){return rstr.steelherodlg.lbl.needGoldLbl},getCanGetExp:function(a,b,c){return this._getCanGetExp(a,b,c,"highGetExp")},getNeedExpendStr:function(a,b,c){var d=this._getHeroSteelQuarters(a,c),e=this.efficiencys[a],f=Math.ceil(this._getBaseNeedGold()/4*d);if(!e.cur)return f;var g=Math.ceil(this._getSpeedNeedGold()/4*d);return TQ.format(rstr.steelherodlg.lbl.needAddGold,f,g)},setOpDom:function(a,b,c){var d=this.efficiencys[a];TQ.setCSS(c.exsubs.opDom,"display",d.can?"block":"none"),TQ.setTextEx(c.exsubs.addEfficiency,d.cur?TQ.format(rstr.steelherodlg.lbl.addEfficiency,100):"")},getMaxSteelHours:function(){return res_high_herosteel_max_hours},getExpendDesc:function(a){return TQ.format(rstr.steelherodlg.lbl.needGold,this._getNeedExpends(a))},getSteelEfficiencyType:function(a){var b=this.efficiencys[a];return b.cur?"speed":"normal"},setSteelEfficiencyType:function(a,b){var c=this.efficiencys[a];b=="normal"?c.cur=!1:b=="speed"&&(c.cur=!0)},isEnoughExpend:function(a){return this._getNeedExpends(a)<=this.g.getImgr().getGold()},getNotEnoughExpendMsg:function(a){return TQ.format(rstr.comm.noEnoughRechargeGold,this._getNeedExpends(a),this.g.getImgr().getGold())},sendSteelMsg:function(a){var b=this._getHerosSteelQuarters(a);HeroSender.sendHerosSteel(this.g,this.getSteelType(),this.heros,b,this.efficiencys)},getSpeedEffectSteelHeroCount:function(){var a=0;for(var b=0;b<this.efficiencys.length;++b)this.efficiencys[b].cur&&a++;return a},_getNeedExpend:function(a,b){var c=this._getHeroSteelQuarters(a,b),d=this.efficiencys[a],e=this._getBaseNeedGold()/4,f=d.cur?this._getSpeedNeedGold()/4:0;return Math.ceil(c*(e+f))},_getCanGetExpPerQuarter:function(a){var b=this.heros[a],c=res_herosteel[b.level-1],d=c.highGetExp;return this.efficiencys[a].cur&&(d*=2),d},_getCanGetExp:function(a,b,c,d){var e=this.efficiencys[a],f=res_herosteel[b.level-1],g=e.cur?2:1;return f[d]*this._getHeroSteelQuarters(a,c)*g},_getNeedExpendStr:function(a,b,c,d,e){var f=this._getHeroSteelQuarters(a,c),g=this.efficiencys[a],h=Math.ceil(d/4*f);if(!g.cur)return h;var i=Math.ceil(e/4*f);return TQ.format(rstr.steelherodlg.lbl.needAddGold,h,i)},_getBaseNeedGold:function(){return 2},_getSpeedNeedGold:function(){return 3},getSteelType:function(){return"highsteel"}}),Vip1HeroSteelOpHdr=HighHeroSteelOpHdr.ex({getTitle:function(){return rstr.steelherodlg.vip1Title},getCanGetExp:function(a,b,c){return this._getCanGetExp(a,b,c,"high1GetExp")},getSteelType:function(){return"vip1steel"},_getBaseNeedGold:function(){return 5},_getSpeedNeedGold:function(){return 6}}),Vip2HeroSteelOpHdr=HighHeroSteelOpHdr.ex({getTitle:function(){return rstr.steelherodlg.vip2Title},getCanGetExp:function(a,b,c){return this._getCanGetExp(a,b,c,"high2GetExp")},getSteelType:function(){return"vip2steel"},_getBaseNeedGold:function(){return 10},_getSpeedNeedGold:function(){return 12}}),SteelHeroDlg=Class.extern(function(){var a=null,b=null,c=null,d={},e=null,f=null,g=null,h=null;this.init=function(a){i(this,a),j()},this.openDlg=function(a,b){k(a,b),l(),o(),p(),q(),r()},this.hideDlg=function(){c&&c.hide()};var i=function(c,d){b=c,a=d},j=function(){a.regEvent(EVT.HERO_UPDATE,0,b,A)},k=function(a,b){e=a,f=b},l=function(){if(c)return;m(),n()},m=function(){c=Dialog.snew(a,{modal:!1,title:rstr.steelherodlg.title,pos:{x:"center",y:50}}),a.getGUI().initDlg(c,uicfg.hero.steelherodlg,d)},n=function(){d.ihour.setLimit(B),d.ihour.setCaller({self:b,caller:E}),d.steelBtn.setCaller({self:b,caller:F})},o=function(){e=="steel"?g=CommHeroSteelOpHdr.snew(a,f,c,d):e=="highsteel"?g=HighHeroSteelOpHdr.snew(a,f,c,d):e=="vip1steel"?g=Vip1HeroSteelOpHdr.snew(a,f,c,d):e=="vip2steel"&&(g=Vip2HeroSteelOpHdr.snew(a,f,c,d))},p=function(){c.show()},q=function(){c.setTitle(g.getTitle()),TQ.setTextEx(d.needExpendLbl,g.getNeedExpendLbl())},r=function(){d.ihour.setVal(1),s(),t(),u()},s=function(){var b=a.getImgr().getBuildLevelByResId(BUILDCITY_ID.ALL,FIXID.STEEL_BUILD),c=ItemResUtil.findBuildLevelres(FIXID.STEEL_BUILD,b);TQ.setTextEx(d.steelDesc,TQ.format(rstr.steelherodlg.lbl.steelDesc,c.herosteelmaxlevel))},t=function(){var a=g.getSpeedEffectSteelHeroCount();a==0?TQ.setTextEx(d.speedHighSteelDesc,""):TQ.setTextEx(d.speedHighSteelDesc,TQ.format(rstr.steelherodlg.lbl.speedHighSteelDesc,a))},u=function(){if(!v())return;w(),z()},v=function(){return c?c.isShow():!1},w=function(){x(),y()},x=function(){var b=a.getImgr().multHeroSteelBySvrAct(),c=G();d.list.setItemCount(f.length);for(var e=0;e<d.list.getCount();++e){var h=d.list.getItem(e),i=f[e];TQ.setTextEx(h.exsubs.name,i.name),TQ.setTextEx(h.exsubs.level,i.level),TQ.setTextEx(h.exsubs.canGetExp,g.getCanGetExp(e,i,c)*b),TQ.setTextEx(h.exsubs.needExpend,g.getNeedExpendStr(e,i,c)),g.setOpDom(e,i,h)}},y=function(){for(var a=0;a<d.list.getCount();++a){var c=d.list.getItem(a);c.exsubs.changeBtn.setId(a),c.exsubs.changeBtn.setCaller({self:b,caller:C})}},z=function(){var a=G();TQ.setTextEx(d.needDesc,g.getExpendDesc(a))},A=function(){u()},B=function(){return{min:1,max:g.getMaxSteelHours()}},C=function(a){var c=UIM.getDlg("selectsteeltype");c.setCaller({self:b,caller:D}),c.openDlg(a,g.getSteelEfficiencyType(a),g.getSteelType())},D=function(a,b){g.setSteelEfficiencyType(a,b),u()},E=function(a){u()},F=function(){var b=G();if(!g.isEnoughExpend(b)){a.getGUI().msgBox(rstr.comm.msgts,g.getNotEnoughExpendMsg(b),MB_F_CLOSE,null);return}g.sendSteelMsg(b),c.hide()},G=function(){return d.ihour.getVal()*4}})