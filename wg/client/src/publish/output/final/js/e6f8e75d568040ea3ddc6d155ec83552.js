RoleBasePanel=Class.extern(function(){var a=null,b=null,c=null,d={},e=null,f=-1;this.init=function(c,d){a=c,b=this,e=d,g()};var g=function(){h(),a.regEvent(EVT.LOGIN_OK,0,b,m),a.regEvent(EVT.NET,NETCMD.ROLEBASE,b,n),a.regEvent(EVT.ROLEBASE,2,b,o)},h=function(){a.getGUI().initPanel(e,uicfg.rolepanel,d),TQ.addEvent(d.icon,"click",k),TQ.fixIE6Png(d.roleback),TQ.fixIE6Png(d.cityflag),TQ.fixIE6Png(d.level),i()},i=function(){var a=["exp"];for(var c=0;c<a.length;++c){var e=a[c],f=d.tooltips[TIP_PREFIX+e],g=TTIP.getTipById(f);g.setCaller({self:b,caller:l}),g.setData({type:e})}},j=function(){var b=a.getImgr(),c=b.getRoleRes();if(!c.itemres)return;IMG.setBKImage(d.icon,IMG.makeMidImg(c.itemres.bigpic)),TQ.setHtml(d.name,RStrUtil.makeXDiamondRoleName(c.name,c)),TQ.setTextEx(d.level,c.level),TQ.setTextEx(d.alliance,c.alliance.name),d.exp.setRange(b.getRoleAttrVal(ATTR.NXP)),d.exp.setValue(0,b.getRoleAttrVal(ATTR.XP));var e=ItemResUtil.findItemres(c.cityid);IMG.setBKImage(d.cityflag,IMG.makeStateCityFlag(e.flagimg))},k=function(a){UIM.openDlg("role")},l=function(b){var c=null;if(b.type=="exp"){var d=a.getImgr();d.isArrivedMaxRoleLevel()?c=rstr.comm.fulllevel:(c=rstr.comm.attrs.curexp+":"+d.getRoleAttrVal(ATTR.XP)+"<br/>",c+=rstr.comm.attrs.nextexp+":"+d.getRoleAttrVal(ATTR.NXP))}return c},m=function(){var b="{cmd="+NETCMD.ROLEBASE+",subcmd=1}";a.send(null,b)},n=function(b){var c=b.data,d=a.getImgr().getRoleRes();c.res&&(TQ.dictCopy(d,c.res),d.itemres=ItemResUtil.findItemres(d.resid),j(),a.sendEvent({eid:EVT.ROLEBASE,sid:0}),HelpGuider.getNewcomerSpirit().refreshCurNewcomerTask()),c.res&&!isNull(c.res.introduction)&&a.sendEvent({eid:EVT.ROLEBASE,sid:1}),c.res&&c.res.level&&c.res.level>f&&(f!=-1&&a.sendEvent({eid:EVT.ROLEBASE,sid:2}),f=c.res.level),c.res&&c.res.ydInfo&&a.sendEvent({eid:EVT.ROLEBASE,sid:3}),c.res&&c.res.bdInfo&&a.sendEvent({eid:EVT.ROLEBASE,sid:4}),c.res&&c.res.firsthero==0&&FirstRewardHero.snew(a).start()},o=function(){var b={cx:308,cy:70},c=a.getWinSizer().getValidClientSize(),d={parent:TQ.getUiBody(),size:b,imageClass:"role_upgrade_effect",zorder:UI_ZORDER_SCREEN_EFFECT+2,pos:{x:(c.cx-b.cx)/2,y:(c.cy-b.cy)/2}};a.getEntityfactory().playImageEffect(d)}})