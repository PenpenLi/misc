SoldierOpDlg=Class.extern(function(){var a=null,b=null,c=null,d={},e=null,f=null,g=null;this.init=function(c){a=c,b=this},this.getCtrl=function(a){return d[a]},this.openDlg=function(a){e=a,h(),i()},this.closeDlg=function(){c&&c.hide()},this.isShow=function(){return c&&c.isShow()},this.getTitle=function(){return c.getTitle()};var h=function(){c||(c=Dialog.snew(a,{modal:!1,title:rstr.soldieropdlg.title,pos:{x:"center",y:30}}),a.getGUI().initDlg(c,uicfg.soldier.opdlg,d),f=SoldierUpgradeOp.snew(a,c,d),g=SoldierDemobOp.snew(a,c,d),f.setCaller(),g.setCaller()),c.show()},i=function(){j(),f.initInfo(e),g.initInfo(e)},j=function(){c.setTitle(rstr.soldieropdlg.title+" - "+RStrUtil.getSoldierNameByResId(e.id))}}),SoldierUpgradeOp=Class.extern(function(){var a=null,b=null,c=null,d=null,e=null;this.init=function(e,f,g){d=this,a=e,b=f,c=g},this.setCaller=function(){f(),g()},this.initInfo=function(a){e=a,h(),i(),j()};var f=function(){c.iupdnum.setLimit(k),c.iupdnum.setCaller({self:d,caller:l})},g=function(){c.updbtn.setCaller({self:d,caller:m})},h=function(){n()?TQ.setText(c.desc,rstr.soldieropdlg.lbl.arrivemaxlevel):TQ.setText(c.desc,"")},i=function(){n()?c.updbtn.enable(!1):c.updbtn.enable(!0)},j=function(){c.iupdnum.setVal(1)},k=function(){var b=a.getImgr(),c=o(),d=parseInt(b.getMoney()/c.money,10),f=parseInt(b.getCityRes().cres.food/c.food,10),g=a.getImgr().getSoldierNumber(e.id),h=Math.min(d,f,g);return h=Math.max(1,h),{min:1,max:h}},l=function(a){var b=o(),d=TQ.format(rstr.soldieropdlg.lbl.needmoney,b.money*a),e=TQ.format(rstr.soldieropdlg.lbl.needfood,b.food*a);TQ.setText(c.needmoney,d),TQ.setText(c.needfood,e)},m=function(){var b=a.getImgr(),d=o(),f=c.iupdnum.getVal(),g=d.money*f<=b.getMoney(),h=d.food*f<=b.getCityRes().cres.food,i=b.getSoldierNumber(e.id),j=f<=i;if(!g){a.getGUI().sysMsgTips(SMT_WARNING,rstr.soldieropdlg.err.noMoney);return}if(!h){a.getGUI().sysMsgTips(SMT_WARNING,rstr.soldieropdlg.err.noFood);return}if(!j){a.getGUI().sysMsgTips(SMT_WARNING,rstr.soldieropdlg.err.noSoldierForUpgrade);return}SoldierSender.sendUpgrade(a,e.id,f),c.iupdnum.setVal(1)},n=function(){var b=ItemResUtil.splitResidLevel(e.id),c=b.resid-FIXID.FIRSTSOLDIER,d=a.getImgr().getTrainCultureByIdx(c);return b.level>=d.level},o=function(){var a=ItemResUtil.splitResidLevel(e.id),b=a.level+1;return TQ.qfind(res_soldiers_upd,"level",b)}}),SoldierDemobOp=Class.extern(function(){var a=null,b=null,c=null,d=null,e=null;this.init=function(e,f,g){d=this,a=e,b=f,c=g},this.setCaller=function(){f(),g()},this.initInfo=function(a){e=a,h()};var f=function(){c.idemobnum.setLimit(i),c.idemobnum.setCaller({self:d,caller:j})},g=function(){c.demobbtn.setCaller({self:d,caller:k})},h=function(){c.idemobnum.setVal(1)},i=function(){var b=a.getImgr().getSoldierNumber(e.id);return{min:1,max:Math.max(1,b)}},j=function(a){var b=l(),d=TQ.format(rstr.soldieropdlg.lbl.rtmoney,parseInt(b.money*a*res_demob_soldier_retres_per,10)),e=TQ.format(rstr.soldieropdlg.lbl.rtfood,parseInt(b.food*a*res_demob_soldier_retres_per,10));TQ.setText(c.rtmoney,d),TQ.setText(c.rtfood,e)},k=function(){var b=c.idemobnum.getVal(),f=a.getImgr().getSoldierNumber(e.id),g=b<=f;if(!g){a.getGUI().sysMsgTips(SMT_WARNING,rstr.soldieropdlg.err.noSoldierForDemob);return}var h=function(d){d==MB_IDYES&&(SoldierSender.sendDemob(a,e.id,b),c.idemobnum.setVal(1))};a.getGUI().msgBox(rstr.comm.msgts,rstr.soldieropdlg.lbl.confrimdemob,MB_F_YESNO,{self:d,caller:h})},l=function(){var a=ItemResUtil.splitResidLevel(e.id);return TQ.qfind(res_soldiers_upd,"level",a.level)}})