var UserReg=JClass.ex({_init:function(a){this._seq=0,this._params=a,this._doms=this._params.doms,this._ajax=JAjax.snew(this._params.url),this._ajax.setCaller(Caller.snew(this,this._onServerData)),this._validUser=!1,this._validPsw=!1,this._validRepeatPsw=!1,this._validEmail=!0,this._firstInit()},_onServerData:function(msg){var m=eval("("+msg+")");m.isbind==1?this._handleRegBindMsg(m):this._handleCheckUserMsg(m)},_handleRegBindMsg:function(a){a.ret==0?(this._params.dlg.hideDlg(),UIM.getPanel("main").hideGuestBindBtn(),this._params.g.getGUI().msgBox(rstr.comm.msgts,a.msg,MB_F_CLOSE,null)):this._params.g.getGUI().msgBox(rstr.comm.msgts,a.msg,MB_F_CLOSE,null)},_handleCheckUserMsg:function(a){TQ.setRichText(this._doms.regUsernameResult,a.msg),this._validUser=a.ret==0},_firstInit:function(){var a=this;TQ.addEvent(this._doms.regUsername,"blur",function(b){a.checkUserName()}),TQ.addEvent(this._doms.regPassword,"blur",function(b){a.checkRegPassword()}),TQ.addEvent(this._doms.repeatRegPassword,"blur",function(b){a.checkRepeatRegPassword()}),TQ.addEvent(this._doms.regEmail,"blur",function(b){a.checkRegEmail()}),this._doms.regPassword.type="password",this._doms.repeatRegPassword.type="password",this._addUserNameInputEvent(),TQ.setRichText(this._doms.regUsernameResult,rstr.bindGuestDlg.tip.please_input),TQ.setRichText(this._doms.regPasswordResult,rstr.bindGuestDlg.tip.please_input),TQ.setRichText(this._doms.repeatRegPasswordResult,rstr.bindGuestDlg.tip.please_input),this._hideUserNameInValidTip()},checkUserName:function(){var a=this._doms.regUsername.value;this._ajax.asyncSend("act=checkuser&user="+a+"&seq="+this._seq++)},checkRegPassword:function(){var a=this._doms.regPassword.value;a==""?(TQ.setRichText(this._doms.regPasswordResult,rstr.bindGuestDlg.tip.psw_empty),this._validPsw=!1):this._isValidPassword(a)?(TQ.setRichText(this._doms.regPasswordResult,rstr.bindGuestDlg.tip.input_ok),this._validPsw=!0):(TQ.setRichText(this._doms.regPasswordResult,rstr.bindGuestDlg.tip.psw_tooshort),this._validPsw=!1)},checkRepeatRegPassword:function(){var a=this._doms.regPassword.value,b=this._doms.repeatRegPassword.value;b==""?(TQ.setRichText(this._doms.repeatRegPasswordResult,rstr.bindGuestDlg.tip.psw_empty),this._validRepeatPsw=!1):a!=b?(TQ.setRichText(this._doms.repeatRegPasswordResult,rstr.bindGuestDlg.tip.not_same),this._validRepeatPsw=!1):this._isValidPassword(b)?(TQ.setRichText(this._doms.repeatRegPasswordResult,rstr.bindGuestDlg.tip.input_ok),this._validRepeatPsw=!0):(TQ.setRichText(this._doms.repeatRegPasswordResult,rstr.bindGuestDlg.tip.psw_tooshort),this._validRepeatPsw=!1)},checkRegEmail:function(){var a=this._doms.regEmail.value;a==""?(TQ.setRichText(this._doms.regEmailResult,""),this._validEmail=!0):this._isValidEmail(a)?(TQ.setRichText(this._doms.regEmailResult,rstr.bindGuestDlg.tip.input_ok),this._validEmail=!0):(TQ.setRichText(this._doms.regEmailResult,rstr.bindGuestDlg.tip.email_error),this._validEmail=!1)},submit:function(){if(!this._validUser)this._doms.regUsername.focus();else if(!this._validPsw)this._doms.regPassword.focus();else if(!this._validRepeatPsw)this._doms.repeatRegPassword.focus();else if(!this._validEmail)this._doms.regEmail.focus();else{var a=this._doms.regUsername.value,b=this._doms.regPassword.value;this._ajax.asyncSend("act=regbind&user="+a+"&psw="+b+"&guestuser="+this._params.guestuser+"&guestsign="+this._params.guestsign+"&serverid="+this._params.serverid+"&seq="+this._seq++)}},_isValidPassword:function(a){return a==""?!1:a.length>=6},_isValidEmail:function(a){var b=/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,7}$/;return b.test(a)},_addUserNameInputEvent:function(){var a=this,b=this._doms.regUsername;TQ.addEvent(b,"keypress",function(b){b=b?b:window.event;var c=TQ.getKeyCode(b),d=c>=48&&c<=57,e=c>=97&&c<=122||c>=65&&c<=90,f=c==95,g=d||e||f;g?a._hideUserNameInValidTip():(TQ.preventDefault(b),a._showUserNameInValidTip())}),TQ.addEvent(b,"keyup",function(c){b.value.match(/[^\w\.\/]/ig)&&(b.value=b.value.replace(/[^\w\.\/]/ig,""),a._showUserNameInValidTip())})},_showUserNameInValidTip:function(){var a=this._doms.regUsernameValidTip;TQ.setRichText(this._doms.regUsernameValidTipCon,rstr.bindGuestDlg.tip.invalid_username_char),TQ.showElem(a),setTimeout(function(){TQ.hideElem(a)},1500)},_hideUserNameInValidTip:function(){TQ.hideElem(this._doms.regUsernameValidTip)}}),BindGuestRegTabPanel=JClass.ex({_init:function(a,b,c){this._dlg=b,this._regHandler=UserReg.snew({url:"./plat/reg.py",doms:{regUsernameResult:c.usernameResult,regPasswordResult:c.passwordResult,repeatRegPasswordResult:c.repeatPasswordResult,regUsername:c.username,regPassword:c.password,repeatRegPassword:c.repeatPassword,regEmail:c.email,regEmailResult:c.emailResult,formReg:null,regUsernameValidTip:c.regUsernameValidTip,regUsernameValidTipCon:c.regUsernameValidTipCon},dlg:b,g:a,guestuser:g_guestuser,guestsign:g_guestsign,serverid:g_serverid}),c.confirm.setCaller({self:this,caller:this._onClickComfirm}),c.cancel.setCaller({self:this,caller:this._onClickCancel})},_onClickComfirm:function(){this._regHandler.submit()},_onClickCancel:function(){this._dlg.hideDlg()}}),BindGuestLoginTabPanel=JClass.ex({_init:function(a,b,c){this._g=a,this._dlg=b,this._items=c,this._seq=1,this._ajax=JAjax.snew("./plat/login.py"),this._ajax.setCaller(Caller.snew(this,this._onServerData)),this._items.password.type="password",c.confirm.setCaller({self:this,caller:this._onClickComfirm}),c.cancel.setCaller({self:this,caller:this._onClickCancel})},_onServerData:function(msg){var m=eval("("+msg+")");m.ret==0?(this._dlg.hideDlg(),UIM.getPanel("main").hideGuestBindBtn(),this._g.getGUI().msgBox(rstr.comm.msgts,m.msg,MB_F_CLOSE,null)):this._g.getGUI().msgBox(rstr.comm.msgts,m.msg,MB_F_CLOSE,null)},_onClickComfirm:function(){var a=this._items.username.value,b=this._items.password.value;this._ajax.asyncSend("act=loginbind&user="+a+"&psw="+b+"&guestuser="+g_guestuser+"&guestsign="+g_guestsign+"&serverid="+g_serverid+"&seq="+this._seq++)},_onClickCancel:function(){this._dlg.hideDlg()}});BindGuestDlg=JBaseDlg.ex({_getDlgCfg:function(){return{modal:!0,pos:{x:"center",y:40},title:rstr.bindGuestDlg.title,uicfg:uicfg.bindGuestDlg}},_afterCreate:function(){this._setTabTexts(),this._createPanels()},_setTabTexts:function(){for(var a=0;a<rstr.bindGuestDlg.tabs.length;++a)this.getItems().tabs.setTabText(a,rstr.bindGuestDlg.tabs[a])},_createPanels:function(){this._panels={},this._panels.reg=BindGuestRegTabPanel.snew(this.g_,this,this.getItems().tabs.getTabItems(0)),this._panels.login=BindGuestLoginTabPanel.snew(this.g_,this,this.getItems().tabs.getTabItems(1))},_initInfo:function(){this.getItems().tabs.activeTab(0)}})