UseListItemDlg=Class.extern(function(){var a=null,b=null,c=null,d=RET_END,e=null;this.init=function(c){a=c,b=this},this.setPreUseCaller=function(a){e=a},this.openDlg=function(a,c,d,e){f(c,d);var i=g(a);if(!i)return;var j=UIM.getDlg("filteritem");j.setCaller({self:b,caller:h}),j.openDlg({title:i.dlg.title,filter:"effect",effids:a,btntext:i.dlg.btntext,name:m(),targetitem:c,desc:e?e:""})},this.openDlgByItemIds=function(a,c,d,e,g,i){f(e,g);var j=UIM.getDlg("filteritem");j.setCaller({self:b,caller:h}),j.openDlg({title:a,filter:"itemids",itemids:d,btntext:c,name:m(),targetitem:e,desc:i?i:""})},this.isShow=function(){var a=UIM.getDlg("filteritem");return a&&a.isShow()},this.clickItem=function(a){var b=UIM.getDlg("filteritem");b.clickItem(a)};var f=function(a,b){e=null,c=a,d=isNull(b)?RET_END:b},g=function(a){var b=null;for(var c=0;c<a.length;++c){var d=a[c];b=TQ.qfind(res_effects,"id",d);if(!b)return log("not find effid: "+d+" in res_effects"),null}return b},h=function(b){return i(b)?j(b)?RET_CONTINUE:l(b)?RET_CONTINUE:(DirectUseItemHdrMgr.isSpec(b.itemres)?DirectUseItemHdrMgr.getHdr(b.itemres).useItem(a,b):UseItemSender.send(a,b,b.needNumber,n()),d):RET_CONTINUE},i=function(a){return e?e(a):!0},j=function(a){if(a.number==0&&a.itemres.buyprice){var b=UIM.getDlg("buyitem");return b.openDlg({id:0,resid:a.resid,number:1e5}),!0}return!1},l=function(c){if(c.isGiftGold&&c.needNumber>a.getImgr().getAllGold()){var d=function(a){a==MB_IDYES&&JMISC.openPayWnd()};return a.getGUI().msgBox(rstr.comm.msgts,rstr.useitem.uselistitemdlg.noEnoughGold,MB_F_YESNO,{self:b,caller:d}),!0}return!1},m=function(){var a="--";return c.name?a=c.name:c.itemres?a=c.itemres.name:c.resid&&(res=ItemResUtil.findItemres(c.resid),a=res.name),a},n=function(){var a={};for(k in c){if(k=="resid"||k=="stoptime"||k=="starttime"||k=="name")continue;a[k]=c[k]}return a}})