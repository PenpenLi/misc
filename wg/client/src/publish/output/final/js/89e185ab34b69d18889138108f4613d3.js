BaseQQdiamondDlg=JBaseDlg.ex({_innerInit:function(){this.g_.regEvent(EVT.ROLEBASE,2,this,this._onRoleUpgrade),this._regEvents()},_getDlgCfg:function(){return{modal:!1,pos:{x:"center",y:40},uiback:uiback.dlg.noborder,uicfg:this._getUiCfg()}},_afterCreate:function(){TQ.fixIE6Png(this.items_.dlg_bak)},_setCallers:function(){this.items_.closeBtn.setCaller({self:this,caller:this._onCloseDlg}),this.items_.openCommBtn.setCaller({self:this,caller:this._onOpenComm}),this.items_.openYearBtn.setCaller({self:this,caller:this._onOpenYear}),this.items_.payCommBtn.setCaller({self:this,caller:this._onPayComm}),this.items_.payYearBtn.setCaller({self:this,caller:this._onPayYear}),this.items_.buyGoldBtn.setCaller({self:this,caller:this._onBuyGold}),this.items_.getNewBtn.setCaller({self:this,caller:this._onGetNewGift}),this.items_.getCommEveryDayBtn.setCaller({self:this,caller:this._onGetCommEveryDayGift}),this.items_.getYearEveryDayBtn.setCaller({self:this,caller:this._onGetYearEveryDayGift})},_initInfo:function(){this._getSender().sendGetInfo(this.g_),this._update()},_onCloseDlg:function(){this.hideDlg()},_onBuyGold:function(){JMISC.openPayWnd()},_onGetNewGift:function(){if(!this._isDiamond()){this.g_.getGUI().sysMsgTips(SMT_WARNING,this._needOpenDiamondTip());return}this._isGotNewGift()||this._getSender().sendGetNewGift(this.g_)},_onGetCommEveryDayGift:function(){if(!this._isDiamond()){this.g_.getGUI().sysMsgTips(SMT_WARNING,this._needOpenDiamondTip());return}this._isGotCommEverydayGift()||this._getSender().sendGetCommEveryDayGift(this.g_)},_onGetYearEveryDayGift:function(){if(!this._isYearDiamond()){this.g_.getGUI().sysMsgTips(SMT_WARNING,this._needOpenYearDiamondTip());return}this._isGotYearEveydayGift()||this._getSender().sendGetYearEveryDayGift(this.g_)},_onRoleUpgrade:function(){this._update()},_onDiamondInfo:function(a){this._update()},_onGetLvlGift:function(a){var b=this._getLevelGiftsResByIdx(a),c=this.g_.getImgr().getRoleRes().level;if(b.level>c)return;if(this._isGotLvlGift(b.id))return;if(b.xdlvl>this._getDiamondLevel()){this.g_.getGUI().sysMsgTips(SMT_WARNING,TQ.format(this._needLevelDiamondTip(),b.xdlvl));return}this._getSender().sendGetLevelGift(this.g_,b.id)},_onGetTooltip:function(a){if(a.resid==0)return"";var b={id:a.resid,resid:a.resid,itemres:ItemResUtil.findItemres(a.resid)};return TIPM.getItemDesc(b)},_update:function(){if(!this.isShow())return;this._updateCurDiamondLevel(),this._updateDiamondBtnsDisplay(),this._updateNewGiftBtnEnable(),this._updateCommGiftBtnEnable(),this._updateLevelGiftList(),this._updateNewGiftList(),this._updateCommGiftList(),this._updateYearGiftList(),this._updateYearGiftBtnEnable()},_updateDiamondBtnsDisplay:function(){this._isCommDiamond()?(TQ.setCSS(this.items_.openCommBtn.getParent(),"display","none"),TQ.setCSS(this.items_.payCommBtn.getParent(),"display","block")):(TQ.setCSS(this.items_.openCommBtn.getParent(),"display","block"),TQ.setCSS(this.items_.payCommBtn.getParent(),"display","none")),this._isYearDiamond()?(TQ.setCSS(this.items_.openYearBtn.getParent(),"display","none"),TQ.setCSS(this.items_.payYearBtn.getParent(),"display","block")):(TQ.setCSS(this.items_.openYearBtn.getParent(),"display","block"),TQ.setCSS(this.items_.payYearBtn.getParent(),"display","none"))},_updateLevelGiftList:function(){var a=this.g_.getImgr().getRoleRes().level,b=this.items_.levelList;b.setItemCount(this._getLevelGiftsResCount());for(var c=0;c<b.getCount();++c){var d=this._getLevelGiftsResByIdx(c),e=DropItemUtil.getDropItems(d.dropid),f=b.getItem(c);TQ.setText(f.exsubs.roleLevel,"Lv"+d.level),IMG.setBKImage(f.exsubs.xdLevel,this._makeUiDiamondImg(d.xdlvl));for(var g=1;g<=e.length;++g){var h=e[g-1];h.itemres=ItemResUtil.findItemres(h.id),this._setItem(f.exsubs["icon"+g],f.exsubs["number"+g],f.exsubs.tooltips["$item"+g],h)}for(var g=e.length+1;g<=3;++g)TTIP.setCallerData(f.exsubs.tooltips["$item"+g],{self:this,caller:this._onGetTooltip},{resid:0});var i=!this._isGotLvlGift(d.id)&&d.level<=a&&d.xdlvl<=this._getDiamondLevel();f.exsubs.getBtn.enable(i),f.exsubs.getBtn.setId(c),f.exsubs.getBtn.setCaller({self:this,caller:this._onGetLvlGift}),f.exsubs.getBtn.resetUIBack(this._getGetBtnUiback())}},_updateNewGiftBtnEnable:function(){this.items_.getNewBtn.enable(!this._isGotNewGift())},_updateNewGiftList:function(){var a=this._getNewGiftsResByIdx(0),b=DropItemUtil.getDropItems(a.dropid),c=this.items_.newhandList;c.setItemCount(b.length);for(var d=0;d<c.getCount();++d){var e=b[d];e.itemres=ItemResUtil.findItemres(e.id);var f=c.getItem(d);this._setItem(f.exsubs.icon,f.exsubs.number,f.exsubs.tooltips.$item,e)}},_updateCommGiftBtnEnable:function(){this.items_.getCommEveryDayBtn.enable(!this._isGotCommEverydayGift())},_updateCommGiftList:function(){var a=this.items_.everydayList;a.setItemCount(this._getEverydayGiftsResCount());for(var b=0;b<a.getCount();++b){var c=this._getEverydayGiftsResByIdx(b),d=DropItemUtil.getDropItems(c.dropid),e=a.getItem(b);IMG.setBKImage(e.exsubs.xdLevel,this._makeUiDiamondImg(c.id));for(var f=1;f<=d.length;++f){var g=d[f-1];g.itemres=ItemResUtil.findItemres(g.id),this._setItem(e.exsubs["icon"+f],e.exsubs["number"+f],e.exsubs.tooltips["$item"+f],g)}for(var f=d.length+1;f<=3;++f)TTIP.setCallerData(e.exsubs.tooltips["$item"+f],{self:this,caller:this._onGetTooltip},{resid:0})}},_updateYearGiftBtnEnable:function(){this.items_.getYearEveryDayBtn.enable(!this._isGotYearEveydayGift())},_updateYearGiftList:function(){var a=this._getYearEverydayGiftsResByIdx(0),b=DropItemUtil.getDropItems(a.dropid),c=this.items_.yearEverydayList;c.setItemCount(b.length);for(var d=0;d<c.getCount();++d){var e=b[d];e.itemres=ItemResUtil.findItemres(e.id);var f=c.getItem(d);this._setItem(f.exsubs.icon,f.exsubs.number,f.exsubs.tooltips.$item,e)}},_setItem:function(a,b,c,d){IMG.setBKImage(a,IMG.makeSmallImg(d.itemres.smallpic)),TQ.setText(b,"Ã—"+d.number),TTIP.setCallerData(c,{self:this,caller:this._onGetTooltip},{resid:d.id})},_isGotNewGift:function(){var a=this._getRoleDiamondInfo();return a.got_newgift?!0:!1},_isGotCommEverydayGift:function(){var a=this._getRoleDiamondInfo();return a.got_commgift?TQ.isSameDay(a.got_commgift,this.g_.getSvrTimeS()):!1},_isGotYearEveydayGift:function(){var a=this._getRoleDiamondInfo();return a.got_yeargift?TQ.isSameDay(a.got_yeargift,this.g_.getSvrTimeS()):!1},_isGotLvlGift:function(a){var b=this._getRoleDiamondInfo();return b.got_lvlgifts?TQ.find(b.got_lvlgifts,null,a)!=null:!1},_isDiamond:function(){var a=this._getRoleDiamondInfo();return a.is_high_vip||a.is_vip||a.is_year_vip?!0:!1},_isCommDiamond:function(){var a=this._getRoleDiamondInfo();return a.is_high_vip||a.is_vip?!0:!1},_isYearDiamond:function(){var a=this._getRoleDiamondInfo();return a.is_year_vip?!0:!1},_getDiamondLevel:function(){var a=this._getRoleDiamondInfo();return a.vip_level?a.vip_level:0},_getLevelGiftsResByIdx:function(a){var b=this._getRess().lvlgifts[a];return b.xdlvl=b.bdlvl?b.bdlvl:b.ydlvl,b},_getLevelGiftsResCount:function(){return this._getRess().lvlgifts.length},_getNewGiftsResByIdx:function(a){return this._getRess().newgifts[a]},_getEverydayGiftsResByIdx:function(a){return this._getRess().everydaygifts[a]},_getEverydayGiftsResCount:function(){return this._getRess().everydaygifts.length},_getYearEverydayGiftsResByIdx:function(a){return this._getRess().yeareverydaygifts[a]},_regEvents:function(){},_getUiCfg:function(){},_getSender:function(){},_getRess:function(){},_getRoleDiamondInfo:function(){},_getGetBtnUiback:function(){},_onOpenComm:function(){},_onOpenYear:function(){},_onPayComm:function(){},_onPayYear:function(){},_updateCurDiamondLevel:function(){},_needOpenDiamondTip:function(){},_needOpenYearDiamondTip:function(){},_needLevelDiamondTip:function(){},_makeUiDiamondImg:function(){}}),BluediamondDlg=BaseQQdiamondDlg.ex({_regEvents:function(){this.g_.regEvent(EVT.ROLEBASE,4,this,this._onDiamondInfo)},_setCallers:function(){this._super._setCallers.call(this),this.items_.gotoOfficial.setCaller({self:this,caller:this._onGotoOfficial}),this.items_.getHighEveryDayBtn.setCaller({self:this,caller:this._onGetHighEveryDayGift})},_getUiCfg:function(){return uicfg.BluediamondDlg},_getSender:function(){return BlueDiamondSender},_getRess:function(){return{lvlgifts:res_bd_lvlgifts,newgifts:res_bd_newgifts,everydaygifts:res_bd_everydaygifts,yeareverydaygifts:res_bd_yeareverydaygifts,higheverydaygifts:res_bd_higheverydaygifts}},_getRoleDiamondInfo:function(){var a={};return TQ.dictCopy(a,this.g_.getImgr().getRoleRes().bdInfo),a.is_vip=a.is_blue_vip,a.is_high_vip=a.is_super_blue_vip,a.is_year_vip=a.is_blue_year_vip,a.vip_level=a.blue_vip_level,a},_update:function(){if(!this.isShow())return;this._super._update.call(this),this._updateHighGiftList(),this._updateHighGiftBtnEnable()},_updateHighGiftList:function(){var a=this._getRess().higheverydaygifts[0],b=DropItemUtil.getDropItems(a.dropid),c=this.items_.highEverydayList;c.setItemCount(b.length);for(var d=0;d<c.getCount();++d){var e=b[d];e.itemres=ItemResUtil.findItemres(e.id);var f=c.getItem(d);this._setItem(f.exsubs.icon,f.exsubs.number,f.exsubs.tooltips.$item,e)}},_getGetBtnUiback:function(){return uiback.btn.bdgetbtn},_onOpenComm:function(){JMISC.openCommBlueDiamond()},_onOpenYear:function(){JMISC.openYearBlueDiamond()},_onPayComm:function(){JMISC.payCommBlueDiamond()},_onPayYear:function(){JMISC.payYearBlueDiamond()},_onGotoOfficial:function(){JMISC.openBlueOfficial()},_onGetHighEveryDayGift:function(){if(!this._isHighDiamond()){this.g_.getGUI().sysMsgTips(SMT_WARNING,rstr.bluediamondDlg.tip.openHighBlue);return}this._isGotHighEveydayGift()||this._getSender().sendGetHighEveryDayGift(this.g_)},_updateCurDiamondLevel:function(){this._isDiamond()?(IMG.setBKImage(this.items_.blueLbl,""),IMG.setBKImage(this.items_.blueLevel,this._makeUiDiamondImg(this._getDiamondLevel()))):IMG.setBKImage(this.items_.blueLbl,IMG.makeImg("qq/bd/mainui/notblue.gif"))},_updateHighGiftBtnEnable:function(){this.items_.getHighEveryDayBtn.enable(!this._isGotHighEveydayGift())},_isHighDiamond:function(){var a=this._getRoleDiamondInfo();return a.is_high_vip?!0:!1},_isGotHighEveydayGift:function(){var a=this._getRoleDiamondInfo();return a.got_highgift?TQ.isSameDay(a.got_highgift,this.g_.getSvrTimeS()):!1},_needOpenDiamondTip:function(){return rstr.bluediamondDlg.tip.openBlue},_needOpenYearDiamondTip:function(){return rstr.bluediamondDlg.tip.openYearBlue},_needLevelDiamondTip:function(){return rstr.bluediamondDlg.tip.levelBlue},_makeUiDiamondImg:function(a){return IMG.makeBlueDiamondImg("ui",a)}})