SmallViewmap=Class.extern(function(){var a=null,b=null,c=null,d=null,e=null,f=null,g={cx:137,cy:115},h={x1:0,y1:0,x2:1,y2:1},i={x:0,y:0,w:65,h:53},j={cx:137,cy:115};this.init=function(c,g,h,i){a=this,b=c,d=g,e=h,f=i,k()},this.loadMap=function(a){t(a)},this.setMapPixelRect=function(a,b,c,d){h.x1=a,h.y1=b,h.x2=c,h.y2=d},this.setCaller=function(a){c=a},this.setViewportPos=function(a){u(a)},this.getMapPixelSize=function(){return g},this.setMapPixelSize=function(a){g.cx=a.cx,g.cy=a.cy},this.getViewport=function(){return i},this.setViewportSize=function(a){r(a),s()},this.convertLTSPos=function(a){var b=v(),c=w(),d=parseInt(g.cx*(a.x-b.x)/c.cx),e=parseInt(g.cy*(a.y-b.y)/c.cy);return{x:d,y:e}},this.convertSTLPos=function(a){var b=v(),c=w(),d=parseInt(c.cx*a.x/g.cx+b.x),e=parseInt(c.cy*a.y/g.cy+b.y);return{x:d,y:e}};var k=function(){l()},l=function(){TQ.addEvent(f,"dragstart",function(a){return!1}),TQ.addEvent(f,"selectstart",function(a){return!1}),TQ.captureMouseEvent(f,{self:a,mouseDown:m,mouseMove:n}),TQ.captureTouchEvent(f,{self:a,touchStart:o,touchMove:p})},m=function(a){q(a)},n=function(a){q(a)},o=function(a,b){q(TQ.makeMouseEvent(b.pageX,b.pageY,BTN_LEFT))},p=function(a,b){q(TQ.makeMouseEvent(b.pageX,b.pageY,BTN_LEFT))},q=function(b){var d=TQ.mouseRelativeCoords(f,b),e=a.getViewport(),g=parseInt(d.x-e.w/2),h=parseInt(d.y-e.h/2);u({x:g,y:h}),c&&c.caller.call(c.self,a.getViewport())},r=function(a){i.w=a.cx,i.h=a.cy},s=function(){var a=Math.max(5,i.w),b=Math.max(5,i.h);TQ.setDomSize(e,a,b)},t=function(a){m_mapid=a,m_mapres=ItemResUtil.findItemres(m_mapid),j.cx=m_mapres.mapsize.cx,j.cy=m_mapres.mapsize.cy,h.x1=0,h.y1=0,h.x2=m_mapres.mapsize.cx,h.y2=m_mapres.mapsize.cy,IMG.setBKImage(d,IMG.makeImg("map/"+m_mapres.simg))},u=function(a){i.x=a.x,i.y=a.y,i.x<0?i.x=0:i.x+i.w>g.cx&&(i.x=g.cx-i.w),i.y<0?i.y=0:i.y+i.h>g.cy&&(i.y=g.cy-i.h),e.style.left=i.x+"px",e.style.top=i.y+"px"},v=function(){return{x:h.x1,y:h.y1}},w=function(){return{cx:h.x2-h.x1,cy:h.y2-h.y1}}}),SmallMapPanel=SmallViewmap.extern(function(){var a=137,b=115,c=149,d=146,e=null,f=null,g=null,h=null,i={};this.init=function(c,d){j(this,c,d),k(),l(),this.setMapPixelSize({cx:a,cy:b})},this.setTitle=function(a){TQ.setTextEx(i.title,a)},this.getMapSize=function(){return{cx:c,cy:d}},this.getMapEventDom=function(){return i.smap_event};var j=function(a,b,c){e=a,f=b,g=c},k=function(){f.getGUI().initPanel(g,uicfg.main.smallmap,i),TQ.setCSS(i.smap_viewblock_i,"opacity",15)},l=function(){var a=e.Super;e.Super=e.Super.Super,a.init(f,i.smallmap,i.smap_viewblock,i.smap_event),e.Super=a}})