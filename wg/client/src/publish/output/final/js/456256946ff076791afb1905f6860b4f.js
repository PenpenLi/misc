SelfFieldsListDlg=Class.extern(function(){var a=null,b=null,c=null,d={};this.init=function(c){a=c,b=this,e()},this.openDlg=function(){f(),g(),h()};var e=function(){a.regEvent(EVT.SELFFIELD_UPDATE,0,b,i),a.regEvent(EVT.PERSONAL_ARMY_UPDATE,0,b,i)},f=function(){if(c)return;c=Dialog.snew(a,{modal:!1,title:rstr.field.selffieldslistdlg.title,pos:{x:"center",y:50}}),a.getGUI().initDlg(c,uicfg.field.selffieldslistdlg,d)},g=function(){c.show()},h=function(){j()},i=function(){if(!q())return;j()},j=function(){k(),o()},k=function(){var b=a.getImgr().getSelfFields().list;d.list.setItemCount(b.length);for(var c=0;c<d.list.getCount();++c){var e=d.list.getItem(c),f=b[c],g=FieldUtil.makeFieldFromSelfField(f),h=l(g);TQ.setTextEx(e.exsubs.fieldName,m(g)),TQ.setTextEx(e.exsubs.heroName,h.name),TQ.setTextEx(e.exsubs.soldierName,RStrUtil.getSoldierNameByResId(h.soldier.resid)),TQ.setTextEx(e.exsubs.soldierNum,h.soldier.number),TQ.setTextEx(e.exsubs.collectState,n(f))}},l=function(a){var b=SelfFieldUtil.getCurDispatchHero(a);return b?b:{name:"--",soldier:{resid:0,number:0}}},m=function(a){var b=FieldUtil.getFieldName(a),c=FieldUtil.getPosByGridId(a.gridId);return b+"("+c.x+","+c.y+")"},n=function(a){return a.startTime?rstr.field.selffieldslistdlg.lbl.collecting:rstr.field.selffieldslistdlg.lbl.stopCollect},o=function(){for(var a=0;a<d.list.getCount();++a){var c=d.list.getItem(a);c.exsubs.enterBtn.setId(a),c.exsubs.enterBtn.setCaller({self:b,caller:p})}},p=function(b){var c=FieldUtil.makeFieldFromSelfField(a.getImgr().getSelfFieldByIdx(b)),d=UIM.getDlg("selffield");d.openDlg(c)},q=function(){return c?c.isShow():!1}})