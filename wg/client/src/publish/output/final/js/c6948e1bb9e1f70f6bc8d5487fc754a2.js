CommMapPanel=Class.extern(function(){var a=2048,b=1536,c=null,d=null,e=null,f=null,g={},h=null,i={x:0,y:0},j=!0,k=!1;this.init=function(a,b){c=a,d=this,c.getGUI().initPanel(b,uicfg.main.mappanel,g)},this.getItems=function(){return g},this.create=function(){l()},this.loadMap=function(a,b){this.setName(b),this.setActive(!0),r(a)},this.setMapPixelRect=function(a,b,c,d){e.setMapPixelRect(a,b,c,d),f.setMapPixelRect(a,b,c,d)},this.getMapPixelRect=function(){return e.getMapPixelRect()},this.setName=function(a){f.setTitle(a)},this.setViewportPos=function(a){e.setViewportPos(a),f.setViewportPos(f.convertLTSPos(e.getViewport()))},this.setLastViewport=function(a){i.x=a.x,i.y=a.y},this.getLastViewport=function(a){return i},this.getViewport=function(){return e?e.getViewport():{x:0,y:0,w:a,h:b}},this.show=function(){TQ.setCSS(g.gamemap,"visibility","visible"),TQ.setCSS(g.gamemap,"display","block"),j=!0},this.hide=function(){TQ.setCSS(g.gamemap,"visibility","hidden"),TQ.setCSS(g.gamemap,"display","none");var a=d.getViewport();i.x=a.x,i.y=a.y,j=!1},this.isShow=function(){return j},this.setViewportCaller=function(a){h=a},this.isDragged=function(a){var b=e.getMouseDownPos(),c=TQ.mouseCoords(a);return Math.abs(b.x-c.x)>8||Math.abs(b.y-c.y)>8},this.resetSMapCaller=function(){o()},this.resize=function(a){if(!e)return;e.setViewportSize(a)},this.setActive=function(a){k=a},this.isActive=function(){return k},this.resetViewPos=function(){var a=e.getViewport();e.setViewportPos({x:a.x,y:a.y}),s(),f.setViewportPos(f.convertLTSPos(a))},this.setLastViewPort=function(){d.setViewportPos(i),s()};var l=function(){m(),n(),o()},m=function(){e=GameMap.snew(c,g.mapscene),f=UIM.getPanel("smallmap")},n=function(){e.setViewportPos({x:0,y:0});var a=c.getWinSizer().getValidClientSize();e.setViewportSize({cx:a.cx,cy:a.cy})},o=function(){e.setCaller({self:d,caller:p}),f.setCaller({self:d,caller:q})},p=function(a){if(!j)return;f.setViewportPos(f.convertLTSPos(a)),h&&h.caller.call(h.self,a)},q=function(a){if(!j)return;e.setViewportPos(f.convertSTLPos(a)),h&&h.caller.call(h.self,e.getViewport())},r=function(a){e.loadMap(a),f.loadMap(a),d.setLastViewPort()},s=function(){var a=e.getMapPixelSize(),b=e.getViewport(),c=f.getMapPixelSize(),d={cx:0,cy:0};d.cx=parseInt(b.w/a.cx*c.cx),d.cy=parseInt(b.h/a.cy*c.cy),f.setViewportSize(d)}})