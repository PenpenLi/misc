ResProtectDlg=Class.extern(function(){var a=37,b=165,c=50,d=164,e=null,f=null,g=null,h={};this.init=function(a){f=this,e=a},this.openDlg=function(){i(),k(),l()},this.hideDlg=function(){g&&g.hide()};var i=function(){if(g)return;j()},j=function(){g=Dialog.snew(e,{modal:!1,title:rstr.resprotectdlg.title,pos:{x:"center",y:50}}),e.getGUI().initDlg(g,uicfg.resprotectdlg,h)},k=function(){g.show()},l=function(){m(),n(),o()},m=function(){TQ.setTextEx(h.storageCap,e.getImgr().getCityRes().cres.max)},n=function(){TQ.setTextEx(h.resProtect,t())},o=function(){for(var a=0;a<h.list.getCount();++a){var b=h.list.getItem(a);p(a,b),q(a,b),r(a,b),s(a,b)}},p=function(f,g){var h=e.getImgr().getCityRes().cres.max,i=e.getImgr().getCityResValByIdx(f);h=Math.max(h,i);var j=Math.floor(i*d/h),k=b-j;TQ.setDomRect(g.exsubs.curhas,a,k,c,j)},q=function(f,g){var h=e.getImgr().getCityRes().cres.max,i=e.getImgr().getCityResValByIdx(f),j=t();h=Math.max(h,i,j),i=Math.min(i,j);var k=Math.floor(i*d/h),l=b-k;TQ.setDomRect(g.exsubs.curprotect,a,l,c,k)},r=function(a,b){var c=ItemResUtil.findItemres(e.getImgr().getCityResResIdByIdx(a));IMG.setBKImage(b.exsubs.icon,IMG.makeSmallImg(c.smallpic)),TQ.setTextEx(b.exsubs.name,c.name)},s=function(a,b){TQ.setTextEx(b.exsubs.curhasnum,e.getImgr().getCityResValByIdx(a))},t=function(){var a=0,b=e.getImgr().getBuildsByResid(BUILDCITY_ID.ALL,FIXID.DIJIAOBUILD);for(var c=0;c<b.length;++c){var d=b[c],f=ItemResUtil.findBuildLevelres(d.resid,d.level);if(!f)continue;a+=f.addresprotectnum}return a}})