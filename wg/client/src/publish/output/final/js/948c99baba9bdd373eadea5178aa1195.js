IntervalTips=function(){var a=null,b=null,c=3e5,d=0;this.init=function(d,e){a=d,b=this,isNull(e)||(c=e)},this.send=function(b){var e=a.getCurTimeMs();e-d>=c&&(UIM.getPanel("sysmsg").append(CHAT_TAG.SYS,b),d=e)},this.init.apply(this,arguments)},BriefResPanel=Class.extern(function(){var a="#FFFF00",b="#FF3300",c="#FFFFFF",d="#FF3300",e=1e4,f=1,g=null,h=null,i={},j=null,k=-1,l={food:0,wood:0,stone:0,iron:0,money:0,maxfood:0,maxwood:0,maxstone:0,maxiron:0,maxmoney:0},m={food:0,wood:0,stone:0,iron:0,money:0,maxfood:0,maxwood:0,maxstone:0,maxiron:0,maxmoney:0};this.init=function(a,b){g=a,h=this,i=b;var c={uiback:uiback.progress.buildvarprog,showflag:0,count:2};i.buildvalbar=new ProgressBarEx(g,i.buildvalbar,c),j=new IntervalTips(g,0),g.regEvent(EVT.LOGIN_OK,0,h,r),g.regEvent(EVT.NET,NETCMD.CITYRES,h,s),g.regEvent(EVT.PKG_CHANGE,1,h,v),i.rechargebtn2.setCaller({self:h,caller:w}),i.cityupgradebtn.setCaller({self:h,caller:x}),n(),o(),p(),D()},this.show=function(){TQ.setCSS(i.briefres,"display","block"),TQ.setCSS(i.briefres,"visibility","visible")},this.hide=function(){TQ.setCSS(i.briefres,"display","none"),TQ.setCSS(i.briefres,"visibility","hidden")},this.isCanUpgradeCityLevel=function(){return J()},this.getUpgradeCityBtn=function(){return i.cityupgradebtn};var n=function(){var a=[{tag:"foodtag",resid:FIXID.FOOD},{tag:"woodtag",resid:FIXID.WOOD},{tag:"stonetag",resid:FIXID.STONE},{tag:"irontag",resid:FIXID.IRON},{tag:"poputag",resid:FIXID.POPU},{tag:"moneytag",resid:FIXID.MONEY},{tag:"goldtag",resid:FIXID.GOLD},{tag:"giftgoldtag",resid:FIXID.GIFTGOLD}];for(var b=0;b<a.length;++b){var c=a[b],d=ItemResUtil.findItemres(c.resid);IMG.setBKImage(i[c.tag],IMG.makeSmallImg(d.smallpic))}},o=function(){var a={food:FIXID.FOOD,wood:FIXID.WOOD,stone:FIXID.STONE,iron:FIXID.IRON};for(var b in a){var c=a[b];for(var d=1;d<=2;++d)TTIP.setCallerData(i.tooltips["$"+b+"item"+d],{self:h,caller:y},{tag:b,resid:c})}var e=[{id:"$popu1",caller:B},{id:"$popu2",caller:B},{id:"$buildvalbar",caller:z},{id:"$cityupgradebtn",caller:A},{id:"$moneyitem1",caller:C},{id:"$moneyitem2",caller:C}];for(var d=0;d<e.length;++d){var f=e[d];TTIP.setCallerData(i.tooltips[f.id],{self:h,caller:f.caller},{})}},p=function(){var a=g.getImgr(),b=a.getCityRes(),c=b.cres;m={food:c.food,wood:c.wood,stone:c.stone,iron:c.iron,money:a.getMoney(),maxfood:c.max,maxwood:c.max,maxstone:c.max,maxiron:c.max,maxmoney:a.getMaxMoney()}},q=function(){var a=["food","wood","stone","iron","money"],b=[];for(var c=0;c<a.length;++c){var d=a[c];(l[d]!=m[d]||l["max"+d]!=m["max"+d])&&b.push(d)}for(var c=0;c<b.length;++c){var d=b[c],e=l[d]>l["max"+d]&&l["max"+d]>0;e&&j.send(TQ.format(rstr.briefrespanel.tips.beyond,rstr.comm[d]))}},r=function(){M()},s=function(a){p();var b=a.data;if(b.res){var c=g.getImgr().getCityRes();TQ.dictCopy(c,b.res),b.res.buildval&&b.res.buildval.level!=undefined&&(g.sendEvent({eid:EVT.SETCITYLEVEL,sid:0,level:b.res.buildval.level}),t(b.res.buildval.level)),g.sendEvent({eid:EVT.CITYRES,sid:0}),D()}},t=function(a){a>k&&(k!=-1&&u(a),k=a)},u=function(a){var b={cx:308,cy:70},c=g.getWinSizer().getValidClientSize(),d={parent:TQ.getUiBody(),size:b,imageClass:"city_upgrade_effect",zorder:UI_ZORDER_SCREEN_EFFECT+1,pos:{x:(c.cx-b.cx)/2,y:(c.cy-b.cy)/2}};g.getEntityfactory().playImageEffect(d),HelpGuider.getNewcomerSpirit().refreshCurNewcomerTask()},v=function(){G()},w=function(){JMISC.openPayWnd()},x=function(){N()},y=function(a){return TIPM.getCommResDesc(a.tag,a.resid)},z=function(a){return TIPM.getBuildVarBarDesc()},A=function(a){if(J()){var b=g.getImgr().getCityRes(),c=b.buildval.level+1;return TQ.format(rstr.briefrespanel.tips.canup,RStrUtil.getCityNameByLevel(c))}return K()?rstr.briefrespanel.buildval.fulllevel:TIPM.getBuildVarBarDesc()},B=function(a){return TIPM.getPopuDesc()},C=function(a){return TIPM.getMoneyDesc()},D=function(){var a=g.getImgr(),b=a.getCityRes(),c=b.cres;l={food:c.food,wood:c.wood,stone:c.stone,iron:c.iron,money:a.getMoney(),maxfood:c.max,maxwood:c.max,maxstone:c.max,maxiron:c.max,maxmoney:a.getMaxMoney()},E(["food","wood","stone","iron","money"]),G(),H(),F(),I(),q()},E=function(a){for(var b=0;b<a.length;++b){var c=a[b],e=l[c]>l["max"+c]&&l["max"+c]>0,f=RStrUtil.formatResNumStr(l[c]),g=e?TQ.formatColorStr(f,d):f;TQ.setHtml(i["cur"+c],g)}},F=function(){var a=g.getImgr();TQ.setTextEx(i.curpopu,RStrUtil.formatResNumStr(a.getIdlePopu()))},G=function(){TQ.setHtml(i.curgold,g.getImgr().getGold()),TQ.setHtml(i.curgiftgold,g.getImgr().getGiftGold())},H=function(){var a=g.getImgr().getCityRes(),b=0;if(a.buildval.level>0){var c=TQ.qfind(res_citylevelneeds,"level",a.buildval.level);b=c.needbuildval}i.buildvalbar.setRange(a.buildval.max-b),i.buildvalbar.setValue(0,a.buildval.cur-b),i.buildvalbar.setValue(1,a.buildval.cur-a.buildval.hurt-b),IMG.setBKImage(i.buildlevel,IMG.getCityNameImgByLevel(a.buildval.level))},I=function(){J()?(i.cityupgradebtn.enable(!0),i.cityupgradebtn.startBlinking(0),TQ.setCSS(i.cityupgradebk,"display","block"),HelpGuider.getNewcomerSpirit().refreshCurNewcomerTask()):(i.cityupgradebtn.enable(!1),i.cityupgradebtn.stopBlinking(),TQ.setCSS(i.cityupgradebk,"display","none"))},J=function(){var a=g.getImgr().getCityRes(),b=L()>=a.buildval.max;return b&&!K()},K=function(){var a=g.getImgr().getCityRes();return a.buildval.level>=res_max_city_level},L=function(){var a=g.getImgr().getCityRes();return a.buildval.cur-a.buildval.hurt},M=function(){var a="{cmd="+NETCMD.CITYRES+",subcmd=1}";g.send(null,a)},N=function(){var a="{cmd="+NETCMD.CITYRES+",subcmd=2}";g.send(null,a)}})