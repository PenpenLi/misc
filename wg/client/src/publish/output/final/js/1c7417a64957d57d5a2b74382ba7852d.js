SteelListDlg=Class.extern(function(){var a=Class.extern(function(){this.isSatisfiedBy=function(a,b){return b.state==HERO_STATE.FREE}}),b=Class.extern(function(){this.isSatisfiedBy=function(a,b){return a.exsubs.sel.getCheck()>0}}),c=Class.extern(function(){this.init=function(a){this.g_=a},this.isSatisfiedBy=function(a,b){return!this.g_.getImgr().isMaxHeroLevel(b)}}),d=Class.extern(function(){this.init=function(a,b){this.g_=a,this.steelType_=b},this.isSatisfiedBy=function(a,b){return this.steelType_!="steel"||!this._isArriveMaxBuildLevel(b)},this._isArriveMaxBuildLevel=function(a){var b=this.g_.getImgr().getBuildLevelByResId(BUILDCITY_ID.ALL,FIXID.STEEL_BUILD),c=ItemResUtil.findBuildLevelres(FIXID.STEEL_BUILD,b);return a.level>=c.herosteelmaxlevel}}),e=0,f=null,g=null,h=null,i={};this.init=function(a){k(this,a),l()},this.openDlg=function(){if(!j())return;m(),p(),q()},this.hideDlg=function(){h&&h.hide()};var j=function(){var a=f.getImgr().getBuildLevelByResId(BUILDCITY_ID.ALL,FIXID.STEEL_BUILD);return a==0?(f.getGUI().sysMsgTips(SMT_WARNING,rstr.steellistdlg.tip.hasNoBuild),!1):!0},k=function(a,b){g=a,f=b},l=function(){f.regEvent(EVT.HERO_UPDATE,0,g,B),f.regEvent(EVT.ROLEBASE,0,g,C)},m=function(){if(h)return;n(),o()},n=function(){h=Dialog.snew(f,{modal:!1,title:rstr.steellistdlg.title,pos:{x:"center",y:50}}),f.getGUI().initDlg(h,uicfg.hero.steellistdlg,i)},o=function(){var a=i.tabList.getTabItems(e);a.list.setCaller({self:g,caller:E}),a.selectAllBtn.setCaller({self:g,caller:F}),a.unselectAllBtn.setCaller({self:g,caller:G}),a.stopsteelAllBtn.setCaller({self:g,caller:H}),a.steelBtn.setCaller({self:g,caller:I}),a.highsteelBtn.setCaller({self:g,caller:J}),h.setCaller({self:g,caller:A}),i.vip1SteelBtn.setCaller({self:g,caller:K}),i.vip2SteelBtn.setCaller({self:g,caller:L})},p=function(){h.show()},q=function(){i.tabList.activeTab(0),r(),f.regUpdater(g,z,1e3),s()},r=function(){if(!t())return;u(),w(),x(),v()},s=function(){f.getImgr().getVipEffectVal(VIP_EFF.HERO_HIGH_STEEL)>=1?i.vip1SteelBtn.visible():i.vip1SteelBtn.hidden(),f.getImgr().getVipEffectVal(VIP_EFF.HERO_HIGH_STEEL)==2?i.vip2SteelBtn.visible():i.vip2SteelBtn.hidden()},t=function(){return h?h.isShow():!1},u=function(){var a=f.getImgr().getHeros().list,b=i.tabList.getTabItems(e);b.list.setItemCount(a.length);var c=function(a,b){var c=f.getImgr();TQ.setTextEx(a.exsubs.name,b.name),TQ.setTextEx(a.exsubs.level,b.level),b.state!=HERO_STATE.STEEL?TQ.setRichText(a.exsubs.state,rstr.comm.herostate[b.state]):b.steel.type==HSTEEL_TYPE.COMM?TQ.setTextEx(a.exsubs.state,rstr.steellistdlg.lbl.commSteel):b.steel.type==HSTEEL_TYPE.HIGH?TQ.setTextEx(a.exsubs.state,rstr.steellistdlg.lbl.highSteel):b.steel.type==HSTEEL_TYPE.VIP1?TQ.setTextEx(a.exsubs.state,rstr.steellistdlg.lbl.vip1Steel):b.steel.type==HSTEEL_TYPE.VIP2&&TQ.setTextEx(a.exsubs.state,rstr.steellistdlg.lbl.vip2Steel);var d=Math.floor(c.getHeroAttrVal(b,ATTR.XP)*100/c.getHeroAttrVal(b,ATTR.NXP));TQ.setTextEx(a.exsubs.exp,d+"%")},d=function(a,b){c(a,b),TQ.setTextEx(a.exsubs.totalsteeltime,"--")},g=function(a,b,d){c(a,b),TQ.setTextEx(a.exsubs.totalsteeltime,TQ.format(rstr.comm.hour,b.steel.steelQuarters/4))};y(d,g)},v=function(){var a=function(a,b){a.exsubs.opBtn.hide()},b=function(a,b,c){a.exsubs.opBtn.show(),a.exsubs.opBtn.setId(c),a.exsubs.opBtn.setCaller({self:g,caller:D})};y(a,b)},w=function(){var a=function(a,b){TQ.setTextEx(a.exsubs.steeltime,"--")},b=function(a,b){var c=Math.clamp(f.getSvrTimeS()-b.steel.startTime,0,b.steel.steelQuarters*900);TQ.setTextEx(a.exsubs.steeltime,TQ.formatTime(0,c))};y(a,b)},x=function(){var a=function(a,b){TQ.setTextEx(a.exsubs.getexp,0)},b=function(a,b){var c=f.getImgr().multHeroSteelBySvrAct(),d=Math.clamp(f.getSvrTimeS()-b.steel.startTime,0,b.steel.steelQuarters*900),e=Math.floor(d/900)*b.steel.quarterRes;TQ.setTextEx(a.exsubs.getexp,e*c)};y(a,b)},y=function(a,b){var c=f.getImgr().getHeros().list,d=i.tabList.getTabItems(e);for(var g=0;g<d.list.getCount();++g){var h=d.list.getItem(g),j=c[g];if(j.state!=HERO_STATE.STEEL){a(h,j,g);continue}b(h,j,g)}},z=function(){w(),x()},A=function(a){a==C_SYS_DLG_HIDE&&f.unregUpdater(g,z)},B=function(){r()},C=function(){if(!t())return;s()},D=function(a){var b=f.getImgr().getHeros().list[a];HeroSender.sendStopHeroSteel(f,b.id)},E=function(a,b){var c=i.tabList.getTabItems(e),d=c.list.getItem(b);if(!d)return;var f=d.exsubs.sel.getCheck()?0:1;d.exsubs.sel.setCheck(f)},F=function(){M(1)},G=function(){M(0)},H=function(){var a=function(a){a==MB_IDYES&&HeroSender.sendStopAllHerosSteel(f)};f.getGUI().msgBox(rstr.comm.msgts,rstr.steellistdlg.lbl.stopAllSteel,MB_F_YESNO,{self:g,caller:a})},I=function(){var a=N("steel");if(a.length==0)return;UIM.openDlg("steelhero","steel",a)},J=function(){var a=N("highsteel");if(a.length==0)return;UIM.openDlg("steelhero","highsteel",a)},K=function(){var a=N("highsteel");if(a.length==0)return;UIM.openDlg("steelhero","vip1steel",a)},L=function(){var a=N("highsteel");if(a.length==0)return;UIM.openDlg("steelhero","vip2steel",a)},M=function(a){var b=i.tabList.getTabItems(e);for(var c=0;c<b.list.getCount();++c){var d=b.list.getItem(c);d.exsubs.sel.setCheck(a)}},N=function(a){var b=R(a),c=S(b,a);return c!=""&&f.getGUI().sysMsgTips(SMT_WARNING,c),b},O=function(){var a=b.snew();return T(a).length},P=function(){var a=AndSpec.snew(b.snew(),NotSpec.snew(c.snew(f)));return T(a).length},Q=function(e){var g=AndSpec.snew(a.snew(),b.snew(),c.snew(f),NotSpec.snew(d.snew(f,e)));return T(g).length},R=function(e){var g=AndSpec.snew(a.snew(),b.snew(),c.snew(f),d.snew(f,e));return T(g)},S=function(a,b){var c="";return a.length==0?O()==0?c=rstr.steellistdlg.tip.emptySteelHeros:P()>0?c=rstr.steellistdlg.tip.allFullLevelHeros:Q(b)>0?c=rstr.steellistdlg.tip.allArriveMaxBuildLevel:c=rstr.steellistdlg.tip.allHerosBusy:P()>0?c=rstr.steellistdlg.tip.fullLevelHeros:Q(b)>0&&(c=rstr.steellistdlg.tip.arriveMaxBuildLevel),c},T=function(a){var b=[],c=f.getImgr().getHeros().list,d=i.tabList.getTabItems(e);for(var g=0;g<d.list.getCount();++g){var h=d.list.getItem(g),j=c[g];a.isSatisfiedBy(h,j)&&b.push(j)}return b},U=function(a){var b=f.getImgr().getBuildLevelByResId(BUILDCITY_ID.ALL,FIXID.STEEL_BUILD),c=ItemResUtil.findBuildLevelres(FIXID.STEEL_BUILD,b);return a.level>=c.herosteelmaxlevel}})