JAJAX_STATE={INIT:0,GETTING:1,RECVOK:2,ERROR:3},JAjax=JClass.ex({_init:function(a){this._state=JAJAX_STATE.INIT,this._url=a,this._caller=NullCaller,this._syncObj=null,this._asyncObj=null,this._timer=null,this._caches=[]},setCaller:function(a){this._caller=a},asyncSend:function(a){this.send(a,!0)},syncSend:function(a){this.send(a,!1)},send:function(a,b){var b=isNull(b)?!0:b;if(b){this._caches.push(a);if(!this._timer){var c=this;this._timer=window.setInterval(function(){c._onTimer()},50)}}else this._syncObj=this._createAjaxObj(),this._send(this._syncObj,a,b)},_send:function(a,b,c){if(!a)return;var d=this._url+"?msg="+encodeURIComponent(b);try{a.open("GET",d,c),a.send(null),this._state=JAJAX_STATE.GETTING}catch(e){alert("send msg by ajax failed!")}},_onTimer:function(){if(this._caches.length==0){window.clearInterval(this._timer),this._timer=null;return}if(this._asyncObj)return;var a=this._caches[0];this._caches.splice(0,1),this._asyncObj=this._createAjaxObj(),this._send(this._asyncObj,a,!0)},getState:function(){return this._state},_createObject:function(){try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(a){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(a){}try{return new XMLHttpRequest}catch(a){}return null},_handleStateChange:function(a){a.readyState==4&&(this._state=JAJAX_STATE.RECVOK,a==this._asyncObj&&(this._asyncObj=null),a==this._syncObj&&(this._syncObj=null));if(a.readyState==4&&a.status==200){var b=a.responseText;this._caller.invoke(b)}},_createAjaxObj:function(){var a=this._createObject();if(!a)return;var b=this;return a.onreadystatechange=function(){b._handleStateChange(a)},this._state=JAJAX_STATE.INIT,a}})