EXPED_TEAMGRID_MAXCNT=5,ExpedTargetUtil=Class.extern(function(){var a=-1;this.createNull=function(){return{type:a}},this.getValidTarget=function(a){return a?a:this.createNull()},this.isNull=function(b){return!b||b.type==a},this.getDistance=function(a,b){var c=a.getImgr().getRoleRes().pos;return Math.sqrt((c.x-b.x)*(c.x-b.x)+(c.y-b.y)*(c.y-b.y))},this.getMoveNeedTime=function(a,b,c){var d=this.getDistance(a,b)/c,e=Math.floor(d*3600)+res_army_preparetime*res_army_movespeed/c;return e}}).snew(),ExpedTargetSpec=Class.extern(function(){this.isSatisfiedBy=function(a){return ExpedUtil.makeExpedTarget(a)!=null},this.getInvalidTip=function(){return rstr.selectexpedtarget.err.noSelTarget}}),ExpeditionDlg=ListenerBaseDlg.extern(function(){var a=null,b=null,c=null,d={},e=ExpedTargetUtil.createNull(),f=null,g=null,h=null,i=null,j=null;this._init=function(){a=this.g_,b=this,j=ExpedTargetChecker.snew(a),a.regEvent(EVT.BATTLETIMES_UPDATE,0,b,r)},this.getItems=function(){return d},this.getCtrl=function(a){return d[a]},this.openDlg=function(a){k(),n(a),HelpGuider.getNewcomerSpirit().onDlgOpen("expedition",{parent:c.getParent(),items:d}),this._notifyOpenDlg()},this.closeDlg=function(){c&&c.hide()},this.hideDlg=function(){this.closeDlg()},this.isShow=function(){return c&&c.isShow()},this.setTarget=function(a){p(a)},this.getTarget=function(){return e},this.hasExpedHeros=function(){var b=i.getCanExpedHeros();return ExpedHerosChecker.isValid(a,b,f.getSelectType())};var k=function(){c||(c=Dialog.snew(a,{modal:!1,title:rstr.expeddlg.title,pos:{x:"center",y:30}}),a.getGUI().initDlg(c,uicfg.expedition.maindlg,d),g=ExpedTargetHdrMgr.snew(a,d),i=ExpedLineupInfoHdr.snew(a,d),h=ExpedDefaultTeamHdr.snew(a,d),h.setLineUpInfoHdr(i),l(),m()),c.show()},l=function(){c.setCaller({self:b,caller:s}),d.selecttype.setCaller({self:b,caller:t}),d.changeforcetab.setCaller({self:b,caller:u}),d.selecttarget.setCaller({self:b,caller:v}),d.assignsoldier.setCaller({self:b,caller:x}),d.fillsoldier.setCaller({self:b,caller:y}),d.treatment.setCaller({self:b,caller:z}),d.expedition.setCaller({self:b,caller:A})},m=function(){TQ.setTextEx(d.imghelp,HyperLinkMgr.formatLink(rstr.military.expeddlg.tip.imghelp))},n=function(a){a?p(a):ExpedTargetUtil.isNull(e)&&p(ExpedTargetUtil.createNull()),q(),o()},o=function(){var b=a.getImgr().getSaveForceByType(FORCELINE_TYPE.COMM);i.setLineup(b.lineup,b.heros),i.refresh()},p=function(a){e=ExpedTargetUtil.getValidTarget(a),j.setTarget(e),h.setTarget(e),g.setTarget(e),f=g.getTargetHdr(),f.updateTargetName(),f.updateTargetPos(),f.updateTargetTypes(),f.udpateEnemyFightCap(),i.setTarget(e),i.setTargetHdr(f),i.refresh(),h.update(),d.selecttype.select(0)},q=function(){if(!b.isShow())return;var c=a.getImgr().getTodayBattleTimes();TQ.setTextEx(d.todaybattleinfo,TQ.format(rstr.expeddlg.lbl.todaybattleinfo,c.taofa,c.cuihui,c.tiaoxin,c.fightowner))},r=function(){q()},s=function(a){a==C_SYS_DLG_HIDE&&HelpGuider.getNewcomerSpirit().onDlgClose("expedition")},t=function(a){f.setSelectType(a),f.updateTypeDesc(),f.udpateEnemyFightCap(),i.setExpedType(f.getSelectType()),i.refresh()},u=function(){if(ExpedTargetUtil.isNull(e)){a.getGUI().sysMsgTips(SMT_WARNING,rstr.expeddlg.err.noTarget);return}var c=function(b,c){h.clearTeamSel(),i.setLineup(b,c),i.refresh(),MilitarySender.sendSaveForceLineUp(a,FORCELINE_TYPE.COMM,b,c),TQ.dictCopy(a.getImgr().getSaveForces(),[{_k:"type"},{type:FORCELINE_TYPE.COMM,lineup:b,heros:c}])},d=UIM.getDlg("assignheros");d.setCaller({self:b,caller:c}),d.openDlg("comm")},v=function(){var a=UIM.getDlg("selectexpedtarget");a.setCaller({self:b,caller:w}),a.openDlg(ExpedTargetSpec.snew(),{tabIdx:0,typeListIdx:0})},w=function(a){var b=ExpedUtil.makeExpedTarget(a);p(b)},x=function(){UIM.openDlg("assignsoldiers")},y=function(){var b=FillSoldiersHdr.snew(a,null,SoldierSender);b.setHeros(i.getFreeHeros()),b.fillAll()},z=function(){TreatmentHeroHdr.treatmentHeros(a,i.getHeroIds())},A=function(){if(ExpedTargetUtil.isNull(e))return a.getGUI().sysMsgTips(SMT_WARNING,rstr.expeddlg.err.noTarget),!1;var c=i.getCanExpedHeros();if(!ExpedHerosChecker.isValid(a,c,f.getSelectType()))return!1;var d=j.isOtherPlayer()&&a.getImgr().getFightRefState(e.roleId)==REF_ROLESTATE.NORMAL;if(d){a.getGUI().sysMsgTips(SMT_WARNING,rstr.expeddlg.err.noDeclareFight);return}var h=j.isOtherPlayer()&&a.getImgr().getFightRefState(e.roleId)==REF_ROLESTATE.DECLARING_FIGHT;if(h){a.getGUI().sysMsgTips(SMT_WARNING,rstr.expeddlg.err.declaringFight);return}if(B())return;if(g.getTargetHdr().isCountryFight()){var k=g.getTargetHdr().getCountryFightTip();a.getGUI().msgBox(rstr.comm.msgts,k,MB_F_CLOSE,{self:b,caller:function(){D()}},[rstr.military.expeddlg.expebtn])}else D()},B=function(){if(!j.isOtherPlayer())return!1;var b=a.getImgr().getTodayBattleTimes();return b.taofa+b.cuihui+b.tiaoxin<res_max_attack_player_times?!1:(C(rstr.expeddlg.warning.attackMaxTimes,res_max_attack_player_times),!0)},C=function(c,d){var e=ItemResUtil.findItemres(FIXID.CHUSHILING),f=TQ.format(c,d,e.name),g=a.getImgr().getItemNumByResId(FIXID.CHUSHILING);if(g>0){var h=function(a){a==MB_IDYES&&D()};a.getGUI().msgBox(rstr.comm.msgts,f,MB_F_YESNO,{self:b,caller:h})}else f+=RStrUtil.makeNoItemBuyMsg(a,FIXID.CHUSHILING,1),a.getGUI().msgBox(rstr.comm.msgts,f,MB_F_CLOSE,null)},D=function(){var b=i.getExpedHerosInLineup(),d=f.getSelectType(),g=i.getLineup();MilitarySender.sendExped(a,e,d,g,b),c.hide()}}),ExpedTargetChecker=Class.extern(function(){var a=null,b=null,c=null;this.init=function(d){a=d,b=this,c=ExpedTargetUtil.createNull()},this.setTarget=function(a){c=ExpedTargetUtil.getValidTarget(a)},this.isSameAlliPlayer=function(){if(!d())return!1;if(!c.alliance)return!1;var b=a.getImgr().getRoleRes().alliance;return b.uid==c.alliance.uid&&b.uid!=0},this.isSelfFieldTarget=function(){return e()?a.getImgr().getSelfFieldByGridId(c.id)!=null:!1},this.isOtherPlayer=function(){return d()?!this.isSameAlliPlayer():!1},this.isOtherFieldTarget=function(){return e()?!this.isSelfFieldTarget():!1},this.isCopyFieldTarget=function(){return c.type==OBJ_TYPE.COPYFIELD};var d=function(){return c.type==OBJ_TYPE.ROLE},e=function(){return c.type==OBJ_TYPE.FIELD}}),ExpedLineupInfoHdr=Class.extern(function(){var a=null,b=null,c=null,d=null,e=null;this.init=function(e,f){a=this,b=f,c=ExpedMyFightCapRefresher.snew(e,f),d=ExpedForceTabHdr.snew(e,f),e.regEvent(EVT.HERO_UPDATE,0,a,g)},this.setTargetHdr=function(a){e=a},this.setTarget=function(a){c.setTarget(a),d.setTarget(a)},this.setExpedType=function(a){c.setExpedType(a),d.setExpedType(a)},this.setLineup=function(a,b){c.setLineup(a,b),d.setLineup(a,b),f()},this.refresh=function(){c.refresh(),d.refresh(),e&&e.updateMoveNeedTime(d.getArmySpeed())},this.getLineup=function(){return d.getLineup()},this.getHeroIds=function(){return d.getHeroIds()},this.getFreeHeros=function(){return d.getFreeHeros()},this.isNeedSingleHero=function(){return d.isNeedSingleHero()},this.getCanExpedHeros=function(){return d.getCanExpedHeros()},this.getExpedHerosInLineup=function(){return d.getExpedHerosInLineup()},this._getArmySpeed=function(){};var f=function(){c.getFirstValidHero()!=null?(b.fillsoldier.enable(!0),b.treatment.enable(!0)):(b.fillsoldier.enable(!1),b.treatment.enable(!1))},g=function(){a.refresh()}}),ExpedMyFightCapRefresher=Class.extern(function(){var a=null,b=null,c=null,d=null,e=ExpedTargetUtil.createNull(),f=null,g=[],h=0;this.init=function(e,f){a=e,c=this,b=f,d=ExpedTargetChecker.snew(a)},this.setTarget=function(a){e=ExpedTargetUtil.getValidTarget(a),d.setTarget(e)},this.setExpedType=function(a){f=a},this.setLineup=function(a,b){h=a,g=b},this.refresh=function(){TQ.setText(b.myfightcap,0),f==EXPED_TYPE.TIAOXIN||f==EXPED_TYPE.DANTIAO?TQ.setText(b.myfightcap,j()):f==EXPED_TYPE.PAIQIAN?d.isSelfFieldTarget()?TQ.setText(b.myfightcap,i()):TQ.setText(b.myfightcap,k()):f==EXPED_TYPE.TAOFA?TQ.setText(b.myfightcap,k()):f==EXPED_TYPE.CUIHUI?TQ.setText(b.myfightcap,k()):f==EXPED_TYPE.ZHANLING&&TQ.setText(b.myfightcap,i())},this.getFirstValidHero=function(){return m()};var i=function(){var b=m();return b?a.getImgr().getHeroAttrVal(b,ATTR.FC):0},j=function(){var b=m();return b?a.getImgr().getHeroAttrVal(b,ATTR.SFC):0},k=function(){if(!l())return 0;var b=0;for(var c=0;c<g.length;++c){var d=g[c],e=a.getImgr().getHero(d);if(!e)continue;b+=a.getImgr().getHeroAttrVal(e,ATTR.FC)}return b},l=function(){var a=ItemResUtil.findItemres(h);return a!=null},m=function(){for(var b=0;b<g.length;++b){var c=g[b],d=a.getImgr().getHero(c);if(d)return d}return null}}),ExpedForceTabHdr=Class.extern(function(){var a=null,b=null,c=null,d=ExpedTargetUtil.createNull(),e=0,f=0,g=[],h=null;this.init=function(d,e){a=d,c=this,b=e,h=ExpedTargetChecker.snew(a)},this.setTarget=function(a){d=ExpedTargetUtil.getValidTarget(a),h.setTarget(d)},this.setExpedType=function(a){e=a},this.setLineup=function(a,b){f=a,g=b},this.getLineup=function(){return c.isNeedSingleHero()?FIXID.DEFAULTLINEUP:f},this.getHeroIds=function(){return g},this.getFreeHeros=function(){var b=[];for(var c=0;c<g.length;++c){var d=a.getImgr().getHero(g[c]);if(!d)continue;if(d.state!=HERO_STATE.FREE)continue;b.push(d)}return b},this.refresh=function(){i(),j()},this.isNeedSingleHero=function(){return e==EXPED_TYPE.TIAOXIN?!0:e==EXPED_TYPE.DANTIAO?!0:e==EXPED_TYPE.ZHANLING?!0:h.isOtherFieldTarget()&&e==EXPED_TYPE.TAOFA?!0:h.isSelfFieldTarget()&&e==EXPED_TYPE.PAIQIAN?!0:!1},this.getCanExpedHeros=function(){return k()},this.getExpedHerosInLineup=function(){return l()},this.getArmySpeed=function(){var b=4294967295;for(var c=0;c<g.length;++c){var d=g[c],e=a.getImgr().getHero(d);if(!e)continue;var f=a.getImgr().getHeroAttrVal(e,ATTR.SP);f<b&&(b=f)}return b==4294967295&&(b=res_army_movespeed),b};var i=function(){var a=ItemResUtil.findItemres(f);a?(TQ.setCSS(b.curlineup,"display","block"),TQ.setText(b.curlineup_txt,a.name)):TQ.setCSS(b.curlineup,"display","none")},j=function(){c.isNeedSingleHero()?g.length>1?n():g.length==1?o():p():g.length>0?q():r()},k=function(){var a=m();return c.isNeedSingleHero()&&a.length>0?[a[0]]:!c.isNeedSingleHero()&&g.length==EXPED_TEAMGRID_MAXCNT?a:[]},l=function(){var a=m();return c.isNeedSingleHero()&&a.length>0?[a[0]]:!c.isNeedSingleHero()&&g.length==EXPED_TEAMGRID_MAXCNT?g:[]},m=function(){var a=[];for(var b=0;b<g.length;++b){var c=g[b];if(c==0)continue;a.push(c)}return a},n=function(){r();var a=z();a&&(u(a.grid),y(a.grid,a.hero))},o=function(){r();var b=4;u(b);var c=a.getImgr().getHero(g[0]);y(b,c)},p=function(){r();var a=4;t(a)},q=function(){r();var b=ItemResUtil.findItemres(f);if(!b)return;for(var c=0;c<b.grids.length;++c){var d=b.grids[c],e=g[c],h=a.getImgr().getHero(e);if(!h){t(d);continue}u(d),y(d,h)}},r=function(){for(var a=0,c=b.forcetablist.getCount();a<c;++a)s(a)},s=function(a){var c=b.forcetablist.getItem(a);v(a),IMG.setBKImage(c.exsubs.icon.parentNode,IMG.makeImg("expedition/forcetab/disablebak.gif"))},t=function(a){var c=b.forcetablist.getItem(a);v(a),IMG.setBKImage(c.exsubs.icon.parentNode,IMG.makeImg("expedition/forcetab/emptybak.gif"))},u=function(a){var c=b.forcetablist.getItem(a);w(a),IMG.setBKImage(c.exsubs.icon.parentNode,IMG.makeImg("expedition/forcetab/emptybak.gif"))},v=function(a){x(a,"hide")},w=function(a){x(a,"show")},x=function(a,c){var d=c=="show"?"block":"none",e=["icon","level","name","health","soldiername","soldiernum","stateflag"],f=b.forcetablist.getItem(a);for(var g in e)TQ.setCSS(f.exsubs[e[g]],"display",d)},y=function(c,d){var e=a.getImgr(),f=b.forcetablist.getItem(c);IMG.setBKImage(f.exsubs.icon,IMG.makeSmallImg(d.icon)),TQ.setTextEx(f.exsubs.level,TQ.format(rstr.comm.flevel,d.level)),TQ.setTextEx(f.exsubs.name,d.name);var g=e.getHeroAttrVal(d,ATTR.HEALTH);TQ.setTextEx(f.exsubs.health,RStrUtil.getHealthStr(g)),TQ.setTextEx(f.exsubs.soldiername,RStrUtil.getSoldierNameByResId(d.soldier.resid)),TQ.setTextEx(f.exsubs.soldiernum,d.soldier.number),d.state!=HERO_STATE.FREE?IMG.setBKImage(f.exsubs.stateflag,IMG.makeImg("expedition/forcetab/herobusy.gif")):IMG.setBKImage(f.exsubs.stateflag,"")},z=function(){var b=ItemResUtil.findItemres(f);if(!b)return null;for(var c=0;c<b.grids.length;++c){var d=b.grids[c],e=g[c],h=a.getImgr().getHero(e);if(h)return{grid:d,hero:h}}return null}}),ExpedDefaultTeamHdr=Class.extern(function(){var a=null,b=null,c=null,d=null,e=ExpedTargetUtil.createNull();this.init=function(d,e){a=d,c=this,b=e,a.regEvent(EVT.BDEFAULT_TEAMS_UPDATE,0,c,h),a.regEvent(EVT.HERO_UPDATE,0,c,i),b.defaultteam.setPreCaller({self:c,caller:f}),b.defaultteam.setCaller({self:c,caller:g})},this.setLineUpInfoHdr=function(a){d=a},this.setTarget=function(a){e=ExpedTargetUtil.getValidTarget(a)},this.update=function(){l(),j()},this.clearTeamSel=function(){b.defaultteam.select(-1)};var f=function(b){if(b<0)return!0;var c=a.getImgr().getDefaultTeams(),d=c[b],f=d&&d.lineup;return f?ExpedTargetUtil.isNull(e)?(a.getGUI().sysMsgTips(SMT_WARNING,rstr.expeddlg.err.noTarget),!1):!0:(a.getGUI().sysMsgTips(SMT_WARNING,rstr.expeddlg.err.noLineup),!1)},g=function(a){l(),k()},h=function(){j()},i=function(){j()},j=function(){var c=[{isSeted:!0,val:0},{isSeted:!0,val:0},{isSeted:!0,val:0}],d=a.getImgr().getDefaultTeams();for(var e=0;e<d.length;++e){var f=d[e];if(f.lineup==0){c[e].isSeted=!1;continue}for(var g=0;g<f.heros.length;++g){var h=f.heros[g],i=a.getImgr().getHero(h);if(!i)continue;c[e].val+=a.getImgr().getHeroAttrVal(i,ATTR.FC)}}for(var j=0;j<c.length;++j){var k=b.defaultteam.getRadio(j),l=c[j];l.isSeted?k.setText(TQ.format(rstr.expeddlg.btn.defaultteam,rstr.comm.hznums[j+1],c[j].val)):k.setText(TQ.format(rstr.expeddlg.btn.defaultteam,rstr.comm.hznums[j+1],rstr.expeddlg.btn.nosetteam))}},k=function(){var c=b.defaultteam.getCurSelId();if(c<0)d.setLineup(0,[]),d.refresh();else{var e=a.getImgr().getDefaultTeams(),f=e[c];d.setLineup(f.lineup,f.heros),d.refresh(),MilitarySender.sendSaveForceLineUp(a,FORCELINE_TYPE.COMM,f.lineup,f.heros),TQ.dictCopy(a.getImgr().getSaveForces(),[{_k:"type"},{type:FORCELINE_TYPE.COMM,lineup:f.lineup,heros:f.heros}])}},l=function(){var a=b.defaultteam.getCurSelId();a<0?TQ.setCSS(b.curdefaultteam,"display","none"):(TQ.setCSS(b.curdefaultteam,"display","block"),TQ.setText(b.curdefaultteam_txt,TQ.format(rstr.expeddlg.lbl.defaultteam,rstr.comm.hznums[a+1])))}}),ExpedTargetHdr=Class.extern(function(){this.g=null,this.items=null,this.target=ExpedTargetUtil.createNull(),this.selectType=0,this.expedTypes=[],this.init=function(a,b){this.g=a,this.items=b},this.setTarget=function(a){this.target=ExpedTargetUtil.getValidTarget(a)},this.setSelectType=function(a){a>=this.expedTypes.length&&alert("error: 4930259r3"),this.selectType=this.expedTypes[a]},this.getSelectType=function(){return this.selectType},this.updateMoveNeedTime=function(a){var b=ExpedTargetUtil.getMoveNeedTime(this.g,this.target.pos,a);TQ.setText(this.items.needtime,TQ.formatTime(0,b))},this.updateTargetName=function(){TQ.setText(this.items.target,this.target.name)},this.udpateEnemyFightCap=function(){TQ.setText(this.items.enemyfightcap,"")},this.updateTargetPos=function(){TQ.setText(this.items.coordinate,"x:"+this.target.pos.x+", y:"+this.target.pos.y)},this.catTargetLevel=function(a){return a+"."+TQ.format(rstr.comm.flevel,this.target.level)},this.setTargetTypeRadioTexts=function(){for(var a=0;a<this.expedTypes.length;++a){var b=this.expedTypes[a],c=b-EXPED_TYPE.FIRST,d=rstr.expeddlg.btn.types[c];this.items.selecttype.getRadio(a).show(),this.items.selecttype.getRadio(a).setText(d)}for(var a=this.expedTypes.length;a<4;++a)this.items.selecttype.getRadio(a).hide()},this.isSameCountry=function(){var a=this.g.getImgr().getRoleRes().pos;return FieldUtil.getCityResIdByPos(this.target.pos)==FieldUtil.getCityResIdByPos(a)},this.isCountryFight=function(){return!1},this.getCountryFightTip=function(){return""}}),NullExpedTargetHdr=ExpedTargetHdr.extern(function(){this.setSelectType=function(a){this.selectType=0},this.updateTargetName=function(){TQ.setText(this.items.target,"")},this.updateTargetPos=function(){TQ.setText(this.items.coordinate,"x:0, y:0")},this.updateMoveNeedTime=function(a){TQ.setText(this.items.needtime,TQ.formatTime(0,0))},this.updateTargetTypes=function(){this.expedTypes=[],this.setTargetTypeRadioTexts()},this.updateTypeDesc=function(){TQ.setRichText(this.items.typedesc,"")}}),SameAlliPlayerTargetHdr=ExpedTargetHdr.extern(function(){this.init=function(a,b){this.g=a,this.items=b},this.setTarget=function(a){this.target=ExpedTargetUtil.getValidTarget(a)},this.updateTargetTypes=function(){this.expedTypes=[EXPED_TYPE.PAIQIAN],this.setTargetTypeRadioTexts()},this.updateTypeDesc=function(){TQ.setRichText(this.items.typedesc,rstr.expeddlg.lbl.paiqianplayertype)},this.updateMoveNeedTime=function(a){var b=this.g.getImgr().getBuildLevelByResId(BUILDCITY_ID.ALL,FIXID.ALLIINBUILD),c=a+.1*b*a,d=ExpedTargetUtil.getMoveNeedTime(this.g,this.target.pos,c);TQ.setText(this.items.needtime,TQ.formatTime(0,d))}}),SelfFieldTargetHdr=ExpedTargetHdr.extern(function(){this.updateTargetTypes=function(){this.expedTypes=[EXPED_TYPE.PAIQIAN],this.setTargetTypeRadioTexts()},this.updateTypeDesc=function(){TQ.setRichText(this.items.typedesc,rstr.expeddlg.lbl.paiqianfieldtype)},this.updateMoveNeedTime=function(a){var b=a*10,c=ExpedTargetUtil.getMoveNeedTime(this.g,this.target.pos,b);TQ.setText(this.items.needtime,TQ.formatTime(0,c))}}),OtherPlayerTargetHdr=ExpedTargetHdr.extern(function(){this.updateTargetTypes=function(){this.expedTypes=[EXPED_TYPE.TAOFA,EXPED_TYPE.CUIHUI,EXPED_TYPE.TIAOXIN],this.setTargetTypeRadioTexts()},this.updateTypeDesc=function(){var a="";this.isSameCountry()?this.selectType==EXPED_TYPE.TAOFA?TQ.setRichText(this.items.typedesc,rstr.expeddlg.lbl.taofaplayertype):this.selectType==EXPED_TYPE.CUIHUI?TQ.setRichText(this.items.typedesc,rstr.expeddlg.lbl.cuihuiplayertype):this.selectType==EXPED_TYPE.TIAOXIN&&TQ.setRichText(this.items.typedesc,rstr.expeddlg.lbl.tiaoxinplayertype):this.selectType==EXPED_TYPE.TAOFA?TQ.setRichText(this.items.typedesc,rstr.expeddlg.lbl.taofaplayertypeex):this.selectType==EXPED_TYPE.CUIHUI?TQ.setRichText(this.items.typedesc,rstr.expeddlg.lbl.cuihuiplayertypeex):this.selectType==EXPED_TYPE.TIAOXIN&&TQ.setRichText(this.items.typedesc,rstr.expeddlg.lbl.tiaoxinplayertypeex)},this._superUpdateMoveNeedTime=this.updateMoveNeedTime,this.updateMoveNeedTime=function(a){this.isSameCountry()?this.selectType==EXPED_TYPE.TIAOXIN?TQ.setText(this.items.needtime,TQ.formatTime(0,res_tiaoxin_needtime)):this._superUpdateMoveNeedTime(a):TQ.setText(this.items.needtime,TQ.formatTime(0,res_countryfight_needtime))},this.isCountryFight=function(){return!this.isSameCountry()},this.getCountryFightTip=function(){var a="",b=this.g.getImgr().getSvrCfg().honorcfg;return this.selectType==EXPED_TYPE.TAOFA?a=TQ.format(rstr.expeddlg.lbl.taofaplayertype_tip,b.taofa):this.selectType==EXPED_TYPE.CUIHUI?a=TQ.format(rstr.expeddlg.lbl.cuihuiplayertype_tip,b.cuihui):this.selectType==EXPED_TYPE.TIAOXIN&&(a=TQ.format(rstr.expeddlg.lbl.tiaoxinplayertype_tip,b.tiaoxin)),a+TQ.format(rstr.expeddlg.lbl.countryfight_desc,b.leveldiff)}}),OhterFieldTargetHdr=ExpedTargetHdr.extern(function(){this.updateTargetTypes=function(){this.expedTypes=[EXPED_TYPE.DANTIAO,EXPED_TYPE.ZHANLING],this.setTargetTypeRadioTexts()},this.updateTargetName=function(){TQ.setText(this.items.target,this.target.name)},this.udpateEnemyFightCap=function(){this.selectType==EXPED_TYPE.DANTIAO?TQ.setText(this.items.enemyfightcap,this.target.sfightcap):TQ.setText(this.items.enemyfightcap,this.target.fightcap)},this.updateTypeDesc=function(){this.selectType==EXPED_TYPE.DANTIAO?TQ.setRichText(this.items.typedesc,this.getDantiaoDropDesc()):this.selectType==EXPED_TYPE.ZHANLING&&TQ.setRichText(this.items.typedesc,rstr.expeddlg.lbl.zhanlingfieldtype)},this.getDantiaoDropDesc=function(){var a=this.target.roleId>0;if(a)return rstr.expeddlg.lbl.winOver+rstr.expeddlg.lbl.getOtherPlayerRes;var b=ItemResUtil.findFieldLevelres(this.target.resid,this.target.level),c=b.dantiaodrop;return rstr.expeddlg.lbl.winOver+DropItemUtil.getDesc(c)}}),CopyFieldTargetHdr=ExpedTargetHdr.extern(function(){this.updateTargetTypes=function(){this.expedTypes=[EXPED_TYPE.TAOFA],this.setTargetTypeRadioTexts()},this.updateMoveNeedTime=function(a){TQ.setText(this.items.needtime,TQ.formatTime(0,this.target.needtime))},this.updateTargetName=function(){var a=this.catTargetLevel(this.target.name);TQ.setText(this.items.target,a)},this.udpateEnemyFightCap=function(){TQ.setText(this.items.enemyfightcap,this.target.fightcap)},this.updateTypeDesc=function(){TQ.setRichText(this.items.typedesc,this.getTaofaDropDesc())},this.getTaofaDropDesc=function(){var a=ItemResUtil.findItemres(this.target.resid),b=a.taofadrop;return rstr.expeddlg.lbl.winOver+DropItemUtil.getDesc(b)}}),ExpedTargetHdrMgr=Class.extern(function(){var a=null,b=null,c=null,d=ExpedTargetUtil.createNull(),e=null,f=null,g=null,h=null,i=null,j=null,k=null;this.init=function(d,l){a=d,b=this,c=l,e=ExpedTargetChecker.snew(a),f=SameAlliPlayerTargetHdr.snew(a,l),g=SelfFieldTargetHdr.snew(a,l),h=OtherPlayerTargetHdr.snew(a,l),i=OhterFieldTargetHdr.snew(a,l),j=CopyFieldTargetHdr.snew(a,l),k=NullExpedTargetHdr.snew(a,l)},this.setTarget=function(a){d=ExpedTargetUtil.getValidTarget(a),e.setTarget(d),this.getTargetHdr().setTarget(d)},this.getTargetHdr=function(){return e.isSameAlliPlayer()?f:e.isSelfFieldTarget()?g:e.isOtherPlayer()?h:e.isOtherFieldTarget()?i:e.isCopyFieldTarget()?j:k}}),DropItemUtil=Class.extern(function(){var a=null;this.init=function(){a=!0},this.getDesc=function(a){var d="";return d+=b(a),d+=c(ItemResUtil.findItemres(a)),d},this.getProItemsDesc=function(a){var b=ItemResUtil.findItemres(a);if(!b.items)return"";var c="";for(var d=0;d<b.items.length;++d){var e=b.items[d];if(!e.id)continue;if(!e.pro)continue;c+=y(c),c+=v(e)}return c},this.getDropItems=function(a){var b=ItemResUtil.findItemres(a);if(!b.items)return[];var c=[];for(var d=0;d<b.items.length;++d){var e=b.items[d];if(!e.id)continue;if(!t(e))continue;if(e.minnum!=e.maxnum)continue;c.push({id:e.id,number:e.minnum})}return c},this.getSimpleDesc=function(c){a=!1;var d=b(c);return a=!0,d},this.getDescNoGainLbl=function(b){a=!1;var c=this.getDesc(b);return a=!0,c};var b=function(a){var b="",c=ItemResUtil.findItemres(a);return b+=e(c),b+=f(c),b+=g(c),b+=h(c),b+=i(c),b+=j(c),b+=k(c),b+=l(c),b+=m(c),b+=n(c),b+=o(c),b+=p(c),b+=q(c),b+=r(c),b+=s(c),b},c=function(a){var b="";if(!a.items)return b;for(var c=0;c<a.items.length;++c){var d=a.items[c];if(!d.id)continue;if(!t(d))continue;b+=x(b),b+=u(),b+=v(d),b+=w(rstr.dropdesc.numPrefix,d)}return b+=x(b),b},d=function(a,b,c){var d="";return a[c]?t(a[c])?(d+=u(),d+=b,d+=w(rstr.dropdesc.numAddPrefix,a[c]),d+=x(d),d):d:d},e=function(a){return d(a,rstr.dropdesc.roleexp,"roleexp")},f=function(a){return d(a,rstr.dropdesc.roleps,"roleps")},g=function(a){return d(a,rstr.dropdesc.heroexp,"heroexp")},h=function(a){return d(a,rstr.dropdesc.credit,"credit")},i=function(a){return d(a,rstr.dropdesc.iforce,"iforce")},j=function(a){return d(a,rstr.dropdesc.money,"money")},k=function(a){return d(a,rstr.dropdesc.fourres,"fourres")},l=function(a){return d(a,rstr.dropdesc.idlepopu,"idlepopu")},m=function(a){return d(a,rstr.dropdesc.giftgold,"giftgold")},n=function(a){return d(a,rstr.dropdesc.gold,"gold")},o=function(a){return d(a,rstr.dropdesc.allicontribute,"allicontribute")},p=function(a){return d(a,rstr.dropdesc.prestige,"prestige")},q=function(a){return d(a,rstr.dropdesc.statehonour,"statehonour")},r=function(a){return d(a,rstr.dropdesc.jibing1,"jibing1")},s=function(a){return d(a,rstr.dropdesc.xinbing,"xinbing")},t=function(a){return a.pro==100},u=function(){return a?rstr.dropdesc.mustget:""},v=function(a){var b=ItemResUtil.findItemres(a.id);return b.name},w=function(a,b){return b.minnum==b.maxnum?a+b.minnum:""},x=function(a){return a!=""?rstr.dropdesc.space:""},y=function(a){return a!=""?" ":""}}).snew()