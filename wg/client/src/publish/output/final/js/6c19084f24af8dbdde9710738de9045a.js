ACTOR_ATTR={STARTTIME:0,ENDTIME:1},ACTOR_ACTION={STAND:0,BUILDING:1};var EFF_ADDHP=1,EFF_SUBHP=2,EFF_ADDMP=3,EFF_SUBMP=4,EFF_DEAD=5,ZORDER_NORMAL=100,ZORDER_HPBAR=160,ZORDER_DFLAG=161,ZORDER_EFFECT=162,ZORDER_NUMBER=163;Actor=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y="unkown",z;this.init=function(a){b=this,this.reinit(a)},this.reinit=function(b){a=b,c=0,d=0,h=null,i=null,g={},j=!1,e={x:0,y:0},f={},n=[],k=[],l={},m=0,o=0,p=100,q=null,r=null,s=null,t=0,u=0},this.create=function(b,d,e,g){this.destroy(),this.reinit(a),c=b,o=d,w=e,v=g,h=a.getEntityfactory().alloc(g),z=ItemResUtil.findItemres(o),f[ATTR.AR]=z.attrange?{val:z.attrange,u:0}:{val:0,u:0},y=z.name,r=TQ.qfind(res_avatarclts,"id",o),s=r.acts.stand;var i=z.showlayer?z.showlayer:0;h.setZOrder(ZORDER_NORMAL+i),h.setSize({cx:w.cx,cy:w.cy}),this.resetImage()},this.destroy=function(){h!=null&&(a.getEntityfactory().free(h),h=null),i!=null&&(a.getEntityfactory().freePBar(i),i=null),q!=null&&(a.getEntityfactory().free(q),q=null);for(state in g){var b=g[state];if(b==null)continue;b.effect!=null&&a.getEntityfactory().free(b.effect)}g={}},this.getName=function(){return y},this.setName=function(a){y=a},this.setBuildCompleteCaller=function(a){x=a},this.setPos=function(a){e.x=a.x,e.y=a.y,h!=null&&h.setPos(e),i!=null&&i.setPos(e),q!=null&&q.setPos(e);for(state in g){var b=g[state];b.effect.setPos(e)}},this.getPos=function(){return e},this.addState=function(b,c){var d=TQ.qfind(res_stateeffects,"state",b),f=null;if(d!=null){f=a.getEntityfactory().allocEffect(v);var h=TQ.qfind(res_effectclts,"id",d.effectid),i=e.x+w.cx/2-h.corner.x,j=e.y+w.cy-h.corner.y;f.setSize(h.size),f.setPos({x:i,y:j});var k=getDirByAngle(h.dirs,t);f.setRes(d.effectid,k,0),f.setZOrder(ZORDER_EFFECT)}this.removeState(b),g[b]={effect:f,starttime:a.getCurTimeMs(),duration:c}},this.removeState=function(b){var c=g[b];c&&c.effect&&(a.getEntityfactory().freeEffect(c.effect),c.effect=null),c&&(g[b]=null)},this.update=function(a){for(state in g){var b=g[state];if(isNull(b))continue;if(a-b.starttime>=b.duration){this.removeState(state);break}}E(d)?this.showHPBar():(d==FACTOR_FLAG.SELF_BUIDING||d==FACTOR_FLAG.FRIEND_BUIDING)&&this.showBuildingBar()},this.show=function(){j=!0,h.show();for(state in g){var a=g[state];if(a==null)continue;a.effect.show()}},this.hide=function(){j=!1,h.hide();for(state in g){var a=g[state];if(a==null)continue;a.effect.hide()}},this.getSkills=function(){return k},this.setSkills=function(a){k=[];for(var b=0;b<a.length;++b)k.push(a[b])},this.getShortcutItems=function(){return l},this.setShortcutItems=function(a){TQ.dictCopy(l,a)},this.getMiscAttr=function(a){return n[a]},this.setMiscAttr=function(a,b){n[a]=b},this.getAttr=function(a){return f[a]},this.getAttrs=function(){return f},this.copyAttrs=function(a){TQ.dictCopy(f,a)},this.getFlag=function(){return d},this.setFlag=function(b){d=b,D(d)&&!i&&A(),q==null&&B();var c=parseInt(d/30,10),e=d%30;e==2?q.setImage("./images/"+a.getMode()+"/comm/hero"+c+".gif"):q.setImage("./images/"+a.getMode()+"/comm/army"+c+".gif")},this.getId=function(){return c},this.getResId=function(){return o},this.setAction=function(a){var b=a;C(d)&&(b="building"),s=r.acts[b],isNull(s)&&(s=r.acts[res_actdefaults[b]]),isNull(s)&&(s=r.acts.stand),isNull(s)&&(s={id:0,dirs:[0]}),m=getDirByAngle(s.dirs,t),this.resetImage(),u=F()},this.getActionSeq=function(){return u},this.setAngle=function(a){t=a,m=getDirByAngle(s.dirs,t),this.resetImage()},this.getAngle=function(){return t},this.resetImage=function(){if(!h)return;h.setRes(o,m,s.id)},this.showHPBar=function(){i==null&&A(),i.setVal(f[ATTR.HP].val),i.setMaxVal(f[ATTR.MHP].val)},this.showBuildingBar=function(){var c=parseInt(a.getSvrTimeMs()/1e3),e=n[ACTOR_ATTR.ENDTIME]-n[ACTOR_ATTR.STARTTIME],g=c-n[ACTOR_ATTR.STARTTIME];g<0&&(g=0),g>e&&(g=e),f[ATTR.HP].val=parseInt(g*f[ATTR.MHP].val/e),d==FACTOR_FLAG.SELF_BUIDING&&g==e&&x&&x.caller.call(x.self,b),this.showHPBar()},this.faceToPos=function(a){var b=calAngleByVector(e,a);this.setAngle(b)},this.getItemres=function(){return z};var A=function(){i=a.getEntityfactory().allocPBar(v),i.setSize({cx:w.cx,cy:5}),i.setBarBorder("./images/"+a.getMode()+"/comm/perbarbak45.gif"),i.setBarImage("./images/"+a.getMode()+"/comm/perbar45.gif"),i.setZOrder(ZORDER_HPBAR),i.setVal(0),i.setMaxVal(100)},B=function(){q=a.getEntityfactory().alloc(v),q.setSize({cx:w.cx,cy:w.cy}),q.setZOrder(ZORDER_DFLAG)},C=function(a){return a==FACTOR_FLAG.SELF_BUIDING||a==FACTOR_FLAG.FRIEND_BUIDING||a==FACTOR_FLAG.ENEMY_BUIDING},D=function(a){return a>=FACTOR_FLAG.SELF_BUIDING&&a<=FACTOR_FLAG.SELF_SOLDIER||a>=FACTOR_FLAG.FRIEND_BUIDING&&a<=FACTOR_FLAG.FRIEND_SOLDIER},E=function(a){return a>=FACTOR_FLAG.SELF_BUIDED&&a<=FACTOR_FLAG.SELF_SOLDIER||a>=FACTOR_FLAG.FRIEND_BUIDED&&a<=FACTOR_FLAG.FRIEND_SOLDIER},F=function(){return u<2147483647?u+1:0};this.init.apply(this,arguments)}