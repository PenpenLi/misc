VipDlg=BaseDlg.extern(function(){this._init=function(){this.payGold_=0,this.g_.regEvent(EVT.ROLEBASE,0,this,this._onRoleBaseResChange),this.g_.regEvent(EVT.NET,NETCMD.PAYGOLD,this,this._onPayGold)},this._getDlgCfg=function(){return{modal:!1,title:rstr.vipdlg.title,pos:{x:"center",y:40},uicfg:uicfg.vipdlg}},this._afterCreate=function(){this._setItems()},this._setCallers=function(){this.items_.payBtn.setCaller({self:this,caller:this._onClickPayBtn})},this._initInfo=function(){this._update()},this._update=function(){if(!this.isShow())return;this._updateVipLevelNumber(),this._updateVipProg(),this._updateCurLevelBlock()},this._updateVipLevelNumber=function(){IMG.setBKImage(this.items_.vipLevel,IMG.makeImg("vip/ui/"+this.imgr_.getVipLevel()+".png"))},this._updateVipProg=function(){var a=this._getVipProgRangeAndVal(),b=455,c=Math.round(b*a.val/a.range);TQ.setCSS(this.items_.vipProg,"width",c+"px"),TQ.setRichText(this.items_.payGold,a.val+"/"+a.range),this.imgr_.getVipLevel()<res_vip_max_level?TQ.setRichText(this.items_.vipProgDesc,TQ.format(rstr.vipdlg.progDesc,a.range-a.val,this.imgr_.getVipLevel()+1)):TQ.setRichText(this.items_.vipProgDesc,TQ.format(rstr.vipdlg.maxProgDesc,this.imgr_.getVipLevel()))},this._getVipProgRangeAndVal=function(){var a=this.imgr_.getVipLevel(),b=TQ.find(res_vip,"effid",VIP_EFF.PAY),c=0,d=0;return a<res_vip_max_level?(c=b.effs[a+1]-b.effs[a],d=this.payGold_-b.effs[a]):(c=b.effs[res_vip_max_level]-b.effs[res_vip_max_level-1],d=this.payGold_-b.effs[res_vip_max_level-1]),d>c&&(d=c),{val:d,range:c}},this._updateCurLevelBlock=function(){var a=196,b=634/res_vip_max_level,c=this.imgr_.getVipLevel();c==0?TQ.setCSS(this.items_.curLevel,"display","none"):(TQ.setCSS(this.items_.curLevel,"display","block"),TQ.setCSS(this.items_.curLevel,"left",a+Math.round(b*(c-1))+"px"))},this._setItems=function(){this.items_.effectList.setItemCount(res_vip.length-1);for(var a=0;a<this.items_.effectList.getCount();++a){var b=res_vip[a+1],c=this.items_.effectList.getItem(a);TQ.setRichText(c.exsubs.name,b.name);for(var d=1;d<=res_vip_max_level;++d){var e=b.effs[d];e==0?TQ.setClass(c.exsubs["level"+d],"noflag"):b.unit=="yesno"?TQ.setClass(c.exsubs["level"+d],"yesflag"):b.unit=="steel"?TQ.setRichText(c.exsubs["level"+d],rstr.vipdlg.steelNames[e]):b.unit=="item"?TQ.setRichText(c.exsubs["level"+d],TQ.format(rstr.vipdlg.itemName,d)):TQ.setRichText(c.exsubs["level"+d],TQ.format(b.unit,e)),TTIP.setCallerData(c.exsubs.tooltips["$level"+d],{self:this,caller:this._onGetTooltip},{unit:b.unit,val:e})}}},this._onClickPayBtn=function(){JMISC.openPayWnd()},this._onGetTooltip=function(a){if(a.unit!="item")return"";var b=a.val,c={id:0,resid:b,itemres:ItemResUtil.findItemres(b)};return TIPM.getItemDesc(c,"sys")},this._onRoleBaseResChange=function(){this._update()},this._onPayGold=function(a){var b=a.data;isNull(b.paygold)||(this.payGold_=b.paygold,this._update())}})