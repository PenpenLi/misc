var MIN_NEED_PRESTIGE=1e3;TaskResSchedule=Class.extern(function(){var a=4294967295;this.inited_=!1,this.roleTaskSchedule_=[],this.init=function(a){this.g_=a},this.initSchedule=function(){if(this.inited_)return;this._initTaskSchedule(),this.inited_=!0},this.updateRoleTasks=function(){var a=this.g_.getImgr().getRoleRes();for(var b=this.roleTaskSchedule_.length-1;b>=0;--b){var c=this.roleTaskSchedule_[b];a.level>=c.precond.roleLevel&&(this._notifyTask(c.id,TASK_STATE.CANDO),this.roleTaskSchedule_.splice(b,1))}},this._initTaskSchedule=function(){for(var a=0;a<res_tasks.length;++a){var b=res_tasks[a];b.type==TASK_TYPE.ROLE&&this.roleTaskSchedule_.push({id:b.id,precond:b.precond})}},this._notifyTask=function(a,b){if(TQ.find(this.g_.getImgr().getTask().actives,"id",a))return;if(TQ.find(this.g_.getImgr().getTask().roles,"id",a))return;this.g_.sendEvent({eid:EVT.NET,sid:NETCMD.TASK,data:{tasks:[{id:a,state:b}]}})}}),CheckAddFavoriteTask=JClass.ex({init:function(a){this.g_=a,TQ.addEvent(document,"keydown",function(b){b=b?b:window.event;var c=TQ.getKeyCode(b);return b.ctrlKey&&c==VK_KEY.D&&TaskSender.sendAddFavorite(a),!0})}}),TaskDlg=BaseDlg.extern(function(){var a=1,b=1e4;this.panels_={},this.taskResSchedule_=null,this.checkAddFavoriteTask_=null,this.hasNewTask_=!1,this.tabIdxs_={activity:0,growup:1,role:2,everyday:3},this.addFavoriteTiped_=!1,this.hasCanGetGifts=function(){for(var a in this.tabIdxs_)if(this._hasCanGetGift(a))return!0;return!1},this.selectTask=function(a,b){this._activeTab(a);var c=this.items_.tabs.getTabItems(this.items_.tabs.getActiveTab());c.list.setCurSel(b)},this._init=function(){this._createTabsPanels(),this.taskResSchedule_=TaskResSchedule.snew(this.g_),this.checkAddFavoriteTask_=CheckAddFavoriteTask.snew(this.g_),this.g_.regEvent(EVT.LOGIN_OK,0,this,this._onLoginOk),this.g_.regEvent(EVT.NET,NETCMD.TASK,this,this._onSvrTask),this.g_.regEvent(EVT.ROLEBASE,0,this,this._onRolebaseChange)},this._getDlgCfg=function(){return{modal:!1,title:rstr.task.taskdlg.title,pos:{x:"center",y:40},uicfg:uicfg.task.taskdlgex}},this._afterCreate=function(){this._createTabsContentSubDom(),this._initTabsPanels()},this._setCallers=function(){this.items_.tabs.setCaller({self:this,caller:this._onSelectTab})},this._createTabsContentSubDom=function(){var a=uicfg.task.taskdlgex.t_,b=a[5];for(var c=0;c<rstr.task.taskdlg.tabs.length;++c){var d=this.items_.tabs.getTabItems(c);d.content_desc=TQ.createDom("div"),d.content_reward=TQ.createDom("div"),TQ.setClass(d.content_reward,"reward"),TQ.append(d.content.getContainerObj(),d.content_desc),TQ.append(d.content.getContainerObj(),d.content_reward),d.content_reward.items={},this.g_.getGUI().buildDomItems(d.content_reward,b,a,d.content_reward.items)}},this._createTabsPanels=function(){this.panels_.activity=TaskDlgActPanel.snew(this.g_),this.panels_.growup=TaskDlgGrowupPanel.snew(this.g_),this.panels_.role=TaskDlgRolePanel.snew(this.g_),this.panels_.everyday=TaskDlgEveryDayPanel.snew(this.g_)},this._initTabsPanels=function(){for(var a in this.tabIdxs_)this.panels_[a].setItems(this.items_.tabs.getTabItems(this.tabIdxs_[a]))},this._initInfo=function(){this._update(),this._blinkingBtn(),this._activeTab(this.params_)},this._activeTab=function(a){var b=this.tabIdxs_[a];this.items_.tabs.activeTab(b?b:0)},this._blinkingBtn=function(){if(!this.hasNewTask_)return;UIM.getPanel("main").getToolbar().stopTaskBlinking(),this.items_.tabs.getTabBtn(a).startBlinking(b),this.hasNewTask_=!1},this._onLoginOk=function(){TaskSender.sendGetAllTasks(this.g_)},this._onSvrTask=function(a){if(a.data.tasks){var b=this.g_.getImgr().getTask();TQ.dictCopy(b.tasks,a.data.tasks),this._reorganizeTasks(),this.g_.sendEvent({eid:EVT.TASKCHANGE,sid:0}),HelpGuider.getNewcomerSpirit().refreshCurNewcomerTask()}else if(a.data.roleTask){var b=this.g_.getImgr().getTask();TQ.dictCopy(b.roleTask,a.data.roleTask),this.g_.sendEvent({eid:EVT.TASKCHANGE,sid:1})}else if(a.data.prestigeTask){var b=this.g_.getImgr().getTask();TQ.dictCopy(b.prestigeTask,a.data.prestigeTask),this.g_.sendEvent({eid:EVT.TASKCHANGE,sid:2})}else{if(a.data.startGTip){StartGlobalTip.snew(this.g_).openDlg();return}if(a.data.openTodayAct){UIM.openDlg("activityval"),this.g_.getImgr().setNewcomerHelpEnd();return}}this._update()},this._onRolebaseChange=function(){this.taskResSchedule_.initSchedule(),this.taskResSchedule_.updateRoleTasks()},this._onSelectTab=function(b){b==a&&this.items_.tabs.getTabBtn(a).stopBlinking()},this._update=function(){if(!this.isShow())return;for(var a in this.tabIdxs_){this.panels_[a].update();var b=this.tabIdxs_[a];this.items_.tabs.getTabBtn(b).setNewFlag(this._hasCanGetGift(a))}},this._hasCanGetGift=function(a){return this.panels_[a].hasCanGetGift()},this._reorganizeTasks=function(){var a=this.g_.getImgr().getTask().growups;this._initTasks(),this._collectTasks(),this._sortTasks(),this._blinkBtnWhenHasNewGrowups(a),this._tipAddFavoriteTask()},this._tipAddFavoriteTask=function(){if(this.addFavoriteTiped_)return;var a=this.g_.getImgr().getTask().actives;for(var b=0;b<a.length;++b){var c=a[b];c.itemres.id==FIXID.ADD_FAVORITE&&c.state==TASK_STATE.WAIT_COMPLETE&&(this.g_.getGUI().sysMsgTips2(SMT_NORMAL,c.itemres.desc),this.addFavoriteTiped_=!0)}},this._initTasks=function(){var a=this.g_.getImgr().getTask();a.actives=[],a.growups=[],a.subGrowups=[],a.roles=[],a.everydays=[],a.activityVals=[]},this._collectTasks=function(){var a=this.g_.getImgr().getTask();for(var b=0;b<a.tasks.length;++b){var c=a.tasks[b];c.itemres||(c.itemres=ItemResUtil.findTaskRes(c.id)),c.itemres||(c.itemres=ItemResUtil.findTaskRes(Math.floor(c.id/100)));if(!c.itemres)continue;if(c.state==TASK_STATE.COMPLETE&&c.itemres.fixShow==0)continue;c.itemres.type==TASK_TYPE.ACTIVE?(!TQ.isMobile()||c.itemres.id!=FIXID.ADD_FAVORITE)&&a.actives.push(c):c.itemres.type==TASK_TYPE.GROWUP?a.growups.push(c):c.itemres.type==TASK_TYPE.SUBGROWUP?a.subGrowups.push(c):c.itemres.type==TASK_TYPE.ROLE?a.roles.push(c):c.itemres.type==TASK_TYPE.EVERYDAY?a.everydays.push(c):c.itemres.type==TASK_TYPE.ACTIVITYVAL&&a.activityVals.push(c)}},this._sortTasks=function(){var a=this.g_.getImgr().getTask();a.actives.sort(G_ID_ASCCOMP),a.growups.sort(G_ID_ASCCOMP),a.subGrowups.sort(G_ID_ASCCOMP),a.roles.sort(G_ID_ASCCOMP),a.everydays.sort(function(a,b){return a.id%100-b.id%100}),a.activityVals.sort(G_ID_ASCCOMP)},this._blinkBtnWhenHasNewGrowups=function(c){if(!this._hasNewGrowupTask(c))return;this.isShow()?this.items_.tabs.getActiveTab()!=a&&this.items_.tabs.getTabBtn(a).startBlinking(b):(UIM.getPanel("main").getToolbar().startTaskBlinking(b),this.hasNewTask_=!0)},this._hasNewGrowupTask=function(a){var b=this.g_.getImgr().getTask();for(var c=0;c<b.growups.length;++c){var d=b.growups[c];if(!TQ.qfind(a,"id",d.id))return!0}return!1}}),TaskDlgBaseList=Class.extern(function(){this.g_=null,this.list_=null,this.init=function(a,b){this.g_=a,this.list_=b},this.setCaller=function(a){this.list_.setCaller(a)},this.update=function(a,b){this._updateListItems(a),b&&this._resetCurSel()},this._updateListItems=function(a){this.list_.setItemCount(a.length);for(var b=0;b<this.list_.getCount();++b){var c=this.list_.getItem(b),d=a[b];TQ.setTextEx(c.exsubs.name,d.itemres.name),TQ.setClass(c.exsubs.state,this._getStateCssClass(d.state)),TQ.setTextEx(c.exsubs.state,rstr.task.taskdlg.states[d.state])}},this._resetCurSel=function(){var a=this.list_.getCurSel();a>=this.list_.getCount()?this.list_.setCurSel(0):a<0&&this.list_.getCount()>0?this.list_.setCurSel(0):this.list_.setCurSel(a)},this._getStateCssClass=function(a){var b=["wait_complete_state","wait_get_state","complete_state","cannotdo_state","cando_state","doing_state"];return b[a]}}),TaskDlgBaseContent=Class.extern(function(){this.g_=null,this.items_=null,this.init=function(a,b){this.g_=a,this.items_=b},this.update=function(a,b,c,d){this._updateContentDesc(a,b,c),this._updateContentReward(a,d),this.items_.content.refresh()},this._updateContentDesc=function(a,b,c){if(!a){TQ.setHtml(this.items_.content_desc,"");return}var d="";for(var e=0;e<c.length;++e){var f=c[e];f=="name"?d+=this._makeNameDiv(b,a):f=="time"?d+=this._makeTimeDiv(b,a):f=="help"?d+=this._makeHelpDiv(b,a):f=="desc"?d+=this._makeDescDiv(b,a):f=="precond"?d+=this._makePrecondDiv(b,a):f=="difficulty"?d+=this._makeDifficultyDiv(b,a):f=="detaildesc"?d+=this._makeDetailDescDiv(b,a):f=="target"&&(d+=this._makeTargetDiv(b,a))}TQ.setHtml(this.items_.content_desc,d)},this._makeNameDiv=function(a,b){return this._makeDivStr("detailname",a.name+b.itemres.dname)},this._makeTimeDiv=function(a,b){if(b.itemres.time.duration==0)return this._makeDivStr("time",a.time+rstr.task.taskdlg.content.longDuration);var c=b.itemres.time.start;if(c==TASK_STARTTIME.SVR_OPEN)c=this.g_.getImgr().getRoleRes().svrOpenTime;else if(c>=TASK_STARTTIME.FIRST_LOGIN&&c<=TASK_STARTTIME.MAX_FIRST_LOGIN){var d=c-TASK_STARTTIME.FIRST_LOGIN;c=this.g_.getImgr().getRoleRes().firstLoginTime+d*24*3600}var e=TQ.formatDateTime(c),f=TQ.formatDateTime(c+b.itemres.time.duration),g=TQ.format(rstr.task.taskdlg.content.timeToTimeFmt,e,f);return this._makeDivStr("time",a.time+g)},this._makeHelpDiv=function(a,b){return this._makeDivStr("help",a.help+b.itemres.help)},this._makeDescDiv=function(a,b){return this._makeDivStr("desc",a.desc+b.itemres.desc)},this._makePrecondDiv=function(a,b){var c=a.precond+TQ.format(rstr.task.taskdlg.content.taskPrecondFmt,b.itemres.precond.roleLevel);return b.state==TASK_STATE.CANNOTDO?this._makeDivStr("precond precond_noenough",c):this._makeDivStr("precond precond_enough",c)},this._makeDifficultyDiv=function(a,b){var c="";for(var d=0;d<b.itemres.difficulty;++d)c+=rstr.comm.star;return this._makeDivStr("difficulty",a.difficulty+c)},this._makeDetailDescDiv=function(a,b){var c=TQ.format(rstr.task.taskdlg.content.taskDDescFmt,b.itemres.needps,this._getRoleTaskNeedTime(b),this._getRoleTaskCDTime(b));return this._makeDivStr("detaildesc",c)},this._getRoleTaskNeedTime=function(a){return this.g_.getImgr().hasVipEffect(VIP_EFF.SPEED_ROLETASK)?TQ.format(rstr.task.taskdlg.lbl.vipimm,this.g_.getImgr().getVipLevel()):TQ.formatTime(0,a.itemres.needtime)},this._getRoleTaskCDTime=function(a){return this.g_.getImgr().hasVipEffect(VIP_EFF.SPEED_ROLETASK)?TQ.format(rstr.task.taskdlg.lbl.vipimm,this.g_.getImgr().getVipLevel()):TQ.formatTime(0,a.itemres.cdtime)},this._makeTargetDiv=function(a,b){return this._makeDivStr("target",a.target+b.itemres.targetDesc)},this._updateContentReward=function(a,b){if(!a){TQ.setCSS(this.items_.content_reward,"display","none");return}TQ.setCSS(this.items_.content_reward,"display","block"),TQ.setHtml(this.items_.content_reward.items.desc,b+this._getRewardDesc(a));var c=this._getRewardItems(a),d=this.items_.content_reward.items.rewardList;d.setItemCount(c.length);for(var e=0;e<d.getCount();++e){var f=d.getItem(e),g=c[e],h=ItemResUtil.findItemres(g.id);CommDrawItem.drawItemIcon(f.exsubs.icon,h),TQ.setTextEx(f.exsubs.number,rstr.comm.numPrefix+g.number),TTIP.setCallerData(f.exsubs.tooltips[TIP_PREFIX+"item"],{self:this,caller:this._onGetRewardItemTip},{itemRes:h})}},this._getRewardDesc=function(a){return DropItemUtil.getSimpleDesc(a.itemres.dropId)},this._getRewardItems=function(a){return DropItemUtil.getDropItems(a.itemres.dropId)},this._onGetRewardItemTip=function(a){return TIPM.getItemDesc({id:0,itemres:a.itemRes},"sys")},this._makeDivStr=function(a,b){return'<div class="'+a+'">'+b+"</div>"}}),TaskDlgBaseOpBtn=Class.extern(function(){this.g_=null,this.items_=null,this.task_=null,this.init=function(a,b){this.g_=a,this.items_=b,this._setCaller()},this.update=function(a){this.task_=a,!a||a.state==TASK_STATE.WAIT_COMPLETE?(this.items_.getRewardBtn.enable(!1),this.items_.getRewardBtn.setText(rstr.task.taskdlg.btn.getReward)):a.state==TASK_STATE.WAIT_GET?(this.items_.getRewardBtn.enable(!0),this.items_.getRewardBtn.setText(rstr.task.taskdlg.btn.getReward)):(this.items_.getRewardBtn.enable(!1),this.items_.getRewardBtn.setText(rstr.task.taskdlg.btn.completed))},this._setCaller=function(){this.items_.getRewardBtn.setCaller({self:this,caller:this._onClickGetRewardBtn})},this._onClickGetRewardBtn=function(){TaskSender.sendGetReward(this.g_,this.task_.id)}}),TaskDlgBasePanel=JClass.ex({hasCanGetGift:function(){var a=this._getTasks();for(var b=0;b<a.length;++b){var c=a[b];if(c.state==TASK_STATE.WAIT_GET)return!0;if(c.state==TASK_STATE.CANDO&&this._isCanDoRoleTask(c))return!0}return!1},_isCanDoRoleTask:function(a){var b=ItemResUtil.findTaskRes(a.id),c=this.g_.getImgr().getTask().roleTask,d=this.g_.getImgr().getRoleAttrVal(ATTR.PS);return c.doing.id==0&&c.cdStopTime==0&&d>=b.needps}}),TaskDlgActPanel=TaskDlgBasePanel.ex({init:function(a){this.g_=a,this.items_=null,this.listComponent_=null,this.contentComponent_=null,this.opBtnComponent_=null},setItems:function(a){this.items_=a,this._createComponents(),this._setCaller()},update:function(){this.listComponent_.update(this._getTasks(),!0)},_getTasks:function(){return this.g_.getImgr().getTask().actives},_createComponents:function(){this.listComponent_=TaskDlgBaseList.snew(this.g_,this.items_.list),this.contentComponent_=TaskDlgBaseContent.snew(this.g_,this.items_),this.opBtnComponent_=TaskDlgBaseOpBtn.snew(this.g_,this.items_)},_setCaller:function(){this.listComponent_.setCaller({self:this,caller:this._onClickListItem}),this.items_.paygold.setCaller({self:this,caller:this._onClickPayGold})},_onClickListItem:function(a,b){var c=this.g_.getImgr().getTask().actives[b];this.contentComponent_.update(c,this._getContenLbls(),this._getCanShowLbls(),this._getRewardLbl()),this.opBtnComponent_.update(c)},_onClickPayGold:function(){JMISC.openPayWnd()},_getContenLbls:function(){return{name:rstr.task.taskdlg.content.name,time:rstr.task.taskdlg.content.activeTime,desc:rstr.task.taskdlg.content.activeDesc,target:rstr.task.taskdlg.content.activeTarget}},_getCanShowLbls:function(){return["name","time","desc","target"]},_getRewardLbl:function(){return rstr.task.taskdlg.content.activeReward}}),TaskDlgGrowupPanel=TaskDlgBasePanel.ex({init:function(a){this.g_=a,this.items_=null,this.listComponent_=null,this.subListComponent_=null,this.contentComponent_=null,this.opBtnComponent_=null},setItems:function(a){this.items_=a,this._createComponents(),this._setCaller()},update:function(){var a=this.items_.list.getCurSel(),b=this.items_.subList.getCurSel(),c=a<0&&b<0,d=a>=0,e=b>=0;this.listComponent_.update(this.g_.getImgr().getTask().growups,c||d),this.subListComponent_.update(this.g_.getImgr().getTask().subGrowups,e)},_getTasks:function(){var a=[];for(var b=0;b<this.g_.getImgr().getTask().growups.length;++b)a.push(this.g_.getImgr().getTask().growups[b]);for(var b=0;b<this.g_.getImgr().getTask().subGrowups.length;++b)a.push(this.g_.getImgr().getTask().subGrowups[b]);return a},_createComponents:function(){this.listComponent_=TaskDlgBaseList.snew(this.g_,this.items_.list),this.subListComponent_=TaskDlgBaseList.snew(this.g_,this.items_.subList),this.contentComponent_=TaskDlgBaseContent.snew(this.g_,this.items_),this.opBtnComponent_=TaskDlgBaseOpBtn.snew(this.g_,this.items_)},_setCaller:function(){this.listComponent_.setCaller({self:this,caller:this._onClickListItem}),this.subListComponent_.setCaller({self:this,caller:this._onClickSubListItem})},_onClickListItem:function(a,b){b>=0&&this.items_.subList.setCurSel(-1),this._updateContent(this.g_.getImgr().getTask().growups[b])},_onClickSubListItem:function(a,b){b>=0&&this.items_.list.setCurSel(-1),this._updateContent(this.g_.getImgr().getTask().subGrowups[b])},_updateContent:function(a){this.contentComponent_.update(a,this._getContenLbls(),this._getCanShowLbls(),this._getRewardLbl()),this.opBtnComponent_.update(a)},_getContenLbls:function(){return{desc:rstr.task.taskdlg.content.growupDesc,help:rstr.task.taskdlg.content.growupHelp,target:rstr.task.taskdlg.content.growupTarget}},_getCanShowLbls:function(){return["desc","help","target"]},_getRewardLbl:function(){return rstr.task.taskdlg.content.growupReward}}),TaskDlgRoleOpBtn=Class.extern(function(){this.g_=null,this.items_=null,this.task_=null,this.init=function(a,b){this.g_=a,this.items_=b,this._setCaller()},this.update=function(a){this.task_=a;var b=this.g_.getImgr().getTask().roleTask;b.doing.id>0?(this._showBtnParent(this.items_.speedBtn),this._hideBtnParent(this.items_.doBtn)):b.cdStopTime>0?(this._hideBtnParent(this.items_.speedBtn),this._hideBtnParent(this.items_.doBtn)):!a||a.state==TASK_STATE.CANNOTDO?(this._hideBtnParent(this.items_.speedBtn),this._hideBtnParent(this.items_.doBtn)):a.state==TASK_STATE.CANDO?(this._hideBtnParent(this.items_.speedBtn),this._showBtnParent(this.items_.doBtn)):a.state==TASK_STATE.DOING&&(this._hideBtnParent(this.items_.speedBtn),this._hideBtnParent(this.items_.doBtn))},this._showBtnParent=function(a){TQ.setCSS(a.getParent(),"display","block"),a.show()},this._hideBtnParent=function(a){TQ.setCSS(a.getParent(),"display","none"),a.hide()},this._setCaller=function(){this.items_.doBtn.setCaller({self:this,caller:this._onClickDoTaskBtn}),this.items_.speedBtn.setCaller({self:this,caller:this._onClickSpeedBtn}),this.items_.useItemBtn.setCaller({self:this,caller:this._onClickUseItemBtn})},this._onClickDoTaskBtn=function(){TaskSender.sendDoRoleTask(this.g_,this.task_.id)},this._onClickSpeedBtn=function(){var a=this.g_.getImgr().getTask().roleTask.doing.stopTime;UIM.getDlg("uselistitem").openDlg([RES_EFF.ACC_DOINGROLETASK],{id:0,stoptime:a,name:rstr.task.taskdlg.roleTask,type:RES_TRG.SELF_ROLE})},this._onClickUseItemBtn=function(){var a=[3000018,3000019];UIM.getDlg("uselistitem").openDlgByItemIds(rstr.useitem.filterdlg.title.addPs,rstr.useitem.filterdlg.btn.useItem,a,{id:0,name:"",type:RES_TRG.SELF_ROLE})}}),TaskDlgRoleContent=TaskDlgBaseContent.extern(function(){this._getRewardDesc=function(a){return TQ.format(rstr.task.taskdlg.content.roleTaskReward,a.itemres.roleExp,a.itemres.multiple)},this._getRewardItems=function(a){return[]}}),TaskDlgRolePanel=TaskDlgBasePanel.ex({init:function(a){this.g_=a,this.items_=null,this.listComponent_=null,this.contentComponent_=null,this.opBtnComponent_=null},setItems:function(a){this.items_=a,this._createComponents(),this._setCaller(),this._regEvent(),this.g_.regUpdater(this,this._onUpdate,1e3)},update:function(){this.listComponent_.update(this._getTasks(),!0),this._updateRolePs(),this._updateDoingInfo()},_getTasks:function(){return this.g_.getImgr().getTask().roles},_updateRolePs:function(){var a=this.g_.getImgr().getRoleAttrVal(ATTR.PS);TQ.setTextEx(this.items_.rolePs,TQ.format(rstr.task.taskdlg.roleps,a))},_updateDoingInfo:function(){TQ.setTextEx(this.items_.doingInfo,""),this._updateDoingTask(),this._updateTaskCDTime()},_updateDoingTask:function(){var a=this.g_.getImgr().getTask().roleTask.doing;if(a.id==0)return;var b=ItemResUtil.findTaskRes(a.id),c=a.stopTime-this.g_.getSvrTimeS(),d="";c>0&&(d=TQ.format(rstr.task.taskdlg.content.doingRoleTask,b.name,TQ.formatTime(0,c))),TQ.setTextEx(this.items_.doingInfo,d)},_updateTaskCDTime:function(){var a=this.g_.getImgr().getTask().roleTask.cdStopTime;if(a==0)return;var b=a-this.g_.getSvrTimeS(),c="";b>0&&(c=TQ.format(rstr.task.taskdlg.content.roleTaskCD,TQ.formatTime(0,b))),TQ.setTextEx(this.items_.doingInfo,c)},_createComponents:function(){this.listComponent_=TaskDlgBaseList.snew(this.g_,this.items_.list),this.contentComponent_=TaskDlgRoleContent.snew(this.g_,this.items_),this.opBtnComponent_=TaskDlgRoleOpBtn.snew(this.g_,this.items_)},_setCaller:function(){this.listComponent_.setCaller({self:this,caller:this._onClickListItem})},_regEvent:function(){this.g_.regEvent(EVT.ROLEBASE,0,this,this._onRolebaseChange)},_onClickListItem:function(a,b){var c=this.g_.getImgr().getTask().roles[b];this.contentComponent_.update(c,this._getContenLbls(),this._getCanShowLbls(),this._getRewardLbl()),this.opBtnComponent_.update(c)},_onRolebaseChange:function(){this._updateRolePs()},_onUpdate:function(){this._updateDoingInfo()},_getContenLbls:function(){return{desc:rstr.task.taskdlg.content.taskDesc,precond:rstr.task.taskdlg.content.taskPrecond,detaildesc:rstr.task.taskdlg.content.taskDetailDesc}},_getCanShowLbls:function(){return["desc","precond","detaildesc"]},_getRewardLbl:function(){return rstr.task.taskdlg.content.taskReward}}),TaskDlgEveryDayOpBtn=Class.extern(function(){var a=null;this.g_=null,this.items_=null,this.task_=null,this.baseOpBtn=null,this.init=function(b,c){a=this,this.g_=b,this.items_=c,this.baseOpBtn=TaskDlgBaseOpBtn.snew(this.g_,this.items_),this._setCaller()},this.update=function(a){this.task_=a,this.baseOpBtn.update(a),a&&a.state==TASK_STATE.WAIT_COMPLETE?(this.items_.changeTaskBtn.show(),this.items_.immediatelyBtn.show()):a&&a.state==TASK_STATE.WAIT_GET?this.items_.changeTaskBtn.show():(this.items_.changeTaskBtn.hide(),this.items_.immediatelyBtn.hide())},this._setCaller=function(){this.items_.changeTaskBtn.setCaller({self:this,caller:this._onClickChangeTaskBtn}),this.items_.immediatelyBtn.setCaller({self:this,caller:this._onClickImmediatelyBtn})},this._onClickChangeTaskBtn=function(){this.g_.getGUI().msgBox(rstr.comm.msgts,rstr.task.taskdlg.tip.changeEverydayTask,MB_F_YESNO,{self:this,caller:function(b){b==MB_IDYES&&TaskSender.sendChangeEverydayTask(a.g_,a.task_.id)}})},this._onClickImmediatelyBtn=function(){this.g_.getGUI().msgBox(rstr.comm.msgts,rstr.task.taskdlg.tip.completeEverydayTask,MB_F_YESNO,{self:this,caller:function(b){b==MB_IDYES&&TaskSender.sendCompleteEverydayTask(a.g_,a.task_.id)}})}}),GetGiftByPrestigeChecker=JClass.ex({_init:function(a){this._g=a},hasCanGetGift:function(){var a=this._g.getImgr().getRoleRes().prestige>=MIN_NEED_PRESTIGE,b=this._g.getImgr().getTask().prestigeTask,c=TQ.isSameDay(this._g.getSvrTimeS(),b.lastTime);return a&&!c}}),TaskDlgPrestigePanel=TaskDlgBasePanel.ex({init:function(a,b){this.g_=a,this.items_=null},setItems:function(a){this.items_=a,this.g_.regEvent(EVT.ROLEBASE,0,this,this._onRolebaseChange),this.items_.getByPrestige.setCaller({self:this,caller:this._onClickGetByPrestigeBtn})},update:function(){this._updatePrestige(),this._updateBtnState()},hasCanGetGift:function(){return GetGiftByPrestigeChecker.snew(this.g_).hasCanGetGift()},_onRolebaseChange:function(){this._updatePrestige()},_onClickGetByPrestigeBtn:function(){this.g_.getImgr().getRoleRes().prestige<MIN_NEED_PRESTIGE?this.g_.getGUI().msgBox(rstr.comm.msgts,rstr.task.taskdlg.tip.noEnoughPrestige,MB_F_CLOSE,null):TaskSender.sendGetRewardByPrestige(this.g_)},_updatePrestige:function(){TQ.setTextEx(this.items_.prestige,rstr.task.taskdlg.prestige+this.g_.getImgr().getRoleRes().prestige)},_updateBtnState:function(){var a=this.g_.getImgr().getTask().prestigeTask,b=TQ.isSameDay(this.g_.getSvrTimeS(),a.lastTime);this.items_.getByPrestige.enable(!b)}}),TaskDlgEveryDayPanel=TaskDlgBasePanel.ex({init:function(a){this.g_=a,this.items_=null,this.listComponent_=null,this.contentComponent_=null,this.opBtnComponent_=null,this.prestigePanel_=TaskDlgPrestigePanel.snew(this.g_)},setItems:function(a){this.items_=a,this._createComponents(),this._setCaller()},update:function(){var a=this._getTasks();if(this._isChangedBefore(a))return;this.listComponent_.update(a,!0),this.prestigePanel_.update()},hasCanGetGift:function(){return this._super.hasCanGetGift.call(this)||this.prestigePanel_.hasCanGetGift()},_getTasks:function(){return this.g_.getImgr().getTask().everydays},_createComponents:function(){this.listComponent_=TaskDlgBaseList.snew(this.g_,this.items_.list),this.contentComponent_=TaskDlgBaseContent.snew(this.g_,this.items_),this.opBtnComponent_=TaskDlgEveryDayOpBtn.snew(this.g_,this.items_),this.prestigePanel_.setItems(this.items_)},_setCaller:function(){this.listComponent_.setCaller({self:this,caller:this._onClickListItem})},_onClickListItem:function(a,b){var c=this.g_.getImgr().getTask().everydays[b];this.contentComponent_.update(c,this._getContenLbls(),this._getCanShowLbls(),this._getRewardLbl()),this.opBtnComponent_.update(c)},_getContenLbls:function(){return{desc:rstr.task.taskdlg.content.taskDesc,help:rstr.task.taskdlg.content.taskHelp,difficulty:rstr.task.taskdlg.content.taskDifficulty,target:rstr.task.taskdlg.content.taskTarget}},_getCanShowLbls:function(){return["desc","help","difficulty","target"]},_getRewardLbl:function(){return rstr.task.taskdlg.content.activeReward},_isChangedBefore:function(a){return a.length<res_everyday_task_cnt&&a.length>0}})