CommBuildUpdater=Class.extern(function(){var a=null,b=null,c=null,d=null,e=null,f=null,g=null;this.init=function(g,h){a=g,b=this,c=h,d=c.list,e=c.rlist?c.rlist:null,f=c.rgroupList?c.rgroupList:null},this.update=function(){e?h():f&&i()};var h=function(){d.setItemCount(e.length);var a=0,b=j(a,0,e);d.setItemCount(b)},i=function(){var a=0;d.setItemCount(k());for(var b=0;b<f.length;++b)a=j(a,b,f[b]);d.setItemCount(a)},j=function(a,b,c){var e=a;for(var f=0;f<c.length;++f){var g=c[f];if(g.state==0)continue;var h=d.getItem(e++);m(l(b,f),h,g)}return e},k=function(){var a=0;for(var b=0;b<f.length;++b)a+=f[b].length;return a},l=function(a,b){return a*1e4+b},m=function(a,b,d){for(var e=0;e<c.needitems.length;++e){var f=c.needitems[e],g=n(f);g(a,b,d)}},n=function(a){g||(g={icon:o,stop:p,name:q,state:r,levelstate:s,number:t,lefttime:u,curlevel:v,goallevel:w,opbtn:x,"null":function(){}});var b=g[a];return b||(b=g["null"]),b},o=function(a,b,c){IMG.setBKImage(b.exsubs.icon,IMG.makeSmallImg(c.itemres.smallpic))},p=function(b,d,e){if(e.state!=BUILD_STATE.UPGRADE&&e.state!=BUILD_STATE.DOWN)return;if(!c.sendStopCmdToSvr)return;if(e.stoptime>a.getSvrTimeS())return;E(e)},q=function(a,b,c){TQ.setTextEx(b.exsubs.name,c.itemres.name),TQ.setClass(b.exsubs.name,F(c))},r=function(a,b,d){c.getStateName!=null?TQ.setTextEx(b.exsubs.state,c.getStateName(d,B(a))):d.level==0&&d.state==BUILD_STATE.UPGRADE?TQ.setTextEx(b.exsubs.state,c.firststatefmt):TQ.setTextEx(b.exsubs.state,c.statefmt[d.state]),TQ.setClass(b.exsubs.state,F(d))},s=function(a,b,c){TQ.setTextEx(b.exsubs.levelstate,c.level+"->"+D(c)),TQ.setClass(b.exsubs.levelstate,F(c))},t=function(a,b,c){TQ.setTextEx(b.exsubs.levelstate,TQ.format(rstr.soldierdlg.recruitnum,c.number)),TQ.setClass(b.exsubs.levelstate,F(c))},u=function(b,c,d){var e=0;if(d.state==BUILD_STATE.UPGRADE||d.state==BUILD_STATE.DOWN)leftTime=Math.max(0,d.stoptime-a.getSvrTimeS()),e=leftTime;TQ.setTextEx(c.exsubs.lefttime,TQ.formatTime(0,e)),TQ.setClass(c.exsubs.lefttime,F(d))},v=function(a,b,c){TQ.setTextEx(b.exsubs.curlevel,c.level),TQ.setClass(b.exsubs.curlevel,F(c))},w=function(a,b,c){TQ.setTextEx(b.exsubs.nextlevel,D(c)),TQ.setClass(b.exsubs.nextlevel,F(c))},x=function(a,c,d){c.exsubs.opspeed.setId(a),c.exsubs.opcancel.setId(a),c.exsubs.opspeed.setCaller({self:b,caller:y}),c.exsubs.opcancel.setCaller({self:b,caller:z})},y=function(a){var b=A(a),d=Math.floor(a/1e4);c.opspeed(b,B(a))},z=function(a){var b=A(a);c.opcancel(b,B(a))},A=function(a){return e?e[a]:f?f[B(a)][C(a)]:(alert("error: 59030235"),null)},B=function(a){return Math.floor(a/1e4)},C=function(a){return a%1e4},D=function(a){return typeof a.level!="number"?a.level:a.state==BUILD_STATE.UPGRADE?a.level+1:a.state==BUILD_STATE.DOWN?a.level-1:a.level},E=function(a){c.sendStopCmdToSvr(a)},F=function(a){return a&&a.isCulture?"comm_yellowfont":"comm_whitefont"}})